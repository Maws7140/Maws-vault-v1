"use strict";var J=Object.defineProperty;var H=(o,s,e)=>s in o?J(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var p=(o,s,e)=>H(o,typeof s!="symbol"?s+"":s,e);const obsidian=require("obsidian"),state=require("@codemirror/state"),view=require("@codemirror/view"),language=require("@codemirror/language");var store;function getGlobalConfig(o){return{lang:(o==null?void 0:o.lang)??(store==null?void 0:store.lang),message:o==null?void 0:o.message,abortEarly:(o==null?void 0:o.abortEarly)??(store==null?void 0:store.abortEarly),abortPipeEarly:(o==null?void 0:o.abortPipeEarly)??(store==null?void 0:store.abortPipeEarly)}}var store2;function getGlobalMessage(o){return store2==null?void 0:store2.get(o)}var store3;function getSchemaMessage(o){return store3==null?void 0:store3.get(o)}var store4;function getSpecificMessage(o,s){var e;return(e=store4==null?void 0:store4.get(o))==null?void 0:e.get(s)}function _stringify(o){var e,t;const s=typeof o;return s==="string"?`"${o}"`:s==="number"||s==="bigint"||s==="boolean"?`${o}`:s==="object"||s==="function"?(o&&((t=(e=Object.getPrototypeOf(o))==null?void 0:e.constructor)==null?void 0:t.name))??"null":s}function _addIssue(o,s,e,t,n){const r=n&&"input"in n?n.input:e.value,i=(n==null?void 0:n.expected)??o.expects??null,a=(n==null?void 0:n.received)??_stringify(r),l={kind:o.kind,type:o.type,input:r,expected:i,received:a,message:`Invalid ${s}: ${i?`Expected ${i} but r`:"R"}eceived ${a}`,requirement:o.requirement,path:n==null?void 0:n.path,issues:n==null?void 0:n.issues,lang:t.lang,abortEarly:t.abortEarly,abortPipeEarly:t.abortPipeEarly},c=o.kind==="schema",d=(n==null?void 0:n.message)??o.message??getSpecificMessage(o.reference,l.lang)??(c?getSchemaMessage(l.lang):null)??t.message??getGlobalMessage(l.lang);d!==void 0&&(l.message=typeof d=="function"?d(l):d),c&&(e.typed=!1),e.issues?e.issues.push(l):e.issues=[l]}function _getStandardProps(o){return{version:1,vendor:"valibot",validate(s){return o["~run"]({value:s},getGlobalConfig())}}}function _isValidObjectKey(o,s){return Object.hasOwn(o,s)&&s!=="__proto__"&&s!=="prototype"&&s!=="constructor"}function _joinExpects(o,s){const e=[...new Set(o)];return e.length>1?`(${e.join(` ${s} `)})`:e[0]??"never"}var ValiError=class extends Error{constructor(o){super(o[0].message),this.name="ValiError",this.issues=o}};function getFallback(o,s,e){return typeof o.fallback=="function"?o.fallback(s,e):o.fallback}function getDefault(o,s,e){return typeof o.default=="function"?o.default(s,e):o.default}function getDefaults(o){if("entries"in o){const s={};for(const e in o.entries)s[e]=getDefaults(o.entries[e]);return s}return"items"in o?o.items.map(getDefaults):getDefault(o)}function array(o,s){return{kind:"schema",type:"array",reference:array,expects:"Array",async:!1,item:o,message:s,get"~standard"(){return _getStandardProps(this)},"~run"(e,t){var r;const n=e.value;if(Array.isArray(n)){e.typed=!0,e.value=[];for(let i=0;i<n.length;i++){const a=n[i],l=this.item["~run"]({value:a},t);if(l.issues){const c={type:"array",origin:"value",input:n,key:i,value:a};for(const d of l.issues)d.path?d.path.unshift(c):d.path=[c],(r=e.issues)==null||r.push(d);if(e.issues||(e.issues=l.issues),t.abortEarly){e.typed=!1;break}}l.typed||(e.typed=!1),e.value.push(l.value)}}else _addIssue(this,"type",e,t);return e}}}function boolean(o){return{kind:"schema",type:"boolean",reference:boolean,expects:"boolean",async:!1,message:o,get"~standard"(){return _getStandardProps(this)},"~run"(s,e){return typeof s.value=="boolean"?s.typed=!0:_addIssue(this,"type",s,e),s}}}function literal(o,s){return{kind:"schema",type:"literal",reference:literal,expects:_stringify(o),async:!1,literal:o,message:s,get"~standard"(){return _getStandardProps(this)},"~run"(e,t){return e.value===this.literal?e.typed=!0:_addIssue(this,"type",e,t),e}}}function number(o){return{kind:"schema",type:"number",reference:number,expects:"number",async:!1,message:o,get"~standard"(){return _getStandardProps(this)},"~run"(s,e){return typeof s.value=="number"&&!isNaN(s.value)?s.typed=!0:_addIssue(this,"type",s,e),s}}}function object(o,s){return{kind:"schema",type:"object",reference:object,expects:"Object",async:!1,entries:o,message:s,get"~standard"(){return _getStandardProps(this)},"~run"(e,t){var r;const n=e.value;if(n&&typeof n=="object"){e.typed=!0,e.value={};for(const i in this.entries){const a=this.entries[i];if(i in n||(a.type==="exact_optional"||a.type==="optional"||a.type==="nullish")&&a.default!==void 0){const l=i in n?n[i]:getDefault(a),c=a["~run"]({value:l},t);if(c.issues){const d={type:"object",origin:"value",input:n,key:i,value:l};for(const u of c.issues)u.path?u.path.unshift(d):u.path=[d],(r=e.issues)==null||r.push(u);if(e.issues||(e.issues=c.issues),t.abortEarly){e.typed=!1;break}}c.typed||(e.typed=!1),e.value[i]=c.value}else if(a.fallback!==void 0)e.value[i]=getFallback(a);else if(a.type!=="exact_optional"&&a.type!=="optional"&&a.type!=="nullish"&&(_addIssue(this,"key",e,t,{input:void 0,expected:`"${i}"`,path:[{type:"object",origin:"key",input:n,key:i,value:n[i]}]}),t.abortEarly))break}}else _addIssue(this,"type",e,t);return e}}}function optional(o,s){return{kind:"schema",type:"optional",reference:optional,expects:`(${o.expects} | undefined)`,async:!1,wrapped:o,default:s,get"~standard"(){return _getStandardProps(this)},"~run"(e,t){return e.value===void 0&&(this.default!==void 0&&(e.value=getDefault(this,e,t)),e.value===void 0)?(e.typed=!0,e):this.wrapped["~run"](e,t)}}}function record(o,s,e){return{kind:"schema",type:"record",reference:record,expects:"Object",async:!1,key:o,value:s,message:e,get"~standard"(){return _getStandardProps(this)},"~run"(t,n){var i,a;const r=t.value;if(r&&typeof r=="object"){t.typed=!0,t.value={};for(const l in r)if(_isValidObjectKey(r,l)){const c=r[l],d=this.key["~run"]({value:l},n);if(d.issues){const h={type:"object",origin:"key",input:r,key:l,value:c};for(const g of d.issues)g.path=[h],(i=t.issues)==null||i.push(g);if(t.issues||(t.issues=d.issues),n.abortEarly){t.typed=!1;break}}const u=this.value["~run"]({value:c},n);if(u.issues){const h={type:"object",origin:"value",input:r,key:l,value:c};for(const g of u.issues)g.path?g.path.unshift(h):g.path=[h],(a=t.issues)==null||a.push(g);if(t.issues||(t.issues=u.issues),n.abortEarly){t.typed=!1;break}}(!d.typed||!u.typed)&&(t.typed=!1),d.typed&&(t.value[d.value]=u.value)}}else _addIssue(this,"type",t,n);return t}}}function string(o){return{kind:"schema",type:"string",reference:string,expects:"string",async:!1,message:o,get"~standard"(){return _getStandardProps(this)},"~run"(s,e){return typeof s.value=="string"?s.typed=!0:_addIssue(this,"type",s,e),s}}}function _subIssues(o){let s;if(o)for(const e of o)s?s.push(...e.issues):s=e.issues;return s}function union(o,s){return{kind:"schema",type:"union",reference:union,expects:_joinExpects(o.map(e=>e.expects),"|"),async:!1,options:o,message:s,get"~standard"(){return _getStandardProps(this)},"~run"(e,t){let n,r,i;for(const a of this.options){const l=a["~run"]({value:e.value},t);if(l.typed)if(l.issues)r?r.push(l):r=[l];else{n=l;break}else i?i.push(l):i=[l]}if(n)return n;if(r){if(r.length===1)return r[0];_addIssue(this,"type",e,t,{issues:_subIssues(r)}),e.typed=!0}else{if((i==null?void 0:i.length)===1)return i[0];_addIssue(this,"type",e,t,{issues:_subIssues(i)})}return e}}}function parse(o,s,e){const t=o["~run"]({value:s},getGlobalConfig(e));if(t.issues)throw new ValiError(t.issues);return t.value}function safeParse(o,s,e){const t=o["~run"]({value:s},getGlobalConfig(e));return{typed:t.typed,success:!t.issues,output:t.value,issues:t.issues}}const customPropertyTypePrefix="better-properties:",monkeyAroundKey="better-properties_monkey-around-key",selectColors={red:"var(--better-properties-select-red)",orange:"var(--better-properties-select-orange)",yellow:"var(--better-properties-select-yellow)",green:"var(--better-properties-select-green)",blue:"var(--better-properties-select-blue)",cyan:"var(--better-properties-select-cyan)",purple:"var(--better-properties-select-purple)",pink:"var(--better-properties-select-pink)",gray:"var(--better-properties-select-gray)",transparent:"var(--better-properties-select-transparent)"},getTrueProperty=o=>o.split(".").map(s=>{const e=Number(s);return Number.isNaN(e)?s:"#"}).join("."),getPropertySettings=({plugin:o,property:s})=>{const e=getTrueProperty(s).toLowerCase();o.settings.propertySettings||(o.settings.propertySettings={}),o.settings.propertySettings[e]||(o.settings.propertySettings[e]=getDefaultPropertySettings());const t=o.settings.propertySettings[e],n=getDefaultPropertySettings(),r=Object.keys(n).reduce((i,a)=>{const l=a,c=t[l];return c&&(i[l]=c),i},n);return o.settings.propertySettings[e]=r,r},deletePropertySettings=({plugin:o,property:s})=>{const e=getTrueProperty(s).toLowerCase();o.settings.propertySettings||(o.settings.propertySettings={}),delete o.settings.propertySettings[e],o.saveSettings()},setPropertySettings=({plugin:o,property:s,settings:e})=>{const t=getTrueProperty(s).toLowerCase();o.settings.propertySettings||(o.settings.propertySettings={}),o.settings.propertySettings[t]=e,o.saveSettings()},getPropertyTypeSettings=({type:o,...s})=>getPropertySettings(s)[o],setPropertyTypeSettings=({plugin:o,property:s,type:e,typeSettings:t})=>{const n=getPropertySettings({plugin:o,property:s});n[e]=t,setPropertySettings({plugin:o,property:s,settings:n})},updatePropertyTypeSettings=({plugin:o,property:s,type:e,cb:t})=>{const n=getPropertySettings({plugin:o,property:s});n[e]=t(n[e]),setPropertySettings({plugin:o,property:s,settings:n})};class PropertyWidgetComponentNew{constructor(s,e,t,n){p(this,"containerEl");p(this,"onFocus",()=>{throw new Error("Method not implemented")});this.plugin=s,this.el=e,this.value=t,this.ctx=n,this.containerEl=e}focus(){this.onFocus()}setValue(s){this.ctx.onChange(s)}getSettings(){return getPropertyTypeSettings({plugin:this.plugin,property:this.ctx.key,type:this.type})}setSettings(s){setPropertyTypeSettings({plugin:this.plugin,property:this.ctx.key,type:this.type,typeSettings:s})}}const withoutTypeWidgetPrefix=o=>o.startsWith(customPropertyTypePrefix)?o.slice(customPropertyTypePrefix.length):o,findKeyValueByDotNotation=(o,s)=>{const e=o.toLowerCase().split(".");let t=s,n;for(const r of e){if(typeof t!="object")return{key:void 0,value:void 0};const i=Object.keys(t??{}).find(a=>a.toLowerCase()===r);if(!i)return{key:void 0,value:void 0};n=i,t=t[i]}return{key:n,value:t}},updateNestedObject=(o,s,e)=>{const t=s.split(".");let n=o;for(let r=0;r<t.length-1;r++){const i=t[r];if(i==="")return o;(!n[i]||typeof n[i]!="object")&&(n[i]={}),n=n[i]}return n[t[t.length-1]]=e,o},flashElement=(o,s)=>{const e="is-flashing";o.classList.add(e),window.setTimeout(()=>{o.classList.remove(e)},1e3)},triggerPropertyTypeChange=(o,s)=>{o.trigger("changed",s.toLowerCase())},tryCatch=async o=>{try{return{success:!0,data:typeof o=="function"?await o():await o,error:void 0}}catch(s){return{success:!1,data:void 0,error:s instanceof Error?s.message:typeof s=="string"?s:s!=null&&s.toString?s.toString():"Unknown error"}}},syncTryCatch=o=>{try{return{success:!0,data:o(),error:void 0}}catch(s){return{success:!1,data:void 0,error:s instanceof Error?s.message:typeof s=="string"?s:s!=null&&s.toString?s.toString():"Unknown error"}}},clampNumber=(o,s,e,t)=>o<=s?s:o>=e?e:o,arrayMove=(o,s,e)=>{const t=[...o],n=t[s];return t.splice(s,1),t.splice(e,0,n),t},getFirstLinkPathDest=(o,s,e)=>{const t=e.startsWith("[[")&&e.endsWith("]]")?e.slice(2,-2):e,n=t.indexOf("#"),r=n===-1?t:t.slice(0,n),i=r.indexOf("|"),a=i===-1?r:r.slice(0,i);return o.getFirstLinkpathDest(a,s)},iterateFileMetadata=({vault:o,metadataCache:s,callback:e})=>{var n;const t=o.getMarkdownFiles();for(let r=0;r<t.length;r++){const i=t[r],a=(n=s.fileCache[i.path])==null?void 0:n.hash,l=a?s.metadataCache[a]:void 0;e({file:i,metadata:l})}},iterativelyProcessFrontmatter=async({fileManager:o,vault:s,process:e,afterProcess:t})=>{const n=s.getMarkdownFiles();for(let r=0;r<n.length;r++){const i=n[r],a=await tryProcessFrontmatter({file:i,fileManager:o,process:e});await t(a)}},tryProcessFrontmatter=async({file:o,fileManager:s,process:e,options:t})=>await tryCatch(s.processFrontMatter(o,e,t)),findKey=(o,s)=>{const e=s.toLowerCase();return Object.keys(o).find(n=>n.toLowerCase()===e)??null},deletePropertyConfiguration=async({plugin:o,property:s})=>{await o.updateSettings(e=>{if(!e)return e;const t=findKey(e,s);return t&&delete e[t],e})},renamePropertyConfiguration=async({plugin:o,property:s,newProperty:e})=>{await o.updateSettings(t=>{const{propertySettings:n}=t;if(!n)return t;const r=findKey(n,s);if(!r)return t;const i={...n[r]};delete n[r];const a=e.toLowerCase();return n[a]=i,t})},deleteProperty=async({plugin:o,property:s})=>{iterativelyProcessFrontmatter({fileManager:o.app.fileManager,vault:o.app.vault,process:e=>{if(!e)return;const t=findKey(e,s);t&&delete e[t]},afterProcess:async({success:e,error:t})=>{if(e){await deletePropertyConfiguration({plugin:o,property:s});return}const n="Better Properties: Error when deleting property";new obsidian.Notice(createFragment(r=>{r.createDiv({text:n}),r.createDiv({text:t})}),0),console.error(n+`
`+t)}})},renameProperty=async({plugin:o,property:s,newProperty:e})=>{const t=o.app.metadataTypeManager.getAssignedWidget(s)??"text";o.app.metadataTypeManager.setType(e,t),o.app.metadataTypeManager.unsetType(s),iterativelyProcessFrontmatter({fileManager:o.app.fileManager,vault:o.app.vault,process:n=>{if(!n)return;const r=findKey(n,s);if(!r)return;const i=n[r];Array.isArray(i)&&(n[e]=[...i]),typeof i=="object"&&(n[e]={...i}),typeof i!="object"&&(n[e]=i),delete n[r]},afterProcess:async({success:n,error:r})=>{if(n){await renamePropertyConfiguration({plugin:o,property:s,newProperty:e});return}const i="Better Properties: Error when renaming property";new obsidian.Notice(createFragment(a=>{a.createDiv({text:i}),a.createDiv({text:r})}),0),console.error(i+`
`+r)}})},getAllTags=(o,s)=>{var n,r;const e=new Set;(n=o.tags)==null||n.forEach(({tag:i})=>{const a=i.slice(1);e.add(a)});const t=(r=o.frontmatter)==null?void 0:r.tags;return Array.isArray(t)&&t.forEach(i=>{if(typeof i!="string")return;const a=i;e.add(a)}),Array.from(e)},compareFunc=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!1}).compare,makeDraggable=({itemEl:o,dragHandleEl:s,parentEl:e,itemsQuerySelector:t,onDragEnd:n})=>{s.addEventListener("mousedown",r=>{const i="drag-ghost-hidden",a=createDiv({cls:"drag-reorder-ghost"});let l=!1;const{width:c,height:d,left:u,top:h}=o.getBoundingClientRect();let g=[],f=-1,y=-1;const S=25;let m=!1;const b=T=>{var N;if(m||(m=Math.abs(r.pageX-T.pageX)>S||Math.abs(r.pageY-T.pageY)>S),!!m){if(!l){const E=o.cloneNode(!0);if(o.classList.add(i),!(E instanceof HTMLElement))throw new Error("Cloned property element is not an HTMLElement");E.classList.add("better-properties-draggable-item-clone"),E.setCssProps({"--better-properties-width":c+"px","--better-properties-height":d+"px"}),a.appendChild(E),a.setCssProps({"--better-properties-left":`calc(${u}px - var(--icon-size))`,"--better-properties-top":`calc(${h}px - var(--icon-size))`}),window.activeDocument.body.appendChild(a),window.activeDocument.body.classList.add("is-grabbing"),l=!0,(N=e.querySelectorAll(t))==null||N.forEach((F,x)=>{F===o&&(f=x,y=x);const{top:w,bottom:k}=F.getBoundingClientRect();g.push({top:w,bottom:k,el:F})})}a.setCssProps({"--better-properties-transform":`translate(${T.pageX-u}px, ${T.pageY-h}px)`}),g.forEach(({top:E,bottom:F,el:x},w)=>{const k=(E+F)/2,O=w<y&&T.pageY<k,C=w>y&&T.pageY>k;!O&&!C||(x.insertAdjacentElement(O?"beforebegin":"afterend",o),g=arrayMove(g,y,w),y=w)})}},R=()=>{a.remove(),o.classList.remove(i),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",R),window.activeDocument.body.classList.remove("is-grabbing"),!(f===-1||y===-1)&&n(f,y)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",R)})},parseCsv=(o,s=",")=>{const e=[];let t=[],n="",r=!1;for(let i=0;i<o.length;i++){const a=o[i],l=o[i+1];if(a==='"'){if(r&&l==='"'){n+='"',i++;continue}r=!r;continue}if(a===s&&!r){t.push(n),n="";continue}if(!r&&(a===`
`||a==="\r")){a==="\r"&&l===`
`&&i++,t.push(n),e.push(t),t=[],n="";continue}n+=a}return(n.length>0||t.length>0)&&(t.push(n),e.push(t)),e},obsidianFixed=window.i18next.getFixedT(null,"default"),obsidianText=(o,s)=>obsidianFixed(o,s),common={nothingToSeeHere:"Nothing to see here!",typeHasNoSettings:"This type has no settings available",valuePlaceholder:"value",optionalLabelPlaceholder:"label (optional)",sort:{valueAlphabetical:"Value (A - Z)",valueReverseAlphabetical:"Value (Z - A)",labelAlphabetical:"Label (A - Z)",labelReverseAlphabetical:"Label (Z - A)",nameAlphabetical:"Name (A - Z)",nameReverseAlphabetical:"Name (Z - A)",pathAlphabetical:"Path (A - Z)",pathReverseAlphabetical:"Path (Z - A)",typeAlphabetical:"Type (A - Z)",typeReverseAlphabetical:"Type (Z - A)"},openFile:'Open "{{fileName}}"',dontAskAgain:"Don't ask again",areYouSure:"Are you sure?",icon:"Icon",import:"Import",reset:"Reset",more:"More"},datetime={date:"Date",dateAndTime:"Date & time",year:"Year",month:"Month",day:"Day",hour:"Hour",minute:"Minute",second:"Second"},customPropertyTypes={created:{name:"Created",settings:{format:{title:"Format",desc:"Enter a valid momentjs format to display the date with."}}},numeric:{name:"Numeric",settings:{decimalPlaces:{title:"Decimal places",desc:"How many decimal places to round the number to."}}},color:{name:"Color"},slider:{name:"Slider",settings:{min:{title:"Minimum",desc:"The lowest value the slider can be set to."},max:{title:"Maximum",desc:"The highest value the slider can be set to."},step:{title:"Step",desc:"The amount the slider value will change when moved left or right one time."},hideLimits:{title:"Hide limits",desc:"Whether to hide the limits of the slider"}}},time:{name:"Time",settings:{}},rating:{name:"Rating",settings:{icon:{title:"Icon",desc:"Set a custom icon to use instead of a star."},count:{title:"Count",desc:"Set a custom icon count rather than the default of 5."}}},relation:{name:"Relation"},datecustom:{name:"Date custom",settings:{type:{title:"Type",desc:"The type of date."},format:{title:"Format",desc:"The format to apply to the date value."},placeholder:{title:"Placeholder",desc:"What text to show when the date is empty."},icon:{title:"Icon",desc:"The icon to show for the date-picker button."}}},select:{name:"Select",settings:{useDefaultDropdown:{title:"Use default dropdown",desc:"Whether to use the default dropdown."},optionsType:{title:"Options type",desc:"Whether to use manually defined options or a different dynamic way of determining available options.",selectLabelManual:"Manual",selectLabelDynamic:"Dynamic"},optionsTypeSettings:{manual:{allowCreateTitle:"Allow creating options",allowCreateDesc:"Whether to show a button to create a new option in the popup menu.",optionsTitle:"Manual options",optionsDesc:"The manually created choices this select can be set to."},dynamic:{typeTitle:"Dynamic type",typeDesc:"Which method to use to dynamically determine available options.",emptyLabelTitle:"Empty label",emptyLabelDesc:"The text that will show when the value is empty.",filesInFolderLabel:"Files from folder",filesFromTagLabel:"Files from tag",filesFromInlineJsLabel:"Inline JS",filesFromFileJsLabel:"JS file",scriptLabel:"Options from script",filesInFolder:{folderPaths:{title:"Folder paths",desc:"Notes in the following folders will be options for this select."},excludeFolderNotes:{title:"Exclude Folder Notes",desc:"Whether to exclude notes that have the same name as their folder."}},filesFromTag:{tags:{title:"Tag(s)",desc:"Notes with all of the following tags will be shown as this select's options."},includeNestedTags:{title:"Include Nested Tags",desc:'Whether to include notes containing a nested tag of one of the selected tags. For example, whether to include a note with the tag "food/fruit" when "food" is a selected tag.'}},filesFromInlineJs:{code:{title:"JavaScript code",desc:"Provide a function which returns an array of options.",helpText:"Copy function template",runInConsole:"Run code in console",copySuccessNotice:"Copied template to clipboard"}},filesFromFileJs:{filePath:{title:"JavaScript file",desc:"Select the path to a JavaScript file which default exports a function which returns an array of options.",helpText:"Copy file template",runInConsole:"Run file in console",copySuccessNotice:"Copied template to clipboard"}}}}}},multiSelect:{name:"Multi-Select"},object:{name:"Object",settings:{hideAddButton:{title:'Hide "Add property" button',desc:"Whether to hide the button used to add properties to this object."}}},array:{name:"Array",settings:{hideAddButton:{title:'Hide "Add property" button',desc:"Whether to hide the button used to add properties to this array."}}},markdown:{name:"Markdown"},title:{name:"Title"},toggle:{name:"Toggle"}},propertySettings={generalTabGroupName:"General",generalSettingsTab:{name:"Settings",iconSetting:{title:"Icon",desc:"Set a custom icon to show for this property."},hiddenSetting:{title:"Hidden",desc:"Whether to hide this property from view by default."},defaultValueSetting:{title:"Default value",desc:"Automatically set a property to this value if empty. Note, this will be parsed as YAML."},aliasSetting:{title:"Alias",desc:"This will be shown in place of the property name in frontmatter."},suggestionsSetting:{title:"Suggestions",desc:"Override the default suggestions with the following."}},generalActionsTab:{name:"Actions",importSetting:{title:"Import",desc:"Paste settings as JSON. This will completely overwrite any existing settings for this property!",modalTitle:"Import property settings",modalJsonParseError:"JSON parse error: {{error}}",modalStrutureParseError:"Parse error: Data does not conform to expected structure. Check developer console for more details.",modalDataIsValid:"Data is valid",modalImportSuccess:"Property settings updated"},exportSetting:{title:"Export",desc:"Copy this property's settings as JSON.",copySuccessNotice:"Copied settings to clipboard"},resetSetting:{title:"Reset",desc:"Completely wipe all settings for this property.",modalTitle:"Are you sure?",modalDesc:"This will reset this property's settings which cannot be undone"}},typesTabGroup:{name:"Type specific",unsupportedTypeTitle:"Unsupported type",unsupportedTypeDesc:'The assigned type of "{{widget.type}}" is not supported for type-specific settings. This is likely because it is a built-in type or it was added by a different plugin than Better Properties'}},metadataEditor={moreButton:{showHidden:"Show hidden",sort:"Sort"},propertyMenu:{delete:{modalTitle:"Are you sure?",modalDesc:`This action will permanently remove the property "{{property}}" from all notes, delete property configurations in this plugin's settings, and cannot be undone.`},icon:{modalTitle:'Change icon for property "{{property}}"',iconSetting:{title:"Icon",desc:"The icon to show for this property."}},rename:{modalTitle:"Rename property",modalDesc:`Enter a new name to change all instances of the "{{property}}" property in all notes' properties and this plugin's settings`,newPropertyNamePlaceholder:"new property name",nameExistsWarning:'The name you entered already exists. If you continue, the existing configuration for that name will be overwritten with the configuration from "{{property}}"'}}},en={common,datetime,customPropertyTypes,propertySettings,metadataEditor},ns="better-properties";window.i18next.addResourceBundle("en",ns,en);const fixedT=window.i18next.getFixedT(null,ns),text=(o,s)=>fixedT(o,s);class ComboboxComponent extends obsidian.ValueComponent{constructor(e){super();p(this,"options",[]);p(this,"selectEl");p(this,"auxEl");p(this,"value","");p(this,"positionOffset",5);p(this,"onChangeCallback",()=>{});p(this,"menuOptionFilter",()=>!0);p(this,"search");this.containerEl=e,this.selectEl=this.createSelectEl(e)}setEmptyClass(e){const t="data-better-properties-combobox-mod-empty";e&&this.selectEl.classList.add(t),!e&&this.selectEl.classList.remove(t)}validateOption(e){return e===""||this.options.some(t=>this.getValueFromOption(t)===e)}getValue(){return this.value}setValue(e){var t;return this.value=e,this.selectEl.textContent=e,this.setEmptyClass(e===""),(t=this==null?void 0:this.auxEl)==null||t.remove(),this.auxEl=this.createAuxEl(this.containerEl),this}onChange(e){return this.onChangeCallback=e,this}onChanged(){this.onChangeCallback(this.getValue())}commitValue(){const e=this.selectEl.textContent;this.setValue(e),this.onChanged()}createSelectEl(e){const t=e.createDiv({cls:"better-properties-combobox-select",attr:{tabindex:"0",spellcheck:"false",role:"combobox"}}),n=()=>{const r=this.createMenu();this.options.forEach(i=>{this.menuOptionFilter(i)&&r.addSectionItem("body",a=>{this.onRenderMenuItem(a,i)})}),r.showAtElement(t)};return t.addEventListener("click",r=>{r.preventDefault(),n()}),t.addEventListener("keydown",r=>{r.key===" "&&(r.preventDefault(),n())}),t}createAuxEl(e){const t=this.getValue();if(!this.validateOption(t)){const n=new obsidian.ExtraButtonComponent(e).setTooltip(`Invalid value: "${this.getValue()}"`).setIcon("lucide-alert-circle").extraSettingsEl;return n.classList.add("better-properties-mod-error"),n}return createDiv({cls:"better-properties-select-aux"})}onRenderMenuItem(e,t){const n=this.getValueFromOption(t);e.setTitle(n),e.setChecked(n===this.value),e.onClick(()=>{this.selectEl.textContent=n,e.menu.close(),this.commitValue()})}createMenu(){return new SearchableMenu}filterItem(e,t){if(!e)return!0;const n=e.toLowerCase();return t.dom.innerText.toLowerCase().includes(n)}addOptions(e){this.options=e}}const HEADER="header",BODY="body",FOOTER="footer";class SearchableMenu extends obsidian.Menu{constructor(){super();p(this,"yOffset",5);p(this,"onShowCallback",()=>{});p(this,"search");this.dom.classList.add("better-properties-searchable-menu"),this.addSections([HEADER,BODY,FOOTER])}onShow(e){return this.onShowCallback=e,this}createSearch(){const e=new obsidian.SearchComponent(this.scrollEl);return e.containerEl.addEventListener("click",t=>{t.stopImmediatePropagation(),t.stopPropagation(),e.inputEl.focus()}),this.scrollEl.insertAdjacentElement("afterbegin",e.containerEl),e.setPlaceholder("Search options..."),e.inputEl.focus(),e.onChange(t=>{this.filterItems(t)}),e}filterItems(e){const t=e.toLowerCase();this.items.forEach(n=>{if(n instanceof obsidian.MenuSeparator||n.section!==BODY)return;const r=!e||n.dom.innerText.toLowerCase().includes(t);n.setDisabled(!r)})}addSectionItem(e,t){return super.addItem(n=>{n.setSection(e),t(n)}),this}showAtPosition(e,t){super.showAtPosition(e,t),this.search=this.createSearch(),this.search.inputEl.focus();let n=-1;const r=this.items.findIndex((i,a)=>i instanceof obsidian.MenuSeparator?!1:(n===-1&&i.section===BODY&&(n=a),i.checked));return this.select(r===-1?n:r),this.onShowCallback(this),this}showAtElement(e){const t=e.getBoundingClientRect();return this.showAtPosition({x:t.left,y:t.bottom+this.yOffset}),this}close(){super.close(),this.unload(),this.dom.remove()}}class ColorTextComponent extends obsidian.ValueComponent{constructor(e){super();p(this,"value","");p(this,"componentsContainerEl");p(this,"colorsContainerEl");p(this,"textComponent");p(this,"colorComponent");p(this,"colorInputEl");p(this,"onChangeCallback",()=>{});this.componentsContainerEl=e.createDiv({cls:"better-properties-color-text-component-container"}),this.colorsContainerEl=this.componentsContainerEl.createDiv({cls:"better-properties-color-text-component-colors-container",attr:{}}),this.colorComponent=new obsidian.ColorComponent(this.colorsContainerEl),this.colorComponent.colorPickerEl.setAttribute("aria-hidden","true"),this.colorComponent.colorPickerEl.setAttribute("tabindex","-1"),this.colorInputEl=this.colorsContainerEl.createDiv({cls:"better-properties-swatch better-properties-color-text-component-color-input",attr:{tabindex:"0",role:"button"}}),this.colorComponent.onChange(t=>{this.setColorCssVar(t),this.textComponent.inputEl.value=t,this.value=t,this.onChanged()}),this.colorInputEl.addEventListener("click",()=>{this.colorComponent.colorPickerEl.showPicker()}),this.textComponent=new obsidian.TextComponent(this.componentsContainerEl).setPlaceholder(obsidianText("properties.label-no-value")),this.textComponent.onChange(t=>{this.setColorCssVar(t),isHex(t)&&(this.colorComponent.colorPickerEl.value=t),this.value=t,this.onChanged()})}getValue(){return this.value}setValue(e){return this.value=e,this.setColorCssVar(e),this.textComponent.inputEl.value=e,isHex(e)&&(this.colorComponent.colorPickerEl.value=e),this}onChanged(){this.onChangeCallback(this.getValue())}onChange(e){return this.onChangeCallback=e,this}setColorCssVar(e){this.colorsContainerEl.setCssProps({"--better-properties-bg":e})}}const isHex=o=>o.startsWith("#")&&o.length===7;class InputSuggest extends obsidian.AbstractInputSuggest{constructor(){super(...arguments);p(this,"setFilterCallback",()=>!0)}setFilter(e){return this.setFilterCallback=e,this}renderSuggestion(e,t){if(!this.setFilterCallback(e)){t.remove();return}const{title:n,aux:r,note:i,icon:a}=this.parseSuggestion(e);if(t.classList.add("mod-complex"),a){const c=t.createDiv({cls:"suggestion-icon"}).createSpan({cls:"suggestion-flair"});obsidian.setIcon(c,a)}const l=t.createDiv({cls:"suggestion-content"});l.createDiv({cls:"suggestion-title",text:n}),i!==void 0&&l.createDiv({cls:"suggestion-note",text:i}),r!==void 0&&t.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",text:r})}}class FileSuggest extends InputSuggest{constructor(s,e,t=!0){super(s,e),this.respectUserIgnored=t}getSuggestions(s){const{app:e}=this,t=e.vault.getFiles().toSorted((i,a)=>compareFunc(i.path,a.path)),n=this.respectUserIgnored?t.filter(i=>!this.app.metadataCache.isUserIgnored(i.path)):t;if(!s)return n.filter(this.setFilterCallback);const r=s.toLowerCase();return n.filter(i=>i.path.toLowerCase().includes(r)&&this.setFilterCallback(i))}parseSuggestion({path:s,name:e}){return{title:e,note:s}}}class FolderSuggest extends InputSuggest{constructor(s,e,t){super(s,e),this.options=t}getSuggestions(s){const{app:e}=this,t=e.vault.getAllFolders(!0).toSorted((r,i)=>compareFunc(r.path,i.path));if(!s)return t.filter(this.setFilterCallback);const n=s.toLowerCase();return t.filter(r=>r.path.toLowerCase().includes(n)&&this.setFilterCallback(r))}parseSuggestion({path:s,name:e,children:t}){var n;return{title:e,note:s,aux:(n=this.options)!=null&&n.showFileCountAux?t.filter(r=>r instanceof obsidian.TFile).length.toString():void 0}}}class TagSuggest extends InputSuggest{constructor(s,e){super(s,e)}getSuggestions(s){const{vault:e,metadataCache:t}=this.app,n={};iterateFileMetadata({vault:e,metadataCache:t,callback:({metadata:a})=>{if(!a)return;const l=getAllTags(a);l==null||l.forEach(c=>{c in n?n[c]++:n[c]=1})}});const r=Object.entries(n).map(([a,l])=>({tag:a,count:l}),[]);if(!s)return r.filter(this.setFilterCallback);const i=s.toLowerCase();return r.filter(a=>a.tag.toLowerCase().startsWith(i)&&this.setFilterCallback(a))}parseSuggestion({tag:s,count:e}){return{title:s,aux:e.toString()}}}class ListSetting extends obsidian.Setting{constructor(e){super(e);p(this,"itemsContainerEl");p(this,"items",[]);p(this,"footerContainerEl");p(this,"value",[]);p(this,"onCreateItemCallback",()=>{});p(this,"onChangeCallback",()=>{});p(this,"draggingIndex",-1);p(this,"draggingOverIndex",-1);this.settingEl.classList.add("better-properties-list-setting"),this.itemsContainerEl=this.controlEl.createDiv({cls:"better-properties-list-setting-items-container"}),this.footerContainerEl=this.controlEl.createDiv({cls:"better-properties-list-setting-footer"}),this.itemsContainerEl.addEventListener("dragover",t=>{t.preventDefault()})}startDrag(e){const t=clampNumber(e,0,this.items.length-1);this.draggingIndex=t,this.itemsContainerEl.setAttribute("data-dragging-active","true"),this.items[t].settingEl.setAttribute("data-is-dragged","true")}dragOver(e){var i;(i=this.items[this.draggingOverIndex])==null||i.settingEl.removeAttribute("data-dragged-over");const{draggingIndex:t}=this,n=clampNumber(e,0,this.items.length-1);this.draggingOverIndex=n,this.items[n].settingEl.removeAttribute("data-dragged-over");const r=n>t?"bottom":"top";this.items[n].settingEl.setAttribute("data-dragged-over",r)}endDrag(){var n,r,i;const{draggingIndex:e,draggingOverIndex:t}=this;e!==t&&e!==-1&&t!==-1&&(this.value=arrayMove(this.value,e,t),this.onChangeCallback(this.value),this.renderAllItems(),this.items[t].focusCallback()),(n=this.itemsContainerEl)==null||n.removeAttribute("data-dragging-active"),(r=this.items[t])==null||r.settingEl.removeAttribute("data-dragged-over"),(i=this.items[e])==null||i.settingEl.removeAttribute("data-is-dragged"),this.draggingIndex=-1,this.draggingOverIndex=-1}addFooterButton(e){const t=new obsidian.ButtonComponent(this.footerContainerEl);return e(t),this}setValue(e){return this.value=e,this}setItemValue(e,t){this.value[e]=t,this.onChangeCallback(this.value)}addItem(e){return this.value.push(e),this.onChangeCallback(this.value),this.renderItem(e),this}renderItem(e){const t=new Item(this,e);return this.onCreateItemCallback(e,t),t.focusCallback(),this}renderAllItems(){return this.items=[],this.itemsContainerEl.empty(),this.value.forEach(e=>this.renderItem(e)),this}onChange(e){return this.onChangeCallback=e,this}onCreateItem(e){return this.onCreateItemCallback=e,this}setItemWidth(e){return this.settingEl.setCssProps({"--better-properties-item-width":e}),this}sort(e){this.setValue(this.value.toSorted(e)),this.renderAllItems()}}class Item extends obsidian.Setting{constructor(e,t){super(e.itemsContainerEl);p(this,"index");p(this,"focusCallback",()=>{});this.list=e,this.value=t,this.infoEl.remove(),e.items.push(this),this.index=e.items.length-1,this.settingEl.addEventListener("dragenter",n=>this.onDragEnter(n))}onFocus(e){return this.focusCallback=e,this}onDragEnter(e){return e&&e.preventDefault(),this.list.dragOver(this.index),this}onDragStart(e){return e!=null&&e.dataTransfer&&e.dataTransfer.setDragImage(createDiv(),0,0),this.list.startDrag(this.index),this}onDragEnd(){return this.list.endDrag(),this}onKeyDown(e){const{draggingOverIndex:t}=this.list;return e.key==="ArrowUp"&&(this.onDragStart(),this.list.dragOver(t===-1?this.index-1:t-1)),e.key==="ArrowDown"&&(this.onDragStart(),this.list.dragOver(t===-1?this.index+1:t+1)),e.key==="Escape"&&(this.list.dragOver(-1),this.onDragEnd()),(e.key==="Enter"||e.key===" "||e.key==="Tab")&&this.onDragEnd(),this}addDragButton(){return this.addButton(e=>{e.setIcon("lucide-menu");const t=e.buttonEl;t.classList.add("clickable-icon","extra-setting-button"),t.draggable=!0,t.tabIndex=0,t.addEventListener("dragstart",n=>this.onDragStart(n)),t.addEventListener("dragend",()=>this.onDragEnd()),t.addEventListener("keydown",n=>this.onKeyDown(n))}),this}addDeleteButton(){return this.addButton(e=>{e.buttonEl.classList.add("clickable-icon","extra-setting-button"),e.setIcon("lucide-x").onClick(()=>{this.list.value=this.list.value.filter((t,n)=>n!==this.index),this.list.onChangeCallback(this.list.value),this.list.renderAllItems()})}),this}}const resolveMultiSelectPrototype=o=>{const s=o.metadataTypeManager.registeredTypeWidgets.tags;if(!s)throw new Error("Tags widget not found");const e=createDiv(),t=s.render(e,[],{app:o,blur:()=>{},key:"tags",onChange:()=>{},sourcePath:""}),{multiselect:n}=t;return Object.getPrototypeOf(n).constructor};class MultiselectComponent extends resolveMultiSelectPrototype(app){constructor(e){const t=e instanceof HTMLElement?e:e.controlEl;super(t);p(this,"isInputElSuggestAdded",!1);p(this,"addSuggestCallback");p(this,"setupInput",e=>{this.addSuggestCallback&&this.addSuggestCallback(e,this.getItemIndex(e));const t=n=>{var a;const r=this.getItemIndex(e),i=((a=n.target)==null?void 0:a.textContent)??"";this.updateAndRender(l=>this.values.contains(i)?(e.textContent=this.values[r]??"",e.blur(),l):i?(l[r]=i,l):l.filter((c,d)=>d!==r))};e.addEventListener("blur",t),e.addEventListener("keydown",n=>{n.key==="Enter"&&e.blur()})});p(this,"findDuplicate",(e,t)=>t.indexOf(e));p(this,"createOption",e=>{if(e){if(this.values.contains(e)){this.setInputText(""),this.inputEl.blur();return}this.updateAndRender(t=>[...t,e]),this.setInputText("")}})}addSuggest(e){return this.addSuggestCallback=e,this}updateAndRender(e){const t=[...this.values],n=e(t);return this.setValues(n),this.renderValues(),this}renderValues(){return super.renderValues.call(this),this.addSuggestCallback&&!this.isInputElSuggestAdded&&(this.isInputElSuggestAdded=!0,this.addSuggestCallback(this.inputEl,this.getItemIndex(this.inputEl))),this}getItemIndex(e){const{parentElement:t}=e;return t?Array.from(t.children).indexOf(e):-1}}const renderSettings$b=({plugin:o,modal:s,property:e})=>{const{tabContentEl:t}=s,n=getPropertyTypeSettings({plugin:o,property:e,type:typeKey});if(s.onTabChange(()=>{setPropertyTypeSettings({plugin:o,property:e,type:typeKey,typeSettings:n})}),renderDefaultSettings({plugin:o,parentEl:t,settings:n,modal:s,property:e}),n.optionsType==="manual"&&renderManualSettings$1({plugin:o,parentEl:t,settings:n}),n.optionsType==="dynamic"){if(n.dynamicOptionsType||(n.dynamicOptionsType="filesInFolder"),renderDynamicSettings$1({plugin:o,parentEl:t,settings:n,modal:s,property:e}),n.dynamicOptionsType==="filesInFolder"){renderFilesFromFolderSettings$1({plugin:o,parentEl:t,settings:n});return}if(n.dynamicOptionsType==="filesFromTag"){renderFilesFromTagSettings$1({plugin:o,parentEl:t,settings:n});return}n.dynamicOptionsType==="filesFromInlineJs"&&renderFilesFromInlineJsSettings$1({plugin:o,parentEl:t,settings:n}),n.dynamicOptionsType==="filesFromJsFile"&&renderFilesFromFileJsSetings$1({plugin:o,parentEl:t,settings:n})}},selectOptionInlineCodeTemplate$1=`async (props) => {
	const appleOption = {
		value: "apple",
		label: "Apple", // optional
		bgColor: "red", // optional
	};
	const bananaoption = {
		value: "banana",
	};
	const arr = [appleOption, bananaoption];
	return arr;
};`,selectOptionJsFileTemplate$1="module.default = "+selectOptionInlineCodeTemplate$1,defaultOption$1={value:"",label:""},tryRunInlineCode$1=async(plugin,fnString)=>tryCatch(async()=>{const fn=typeof fnString=="string"?eval(fnString):fnString;if(typeof fn!="function")throw new Error(`Expected type "function" but got type ${typeof fn}`);const result=await fn({plugin,sourcePath:""});if(!Array.isArray(result))throw new Error("The value returned must be an array");return result.forEach(o=>{if(typeof o!="object"||!o)throw new Error(`Expected type of item to be "object" but got type "${typeof o}"`);if(typeof o.value!="string")throw new Error(`Expected typeof item.value to be "string" but got type "${typeof o.value}"`)}),result}),tryRunFileCode$1=async(plugin,filePath)=>tryCatch(async()=>{const normalPath=obsidian.normalizePath(filePath),file=plugin.app.vault.getFileByPath(normalPath);if(!file)throw new Error(`File not found at path "${normalPath}"`);if(!file.extension.toLowerCase().endsWith("js"))throw new Error(`Expected file extension ".js" but got ".${file.extension}"`);const content=await plugin.app.vault.cachedRead(file),module={};if(eval(content),typeof module.default!="function")throw new Error(`Expected typeof module.default to be "function" but got "${typeof module.default}"`);const{success,data,error}=await tryRunInlineCode$1(plugin,module.default);if(success)return data;throw new Error(error)}),renderDefaultSettings=({plugin:o,parentEl:s,settings:e,modal:t,property:n})=>{new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.useDefaultDropdown.title")).setDesc(text("customPropertyTypes.select.settings.useDefaultDropdown.desc")).addToggle(r=>{r.setValue(e.useDefaultStyle??!1).onChange(i=>{e.useDefaultStyle=i})}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsType.title")).setDesc(text("customPropertyTypes.select.settings.optionsType.desc")).addDropdown(r=>{r.addOptions({manual:text("customPropertyTypes.select.settings.optionsType.selectLabelManual"),dynamic:text("customPropertyTypes.select.settings.optionsType.selectLabelDynamic")}).setValue((e==null?void 0:e.optionsType)??"manual").onChange(i=>{const a=i;e.optionsType=a,s.empty(),renderSettings$b({plugin:o,modal:t,property:n})})})},renderManualSettings$1=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsType.selectLabelManual")),renderManualOptionsSetting$1({parentEl:s,settings:e}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.allowCreateTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.allowCreateDesc")).addToggle(t=>t.setValue(e.manualAllowCreate??!1).onChange(n=>{e.manualAllowCreate=n}))},renderManualOptionsSetting$1=({parentEl:o,settings:s})=>{const e=new ListSetting(o).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.optionsTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.optionsDesc")).setValue(s.manualOptions??[]).onChange(t=>s.manualOptions=[...t]).onCreateItem((t,n)=>{if(t===void 0||n===void 0)throw new Error("onCreateItem called with undefined");const{value:r,label:i}=t;n.addDragButton().addText(a=>a.setPlaceholder(text("common.valuePlaceholder")).setValue(r).onChange(l=>{const c=e.value[n.index];c!==void 0&&(c.value=l)}).then(l=>n.onFocus(()=>l.inputEl.focus()))).addText(a=>a.setPlaceholder(text("common.optionalLabelPlaceholder")).setValue(i??"").onChange(l=>{const c=e.value[n.index];c!==void 0&&(c.label=l)})).then(()=>{const a=new SelectColorCombobox$1(n.controlEl),l=Object.entries(selectColors).reduce((c,[d,u])=>(c.push({value:u,label:d}),c),[]);a.addOptions(l),a.setValue(t.bgColor??selectColors.gray),a.onChange(c=>{t.bgColor=c})}).addDeleteButton()}).renderAllItems().addFooterButton(t=>t.setIcon("lucide-sort-asc").onClick(n=>{new obsidian.Menu().setNoIcon().addItem(i=>i.setTitle(text("common.sort.valueAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((a==null?void 0:a.value)??"").localeCompare((l==null?void 0:l.value)??"")),e.renderAllItems()})).addItem(i=>i.setTitle(text("common.sort.valueReverseAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((l==null?void 0:l.value)??"").localeCompare((a==null?void 0:a.value)??"")),e.renderAllItems()})).addItem(i=>i.setTitle(text("common.sort.labelAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((a==null?void 0:a.label)??"").localeCompare((l==null?void 0:l.label)??"")),e.renderAllItems()})).addItem(i=>i.setTitle(text("common.sort.labelReverseAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((l==null?void 0:l.label)??"").localeCompare((a==null?void 0:a.label)??"")),e.renderAllItems()})).showAtMouseEvent(n)})).addFooterButton(t=>t.setCta().setIcon("lucide-plus").onClick(()=>{e.addItem({value:defaultOption$1==null?void 0:defaultOption$1.value,label:defaultOption$1==null?void 0:defaultOption$1.label})}));return e},renderDynamicSettings$1=({plugin:o,parentEl:s,settings:e,modal:t,property:n})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsType.selectLabelDynamic")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.emptyLabelTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.emptyLabelDesc")).addText(r=>{r.setValue(e.dynamicEmptyLabel??"").onChange(i=>{e.dynamicEmptyLabel=i})}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.typeTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.typeDesc")).addDropdown(r=>{r.addOptions({filesInFolder:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolderLabel"),filesFromTag:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTagLabel"),filesFromInlineJs:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJsLabel"),filesFromJsFile:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJsLabel")}).setValue(e.dynamicOptionsType??"filesInFolder").onChange(i=>{const a=i;e.dynamicOptionsType=a,s.empty(),renderSettings$b({plugin:o,modal:t,property:n})})})},renderFilesFromFolderSettings$1=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolderLabel")),renderFolderPathsSetting$1({plugin:o,parentEl:s,settings:e}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.excludeFolderNotes.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.excludeFolderNotes.desc")).addToggle(t=>{t.setValue(e.folderOptionsExcludeFolderNote??!1).onChange(n=>{e.folderOptionsExcludeFolderNote=n})})},renderFilesFromTagSettings$1=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTagLabel")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.tags.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.tags.desc")).then(t=>{const n=new MultiselectComponent(t);n.setValues(e.tagOptionsTags??[]).onChange(r=>e.tagOptionsTags=r).addSuggest(r=>new TagSuggest(o.app,r).setFilter(a=>!n.values.contains(a.tag)).onSelect((a,l)=>{l.preventDefault(),l.stopImmediatePropagation(),r.textContent=a.tag,n.inputEl.blur(),n.inputEl.focus()})).renderValues()}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.includeNestedTags.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.includeNestedTags.desc")).addToggle(t=>t.setValue(e.tagOptionsIncludeNested??!1).onChange(n=>e.tagOptionsIncludeNested=n))},renderFilesFromInlineJsSettings$1=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJsLabel")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.desc")).addTextArea(t=>{t.setValue(e.inlineJsOptionsCode??"").setPlaceholder('(props) => [{value: "apple"}]').onChange(n=>{e.inlineJsOptionsCode=n})}).addExtraButton(t=>{t.setIcon("lucide-copy").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.helpText")).onClick(async()=>{await navigator.clipboard.writeText(selectOptionInlineCodeTemplate$1),new obsidian.Notice(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.copySuccessNotice"))})}).addExtraButton(t=>{t.setIcon("lucide-play-circle").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.runInConsole")).onClick(async()=>{if(!e.inlineJsOptionsCode)return;const{success:n,data:r,error:i}=await tryRunInlineCode$1(o,e.inlineJsOptionsCode);if(n){console.log(r),new obsidian.Notice("Validation successful");return}console.error(i),new obsidian.Notice(createFragment(a=>{a.appendText("Validation failed"),a.createEl("br"),a.appendText(i)}))})})},renderFilesFromFileJsSetings$1=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJsLabel")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.desc")).addText(t=>{t.setValue(e.fileJsOptionsPath??"").onChange(n=>{e.fileJsOptionsPath=n}),new FileSuggest(o.app,t.inputEl).setFilter(n=>n.extension.toLowerCase().endsWith("js")).onSelect(n=>{t.setValue(n.path),t.onChanged()})}).addExtraButton(t=>{t.setIcon("lucide-copy").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.helpText")).onClick(async()=>{await navigator.clipboard.writeText(selectOptionJsFileTemplate$1),new obsidian.Notice(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.copySuccessNotice"))})}).addExtraButton(t=>{t.setIcon("lucide-play-circle").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.runInConsole")).onClick(async()=>{if(!e.fileJsOptionsPath)return;const{success:n,data:r,error:i}=await tryRunFileCode$1(o,e.fileJsOptionsPath);if(n){console.log(r),new obsidian.Notice("Validation successful");return}console.error(i),new obsidian.Notice(createFragment(a=>{a.appendText("Validation failed"),a.createEl("br"),a.appendText(i)}))})})},renderFolderPathsSetting$1=({plugin:o,parentEl:s,settings:e})=>{const t=new ListSetting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.folderPaths.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.folderPaths.desc")).setValue(e.folderOptionsPaths??[]).onCreateItem((n,r)=>{r.addDragButton().addSearch(i=>{i.setValue(n).onChange(a=>{r.list.setItemValue(r.index,a)}),new FolderSuggest(o.app,i.inputEl,{showFileCountAux:!0}).onSelect(a=>{i.setValue(a.path),i.onChanged()})}).addDeleteButton()}).onChange(n=>{e.folderOptionsPaths=n}).renderAllItems().addFooterButton(n=>{n.setIcon("lucide-sort-asc").onClick(r=>{const i=a=>a.split("/").reverse()[0];new obsidian.Menu().setNoIcon().addItem(a=>a.setSection("name").setTitle(text("common.sort.nameAlphabetical")).onClick(()=>{t.sort((l,c)=>i(l).localeCompare(i(c)))})).addItem(a=>a.setSection("name").setTitle(text("common.sort.nameReverseAlphabetical")).onClick(()=>{t.sort((l,c)=>i(c).localeCompare(i(l)))})).addItem(a=>a.setSection("path").setTitle(text("common.sort.pathAlphabetical")).onClick(()=>{t.sort((l,c)=>l.localeCompare(c))})).addItem(a=>a.setSection("path").setTitle(text("common.sort.pathReverseAlphabetical")).onClick(()=>{t.sort((l,c)=>c.localeCompare(l))})).showAtMouseEvent(r)})}).addFooterButton(n=>{n.setCta().setIcon("lucide-plus").onClick(()=>{t.addItem("")})});return t};let SelectColorCombobox$1=class extends ComboboxComponent{constructor(s){super(s)}getValueFromOption(s){return s.value}setValue(s){return super.setValue(s),this.setEmptyClass(!1),this.selectEl.textContent="",this.selectEl.setCssProps({"--better-properties-bg":s}),this}createAuxEl(s){const e=super.createAuxEl(s);return e.remove(),e}onRenderMenuItem(s,e){super.onRenderMenuItem(s,e);const{value:t,label:n}=e;s.titleEl.empty(),s.removeIcon(),s.titleEl.createDiv({cls:"better-properties-select-option",text:n}).setCssProps({"--better-properties-select-bg":t??selectColors.gray})}createSelectEl(s){const e=super.createSelectEl(s);return e.classList.add("better-properties-swatch"),e}createMenu(){const s=super.createMenu();return s.addSectionItem("footer",e=>{e.setIcon("lucide-paintbrush").setTitle("Custom color").setSubmenu().addItem(t=>{t.removeIcon();const n=new ColorTextComponent(t.titleEl);n.setValue(this.getValue()),n.onChange(r=>{this.setValue(r),this.onChanged()}),t.onClick(r=>{r.stopImmediatePropagation(),r.stopPropagation(),n.textComponent.inputEl.focus()})})}),s}};const getDynamicOptions=async({plugin:o,ctx:s,dynamicOptionsType:e,folderOptionsExcludeFolderNote:t,folderOptionsPaths:n,tagOptionsTags:r,tagOptionsIncludeNested:i,inlineJsOptionsCode:a,fileJsOptionsPath:l,dynamicEmptyLabel:c})=>{let d=[];if(e==="filesInFolder"&&(d=getFolderFilesOptions({plugin:o,excludeFolderNote:!!t,sourcePath:s.sourcePath,propertyName:s.key,folderOptionsPaths:n??[]})),e==="filesFromTag"&&(d=getTagOptions({plugin:o,tags:r??[],includeNested:i??!1,sourcePath:s.sourcePath})),e==="filesFromInlineJs"&&a){const{success:u,data:h}=await tryRunInlineCode$1(o,a);u&&(d=h)}if(e==="filesFromJsFile"&&l){const{success:u,data:h}=await tryRunFileCode$1(o,l);u&&(d=h)}return c&&d.unshift({value:"",label:c}),d},getFolderFilesOptions=({plugin:o,excludeFolderNote:s,sourcePath:e,folderOptionsPaths:t})=>(t??[]).reduce((r,i)=>{const a=i===""||i===void 0?"/":i,l=o.app.vault.getFolderByPath(a);if(!l)return[];const c=l.children.reduce((d,u)=>{if(!(u instanceof obsidian.TFile)||u.extension.toLowerCase()!=="md"||s&&l.name===u.basename)return d;const h=o.app.fileManager.generateMarkdownLink(u,e);return d.push({value:h,label:u.basename}),d},[]);return[...r,...c]},[]),getTagOptions=({plugin:o,tags:s,includeNested:e,sourcePath:t})=>{const n=[],r=s.map(a=>a.startsWith("#")?a:"#"+a),i=a=>{n.push({value:o.app.fileManager.generateMarkdownLink(a,t),label:a.basename})};return iterateFileMetadata({vault:o.app.vault,metadataCache:o.app.metadataCache,callback:({file:a,metadata:l})=>{if(!l)return;const c=obsidian.getAllTags(l);if(!c)return;let d=!1;if(e)d=c.some(u=>r.some(h=>h===u||u.startsWith(`${h}/`)));else{const u=new Set(c);d=r.some(h=>u.has(h))}d&&i(a)}}),n},renderWidget$b=({plugin:o,el:s,value:e,ctx:t})=>new SelectTypeComponent(o,s,e,t);class SelectTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","select");p(this,"parseValue",e=>(e==null?void 0:e.toString())??"");p(this,"selectContainerEl");p(this,"component");p(this,"options",[]);this.value=n;const i=this.getSettings();this.selectContainerEl=t.createDiv({cls:"better-properties-select-container"}),this.component=i!=null&&i.useDefaultStyle?new obsidian.DropdownComponent(this.selectContainerEl):new SelectComponent(e,this.selectContainerEl,r.key,!!(i!=null&&i.manualAllowCreate)&&i.optionsType!=="dynamic",r.sourcePath),this.initOptions()}getValue(){return this.component.getValue()}setValue(e){this.component.getValue()!==e&&this.component.setValue(this.parseValue(e)),super.setValue(e)}addOptions(e){if(this.component instanceof SelectComponent){this.component.addOptions(e);return}this.component.addOptions(e.reduce((t,{value:n,label:r})=>(t[n]=r||n,t),{}))}async initOptions(){const e=this.getSettings();this.component instanceof SelectComponent&&(this.component.selectEl.classList.add("better-properties-mod-loader"),obsidian.setIcon(this.component.selectEl,"lucide-loader-2"));const{dynamicOptionsType:t,folderOptionsExcludeFolderNote:n,folderOptionsPaths:r,tagOptionsTags:i,tagOptionsIncludeNested:a,inlineJsOptionsCode:l,fileJsOptionsPath:c,dynamicEmptyLabel:d}=e;this.options=e.optionsType==="manual"?e.manualOptions??[]:await getDynamicOptions({plugin:this.plugin,ctx:this.ctx,dynamicEmptyLabel:d,dynamicOptionsType:t,fileJsOptionsPath:c,folderOptionsExcludeFolderNote:n,folderOptionsPaths:r,inlineJsOptionsCode:l,tagOptionsIncludeNested:a,tagOptionsTags:i}),this.component instanceof SelectComponent&&(this.component.selectEl.classList.remove("better-properties-mod-loader"),this.component.selectEl.empty()),this.addOptions(this.options);const u=this.parseValue(this.value);if(this.component.setValue(u),this.component.onChange(g=>{this.setValue(g)}),this.onFocus=()=>{this.component.selectEl.focus()},!(this.value===""&&this.component instanceof obsidian.DropdownComponent))return;const h=this.component.selectEl.querySelector('option[value=""]');h&&h.setAttribute("selected","true")}}class SelectComponent extends ComboboxComponent{constructor(e,t,n,r,i){super(t);p(this,"selectContainerEl");p(this,"openLinkedFile");p(this,"createOptionItem");this.plugin=e,this.containerEl=t,this.property=n,this.isCreateAllowed=r,this.sourcePath=i,this.selectContainerEl=t.createDiv({cls:"better-properties-select-container"}),this.selectContainerEl.insertAdjacentElement("afterbegin",this.selectEl)}getValueFromOption(e){return e.value}onRenderMenuItem(e,t){super.onRenderMenuItem(e,t);const{value:n,label:r,bgColor:i}=t;e.titleEl.empty(),e.removeIcon(),e.titleEl.createDiv({cls:"better-properties-select-option",text:r||n}).setCssProps({"--better-properties-select-bg":i??selectColors.gray})}createSelectEl(e){const t=super.createSelectEl(e);return t.classList.add("better-properties-select"),t.addEventListener("click",n=>{this.openLinkedFile&&obsidian.Keymap.isModEvent(n)&&(n.stopImmediatePropagation(),this.openLinkedFile(n))},{capture:!0}),t}validateOption(e){return e?!!this.options.find(t=>t.value===e):!0}createAuxEl(e){const t=super.createAuxEl(e);this.selectContainerEl.insertAdjacentElement("beforeend",t);const n=this.getValue();if(!this.validateOption(n)||!(n.startsWith("[[")&&n.endsWith("]]")))return this.openLinkedFile=void 0,t;const r=getFirstLinkPathDest(this.plugin.app.metadataCache,this.sourcePath,n),i=r?text("common.openFile",{fileName:r.name}):obsidianText("interface.empty-state.create-new-file"),a=new obsidian.ExtraButtonComponent(e).setTooltip(i).setIcon("link");return this.openLinkedFile=l=>{this.plugin.app.workspace.openLinkText(n.slice(2,-2),this.sourcePath,obsidian.Keymap.isModEvent(l))},a.extraSettingsEl.addEventListener("click",l=>{var c;(c=this.openLinkedFile)==null||c.call(this,l)}),a.extraSettingsEl}setValue(e){super.setValue(e);const t=this.options.find(n=>n.value===e);return t!=null&&t.label&&(this.selectEl.textContent=t.label),e===""&&(t!=null&&t.label)&&this.setEmptyClass(!1),this.selectEl.setCssProps({"--better-properties-select-bg":(t==null?void 0:t.bgColor)??selectColors.gray}),this}createMenu(){const e=super.createMenu();return this.isCreateAllowed&&e.addSectionItem("footer",t=>{this.createOptionItem=t,t.setIcon("lucide-plus"),this.createOptionItem.dom.classList.add("better-properties-mod-hidden")}),e.addSectionItem("footer",t=>{t.setIcon("lucide-trash-2").setTitle(obsidianText("interface.menu.remove")).onClick(()=>{this.setValue(""),this.onChanged()})}),this.isCreateAllowed&&e.onShow(()=>{const{search:t}=e;t&&t.inputEl.addEventListener("keyup",()=>{if(!this.createOptionItem)return;const n=t.getValue();if(!n){this.createOptionItem.dom.classList.add("better-properties-mod-hidden");return}this.createOptionItem.dom.classList.remove("better-properties-mod-hidden"),this.createOptionItem.setTitle(`Create option "${n}"`).onClick(()=>{this.selectEl.textContent=n,this.options.push({value:n}),this.plugin.saveSettings(),e.close(),this.commitValue()})})}),e}}function around(o,s){const e=Object.keys(s).map(t=>around1(o,t,s[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function around1(o,s,e){const t=o[s],n=o.hasOwnProperty(s),r=n?t:function(){return Object.getPrototypeOf(o)[s].apply(this,arguments)};let i=e(r);return t&&Object.setPrototypeOf(i,t),Object.setPrototypeOf(a,i),o[s]=a,l;function a(...c){return i===r&&o[s]===a&&l(),i.apply(this,c)}function l(){o[s]===a&&(n?o[s]=r:delete o[s]),i!==r&&(i=r,Object.setPrototypeOf(a,t||Function))}}function dedupe(o,s,e){return t[o]=o,t;function t(...n){return(s[o]===o?s:e).apply(this,n)}}const patchMenu=o=>{const s=around(obsidian.Menu.prototype,{showAtMouseEvent(e){return dedupe(monkeyAroundKey,e,function(t){const n=this,r=()=>e.call(n,t),{currentTarget:i}=t;if(!(i instanceof HTMLElement&&i.tagName.toLowerCase()==="span"&&i.classList.contains("metadata-property-icon")))return r();const c=i.closest("div.metadata-property[data-property-key]").getAttribute("data-property-key")??"",d=r();return o.app.workspace.trigger("better-properties:file-property-menu",n,c),d})}});o.register(s)};class VerticalTabModal extends obsidian.Modal{constructor(e){super(e);p(this,"tabHeaderEl");p(this,"tabContentContainerEl");p(this,"tabContentEl");p(this,"backButtonEl");p(this,"tabGroups",[]);p(this,"activeTabIndex",0);p(this,"onTabChangeCallback",()=>{});const{modalEl:t,contentEl:n}=this;t.classList.add("mod-sidebar-layout","mod-settings"),n.classList.add("vertical-tabs-container"),this.tabHeaderEl=n.createDiv({cls:"vertical-tab-header"}),this.tabContentContainerEl=n.createDiv({cls:"vertical-tab-content-container"}),this.tabContentEl=this.tabContentContainerEl.createDiv({cls:"vertical-tab-content"}),this.titleEl.empty(),this.backButtonEl=this.titleEl.createDiv({cls:"modal-setting-back-button"}),obsidian.setIcon(this.backButtonEl.createDiv({cls:"modal-setting-back-button-icon"}),"lucide-chevron-left"),this.backButtonEl.addEventListener("click",()=>{this.backButtonEl.remove(),this.tabContentContainerEl.remove(),this.contentEl.appendChild(this.tabHeaderEl),this.setTitle(this.getTabViewTitle())}),this.titleEl.appendText("")}onClose(){super.onClose.call(this),this.onTabChangeCallback()}onTabChange(e){return this.onTabChangeCallback=e,this}getTabViewTitle(){throw new Error("Method not implemented!")}addTabGroup(e){const t=new TabGroup(this,this.tabHeaderEl);return this.tabGroups.push(t),e(t),t}setTitle(e){const t=this.titleEl.childNodes.values().find(({nodeType:n})=>n===Node.TEXT_NODE);if(!t)throw new Error("Better Properties: Text Node not found in titleEl of vertical tab modal");return t.textContent=e,this}}class TabGroup{constructor(s,e){p(this,"groupEl");p(this,"titleEl");p(this,"itemsEl");p(this,"tabs",[]);this.modal=s,this.groupEl=e.createDiv({cls:"vertical-tab-header-group"}),this.titleEl=this.groupEl.createDiv({cls:"vertical-tab-header-group-title"}),this.itemsEl=this.groupEl.createDiv({cls:"vertical-tab-header-group-items"})}setTitle(s){return this.titleEl.textContent=s,this}addTab(s){const e=new Tab(this,this.itemsEl);return this.tabs.push(e),s(e),this}then(s){return s(this),this}}class Tab{constructor(s,e){p(this,"labelEl");p(this,"title","");p(this,"onSelectCallback",()=>{});this.group=s,this.labelEl=e.createDiv({cls:"vertical-tab-nav-item"}),this.labelEl.addEventListener("click",t=>this.select(t)),obsidian.setIcon(this.labelEl.createDiv({cls:"vertical-tab-nav-item-chevron"}),"lucide-chevron-right")}setTitle(s){return this.labelEl.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),this.title=s,this.labelEl.prepend(s),this}onSelect(s){const{labelEl:e}=this;return this.onSelectCallback=async t=>{const n=e.closest(".vertical-tab-header");if(!n)throw new Error("Tab header element not found");n.querySelectorAll(".vertical-tab-nav-item").forEach(r=>r.classList.remove("is-active")),e.classList.add("is-active"),await s(t)},this}select(s){const{title:e,group:{modal:t}}=this;t.onTabChangeCallback(),t.onTabChangeCallback=()=>{},obsidian.Platform.isMobile&&(t.tabHeaderEl.remove(),t.contentEl.appendChild(t.tabContentContainerEl),t.backButtonEl.remove(),t.titleEl.prepend(t.backButtonEl)),t.setTitle(e),this.onSelectCallback(s)}then(s){return s(this),this}}const registerListeners$b=o=>{},renderSettings$a=({modal:o})=>{const{tabContentEl:s}=o;new obsidian.Setting(s).setName(text("common.nothingToSeeHere")).setDesc(text("common.typeHasNoSettings"))},renderWidget$a=({plugin:o,el:s,ctx:e,value:t})=>new ToggleTypeComponent(o,s,t,e);class ToggleTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","toggle");p(this,"parseValue",e=>!!e);p(this,"toggle");const i=this.parseValue(n);this.toggle=new obsidian.ToggleComponent(t).setValue(i).onChange(a=>{this.setValue(a)}),this.onFocus=()=>{this.toggle.toggleEl.focus()}}getValue(){var e;return!!((e=this.toggle)!=null&&e.getValue())}setValue(e){this.toggle.getValue()!==e&&this.toggle.setValue(this.parseValue(e)),super.setValue(e)}}const typeKey$9="toggle",togglePropertyType={type:typeKey$9,name:()=>text("customPropertyTypes.toggle.name"),icon:"lucide-toggle-left",validate:o=>typeof o=="boolean",registerListeners:registerListeners$b,renderSettings:renderSettings$a,renderWidget:renderWidget$a},toggleSettingsSchema=optional(object({})),registerListeners$a=o=>{},renderSettings$9=({modal:o})=>{const{tabContentEl:s}=o;new obsidian.Setting(s).setName(text("common.nothingToSeeHere")).setDesc(text("common.typeHasNoSettings"))};function resolveEditorPrototype(o){const s=o.embedRegistry.embedByExtension.md({app:o,containerEl:document.createElement("div")},null,"");s.editable=!0,s.showEditor();const e=Object.getPrototypeOf(Object.getPrototypeOf(s.editMode));return s.unload(),e.constructor}const defaultProperties={cursorLocation:{anchor:0,head:0},value:"",cls:"",placeholder:"",focus:!0,filteredExtensions:[],onEditorClick:()=>{},onEnter:(o,s,e)=>(o.options.onSubmit(o),s),onEscape:o=>{o.options.onBlur(o)},onSubmit:()=>{},onBlur:o=>{o.options.onBlur(o)},onFocus:()=>{},onPaste:()=>{},onChange:()=>{}},createEmbeddableMarkdownEditor=({app:o,container:s,options:e,filePath:t})=>{class n extends resolveEditorPrototype(o){constructor(a,l,c,d){super(a,l,{app:a,onMarkdownScroll:()=>{},getMode:()=>"source"});p(this,"options");p(this,"initial_value");p(this,"scope");this.options={...defaultProperties,...c},this.initial_value=this.options.value,this.scope=new obsidian.Scope(this.app.scope),this.scope.register(["Mod"],"Enter",()=>!0),this.owner.editMode=this,this.owner.editor=this.editor;const u=this.app.vault.getFileByPath(d??"");this.owner.file=u,this.set(c.value||"",!0);let h=null;window.setTimeout(()=>{a.workspace.iterateAllLeaves(g=>{g.view instanceof obsidian.MarkdownView&&g.containerEl.contains(this.containerEl)&&(h=g.view)})},0),this.editor.cm.contentDOM.addEventListener("blur",async()=>{if(a.workspace.activeEditor===this.owner){if(h===null)throw new Error("The MarkdownView containing this editor was not found");a.workspace._activeEditor=h,a.workspace.activeEditor=h}this.app.keymap.popScope(this.scope),await this.options.onBlur(this)}),this.editor.cm.contentDOM.addEventListener("focusin",async()=>{this.app.keymap.pushScope(this.scope),this.options.onFocus!==defaultProperties.onFocus&&this.options.onFocus(this)}),this.editorEl.classList.remove("markdown-source-view"),c.cls&&this.editorEl.classList.add(c.cls),c.cursorLocation&&this.editor.cm.dispatch({selection:state.EditorSelection.range(c.cursorLocation.anchor,c.cursorLocation.head)})}get value(){return this.editor.cm.state.doc.toString()}onEditorClick(a,l){super.onEditorClick(a,l),this.options.onEditorClick(a,this,l)}buildLocalExtensions(){const a=super.buildLocalExtensions();return this.options.placeholder&&a.push(view.placeholder(this.options.placeholder)),a.push(view.EditorView.domEventHandlers({paste:l=>{this.options.onPaste(l,this)}})),a.push(state.Prec.highest(view.keymap.of([{key:"Enter",run:()=>this.options.onEnter(this,!1,!1),shift:()=>this.options.onEnter(this,!1,!0)},{key:"Mod-Enter",run:()=>this.options.onEnter(this,!0,!1),shift:()=>this.options.onEnter(this,!0,!0)},{key:"Escape",run:()=>(this.options.onEscape(this),!0),preventDefault:!0}]))),a}getDynamicExtensions(){return super.getDynamicExtensions().filter(a=>!this.options.filteredExtensions.includes(a))}updateBottomPadding(a){return 0}destroy(){this._loaded&&this.unload(),this.app.keymap.popScope(this.scope),this.app.workspace.activeEditor===this.owner&&(this.app.workspace.activeEditor=null),this.containerEl.empty(),super.destroy()}onunload(){super.onunload(),this.destroy()}onload(){super.onload(),this.options.focus&&this.editor.focus()}}return new n(o,s,e,t)};class EmbeddableMarkdownEditor extends resolveEditorPrototype(app){constructor(e,t,n,r){super(e,t,{app:e,onMarkdownScroll:()=>{},getMode:()=>"source"});p(this,"options");p(this,"initial_value");p(this,"scope");this.options={...defaultProperties,...n},this.initial_value=this.options.value,this.scope=new obsidian.Scope(this.app.scope),this.scope.register(["Mod"],"Enter",()=>!0),this.owner.editMode=this,this.owner.editor=this.editor;const i=this.app.vault.getFileByPath(r??"");this.owner.file=i,this.set(n.value||"",!0);let a=null;window.setTimeout(()=>{e.workspace.iterateAllLeaves(l=>{l.view instanceof obsidian.MarkdownView&&l.containerEl.contains(this.containerEl)&&(a=l.view)})},0),this.editor.cm.contentDOM.addEventListener("blur",async()=>{if(e.workspace.activeEditor===this.owner){if(a===null)throw new Error("The MarkdownView containing this editor was not found");e.workspace._activeEditor=a,e.workspace.activeEditor=a}this.app.keymap.popScope(this.scope),await this.options.onBlur(this)}),this.editor.cm.contentDOM.addEventListener("focusin",async()=>{this.app.keymap.pushScope(this.scope),this.options.onFocus!==defaultProperties.onFocus&&this.options.onFocus(this)}),this.editorEl.classList.remove("markdown-source-view"),n.cls&&this.editorEl.classList.add(n.cls),n.cursorLocation&&this.editor.cm.dispatch({selection:state.EditorSelection.range(n.cursorLocation.anchor,n.cursorLocation.head)})}get value(){return this.editor.cm.state.doc.toString()}onEditorClick(e,t){super.onEditorClick(e,t),this.options.onEditorClick(e,this,t)}buildLocalExtensions(){const e=super.buildLocalExtensions();return this.options.placeholder&&e.push(view.placeholder(this.options.placeholder)),e.push(view.EditorView.domEventHandlers({paste:t=>{this.options.onPaste(t,this)}})),e.push(state.Prec.highest(view.keymap.of([{key:"Enter",run:()=>this.options.onEnter(this,!1,!1),shift:()=>this.options.onEnter(this,!1,!0)},{key:"Mod-Enter",run:()=>this.options.onEnter(this,!0,!1),shift:()=>this.options.onEnter(this,!0,!0)},{key:"Escape",run:()=>(this.options.onEscape(this),!0),preventDefault:!0}]))),e}getDynamicExtensions(){return super.getDynamicExtensions().filter(e=>!this.options.filteredExtensions.includes(e))}updateBottomPadding(e){return 0}destroy(){this._loaded&&this.unload(),this.app.keymap.popScope(this.scope),this.app.workspace.activeEditor===this.owner&&(this.app.workspace.activeEditor=null),this.containerEl.empty(),super.destroy()}onunload(){super.onunload(),this.destroy()}onload(){super.onload(),this.options.focus&&this.editor.focus()}}const renderWidget$9=({plugin:o,el:s,ctx:e,value:t})=>new MarkdownTypeComponent(o,s,t,e);class MarkdownTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","markdown");p(this,"parseValue",e=>(e==null?void 0:e.toString())??"");p(this,"embeddedMarkdownEditor");const i=this.parseValue(n);this.embeddedMarkdownEditor=createEmbeddableMarkdownEditor({app:e.app,container:t,options:{value:i,onBlur:a=>{var c;const l=((c=a.editor)==null?void 0:c.getValue())??"";this.setValue(l)},placeholder:obsidianText("properties.label-no-value")},filePath:r.sourcePath}),this.onFocus=()=>{this.embeddedMarkdownEditor.focus()},e.app.vault.getConfig("showLineNumber")||t.setAttribute("data-better-properties-showLineNumber","false")}getValue(){var e;return((e=this.embeddedMarkdownEditor.editor)==null?void 0:e.getValue())??""}setValue(e){var t,n;((t=this.embeddedMarkdownEditor.editor)==null?void 0:t.getValue())!==e&&((n=this.embeddedMarkdownEditor.editor)==null||n.setValue(this.parseValue(e))),super.setValue(e)}}const markdownPropertyType={type:"markdown",name:()=>text("customPropertyTypes.markdown.name"),icon:"lucide-m-square",validate:o=>typeof o=="string",registerListeners:registerListeners$a,renderSettings:renderSettings$9,renderWidget:renderWidget$9},markdownSettingsSchema=optional(object({})),registerListeners$9=o=>{o.registerEvent(o.app.metadataTypeManager.on("changed",s=>{var t;if(!(s!=null&&s.includes(".")))return;const e=(t=s.split(".")[0])==null?void 0:t.toLowerCase();e&&o.app.metadataTypeManager.trigger("changed",e)}))};class ConfirmationModal extends obsidian.Modal{constructor(e){super(e);p(this,"buttonContainerEl");p(this,"checkbox");this.buttonContainerEl=this.modalEl.createDiv({cls:"modal-button-container"})}setFooterCheckbox(e){return this.checkbox=new Checkbox(this.buttonContainerEl),e(this.checkbox),this}addFooterButton(e){const t=new obsidian.ButtonComponent(this.buttonContainerEl);return e(t),this}}class Checkbox{constructor(s){p(this,"inputEl");p(this,"labelEl");p(this,"labelTextNode");p(this,"onChangeCallback",()=>{});this.containerEl=s,this.labelEl=s.createEl("label",{cls:"mod-checkbox"}),this.inputEl=this.labelEl.createEl("input",{attr:{tabindex:"-1",type:"checkbox"}}),this.labelTextNode=document.createTextNode(""),this.labelEl.appendChild(this.labelTextNode),this.inputEl.addEventListener("change",()=>this.onChangeCallback(this.inputEl.checked))}setLabel(s){return this.labelTextNode.textContent=s,this}setValue(s){return this.inputEl.checked=s,this}onChange(s){return this.onChangeCallback=s,this}}class PropertyComponent extends obsidian.ValueComponent{constructor(e,t,n,r,i){super();p(this,"propertyEl");p(this,"keyEl");p(this,"iconEl");p(this,"keyInputEl");p(this,"valueEl");p(this,"mismatchEl");p(this,"keyWithoutDots");p(this,"onChangeCallback",()=>{});p(this,"onUpdateKeyCallback",()=>{});this.plugin=e,this.containerEl=t,this.key=n,this.value=r,this.sourcePath=i,this.keyWithoutDots=n.split(".").reverse()[0]}render(){return this.propertyEl=this.createPropertyEl(),this.keyEl=this.createKeyEl(this.propertyEl),this.iconEl=this.createIconEl(this.keyEl),this.keyInputEl=this.createKeyInputEl(this.keyEl),this.valueEl=this.createValueEl(this.propertyEl),this.mismatchEl=this.createMismatchEl(this.propertyEl,this.valueEl),this.renderWidget(this.valueEl,this.getTypeInfo().inferred)}setValue(e){return this.value=e,this}getValue(){return this.value}onChange(e){return this.onChangeCallback=e,this}onKeyChange(e){return this.onUpdateKeyCallback=e,this}onChanged(){this.onChangeCallback(this.getValue())}getTypeInfo(){return this.plugin.app.metadataTypeManager.getTypeInfo(this.key,this.value)}updateKey(e){this.onUpdateKeyCallback(e)}remove(){var e;(e=this.propertyEl)==null||e.remove()}async copy(){await navigator.clipboard.writeText(obsidian.stringifyYaml({[this.keyWithoutDots]:this.getValue()}))}renderWidget(e,t){return e.empty(),t.render(e,this.value,{app:this.plugin.app,blur:()=>{},key:this.key,onChange:n=>{this.onChangeCallback(n)},sourcePath:this.sourcePath})}createPropertyEl(){return this.containerEl.createDiv({cls:"metadata-property",attr:{tabindex:"0","data-property-key":this.key}})}createKeyEl(e){return e.createDiv({cls:"metadata-property-key"})}createIconEl(e){const t=e.createSpan({cls:"metadata-property-icon"});return obsidian.setIcon(t,this.getTypeInfo().expected.icon),t.addEventListener("click",n=>{new obsidian.Menu().addItem(r=>{r.setSection("action").setTitle(obsidianText("properties.option-property-type")).setIcon("lucide-info"),r.setSubmenu()}).addItem(r=>r.setSection("clipboard").setIcon("lucide-scissors").setTitle(obsidianText("interface.menu.cut")).onClick(async()=>{await this.copy(),this.remove()})).addItem(r=>r.setSection("clipboard").setIcon("lucide-copy").setTitle(obsidianText("interface.menu.copy")).onClick(async()=>{await this.copy()})).addItem(r=>r.setSection("clipboard").setIcon("lucide-clipboard-check").setTitle(obsidianText("interface.menu.paste"))).addItem(r=>r.setSection("danger").setWarning(!0).setIcon("lucide-trash-2").setTitle(obsidianText("interface.menu.remove")).onClick(async()=>{this.remove()})).showAtMouseEvent(n)}),t}createKeyInputEl(e){const t=e.createEl("input",{cls:"metadata-property-key-input",type:"text",attr:{autocapitalize:"none",enterkeyhint:"next","aria-label":this.key}});return t.value=this.keyWithoutDots,this.keyWithoutDots===""&&t.focus(),t.addEventListener("blur",n=>{this.updateKey(n.target.value)}),t.addEventListener("keydown",n=>{n.key==="Enter"&&this.updateKey(n.target.value)}),t}createValueEl(e){const t=e.createDiv({cls:"metadata-property-value"});return t.addEventListener("keydown",n=>{n.key==="Enter"&&n.target instanceof HTMLElement&&n.target.blur()}),t}createMismatchEl(e,t){const{expected:n,inferred:r}=this.getTypeInfo(),i=e.createDiv({cls:"clickable-icon metadata-property-warning-icon",attr:{"aria-label":obsidianText("properties.label-type-mismatch-warning",{type:n.name()})}});return obsidian.setIcon(i,"lucide-alert-triangle"),n.type===r.type&&i.classList.add("better-properties-mod-hidden"),i.addEventListener("click",()=>{const a=new ConfirmationModal(this.plugin.app);a.setTitle(obsidianText("properties.label-change-property-type",{type:n.type})),a.setContent(obsidianText("properties.label-change-property-type-desc",{oldType:r.type})),a.addFooterButton(l=>l.setButtonText(obsidianText("dialogue.button-update")).setCta().onClick(()=>{a.close(),this.renderWidget(t,n)})),a.addFooterButton(l=>l.setButtonText(obsidianText("dialogue.button-cancel")).onClick(()=>{a.close()})),a.open()}),i}}const typeKey$8="object",renderWidget$8=({plugin:o,el:s,ctx:e,value:t})=>new GroupTypeComponent(o,s,t,e);class GroupTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","object");p(this,"parseValue",e=>typeof e!="object"||!e?{}:e);p(this,"subProperties",[]);this.render()}render(){const e=this.parseValue(this.value),t=this.getSettings(),n=this.el.createDiv({cls:"better-properties-property-value-inner better-properties-mod-object metadata-container",attr:{tabindex:"0","data-better-properties-showindentguide":!!this.plugin.app.vault.getConfig("showIndentGuide")}}),r=n.createDiv({cls:"better-properties-property-object-properties"}),i=(a,l)=>{const c=new SubPropertyComponent$1(this.plugin,r,a,l,this.ctx);this.subProperties.push(c),c.render()};if(!t.hideAddButton){const a=n.createDiv({cls:"better-properties-property-object-add-property metadata-add-button text-icon-button"});obsidian.setIcon(a.createSpan({cls:"text-button-icon"}),"lucide-plus"),a.createSpan({cls:"text-button-label",text:obsidianText("properties.label-add-property-button")}),a.addEventListener("click",()=>{i("",null)})}for(const[a,l]of Object.entries(e))i(a,l);this.onFocus=()=>{const a=r.querySelector("& > .metadata-property");a==null||a.focus()}}getValue(){return this.parseValue(this.value)}setValue(e){super.setValue(e);const t=this.parseValue(e);JSON.stringify(t)!==JSON.stringify(this.getValue())&&this.render()}}let SubPropertyComponent$1=class extends PropertyComponent{constructor(e,t,n,r,i){super(e,t,i.key+"."+n,r,i.sourcePath);p(this,"onChangeCallback",e=>{this.parentCtx.onChange({...this.parentValue,[this.keyWithoutDots]:e})});this.parentCtx=i}get parentValue(){var n;const e=this.plugin.app.vault.getFileByPath(this.sourcePath);if(!e)throw new Error(`File not found at path "${this.sourcePath}"`);const{frontmatter:t}=this.plugin.app.metadataCache.getFileCache(e)??{};if(this.parentCtx.index!==void 0){const r=this.parentCtx.key.split(".");r.pop();const i=r.join(".");return((n=t==null?void 0:t[i])==null?void 0:n[this.parentCtx.index])??{}}return(t==null?void 0:t[this.parentCtx.key])??{}}updateParent(e){const t=e(this.parentValue);this.parentCtx.onChange(t),triggerPropertyTypeChange(this.plugin.app.metadataTypeManager,this.key)}remove(){this.updateParent(e=>({...e,[this.keyWithoutDots]:void 0}))}updateKey(e){var r,i;const t=this.parentCtx.key+"."+e;if(e===this.keyWithoutDots)return;if(e===""){this.remove();return}if(Object.keys(this.parentValue).some(a=>a.toLowerCase()===e.toLowerCase())){const a=(r=this.containerEl.closest(".metadata-container:not(.better-properties-mod-object)"))==null?void 0:r.querySelector(`.metadata-property[data-property-key="${t}" i]`);if(a&&flashElement(a),!((i=this.keyInputEl)!=null&&i.isActiveElement())){this.remove();return}obsidian.displayTooltip(this.propertyEl,obsidianText("properties.msg-duplicate-property-name"),{classes:["mod-error"]});return}if(this.keyWithoutDots===""){this.updateParent(a=>({...a,[e]:null}));return}this.updateParent(a=>Object.entries(a).reduce((l,[c,d])=>c!==this.keyWithoutDots?(l[c]=d,l):(l[e]=d,l),{}))}createIconEl(e){const t=super.createIconEl(e);return this.propertyEl&&makeDraggable({itemEl:this.propertyEl,dragHandleEl:t,parentEl:this.containerEl,itemsQuerySelector:"& > .metadata-property",onDragEnd:(n,r)=>{this.updateParent(i=>{const a=Object.entries(i),l=arrayMove(a,n,r);return Object.fromEntries(l)})}}),t}};const renderSettings$8=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$8});o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$8,typeSettings:n})}),new obsidian.Setting(t).setName(text("customPropertyTypes.object.settings.hideAddButton.title")).setDesc(text("customPropertyTypes.object.settings.hideAddButton.desc")).addToggle(r=>{r.setValue(!!n.hideAddButton).onChange(i=>{n.hideAddButton=i})})},objectPropertyType={type:"object",name:()=>text("customPropertyTypes.object.name"),icon:"lucide-braces",validate:o=>o==null||typeof o=="object"&&!Array.isArray(o),registerListeners:registerListeners$9,renderSettings:renderSettings$8,renderWidget:renderWidget$8},objectSettingsSchema=optional(object({hideAddButton:optional(boolean())})),registerListeners$8=o=>{},renderSettings$7=({modal:o})=>{const{tabContentEl:s}=o;new obsidian.Setting(s).setName(text("common.nothingToSeeHere")).setDesc(text("common.typeHasNoSettings"))},renderWidget$7=({plugin:o,el:s,ctx:e,value:t})=>new ColorTypeComponent(o,s,t,e);class ColorTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","color");p(this,"parseValue",e=>(e==null?void 0:e.toString())??"");p(this,"colorText");const i=this.parseValue(n);this.colorText=new ColorTextComponent(t).setValue(i).onChange(a=>{this.setValue(a)}),this.onFocus=()=>{this.colorText.colorInputEl.focus()}}getValue(){return this.colorText.getValue()??""}setValue(e){this.colorText.getValue()!==e&&this.colorText.setValue(this.parseValue(e)),super.setValue(e)}}const colorPropertyType={type:"color",name:()=>text("customPropertyTypes.color.name"),icon:"lucide-paintbrush",validate:o=>typeof o=="string",registerListeners:registerListeners$8,renderSettings:renderSettings$7,renderWidget:renderWidget$7},colorSettingsSchema=optional(object({})),registerListeners$7=o=>{};class IconSuggest extends InputSuggest{getSuggestions(s){const e=obsidian.getIconIds();if(!s)return e;const t=s.toLowerCase();return e.filter(n=>n.toLowerCase().includes(t))}parseSuggestion(s){return{title:s,icon:" "}}renderSuggestion(s,e){super.renderSuggestion.call(this,s,e);const t=e.querySelector(".suggestion-flair");t instanceof HTMLElement&&obsidian.setIcon(t,s)}}const renderSettings$6=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$7});o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$7,typeSettings:{...n}})}),new obsidian.Setting(t).setName(text("customPropertyTypes.rating.settings.icon.title")).setDesc(text("customPropertyTypes.rating.settings.icon.desc")).addSearch(r=>{r.setValue(n.icon??"").onChange(i=>{n.icon=i||void 0}),new IconSuggest(s.app,r.inputEl).onSelect(i=>{r.setValue(i),r.onChanged()})}),new obsidian.Setting(t).setName(text("customPropertyTypes.rating.settings.count.title")).setDesc(text("customPropertyTypes.rating.settings.count.desc")).addText(r=>{var i;r.setValue(((i=n.count)==null?void 0:i.toString())??"").onChange(a=>{const l=Number(a);n.count=!a||Number.isNaN(l)?void 0:l})})},renderWidget$6=({plugin:o,el:s,ctx:e,value:t})=>new RatingTypeComponent(o,s,t,e);class RatingTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","rating");p(this,"parseValue",e=>{const t=Number(e);return Number.isNaN(t)?0:t});p(this,"rating");const i=this.getSettings(),a=Math.max(1,i.count??5),c=(d=>clampNumber(Number(d),0,a))(this.parseValue(n));this.rating=new RatingComponent(t).setIcon(i.icon??"").setMax(a).setValue(c).onChange(d=>{this.setValue(d)}),this.rating.render(),this.onFocus=()=>{var d;(d=this.rating.checkboxEls[0])==null||d.focus()}}getValue(){return this.rating.getValue()}setValue(e){this.rating.getValue()!==e&&this.rating.setValue(this.parseValue(e)),super.setValue(e)}}class RatingComponent extends obsidian.ValueComponent{constructor(e){super();p(this,"max",5);p(this,"value",0);p(this,"icon","lucide-star");p(this,"inputContainer");p(this,"onChangeCallback",()=>{});p(this,"checkboxEls",[]);this.containerEl=e,this.inputContainer=e.createDiv({cls:"better-properties-rating-container",attr:{role:"group"}})}setMax(e){return this.max=Math.max(0,e),this}setIcon(e){return e?(this.icon=e,this):(this.icon="lucide-star",this)}onChange(e){return this.onChangeCallback=e,this}onChanged(){this.onChangeCallback(this.getValue())}setValue(e){return this.value=e,this.commitRating(),this}getValue(){return this.value}commitRating(){this.checkboxEls.forEach((e,t)=>{if(t<this.getValue()){e.setAttribute("aria-checked","true");return}e.removeAttribute("aria-checked")})}render(){this.inputContainer.empty(),this.checkboxEls=[];for(let e=0;e<this.max;e++){const t=e+1,n=this.inputContainer.createDiv({cls:"better-properties-rating-checkbox clickable-icon",attr:{role:"checkbox",tabindex:"0","aria-label":t}});obsidian.setIcon(n,this.icon);const r=()=>{this.setValue(t===this.getValue()?t-1:t),this.onChanged()};n.addEventListener("click",r),n.addEventListener("keydown",i=>{var l,c,d,u;(i.key===" "||i.key==="Enter")&&(r(),i.preventDefault()),i.key==="ArrowLeft"&&((l=this.checkboxEls[e-1])==null||l.focus(),i.preventDefault()),i.key==="ArrowRight"&&((c=this.checkboxEls[e+1])==null||c.focus(),i.preventDefault()),i.key==="ArrowUp"&&((d=this.checkboxEls[0])==null||d.focus(),i.preventDefault()),i.key==="ArrowDown"&&((u=this.checkboxEls[this.checkboxEls.length-1])==null||u.focus(),i.preventDefault());const a=Number(i.key);Number.isNaN(a)||(this.setValue(a),i.preventDefault())}),this.checkboxEls.push(n)}this.commitRating()}}const typeKey$7="rating",ratingPropertyType={type:typeKey$7,name:()=>text("customPropertyTypes.rating.name"),icon:"lucide-star",validate:o=>typeof o=="number",registerListeners:registerListeners$7,renderSettings:renderSettings$6,renderWidget:renderWidget$6},ratingSettingsSchema=optional(object({icon:optional(string()),count:optional(number())})),registerListeners$6=o=>{},renderSettings$5=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$6});o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$6,typeSettings:{...n}})}),new obsidian.Setting(t).setName(text("customPropertyTypes.datecustom.settings.type.title")).setDesc(text("customPropertyTypes.datecustom.settings.type.desc")).addDropdown(i=>{i.addOptions({date:text("datetime.date"),"datetime-local":text("datetime.dateAndTime")}).setValue(n.type??"date").onChange(a=>{n.type=a})});let r=()=>{};new obsidian.Setting(t).setName(text("customPropertyTypes.datecustom.settings.format.title")).setDesc(createFragment(i=>{i.appendText(text("customPropertyTypes.datecustom.settings.format.desc")),i.appendText(" "),i.createEl("a",{text:obsidianText("plugins.daily-notes.label-syntax-link"),href:"https://momentjs.com/docs/#/displaying/format/",attr:{target:"_blank",rel:"noopener"}}),i.createEl("br"),i.appendText(obsidianText("plugins.daily-notes.label-syntax-live-preview"));const a=i.createEl("b",{cls:"u-pop"});r=()=>{const l=obsidian.moment().format(n.format??"YYYY-MM-DD");a.textContent=l},r()})).addText(i=>{i.setPlaceholder("YYYY-MM-DD").setValue(n.format??"").onChange(a=>{n.format=a||void 0,r()})}),new obsidian.Setting(t).setName(text("customPropertyTypes.datecustom.settings.placeholder.title")).setDesc(text("customPropertyTypes.datecustom.settings.placeholder.desc")).addText(i=>{i.setPlaceholder(obsidianText("interface.empty-state.empty")).setValue(n.placeholder??"").onChange(a=>{n.placeholder=a||void 0})}),new obsidian.Setting(t).setName(text("customPropertyTypes.datecustom.settings.icon.title")).setDesc(text("customPropertyTypes.datecustom.settings.icon.desc")).addSearch(i=>{i.setValue(n.icon??"").onChange(a=>{n.icon=a||void 0}),new IconSuggest(s.app,i.inputEl).onSelect(a=>{i.setValue(a),i.onChanged()})})},renderWidget$5=({plugin:o,el:s,ctx:e,value:t})=>new DateTypeComponent(o,s,t,e);class DateTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","datecustom");p(this,"parseValue",e=>(e==null?void 0:e.toString())??"");p(this,"inputEl");p(this,"formatEl");p(this,"value");p(this,"rawFormat","");this.value=this.parseValue(n),this.render(),this.onFocus=()=>{var i;(i=this.inputEl)==null||i.focus()}}render(){this.containerEl.empty();const e=this.getSettings(),t="data-better-properties-is-empty",n=e.format??"YYYY-MM-DD",r=e.placeholder??obsidianText("interface.empty-state.empty"),i=e.icon??"lucide-calendar",a=e.type??"date";this.rawFormat=a==="date"?"YYYY-MM-DD":"YYYY-MM-DDTHH:mm";const l=a==="date"?"9999-12-31":"9999-12-31T23:59",c=this.value?obsidian.moment(this.parseValue(this.value)):void 0,d=this.containerEl.createDiv({cls:"better-properties-datecustom-button-container"});this.inputEl=d.createEl("input",{type:a,attr:{max:l,placeholder:obsidianText("interface.empty-state.empty"),"aria-hidden":"true"}});const u=d.createDiv({cls:"better-properties-datecustom-button clickable-icon",attr:{role:"button",tabindex:"0"}});obsidian.setIcon(u,i),u.addEventListener("click",()=>{var h;(h=this.inputEl)==null||h.showPicker()}),u.addEventListener("keydown",h=>{var g;h.key===" "&&((g=this.inputEl)==null||g.showPicker())}),this.formatEl=this.containerEl.createDiv({cls:"better-properties-datecustom-format metadata-input-longtext",text:(c==null?void 0:c.format(n))??r,attr:{[t]:!this.value||null}}),this.inputEl.addEventListener("change",h=>{const g=h.target.value;if(!g&&this.formatEl){this.formatEl.textContent=r,this.formatEl.setAttribute(t,"true"),this.setValue(null);return}const f=obsidian.moment(g==null?void 0:g.toString());f.isValid()&&this.formatEl&&(this.formatEl.removeAttribute(t),this.formatEl.textContent=f.format(n)),this.setValue(f.format(this.rawFormat))})}getValue(){var e;return((e=this.inputEl)==null?void 0:e.value)??""}setValue(e){var n;super.setValue(e);const t=obsidian.moment(this.parseValue(e)).format(this.rawFormat);this.inputEl&&((n=this.inputEl)==null?void 0:n.value)!==t&&this.render()}}const typeKey$6="datecustom",dateCustomPropertyType={type:typeKey$6,name:()=>text("customPropertyTypes.datecustom.name"),icon:"lucide-calendar-plus",validate:o=>!0,registerListeners:registerListeners$6,renderSettings:renderSettings$5,renderWidget:renderWidget$5},dateCustomSettingsSchema=optional(object({type:optional(union([literal("date"),literal("datetime-local")])),format:optional(string()),placeholder:optional(string()),icon:optional(string())})),registerListeners$5=o=>{},renderSettings$4=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$5});o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$5,typeSettings:{...n}})}),new obsidian.Setting(t).setName(text("customPropertyTypes.slider.settings.min.title")).setDesc(text("customPropertyTypes.slider.settings.min.desc")).addText(r=>{var i;r.inputEl.setAttribute("type","number"),r.inputEl.setAttribute("inputmode","decimal"),r.setPlaceholder("0").setValue(((i=n.min)==null?void 0:i.toString())??"").onChange(a=>{if(!a){n.min=void 0;return}n.min=Number(a)})}),new obsidian.Setting(t).setName(text("customPropertyTypes.slider.settings.max.title")).setDesc(text("customPropertyTypes.slider.settings.max.desc")).addText(r=>{var i;r.inputEl.setAttribute("type","number"),r.inputEl.setAttribute("inputmode","decimal"),r.setPlaceholder("100").setValue(((i=n.max)==null?void 0:i.toString())??"").onChange(a=>{if(!a){n.max=void 0;return}n.max=Number(a)})}),new obsidian.Setting(t).setName(text("customPropertyTypes.slider.settings.step.title")).setDesc(text("customPropertyTypes.slider.settings.step.desc")).addText(r=>{var i;r.inputEl.setAttribute("type","number"),r.inputEl.setAttribute("inputmode","decimal"),r.setPlaceholder("1").setValue(((i=n.step)==null?void 0:i.toString())??"").onChange(a=>{if(!a){n.step=void 0;return}n.step=Number(a)})}),new obsidian.Setting(t).setName(text("customPropertyTypes.slider.settings.hideLimits.title")).setDesc(text("customPropertyTypes.slider.settings.hideLimits.desc")).addToggle(r=>{r.setValue(!!n.hideLimits).onChange(i=>{n.hideLimits=i})})},renderWidget$4=({plugin:o,el:s,ctx:e,value:t})=>new SliderTypeComponent(o,s,t,e);class SliderTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","slider");p(this,"parseValue",e=>{const t=Number(e);return Number.isNaN(t)?0:t});p(this,"slider");const i=this.getSettings(),a=i.min??0,l=i.max??100,c=i.step??1,u=(g=>clampNumber(Number(g),a,l))(this.parseValue(n)),h=t.createDiv({cls:"better-properties-slider-container",attr:{"data-better-properties-slider-hide-limit":i.hideLimits??null}});h.createDiv({cls:"better-properties-slider-limit",text:a.toString()}),this.slider=new obsidian.SliderComponent(h).setValue(u).onChange(g=>{this.setValue(g)}).setLimits(a,l,c).setDynamicTooltip(),h.createDiv({cls:"better-properties-slider-limit",text:l.toString()}),this.onFocus=()=>{this.slider.sliderEl.focus()}}getValue(){return this.slider.getValue()}setValue(e){this.slider.getValue()!==e&&this.slider.setValue(this.parseValue(e)),super.setValue(e)}}const typeKey$5="slider",sliderPropertyType={type:typeKey$5,name:()=>text("customPropertyTypes.slider.name"),icon:"lucide-git-commit",validate:o=>typeof o=="number",registerListeners:registerListeners$5,renderSettings:renderSettings$4,renderWidget:renderWidget$4},sliderSettingsSchema=optional(object({min:optional(number()),max:optional(number()),step:optional(number()),hideLimits:optional(boolean())})),registerListeners$4=o=>{},renderSettings$3=({modal:o})=>{const{tabContentEl:s}=o;new obsidian.Setting(s).setName(text("common.nothingToSeeHere")).setDesc(text("common.typeHasNoSettings"))},renderWidget$3=({plugin:o,el:s,ctx:e,value:t})=>new TimeTypeComponent(o,s,t,e);class TimeTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","time");p(this,"parseValue",e=>(e==null?void 0:e.toString())??"");p(this,"inputEl");const i=this.parseValue(n);this.inputEl=t.createEl("input",{type:"time",cls:["metadata-input-text","mod-date"],attr:{placeholder:obsidianText("interface.empty-state.empty")}}),this.inputEl.value=i,this.inputEl.addEventListener("change",()=>{this.setValue(this.inputEl.value)}),this.onFocus=()=>{this.inputEl.focus()}}getValue(){return this.inputEl.value}setValue(e){this.inputEl.value!==e&&(this.inputEl.value=this.parseValue(e)),super.setValue(e)}}const typeKey$4="time",timePropertyType={type:typeKey$4,name:()=>text("customPropertyTypes.time.name"),icon:"lucide-clock",validate:o=>typeof o=="string",registerListeners:registerListeners$4,renderSettings:renderSettings$3,renderWidget:renderWidget$3},timeSettingsSchema=optional(object({})),registerListeners$3=o=>{},selectOptionInlineCodeTemplate=`async (props) => {
	const appleOption = {
		value: "apple",
		label: "Apple", // optional
		bgColor: "red", // optional
	};
	const bananaoption = {
		value: "banana",
	};
	const arr = [appleOption, bananaoption];
	return arr;
};`,selectOptionJsFileTemplate="module.default = "+selectOptionInlineCodeTemplate,defaultOption={value:"",label:""},tryRunInlineCode=async(plugin,fnString)=>tryCatch(async()=>{const fn=typeof fnString=="string"?eval(fnString):fnString;if(typeof fn!="function")throw new Error(`Expected type "function" but got type ${typeof fn}`);const result=await fn({plugin,sourcePath:""});if(!Array.isArray(result))throw new Error("The value returned must be an array");return result.forEach(o=>{if(typeof o!="object"||!o)throw new Error(`Expected type of item to be "object" but got type "${typeof o}"`);if(typeof o.value!="string")throw new Error(`Expected typeof item.value to be "string" but got type "${typeof o.value}"`)}),result}),tryRunFileCode=async(plugin,filePath)=>tryCatch(async()=>{const normalPath=obsidian.normalizePath(filePath),file=plugin.app.vault.getFileByPath(normalPath);if(!file)throw new Error(`File not found at path "${normalPath}"`);if(!file.extension.toLowerCase().endsWith("js"))throw new Error(`Expected file extension ".js" but got ".${file.extension}"`);const content=await plugin.app.vault.cachedRead(file),module={};if(eval(content),typeof module.default!="function")throw new Error(`Expected typeof module.default to be "function" but got "${typeof module.default}"`);const{success,data,error}=await tryRunInlineCode(plugin,module.default);if(success)return data;throw new Error(error)}),renderManualSettings=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsType.selectLabelManual")),renderManualOptionsSetting({parentEl:s,settings:e}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.allowCreateTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.allowCreateDesc")).addToggle(t=>t.setValue(e.manualAllowCreate??!1).onChange(n=>{e.manualAllowCreate=n}))},renderManualOptionsSetting=({parentEl:o,settings:s})=>{const e=new ListSetting(o).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.optionsTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.manual.optionsDesc")).setValue(s.manualOptions??[]).onChange(t=>s.manualOptions=[...t]).onCreateItem((t,n)=>{if(t===void 0||n===void 0)throw new Error("onCreateItem called with undefined");const{value:r,label:i}=t;n.addDragButton().addText(a=>a.setPlaceholder(text("common.valuePlaceholder")).setValue(r).onChange(l=>{const c=e.value[n.index];c!==void 0&&(c.value=l)}).then(l=>n.onFocus(()=>l.inputEl.focus()))).addText(a=>a.setPlaceholder(text("common.optionalLabelPlaceholder")).setValue(i??"").onChange(l=>{const c=e.value[n.index];c!==void 0&&(c.label=l)})).then(()=>{const a=new SelectColorCombobox(n.controlEl),l=Object.entries(selectColors).reduce((c,[d,u])=>(c.push({value:u,label:d}),c),[]);a.addOptions(l),a.setValue(t.bgColor??selectColors.gray),a.onChange(c=>{t.bgColor=c})}).addDeleteButton()}).renderAllItems().addFooterButton(t=>t.setIcon("lucide-sort-asc").onClick(n=>{new obsidian.Menu().setNoIcon().addItem(i=>i.setTitle(text("common.sort.valueAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((a==null?void 0:a.value)??"").localeCompare((l==null?void 0:l.value)??"")),e.renderAllItems()})).addItem(i=>i.setTitle(text("common.sort.valueReverseAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((l==null?void 0:l.value)??"").localeCompare((a==null?void 0:a.value)??"")),e.renderAllItems()})).addItem(i=>i.setTitle(text("common.sort.labelAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((a==null?void 0:a.label)??"").localeCompare((l==null?void 0:l.label)??"")),e.renderAllItems()})).addItem(i=>i.setTitle(text("common.sort.labelReverseAlphabetical")).onClick(()=>{e.value.sort((a,l)=>((l==null?void 0:l.label)??"").localeCompare((a==null?void 0:a.label)??"")),e.renderAllItems()})).showAtMouseEvent(n)})).addFooterButton(t=>t.setCta().setIcon("lucide-plus").onClick(()=>{e.addItem({value:defaultOption==null?void 0:defaultOption.value,label:defaultOption==null?void 0:defaultOption.label})}));return e},renderDynamicSettings=({plugin:o,parentEl:s,settings:e,modal:t,property:n})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsType.selectLabelDynamic")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.typeTitle")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.typeDesc")).addDropdown(r=>{r.addOptions({filesInFolder:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolderLabel"),filesFromTag:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTagLabel"),filesFromInlineJs:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJsLabel"),filesFromJsFile:text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJsLabel")}).setValue(e.dynamicOptionsType??"filesInFolder").onChange(i=>{const a=i;e.dynamicOptionsType=a,s.empty(),renderSettings$2({plugin:o,modal:t,property:n})})})},renderFilesFromFolderSettings=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolderLabel")),renderFolderPathsSetting({plugin:o,parentEl:s,settings:e}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.excludeFolderNotes.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.excludeFolderNotes.desc")).addToggle(t=>{t.setValue(e.folderOptionsExcludeFolderNote??!1).onChange(n=>{e.folderOptionsExcludeFolderNote=n})})},renderFilesFromTagSettings=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTagLabel")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.tags.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.tags.desc")).then(t=>{const n=new MultiselectComponent(t);n.setValues(e.tagOptionsTags??[]).onChange(r=>e.tagOptionsTags=r).addSuggest(r=>new TagSuggest(o.app,r).setFilter(a=>!n.values.contains(a.tag)).onSelect((a,l)=>{l.preventDefault(),l.stopImmediatePropagation(),r.textContent=a.tag,n.inputEl.blur(),n.inputEl.focus()})).renderValues()}),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.includeNestedTags.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromTag.includeNestedTags.desc")).addToggle(t=>t.setValue(e.tagOptionsIncludeNested??!1).onChange(n=>e.tagOptionsIncludeNested=n))},renderFilesFromInlineJsSettings=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJsLabel")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.desc")).addTextArea(t=>{t.setValue(e.inlineJsOptionsCode??"").setPlaceholder('(props) => [{value: "apple"}]').onChange(n=>{e.inlineJsOptionsCode=n})}).addExtraButton(t=>{t.setIcon("lucide-copy").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.helpText")).onClick(async()=>{await navigator.clipboard.writeText(selectOptionInlineCodeTemplate),new obsidian.Notice(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.copySuccessNotice"))})}).addExtraButton(t=>{t.setIcon("lucide-play-circle").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromInlineJs.code.runInConsole")).onClick(async()=>{if(!e.inlineJsOptionsCode)return;const{success:n,data:r,error:i}=await tryRunInlineCode(o,e.inlineJsOptionsCode);if(n){console.log(r),new obsidian.Notice("Validation successful");return}console.error(i),new obsidian.Notice(createFragment(a=>{a.appendText("Validation failed"),a.createEl("br"),a.appendText(i)}))})})},renderFilesFromFileJsSetings=({plugin:o,parentEl:s,settings:e})=>{new obsidian.Setting(s).setHeading().setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJsLabel")),new obsidian.Setting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.desc")).addText(t=>{t.setValue(e.fileJsOptionsPath??"").onChange(n=>{e.fileJsOptionsPath=n}),new FileSuggest(o.app,t.inputEl).setFilter(n=>n.extension.toLowerCase().endsWith("js")).onSelect(n=>{t.setValue(n.path),t.onChanged()})}).addExtraButton(t=>{t.setIcon("lucide-copy").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.helpText")).onClick(async()=>{await navigator.clipboard.writeText(selectOptionJsFileTemplate),new obsidian.Notice(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.copySuccessNotice"))})}).addExtraButton(t=>{t.setIcon("lucide-play-circle").setTooltip(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesFromFileJs.filePath.runInConsole")).onClick(async()=>{if(!e.fileJsOptionsPath)return;const{success:n,data:r,error:i}=await tryRunFileCode(o,e.fileJsOptionsPath);if(n){console.log(r),new obsidian.Notice("Validation successful");return}console.error(i),new obsidian.Notice(createFragment(a=>{a.appendText("Validation failed"),a.createEl("br"),a.appendText(i)}))})})},renderFolderPathsSetting=({plugin:o,parentEl:s,settings:e})=>{const t=new ListSetting(s).setName(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.folderPaths.title")).setDesc(text("customPropertyTypes.select.settings.optionsTypeSettings.dynamic.filesInFolder.folderPaths.desc")).setValue(e.folderOptionsPaths??[]).onCreateItem((n,r)=>{r.addDragButton().addSearch(i=>{i.setValue(n).onChange(a=>{r.list.setItemValue(r.index,a)}),new FolderSuggest(o.app,i.inputEl,{showFileCountAux:!0}).onSelect(a=>{i.setValue(a.path),i.onChanged()})}).addDeleteButton()}).onChange(n=>{e.folderOptionsPaths=n}).renderAllItems().addFooterButton(n=>{n.setIcon("lucide-sort-asc").onClick(r=>{const i=a=>a.split("/").reverse()[0];new obsidian.Menu().setNoIcon().addItem(a=>a.setSection("name").setTitle(text("common.sort.nameAlphabetical")).onClick(()=>{t.sort((l,c)=>i(l).localeCompare(i(c)))})).addItem(a=>a.setSection("name").setTitle(text("common.sort.nameReverseAlphabetical")).onClick(()=>{t.sort((l,c)=>i(c).localeCompare(i(l)))})).addItem(a=>a.setSection("path").setTitle(text("common.sort.pathAlphabetical")).onClick(()=>{t.sort((l,c)=>l.localeCompare(c))})).addItem(a=>a.setSection("path").setTitle(text("common.sort.pathReverseAlphabetical")).onClick(()=>{t.sort((l,c)=>c.localeCompare(l))})).showAtMouseEvent(r)})}).addFooterButton(n=>{n.setCta().setIcon("lucide-plus").onClick(()=>{t.addItem("")})});return t};class SelectColorCombobox extends ComboboxComponent{constructor(s){super(s)}getValueFromOption(s){return s.value}setValue(s){return super.setValue(s),this.setEmptyClass(!1),this.selectEl.textContent="",this.selectEl.setCssProps({"--better-properties-bg":s}),this}createAuxEl(s){const e=super.createAuxEl(s);return e.remove(),e}onRenderMenuItem(s,e){super.onRenderMenuItem(s,e);const{value:t,label:n}=e;s.titleEl.empty(),s.removeIcon(),s.titleEl.createDiv({cls:"better-properties-select-option",text:n}).setCssProps({"--better-properties-select-bg":t??selectColors.gray})}createSelectEl(s){const e=super.createSelectEl(s);return e.classList.add("better-properties-swatch"),e}createMenu(){const s=super.createMenu();return s.addSectionItem("footer",e=>{e.setIcon("lucide-paintbrush").setTitle("Custom color").setSubmenu().addItem(t=>{t.removeIcon();const n=new ColorTextComponent(t.titleEl);n.setValue(this.getValue()),n.onChange(r=>{this.setValue(r),this.onChanged()}),t.onClick(r=>{r.stopImmediatePropagation(),r.stopPropagation(),n.textComponent.inputEl.focus()})})}),s}}const renderSettings$2=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$3});if(o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$3,typeSettings:{...n}})}),new obsidian.Setting(t).setName(text("customPropertyTypes.select.settings.optionsType.title")).setDesc(text("customPropertyTypes.select.settings.optionsType.desc")).addDropdown(r=>{r.addOptions({manual:text("customPropertyTypes.select.settings.optionsType.selectLabelManual"),dynamic:text("customPropertyTypes.select.settings.optionsType.selectLabelDynamic")}).setValue((n==null?void 0:n.optionsType)??"manual").onChange(i=>{const a=i;n.optionsType=a,t.empty(),renderSettings$2({plugin:s,modal:o,property:e})})}),n.optionsType==="manual"&&renderManualSettings({plugin:s,parentEl:t,settings:n}),n.optionsType==="dynamic"){if(n.dynamicOptionsType||(n.dynamicOptionsType="filesInFolder"),renderDynamicSettings({plugin:s,parentEl:t,settings:n,modal:o,property:e}),n.dynamicOptionsType==="filesInFolder"){renderFilesFromFolderSettings({plugin:s,parentEl:t,settings:n});return}if(n.dynamicOptionsType==="filesFromTag"){renderFilesFromTagSettings({plugin:s,parentEl:t,settings:n});return}n.dynamicOptionsType==="filesFromInlineJs"&&renderFilesFromInlineJsSettings({plugin:s,parentEl:t,settings:n}),n.dynamicOptionsType==="filesFromJsFile"&&renderFilesFromFileJsSetings({plugin:s,parentEl:t,settings:n})}},renderWidget$2=({plugin:o,el:s,ctx:e,value:t})=>new MultiSelectTypeComponent(o,s,t,e);class MultiSelectTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","multiselect");p(this,"parseValue",e=>Array.isArray(e)?e:[]);p(this,"component");p(this,"options",[]);this.value=n;const i=this.getSettings();this.component=new MultiSelectComponent(e,t,r.key,!!i.manualAllowCreate&&i.optionsType!=="dynamic",r.sourcePath),this.initOptions()}getValue(){return this.component.getValue()}setValue(e){const t=this.component.getValue(),n=this.parseValue(e);n.every((i,a)=>{t[a]})||(this.component.setValue(n),this.component.render()),super.setValue(e)}async initOptions(){const e=this.getSettings(),{dynamicOptionsType:t,folderOptionsExcludeFolderNote:n,folderOptionsPaths:r,tagOptionsTags:i,tagOptionsIncludeNested:a,inlineJsOptionsCode:l,fileJsOptionsPath:c}=e;this.options=e.optionsType==="manual"?e.manualOptions??[]:await getDynamicOptions({plugin:this.plugin,ctx:this.ctx,dynamicEmptyLabel:void 0,dynamicOptionsType:t,fileJsOptionsPath:c,folderOptionsExcludeFolderNote:n,folderOptionsPaths:r,inlineJsOptionsCode:l,tagOptionsIncludeNested:a,tagOptionsTags:i}),this.component.addOptions(this.options);const d=this.parseValue(this.value);this.component.setValue(d),this.component.onChange(u=>{this.setValue(u)}),this.component.render(),this.onFocus=()=>{this.component.focus()}}}class MultiSelectComponent extends obsidian.ValueComponent{constructor(e,t,n,r,i){super();p(this,"set",new Set);p(this,"onChangeCallback",()=>{});p(this,"itemsContainerEl");p(this,"items",[]);p(this,"options",[]);p(this,"trailingItem");this.plugin=e,this.containerEl=t,this.property=n,this.isCreateAllowed=r,this.sourcePath=i,this.itemsContainerEl=t.createDiv({cls:"better-properties-multiselect-items-container"}),this.itemsContainerEl.addEventListener("click",a=>{a.target===this.itemsContainerEl&&(this.trailingItem=this.createTrailingItem(),this.trailingItem.selectEl.click())})}getValue(){return[...this.set]}setValue(e){return this.set=new Set(e),this}onChange(e){return this.onChangeCallback=e,this}addOptions(e){this.options=e.filter(({value:t})=>!!t),this.render()}onChanged(){this.onChangeCallback(this.getValue())}render(){this.itemsContainerEl.empty(),[...this.set].forEach((e,t)=>{this.items.push(this.createItem(e,t))}),this.trailingItem&&this.trailingItem.selectContainerEl.remove()}focus(){const e=this.items[0]??this.trailingItem;e&&e.selectEl.focus()}createTrailingItem(){return this.trailingItem&&this.trailingItem.selectContainerEl.remove(),this.createItem("",this.set.size)}createItem(e,t){const n=new ModifiedSelectComponent(this.plugin,this.itemsContainerEl,this.property,this.isCreateAllowed,this.sourcePath,this);return n.menuOptionFilter=r=>!this.set.has(r.value),n.addOptions(this.options),n.setValue(e),n.onChange(r=>{if(!r){this.set.delete(e),this.setValue([...this.set]),this.onChanged(),this.render();return}const i=[...this.set];i[t]=r,this.setValue(i),this.onChanged(),this.render()}),n}}class ModifiedSelectComponent extends SelectComponent{constructor(s,e,t,n,r,i){super(s,e,t,n,r),this.owner=i}createMenu(){const s=super.createMenu();return s.scope.register(["Shift"],"Tab",e=>{if(this!==this.owner.trailingItem||this.owner.items.some(n=>n.selectEl.isActiveElement()))return;e.preventDefault();const t=this.owner.items[this.owner.items.length-1];t==null||t.selectEl.focus()}),s}}const typeKey$3="multiselect",multiSelectPropertyType={type:typeKey$3,name:()=>text("customPropertyTypes.multiSelect.name"),icon:"lucide-list-collapse",validate:o=>Array.isArray(o),registerListeners:registerListeners$3,renderSettings:renderSettings$2,renderWidget:renderWidget$2},multiSelectSettingsSchema=optional(object({optionsType:optional(union([literal("manual"),literal("dynamic")]),"manual"),manualAllowCreate:optional(boolean()),manualOptions:optional(array(object({value:string(),label:optional(string()),desc:optional(string()),bgColor:optional(string()),textColor:optional(string())}))),dynamicOptionsType:optional(union([literal("filesInFolder"),literal("filesFromTag"),literal("filesFromInlineJs"),literal("filesFromJsFile")])),folderOptionsPaths:optional(array(string())),folderOptionsIsSubsIncluded:optional(boolean()),folderOptionsExcludeFolderNote:optional(boolean()),tagOptionsTags:optional(array(string())),tagOptionsIncludeNested:optional(boolean()),inlineJsOptionsCode:optional(string()),fileJsOptionsPath:optional(string())})),registerListeners$2=o=>{},renderSettings$1=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$2});o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$2,typeSettings:{...n}})}),new obsidian.Setting(t).setName(text("customPropertyTypes.numeric.settings.decimalPlaces.title")).setDesc(text("customPropertyTypes.numeric.settings.decimalPlaces.desc")).addText(r=>{var i;r.inputEl.type="number",r.setValue(((i=n.decimalPlaces)==null?void 0:i.toString())??""),r.onChange(a=>{n.decimalPlaces=Number(a)})})};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var es={exports:{}},lexer={},token={},hasRequiredToken;function requireToken(){return hasRequiredToken||(hasRequiredToken=1,function(o){function s(){return s=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},s.apply(this,arguments)}Object.defineProperty(o,"__esModule",{value:!0});var e,t={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1};o.tokenTypes=void 0,(e=o.tokenTypes||(o.tokenTypes={}))[e.FUNCTION_WITH_ONE_ARG=0]="FUNCTION_WITH_ONE_ARG",e[e.NUMBER=1]="NUMBER",e[e.BINARY_OPERATOR_HIGH_PRECENDENCE=2]="BINARY_OPERATOR_HIGH_PRECENDENCE",e[e.CONSTANT=3]="CONSTANT",e[e.OPENING_PARENTHESIS=4]="OPENING_PARENTHESIS",e[e.CLOSING_PARENTHESIS=5]="CLOSING_PARENTHESIS",e[e.DECIMAL=6]="DECIMAL",e[e.POSTFIX_FUNCTION_WITH_ONE_ARG=7]="POSTFIX_FUNCTION_WITH_ONE_ARG",e[e.FUNCTION_WITH_N_ARGS=8]="FUNCTION_WITH_N_ARGS",e[e.BINARY_OPERATOR_LOW_PRECENDENCE=9]="BINARY_OPERATOR_LOW_PRECENDENCE",e[e.BINARY_OPERATOR_PERMUTATION=10]="BINARY_OPERATOR_PERMUTATION",e[e.COMMA=11]="COMMA",e[e.EVALUATED_FUNCTION=12]="EVALUATED_FUNCTION",e[e.EVALUATED_FUNCTION_PARAMETER=13]="EVALUATED_FUNCTION_PARAMETER",e[e.SPACE=14]="SPACE",o.createTokens=function(n){return[{token:"sin",show:"sin",type:0,value:n.math.sin},{token:"cos",show:"cos",type:0,value:n.math.cos},{token:"tan",show:"tan",type:0,value:n.math.tan},{token:"pi",show:"&pi;",type:3,value:"PI"},{token:"(",show:"(",type:4,value:"("},{token:")",show:")",type:5,value:")"},{token:"P",show:"P",type:10,value:n.math.P},{token:"C",show:"C",type:10,value:n.math.C},{token:" ",show:" ",type:14,value:" ".anchor},{token:"asin",show:"asin",type:0,value:n.math.asin},{token:"acos",show:"acos",type:0,value:n.math.acos},{token:"atan",show:"atan",type:0,value:n.math.atan},{token:"7",show:"7",type:1,value:"7"},{token:"8",show:"8",type:1,value:"8"},{token:"9",show:"9",type:1,value:"9"},{token:"int",show:"Int",type:0,value:Math.floor},{token:"cosh",show:"cosh",type:0,value:n.math.cosh},{token:"acosh",show:"acosh",type:0,value:n.math.acosh},{token:"ln",show:" ln",type:0,value:Math.log},{token:"^",show:"^",type:10,value:Math.pow},{token:"root",show:"root",type:0,value:Math.sqrt},{token:"4",show:"4",type:1,value:"4"},{token:"5",show:"5",type:1,value:"5"},{token:"6",show:"6",type:1,value:"6"},{token:"/",show:"&divide;",type:2,value:n.math.div},{token:"!",show:"!",type:7,value:n.math.fact},{token:"tanh",show:"tanh",type:0,value:n.math.tanh},{token:"atanh",show:"atanh",type:0,value:n.math.atanh},{token:"Mod",show:" Mod ",type:2,value:n.math.mod},{token:"1",show:"1",type:1,value:"1"},{token:"2",show:"2",type:1,value:"2"},{token:"3",show:"3",type:1,value:"3"},{token:"*",show:"&times;",type:2,value:n.math.mul},{token:"sinh",show:"sinh",type:0,value:n.math.sinh},{token:"asinh",show:"asinh",type:0,value:n.math.asinh},{token:"e",show:"e",type:3,value:"E"},{token:"log",show:" log",type:0,value:n.math.log},{token:"0",show:"0",type:1,value:"0"},{token:".",show:".",type:6,value:"."},{token:"+",show:"+",type:9,value:n.math.add},{token:"-",show:"-",type:9,value:n.math.sub},{token:",",show:",",type:11,value:","},{token:"Sigma",show:"&Sigma;",type:12,value:n.math.sigma},{token:"n",show:"n",type:13,value:"n"},{token:"Pi",show:"&Pi;",type:12,value:n.math.Pi},{token:"pow",show:"pow",type:8,value:Math.pow,numberOfArguments:2},{token:"&",show:"&",type:9,value:n.math.and}].map(function(r){return s({},r,{precedence:t[r.type]})})},o.preced=t}(token)),token}var hasRequiredLexer;function requireLexer(){if(hasRequiredLexer)return lexer;hasRequiredLexer=1,Object.defineProperty(lexer,"__esModule",{value:!0});var o=requireToken();function s(u,h){for(var g=0;g<u.length;g++)u[g]+=h;return u}var e={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0},t={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},n={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},r={},i={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},a={1:!0},l=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"," ","&"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function c(u,h,g,f){for(var y=0;y<f;y++)if(u[g+y]!==h[y])return!1;return!0}function d(u,h){for(var g=0;g<h.length;g++)if(h[g].token===u)return g;return-1}return lexer.addToken=function(u){for(var h=0;h<u.length;h++){var g=u[h].token.length,f=-1;u[h].type===o.tokenTypes.FUNCTION_WITH_N_ARGS&&u[h].numberOfArguments===void 0&&(u[h].numberOfArguments=2),l[g]=l[g]||[];for(var y=0;y<l[g].length;y++)if(u[h].token===l[g][y]){f=d(l[g][y],this.tokens);break}f===-1?(this.tokens.push(u[h]),u[h].precedence=o.preced[u[h].type],l.length<=u[h].token.length&&(l[u[h].token.length]=[]),l[u[h].token.length].push(u[h].token)):(this.tokens[f]=u[h],u[h].precedence=o.preced[u[h].type])}},lexer.lex=function(u,h){var g,f={value:this.math.changeSign,type:o.tokenTypes.FUNCTION_WITH_ONE_ARG,precedence:4,show:"-"},y={value:")",show:")",type:o.tokenTypes.CLOSING_PARENTHESIS,precedence:0},S={value:"(",type:o.tokenTypes.OPENING_PARENTHESIS,precedence:0,show:"("},m=[S],b=[],R=u,T=e,N=0,E=r,F="";h!==void 0&&this.addToken(h);var x=function(B,M){for(var L,I,D,$=[],j=M.length,A=0;A<j;A++)if(!(A<j-1&&M[A]===" "&&M[A+1]===" ")){for(L="",I=M.length-A>l.length-2?l.length-1:M.length-A;I>0;I--)if(l[I]!==void 0)for(D=0;D<l[I].length;D++)c(M,l[I][D],A,I)&&(L=l[I][D],D=l[I].length,I=0);if(A+=L.length-1,L==="")throw new Error("Can't understand after "+M.slice(A));$.push(B.tokens[d(L,B.tokens)])}return $}(this,R);for(g=0;g<x.length;g++){var w=x[g];if(w.type!==14){var k,O=w.token,C=w.type,V=w.value,W=w.precedence,_=w.show,v=m[m.length-1];for(k=b.length;k--&&b[k]===0;)if([o.tokenTypes.FUNCTION_WITH_ONE_ARG,o.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,o.tokenTypes.CONSTANT,o.tokenTypes.OPENING_PARENTHESIS,o.tokenTypes.CLOSING_PARENTHESIS,o.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE,o.tokenTypes.BINARY_OPERATOR_PERMUTATION,o.tokenTypes.COMMA,o.tokenTypes.EVALUATED_FUNCTION,o.tokenTypes.EVALUATED_FUNCTION_PARAMETER].indexOf(C)!==-1){if(T[C]!==!0)throw new Error(O+" is not allowed after "+F);m.push(y),T=t,E=i,b.pop()}if(T[C]!==!0)throw new Error(O+" is not allowed after "+F);E[C]===!0&&(C=o.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,V=this.math.mul,_="&times;",W=3,g-=1);var P={value:V,type:C,precedence:W,show:_,numberOfArguments:w.numberOfArguments};if(C===o.tokenTypes.FUNCTION_WITH_ONE_ARG)T=e,E=r,s(b,1),m.push(P),x[g+1].type!==o.tokenTypes.OPENING_PARENTHESIS&&(m.push(S),b.push(2));else if(C===o.tokenTypes.NUMBER)v.type===o.tokenTypes.NUMBER?(v.value+=V,s(b,1)):m.push(P),T=t,E=n;else if(C===o.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE)T=e,E=r,s(b,2),m.push(P);else if(C===o.tokenTypes.CONSTANT)m.push(P),T=t,E=i;else if(C===o.tokenTypes.OPENING_PARENTHESIS)s(b,1),N++,T=e,E=r,m.push(P);else if(C===o.tokenTypes.CLOSING_PARENTHESIS){if(!N)throw new Error("Closing parenthesis are more than opening one, wait What!!!");N--,T=t,E=i,m.push(P),s(b,1)}else if(C===o.tokenTypes.DECIMAL){if(v.hasDec)throw new Error("Two decimals are not allowed in one number");v.type!==o.tokenTypes.NUMBER&&(v={show:"0",value:0,type:o.tokenTypes.NUMBER,precedence:0},m.push(v),s(b,-1)),T=a,s(b,1),E=r,v.value+=V,v.hasDec=!0}else C===o.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&(T=t,E=i,s(b,1),m.push(P));C===o.tokenTypes.FUNCTION_WITH_N_ARGS?(T=e,E=r,s(b,w.numberOfArguments+2),m.push(P),x[g+1].type!==o.tokenTypes.OPENING_PARENTHESIS&&(m.push(S),b.push(w.numberOfArguments+2))):C===o.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?(v.type===o.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?v.value===this.math.add?(v.value=V,v.show=_,s(b,1)):v.value===this.math.sub&&_==="-"&&(v.value=this.math.add,v.show="+",s(b,1)):v.type!==o.tokenTypes.CLOSING_PARENTHESIS&&v.type!==o.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&v.type!==o.tokenTypes.NUMBER&&v.type!==o.tokenTypes.CONSTANT&&v.type!==o.tokenTypes.EVALUATED_FUNCTION_PARAMETER?O==="-"&&(T=e,E=r,s(b,1),b.push(2),m.push(f),m.push(S)):(m.push(P),s(b,2)),T=e,E=r):C===o.tokenTypes.BINARY_OPERATOR_PERMUTATION?(T=e,E=r,s(b,2),m.push(P)):C===o.tokenTypes.COMMA?(T=e,E=r,m.push(P)):C===o.tokenTypes.EVALUATED_FUNCTION?(T=e,E=r,s(b,6),m.push(P),x[g+1].type!==o.tokenTypes.OPENING_PARENTHESIS&&(m.push(S),b.push(6))):C===o.tokenTypes.EVALUATED_FUNCTION_PARAMETER&&(T=t,E=i,m.push(P)),s(b,-1),F=O}else if(g>0&&g<x.length-1&&x[g+1].type===1&&(x[g-1].type===1||x[g-1].type===6))throw new Error("Unexpected Space")}for(k=b.length;k--;)m.push(y);if(T[5]!==!0)throw new Error("complete the expression");for(;N--;)m.push(y);return m.push(y),m},lexer}var postfix={},hasRequiredPostfix;function requirePostfix(){return hasRequiredPostfix||(hasRequiredPostfix=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.toPostfix=function(s){for(var e,t,n,r=[],i=-1,a=-1,l=[{value:"(",type:4,precedence:0,show:"("}],c=1;c<s.length;c++)if(s[c].type===1||s[c].type===3||s[c].type===13)s[c].type===1&&(s[c].value=Number(s[c].value)),r.push(s[c]);else if(s[c].type===4)l.push(s[c]);else if(s[c].type===5)for(;((d=t=l.pop())==null?void 0:d.type)!==4;){var d;t&&r.push(t)}else if(s[c].type===11){for(;((u=t=l.pop())==null?void 0:u.type)!==4;){var u;t&&r.push(t)}l.push(t)}else{a=(e=s[c]).precedence,i=(n=l[l.length-1]).precedence;var h=n.value=="Math.pow"&&e.value=="Math.pow";if(a>i)l.push(e);else{for(;i>=a&&!h||h&&a<i;)t=l.pop(),n=l[l.length-1],t&&r.push(t),i=n.precedence,h=e.value=="Math.pow"&&n.value=="Math.pow";l.push(e)}}return r}}(postfix)),postfix}var postfix_evaluator={},hasRequiredPostfix_evaluator;function requirePostfix_evaluator(){return hasRequiredPostfix_evaluator||(hasRequiredPostfix_evaluator=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.postfixEval=function(s,e){(e=e||{}).PI=Math.PI,e.E=Math.E;for(var t,n,r,i=[],a=e.n!==void 0,l=0;l<s.length;l++)if(s[l].type===1)i.push({value:s[l].value,type:1});else if(s[l].type===3)i.push({value:e[s[l].value],type:1});else if(s[l].type===0){var c=i[i.length-1];Array.isArray(c)?c.push(s[l]):c.value=s[l].value(c.value)}else if(s[l].type===7){var d=i[i.length-1];Array.isArray(d)?d.push(s[l]):d.value=s[l].value(d.value)}else if(s[l].type===8){for(var u=[],h=0;h<s[l].numberOfArguments;h++){var g=i.pop();g&&u.push(g.value)}i.push({type:1,value:s[l].value.apply(s[l],u.reverse())})}else if(s[l].type===10)t=i.pop(),n=i.pop(),Array.isArray(n)?((n=n.concat(t)).push(s[l]),i.push(n)):Array.isArray(t)?(t.unshift(n),t.push(s[l]),i.push(t)):i.push({type:1,value:s[l].value(n.value,t.value)});else if(s[l].type===2||s[l].type===9)t=i.pop(),n=i.pop(),Array.isArray(n)?((n=n.concat(t)).push(s[l]),i.push(n)):Array.isArray(t)?(t.unshift(n),t.push(s[l]),i.push(t)):i.push({type:1,value:s[l].value(n.value,t.value)});else if(s[l].type===12){t=i.pop();var f=void 0;f=!Array.isArray(t)&&t?[t]:t||[],n=i.pop(),r=i.pop(),i.push({type:1,value:s[l].value(r.value,n.value,f)})}else s[l].type===13&&(a?i.push({value:e[s[l].value],type:3}):i.push([s[l]]));if(i.length>1)throw new Error("Uncaught Syntax error");return parseFloat(i[0].value.toFixed(15))}}(postfix_evaluator)),postfix_evaluator}var functions={},hasRequiredFunctions;function requireFunctions(){return hasRequiredFunctions||(hasRequiredFunctions=1,Object.defineProperty(functions,"__esModule",{value:!0}),functions.createMathFunctions=function(o){return{isDegree:!0,acos:function(s){return o.math.isDegree?180/Math.PI*Math.acos(s):Math.acos(s)},add:function(s,e){return s+e},asin:function(s){return o.math.isDegree?180/Math.PI*Math.asin(s):Math.asin(s)},atan:function(s){return o.math.isDegree?180/Math.PI*Math.atan(s):Math.atan(s)},acosh:function(s){return Math.log(s+Math.sqrt(s*s-1))},asinh:function(s){return Math.log(s+Math.sqrt(s*s+1))},atanh:function(s){return Math.log((1+s)/(1-s))},C:function(s,e){var t=1,n=s-e,r=e;r<n&&(r=n,n=e);for(var i=r+1;i<=s;i++)t*=i;var a=o.math.fact(n);return a==="NaN"?"NaN":t/a},changeSign:function(s){return-s},cos:function(s){return o.math.isDegree&&(s=o.math.toRadian(s)),Math.cos(s)},cosh:function(s){return(Math.pow(Math.E,s)+Math.pow(Math.E,-1*s))/2},div:function(s,e){return s/e},fact:function(s){if(s%1!=0)return"NaN";for(var e=1,t=2;t<=s;t++)e*=t;return e},inverse:function(s){return 1/s},log:function(s){return Math.log(s)/Math.log(10)},mod:function(s,e){return s%e},mul:function(s,e){return s*e},P:function(s,e){for(var t=1,n=Math.floor(s)-Math.floor(e)+1;n<=Math.floor(s);n++)t*=n;return t},Pi:function(s,e,t){for(var n=1,r=s;r<=e;r++)n*=Number(o.postfixEval(t,{n:r}));return n},pow10x:function(s){for(var e=1;s--;)e*=10;return e},sigma:function(s,e,t){for(var n=0,r=s;r<=e;r++)n+=Number(o.postfixEval(t,{n:r}));return n},sin:function(s){return o.math.isDegree&&(s=o.math.toRadian(s)),Math.sin(s)},sinh:function(s){return(Math.pow(Math.E,s)-Math.pow(Math.E,-1*s))/2},sub:function(s,e){return s-e},tan:function(s){return o.math.isDegree&&(s=o.math.toRadian(s)),Math.tan(s)},tanh:function(s){return o.math.sinh(s)/o.math.cosh(s)},toRadian:function(s){return s*Math.PI/180},and:function(s,e){return s&e}}}),functions}var hasRequiredEs;function requireEs(){if(hasRequiredEs)return es.exports;hasRequiredEs=1;var o=requireLexer(),s=requireToken(),e=requirePostfix(),t=requirePostfix_evaluator(),n=requireFunctions(),r=function(){function i(){this.toPostfix=e.toPostfix,this.addToken=o.addToken,this.lex=o.lex,this.postfixEval=t.postfixEval,this.math=n.createMathFunctions(this),this.tokens=s.createTokens(this)}return i.prototype.eval=function(a,l,c){return this.postfixEval(this.toPostfix(this.lex(a,l)),c)},i}();return r.TOKEN_TYPES=s.tokenTypes,r.tokenTypes=s.tokenTypes,es.exports=r,es.exports}var esExports=requireEs();const Mexp=getDefaultExportFromCjs(esExports),renderWidget$1=({plugin:o,el:s,ctx:e,value:t})=>new NumericTypeComponent(o,s,t,e);class NumericTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","numeric");p(this,"parseValue",e=>Number(e));p(this,"numericComponent");const i=this.getSettings();this.numericComponent=new NumericComponent(t,i.decimalPlaces).setValue(this.parseValue(n)).onChange(a=>{this.ctx.onChange(a)}),this.onFocus=()=>{this.numericComponent.textComponent.inputEl.focus()}}getValue(){return this.numericComponent.getValue()}setValue(e){this.numericComponent.getValue()!==e&&this.numericComponent.setValue(this.parseValue(e)),super.setValue(e)}}class NumericComponent extends obsidian.ValueComponent{constructor(e,t){super();p(this,"mexp",new Mexp);p(this,"textComponent");p(this,"numericContainerEl");p(this,"resultEl");p(this,"value");p(this,"onChangeCallback",()=>{});p(this,"isTyping",!1);p(this,"showResultAttr","data-better-properties-show-result");this.decimalPlaces=t,this.numericContainerEl=e.createDiv({cls:"better-properties-numeric-container"}),this.textComponent=this.createTextComponent(this.numericContainerEl),this.resultEl=this.numericContainerEl.createDiv({cls:"better-properties-numeric-result"}),this.setIsTyping(!1)}setIsTyping(e){this.isTyping!==e&&(this.isTyping=e,this.numericContainerEl.setAttribute(this.showResultAttr,e?"true":"false"))}onChange(e){return this.onChangeCallback=e,this}onChanged(){this.onChangeCallback(this.getValue())}evaluate(e){return syncTryCatch(()=>this.mexp.eval(e.replaceAll(",","."),[{token:"x",value:this.getValue(),precedence:0,show:"x",type:1}]))}setValue(e){const t=this.decimalPlaces!==void 0?Number(e.toFixed(this.decimalPlaces)):e;return this.value=t,this.textComponent.setValue(t.toLocaleString()),this.resultEl.textContent="",this}getValue(){return this.value??0}createTextComponent(e){const t=new obsidian.TextComponent(e);t.onChange(r=>{const{success:i,data:a,error:l}=this.evaluate(r);this.resultEl.textContent=i?a.toLocaleString():l});const n=()=>{const r=t.inputEl.value,i=this.evaluate(r);i.success&&(this.setValue(i.data),this.onChanged())};return t.inputEl.classList.add("metadata-input","metadata-input-number"),t.inputEl.addEventListener("focus",()=>{t.setValue(this.getValue().toString())}),t.inputEl.addEventListener("blur",()=>{this.setIsTyping(!1),n()}),t.inputEl.addEventListener("keydown",()=>{this.setIsTyping(!0)}),t.inputEl.addEventListener("keyup",r=>{r.key==="Enter"&&n()}),t}}const typeKey$2="numeric",numericPropertyType={type:typeKey$2,name:()=>text("customPropertyTypes.numeric.name"),icon:"lucide-circle-percent",validate:o=>typeof o=="number"||typeof o=="string",registerListeners:registerListeners$2,renderSettings:renderSettings$1,renderWidget:renderWidget$1},numericSettingsSchema=optional(object({decimalPlaces:optional(number())})),registerListeners$1=o=>{o.registerEvent(o.app.metadataTypeManager.on("changed",s=>{var t;if(!(s!=null&&s.includes(".")))return;const e=(t=s.split(".")[0])==null?void 0:t.toLowerCase();e&&o.app.metadataTypeManager.trigger("changed",e)}))},renderSettings=({modal:o,plugin:s,property:e})=>{const{tabContentEl:t}=o,n=getPropertyTypeSettings({plugin:s,property:e,type:typeKey$1});o.onTabChange(()=>{setPropertyTypeSettings({plugin:s,property:e,type:typeKey$1,typeSettings:n})}),new obsidian.Setting(t).setName(text("customPropertyTypes.object.settings.hideAddButton.title")).setDesc(text("customPropertyTypes.object.settings.hideAddButton.desc")).addToggle(r=>{r.setValue(!!n.hideAddButton).onChange(i=>{n.hideAddButton=i})})},renderWidget=({plugin:o,el:s,ctx:e,value:t})=>new ArrayTypeComponent(o,s,t,e);class ArrayTypeComponent extends PropertyWidgetComponentNew{constructor(e,t,n,r){super(e,t,n,r);p(this,"type","array");p(this,"parseValue",e=>Array.isArray(e)?e:[]);p(this,"subProperties",[]);p(this,"metadataContainerEl");p(this,"propertiesEl");this.render()}render(){const e=this.parseValue(this.value),t=this.getSettings();this.metadataContainerEl&&this.metadataContainerEl.remove();const n=this.el.createDiv({cls:"better-properties-property-value-inner better-properties-mod-object metadata-container",attr:{tabindex:"0","data-better-properties-showindentguide":!!this.plugin.app.vault.getConfig("showIndentGuide")}});this.metadataContainerEl=n;const r=n.createDiv({cls:"better-properties-property-object-properties"});this.propertiesEl=r;const i=(a,l)=>{const c=new SubPropertyComponent(this,r,l.toString(),a,l);return this.subProperties.push(c),c.render()};if(!t.hideAddButton){const a=n.createDiv({cls:"better-properties-property-object-add-property metadata-add-button text-icon-button"});obsidian.setIcon(a.createSpan({cls:"text-button-icon"}),"lucide-plus"),a.createSpan({cls:"text-button-label",text:obsidianText("properties.label-add-property-button")}),a.addEventListener("click",()=>{this.createAndFocusNewItem()})}e.forEach((a,l)=>{i(a,l)}),this.onFocus=()=>{const a=r.querySelector("& > .metadata-property");a==null||a.focus()}}createAndFocusNewItem(){if(!this.propertiesEl)throw new Error("propertiesEl is undefined");const e=this.getValue();this.value=[...e,null];const t=new SubPropertyComponent(this,this.propertiesEl,e.length.toString(),null,e.length);this.subProperties.push(t),t.render().focus()}getValue(){return this.parseValue(this.value)}setValue(e){super.setValue(e);const t=this.parseValue(e);JSON.stringify(t)!==JSON.stringify(this.getValue())&&this.render()}}class SubPropertyComponent extends PropertyComponent{constructor(e,t,n,r,i){super(e.plugin,t,e.ctx.key+"."+n,r,e.ctx.sourcePath);p(this,"onChangeCallback",e=>{if(e===""||e===void 0||e===null){this.remove();return}const t=[...this.owner.getValue()],n=t[this.index],r=typeof n=="object"?JSON.stringify(n):n,i=typeof e=="object"?JSON.stringify(e):e;r!==i&&(t[this.index]=e,this.owner.ctx.onChange(t),this.owner.value=t)});this.owner=e,this.index=i}render(){var n;const e=super.render(),t=(n=this.keyEl)==null?void 0:n.createSpan({cls:"better-properties-array-sub-remove",attr:{role:"button","aria-label":"Remove property"}});return t&&(obsidian.setIcon(t,"lucide-trash-2"),t==null||t.addEventListener("click",()=>{this.remove()})),e}createKeyInputEl(e){return e.createEl("input",{cls:"metadata-property-key-input",type:"text",attr:{autocapitalize:"none",enterkeyhint:"next","aria-label":this.key}})}remove(){super.remove();const e=this.owner.getValue().filter((t,n)=>n!==this.index);this.owner.ctx.onChange(e),this.owner.value=e}updateKey(e){}createIconEl(e){const t=super.createIconEl(e);return this.propertyEl&&makeDraggable({itemEl:this.propertyEl,dragHandleEl:t,parentEl:this.containerEl,itemsQuerySelector:"& > .metadata-property",onDragEnd:(n,r)=>{const i=this.owner.getValue(),a=arrayMove(i,n,r);this.owner.ctx.onChange(a),this.owner.value=a}}),t}createValueEl(e){const t=super.createValueEl(e);return t.addEventListener("keydown",async n=>{if(n.key!=="Enter")return;const r=this.index===this.owner.getValue().length-1;if(!(n.key==="Enter"&&r&&n.target instanceof HTMLElement))return;const i=n.target.closest(".metadata-property"),a='.metadata-property-value[data-property-type="better-properties:object"] > .metadata-container > .better-properties-property-object-properties >',l=i==null?void 0:i.matches(`${a} &`),c=i==null?void 0:i.matches(`${a} .metadata-property > .metadata-property-value[data-property-type="better-properties:array"] > .metadata-container > .better-properties-property-object-properties > &`);l||c||this.owner.createAndFocusNewItem()}),t}renderWidget(e,t){return e.empty(),t.render(e,this.value,{app:this.plugin.app,blur:()=>{},key:this.key,onChange:n=>{this.onChangeCallback(n)},sourcePath:this.sourcePath,index:this.index})}}const typeKey$1="array",arrayPropertyType={type:typeKey$1,name:()=>text("customPropertyTypes.array.name"),icon:"lucide-brackets",validate:o=>typeof o=="object"&&Array.isArray(o),registerListeners:registerListeners$1,renderSettings,renderWidget},arraySettingsSchema=optional(object({hideAddButton:optional(boolean())})),getCustomPropertyTypesArr=()=>[arrayPropertyType,selectPropertyType,multiSelectPropertyType,togglePropertyType,markdownPropertyType,objectPropertyType,colorPropertyType,ratingPropertyType,dateCustomPropertyType,sliderPropertyType,timePropertyType,numericPropertyType],getCustomPropertyTypesRecord=()=>getCustomPropertyTypesArr().reduce((o,s)=>(o[s.type]=s,o),{}),registerCustomPropertyTypeWidgets=o=>{getCustomPropertyTypesArr().forEach(s=>{var l;const e=(c,d,u)=>s.renderWidget({plugin:o,el:c,value:d,ctx:u}),t=customPropertyTypePrefix+s.type,{icon:n,name:r,validate:i,reservedKeys:a}=s;o.app.metadataTypeManager.registeredTypeWidgets[t]={type:t,render:e,icon:n,name:r,validate:i,reservedKeys:a},s.registerListeners(o),(l=s.reservedKeys)!=null&&l.length&&s.reservedKeys.forEach(c=>{o.app.metadataTypeManager.setType(c,t)})})},wrapAllPropertyTypeWidgets=o=>{const{registeredTypeWidgets:s}=o.app.metadataTypeManager;Object.values(s).forEach(e=>{const t=around(e,{render(n){return dedupe(monkeyAroundKey,n,(r,i,a)=>{var u,h,g,f;const l=n(r,i,a);r.setAttribute("data-property-type",e.type);const c=getPropertyTypeSettings({plugin:o,property:a.key,type:"general"});if(renderCollapseIndicator({propertyValueEl:r,settings:c,setSettings:y=>setPropertyTypeSettings({plugin:o,property:a.key,type:"general",typeSettings:y})}),c.icon){const y=(u=r.parentElement)==null?void 0:u.querySelector(".metadata-property-icon");y instanceof HTMLElement&&obsidian.setIcon(y,c.icon)}if(c.hidden&&((h=r.parentElement)==null||h.setAttribute("data-better-properties-hidden","true")),c.defaultValue&&!i){const y=S=>{window.setTimeout(()=>{a.onChange(S),triggerPropertyTypeChange(o.app.metadataTypeManager,a.key)},0)};if(typeof i!="object")y(c.defaultValue);else{const S=syncTryCatch(()=>obsidian.parseYaml(c.defaultValue));if(!S.success){const m=S.error;new obsidian.Notice(m),console.error(m)}S.success&&y(S.data)}}if(c.alias){const y=(g=r.parentElement)==null?void 0:g.querySelector("input.metadata-property-key-input");if(y){const S=(f=r.parentElement)==null?void 0:f.querySelector(".better-properties-metadata-property-alias-input");S&&S.classList.remove("better-properties-mod-hidden");const m=S??y.cloneNode();y.insertAdjacentElement("afterend",m),y.classList.add("better-properties-mod-hidden"),y.addEventListener("blur",()=>{y.classList.add("better-properties-mod-hidden"),m.classList.remove("better-properties-mod-hidden")}),m.value=c.alias,m.classList.add("better-properties-metadata-property-alias-input"),m.setAttribute("aria-disabled","true"),m.addEventListener("focus",()=>{m.classList.add("better-properties-mod-hidden"),y.classList.remove("better-properties-mod-hidden"),y.focus()})}}return l})}});o.register(t)})},unregisterCustomPropertyTypeWidgets=o=>{const{registeredTypeWidgets:s}=o.app.metadataTypeManager;Object.keys(s).forEach(e=>{e.startsWith(customPropertyTypePrefix)&&delete s[e]}),Object.values(o.disabledTypeWidgets).forEach(e=>{s[e.type]={...e}})},sortAndFilterRegisteredTypeWidgets=o=>{const s={...o.app.metadataTypeManager.registeredTypeWidgets,...o.disabledTypeWidgets};o.disabledTypeWidgets={};const t=Object.keys(s).toSorted((n,r)=>{const i=s[n].name(),a=s[r].name();return i.localeCompare(a)}).reduce((n,r)=>{var a,l;const i=r;return(l=o.settings.hiddenPropertyTypes)!=null&&l.includes((a=s[i])==null?void 0:a.type)?(o.disabledTypeWidgets[r]=s[i],n):(n[r]=s[i],n)},{});o.app.metadataTypeManager.registeredTypeWidgets=t,o.app.metadataTypeManager.trigger("changed")},renderCollapseIndicator=({settings:o,setSettings:s,propertyValueEl:e})=>{var a;const t="better-properties-properties-property-collapse-indicator",n=(a=e.parentElement)==null?void 0:a.querySelector(".metadata-property-key"),r=n==null?void 0:n.querySelector(`& > .${t}`);r==null||r.remove();const i=n==null?void 0:n.createDiv({cls:t});if(i){obsidian.setIcon(i,"lucide-chevron-down");const l=c=>{const d="data-better-properties-is-collapsed";c?i.setAttribute(d,"true"):i.removeAttribute(d)};l(!!o.collapsed),i.addEventListener("click",()=>{o.collapsed=!o.collapsed,l(o.collapsed),s({...o})})}};class PropertySettingsModal extends VerticalTabModal{constructor(e,t){super(e.app);p(this,"propertyType","unset");this.plugin=e,this.property=t}getTabViewTitle(){return this.property}onOpen(){this.propertyType=this.plugin.app.metadataTypeManager.getAssignedWidget(this.property)??"text",this.addTabGroup(e=>{e.setTitle(this.property),e.titleEl.classList.add("better-properties-vertical-tab-modal-title"),obsidian.setTooltip(e.titleEl,this.property)}),this.addGeneralTabGroup(),this.addTypesTabGroup()}onClose(){super.onClose.call(this),refreshPropertyEditor(this.plugin,this.property)}addGeneralTabGroup(){const{propertyType:e}=this;this.addTabGroup(t=>t.setTitle(text("propertySettings.generalTabGroupName")).addTab(n=>n.setTitle(text("propertySettings.generalSettingsTab.name")).onSelect(()=>renderGeneralSettings(this)).then(r=>{withoutTypeWidgetPrefix(e)in getCustomPropertyTypesRecord()||r.select()})).addTab(n=>handleActionsTab({modal:this,tab:n})))}addTypesTabGroup(){this.addTabGroup(e=>e.setTitle(text("propertySettings.typesTabGroup.name")).then(t=>{Object.values(this.plugin.app.metadataTypeManager.registeredTypeWidgets).toSorted((n,r)=>n.name().localeCompare(r.name())).forEach(n=>{t.addTab(r=>handlePropertyTypeTab({widget:n,tab:r,modal:this}))})}))}}const showPropertySettingsModal=({plugin:o,property:s})=>{new PropertySettingsModal(o,s).open()},renderGeneralSettings=o=>{const{tabContentEl:s,plugin:e,property:t}=o;s.empty();const n=getPropertyTypeSettings({plugin:e,property:t,type:"general"});o.onTabChange(()=>{setPropertyTypeSettings({plugin:e,property:t,type:"general",typeSettings:n})}),new obsidian.Setting(s).setName(text("propertySettings.generalSettingsTab.iconSetting.title")).setDesc(text("propertySettings.generalSettingsTab.iconSetting.desc")).addSearch(r=>{r.setValue((n==null?void 0:n.icon)??"").onChange(i=>{n.icon=i}),new IconSuggest(e.app,r.inputEl).onSelect(i=>{r.setValue(i),r.onChanged()})}),new obsidian.Setting(s).setName(text("propertySettings.generalSettingsTab.hiddenSetting.title")).setDesc(text("propertySettings.generalSettingsTab.hiddenSetting.desc")).addToggle(r=>r.setValue(n.hidden??!1).onChange(i=>{n.hidden=i})),new obsidian.Setting(s).setName(text("propertySettings.generalSettingsTab.defaultValueSetting.title")).setDesc(text("propertySettings.generalSettingsTab.defaultValueSetting.desc")).addTextArea(r=>{r.setValue(n.defaultValue??"").onChange(i=>{n.defaultValue=i}),r.inputEl.setAttribute("rows","3"),r.inputEl.setAttribute("cols","40")}),new obsidian.Setting(s).setName(text("propertySettings.generalSettingsTab.aliasSetting.title")).setDesc(text("propertySettings.generalSettingsTab.aliasSetting.desc")).addText(r=>{r.setValue(n.alias??"").onChange(i=>{n.alias=i})}),new obsidian.Setting(s).setName(text("propertySettings.generalSettingsTab.suggestionsSetting.title")).setDesc(text("propertySettings.generalSettingsTab.suggestionsSetting.desc")).then(r=>{const i=new MultiselectComponent(r);i.setValues(n.suggestions??[]).onChange(a=>{n.suggestions=[...a]}).addSuggest(a=>new PropertyValueSuggest(e.app,a,t,i)).renderValues()})};class PropertyValueSuggest extends InputSuggest{constructor(s,e,t,n){super(s,e),this.property=t,this.multiselect=n}getSuggestions(s){const e=this.getPropertyValues();this.multiselect.values.forEach(r=>{e.delete(r)});const t=Array.from(e);if(!s)return t;const n=s.toLowerCase();return t.filter(r=>r.toLowerCase().includes(n))}parseSuggestion(s){return{title:s}}getPropertyValues(){const s=new Set;return iterateFileMetadata({vault:this.app.vault,metadataCache:this.app.metadataCache,callback:({metadata:e})=>{if(!(e!=null&&e.frontmatter))return;const{value:t}=findKeyValueByDotNotation(this.property,e.frontmatter),n=t==null?void 0:t.toString();n&&s.add(n)}}),s}}const handleActionsTab=({modal:o,tab:s})=>{const{tabContentEl:e,plugin:t,property:n}=o;s.setTitle(text("propertySettings.generalActionsTab.name")).onSelect(()=>{e.empty(),new obsidian.Setting(e).setName(text("propertySettings.generalActionsTab.importSetting.title")).setDesc(text("propertySettings.generalActionsTab.importSetting.desc")).addButton(r=>r.setIcon("lucide-import").onClick(()=>showImportModal(o))),new obsidian.Setting(e).setName(text("propertySettings.generalActionsTab.exportSetting.title")).setDesc(text("propertySettings.generalActionsTab.exportSetting.desc")).addButton(r=>r.setIcon("lucide-copy").onClick(()=>{const i=getPropertySettings({plugin:t,property:n}),a=JSON.stringify(i,null,2);navigator.clipboard.writeText(a),new obsidian.Notice(text("propertySettings.generalActionsTab.exportSetting.copySuccessNotice"))})),new obsidian.Setting(e).setName(text("propertySettings.generalActionsTab.resetSetting.title")).setDesc(text("propertySettings.generalActionsTab.resetSetting.desc")).addButton(r=>r.setWarning().setIcon("lucide-archive").onClick(()=>{(t.settings.confirmPropertySettingsReset??!0)&&showResetModal(o)}))})},showImportModal=o=>{const{plugin:s,property:e}=o,t=new ConfirmationModal(s.app);t.setTitle(text("propertySettings.generalActionsTab.importSetting.modalTitle"));let n;new obsidian.TextAreaComponent(t.contentEl).setPlaceholder("{ general: {}, ...}").then(i=>{i.inputEl.classList.add("better-properties-mod-w-full"),i.inputEl.setAttribute("rows","7"),i.onChange(async a=>{const l=await tryCatch(()=>JSON.parse(a));if(!l.success){n=void 0,r.setAttribute("data-is-valid","false"),r.textContent=text("propertySettings.generalActionsTab.importSetting.modalJsonParseError",{error:l.error});return}const c=safeParse(propertySettingsSchema,l.data);if(!c.success){n=void 0,r.setAttribute("data-is-valid","false"),r.textContent=text("propertySettings.generalActionsTab.importSetting.modalStrutureParseError");return}r.setAttribute("data-is-valid","true"),r.textContent=text("propertySettings.generalActionsTab.importSetting.modalDataIsValid"),n=c.output})});const r=t.contentEl.createEl("p",{cls:"better-properties-validity"});t.addFooterButton(i=>i.setButtonText(text("common.import")).setWarning().onClick(()=>{n&&(setPropertySettings({plugin:s,property:e,settings:n}),t.close(),new obsidian.Notice(text("propertySettings.generalActionsTab.importSetting.modalImportSuccess")))})).addFooterButton(i=>i.setButtonText(obsidianText("dialogue.button-cancel")).onClick(()=>t.close())),t.open()},showResetModal=o=>{const{app:s,plugin:e,property:t}=o,n=new ConfirmationModal(s).setTitle(text("propertySettings.generalActionsTab.resetSetting.modalTitle")).setContent(text("propertySettings.generalActionsTab.resetSetting.modalDesc")).setFooterCheckbox(r=>r.setLabel(text("common.dontAskAgain")).setValue(!1).onChange(i=>{o.plugin.updateSettings(a=>({...a,confirmPropertySettingsReset:i}))})).addFooterButton(r=>r.setButtonText(text("common.reset")).setWarning().onClick(()=>{deletePropertySettings({plugin:e,property:t}),n.close()})).addFooterButton(r=>r.setButtonText(obsidianText("dialogue.button-cancel")).onClick(()=>n.close()));n.open()},handlePropertyTypeTab=({modal:o,widget:s,tab:e})=>{const{tabContentEl:t,plugin:n,property:r,propertyType:i}=o,a=getCustomPropertyTypesRecord()[withoutTypeWidgetPrefix(s.type)];e.setTitle(s.name()).onSelect(()=>{if(t.empty(),!a){new obsidian.Setting(t).setName(text("propertySettings.typesTabGroup.unsupportedTypeTitle")).setHeading().setDesc(text("propertySettings.typesTabGroup.unsupportedTypeDesc"));return}a.renderSettings({plugin:n,modal:o,property:r})}).then(l=>{a||l.labelEl.classList.add("better-properties-mod-unsupported"),i===s.type&&(l.labelEl.classList.add("better-properties-mod-active"),l.select())})},openDeleteModal=({plugin:o,property:s})=>{const e=new ConfirmationModal(o.app).setTitle(text("metadataEditor.propertyMenu.delete.modalTitle")).setContent(text("metadataEditor.propertyMenu.delete.modalTitle",{property:s})).setFooterCheckbox(t=>{t.setValue(!1).setLabel(text("common.dontAskAgain")).onChange(async n=>{await o.updateSettings(r=>(r.confirmPropertyDelete=n,r))})}).addFooterButton(t=>t.setWarning().setButtonText(obsidianText("interface.delete-action-short-name")).onClick(async()=>{await deleteProperty({plugin:o,property:s}),e.close()})).addFooterButton(t=>t.setButtonText(obsidianText("dialogue.button-cancel")).onClick(()=>{e.close()}));e.open()},openRenameModal=({plugin:o,property:s})=>{const e=new ConfirmationModal(o.app);e.setTitle(text("metadataEditor.propertyMenu.rename.modalTitle")).setContent(createFragment(t=>{t.createEl("p",{text:text("metadataEditor.propertyMenu.rename.modalDesc",{property:s})});const n=new obsidian.TextComponent(t.createDiv()).setValue(s).setPlaceholder(text("metadataEditor.propertyMenu.rename.newPropertyNamePlaceholder")),r=createCallout({parentEl:t,type:"warning",icon:"lucide-alert-triangle",title:"Existing property name",desc:text("metadataEditor.propertyMenu.rename.nameExistsWarning",{property:s})});let i=null;e.addFooterButton(a=>{i=a.setButtonText(obsidianText("interface.menu.rename")).setWarning().onClick(async()=>{await renameProperty({plugin:o,property:s,newProperty:n.getValue()}),e.close()})}).addFooterButton(a=>a.setButtonText(obsidianText("dialogue.button-cancel")).onClick(()=>{e.close()})),n.onChange(a=>{if(!i)return;if(a===s){r.classList.add("better-properties-mod-hidden"),i.setDisabled(!0);return}if(i.setDisabled(!1),!findKey(o.app.metadataTypeManager.properties,a)){r.classList.add("better-properties-mod-hidden");return}r.classList.remove("better-properties-mod-hidden")}),n.onChanged()})),e.open()},createCallout=({parentEl:o,type:s,icon:e,title:t,desc:n})=>{const r=o.createDiv({cls:"callout",attr:{"data-callout":s}}),i=r.createDiv({cls:"callout-title",attr:{dir:"auto"}});return obsidian.setIcon(i.createDiv({cls:"callout-icon"}),e),i.createDiv({cls:"callout-title-inner",text:t}),r.createDiv({cls:"callout-content"}).createEl("p",{text:n,attr:{dir:"auto"}}),r},openChangeIconModal=({plugin:o,property:s})=>{var n;const e=new ConfirmationModal(o.app);let t=((n=getPropertyTypeSettings({plugin:o,property:s,type:"general"}))==null?void 0:n.icon)??"";e.setTitle(text("metadataEditor.propertyMenu.icon.modalTitle",{property:s})),new obsidian.Setting(e.contentEl).setName(text("metadataEditor.propertyMenu.icon.iconSetting.title")).setDesc(text("metadataEditor.propertyMenu.icon.iconSetting.desc")).addSearch(r=>{r.setValue(t).onChange(i=>{t=i}),new IconSuggest(o.app,r.inputEl).onSelect(i=>{r.setValue(i),r.onChanged()})}),e.addFooterButton(r=>r.setButtonText(obsidianText("dialogue.button-cancel")).onClick(()=>{e.close()})).addFooterButton(r=>r.setButtonText(obsidianText("dialogue.button-update")).setCta().onClick(()=>{updatePropertyTypeSettings({plugin:o,property:s,type:"general",cb:i=>({...i,icon:t})}),refreshPropertyEditor(o,s),e.close()})),e.open()},onFilePropertyMenu=(o,s,e)=>{var l,c;const{metadataTypeManager:t}=o.app,n=getTrueProperty(e),r=n!==e,i=s.items.find(d=>d instanceof obsidian.MenuSeparator?!1:!!d.submenu);i==null||i.setSection("action"),i&&recreateTypeOptionsSubmenu({found:i,metadataTypeManager:t,property:e});const a=Object.values(t.registeredTypeWidgets).some(({reservedKeys:d})=>d==null?void 0:d.includes(e));i&&a&&((c=(l=i.submenu)==null?void 0:l.items)==null||c.forEach(d=>{d instanceof obsidian.MenuSeparator||d.setDisabled(!0)})),s.addItem(d=>d.setSection("action").setTitle(obsidianText("interface.settings")).setIcon("lucide-settings").onClick(()=>{showPropertySettingsModal({plugin:o,property:n})})),r||s.addItem(d=>d.setSection("action").setTitle(obsidianText("interface.menu.rename")).setIcon("lucide-pen").onClick(()=>{openRenameModal({plugin:o,property:e})})),s.addItem(d=>d.setSection("action").setTitle(text("common.icon")).setIcon("lucide-badge-info").onClick(()=>{openChangeIconModal({plugin:o,property:n})})),r||s.addItem(d=>d.setSection("danger").setWarning(!0).setTitle(obsidianText("interface.delete-action-short-name")).setIcon("lucide-x-circle").onClick(async()=>{if(o.settings.confirmPropertyDelete??!0){openDeleteModal({plugin:o,property:e});return}await deleteProperty({plugin:o,property:e})})),s.sort()},recreateTypeOptionsSubmenu=({found:o,metadataTypeManager:s,property:e})=>{var i,a,l;o.submenu.items.forEach(c=>{c.dom.remove()}),(i=o.submenu)==null||i.unload(),(a=o.submenu)==null||a.dom.remove(),o.submenu=null,(l=o.dom.querySelector(".menu-item-icon.mod-submenu"))==null||l.remove();const t=o.setSubmenu();t.addSections(["obsidian","better-properties"]),Object.values(s.registeredTypeWidgets).forEach(c=>{c.reservedKeys||t.addItem(d=>{const u=!c.type.startsWith(customPropertyTypePrefix);d.onClick(()=>{s.setType(e,c.type)}),d.setTitle(c.name()).setIcon(c.icon),u||d.dom.setAttribute("data-is-better-properties","true"),s.getAssignedWidget(e)===c.type&&d.setChecked(!0)})})},patchMetadataEditor=o=>{const s=resolveMetadataEditorPrototype(o);s.createMoreButtonEl=function(){return createMoreButtonEl(this)},s.toggleShowHidden=function(){return toggleShowHidden(this)},s.createLabelWidthResizerEl=function(){return createLabelWidthResizerEl(this)};const e=around(s,{load(t){return dedupe(monkeyAroundKey,t,function(){const n=this;t.call(n),n.createMoreButtonEl(),n.showHidden=!1,n.contentEl.setAttribute("data-better-properties-show-hidden","false"),n.createLabelWidthResizerEl()})},synchronize(t){return dedupe(monkeyAroundKey,t,function(n){const r=this;t.call(r,n),r.createLabelWidthResizerEl()})}});o.register(e)},resolveMetadataEditorPrototype=o=>{if(!o.app.workspace.layoutReady)throw new Error("resolveMetadataEditorPrototype can only be used when the app.workspace.layoutReady is true");const{workspace:s,viewRegistry:e}=o.app,t=s.getLeaf("tab"),n=e.viewByType.markdown(t),r=Object.getPrototypeOf(n.metadataEditor);return t.detach(),r},createMoreButtonEl=o=>{o.moreButtonEl&&o.moreButtonEl.remove(),o.moreButtonEl=createDiv({cls:"metadata-add-button text-icon-button"}),obsidian.setIcon(o.moreButtonEl.createSpan({cls:"text-button-icon"}),"lucide-ellipsis"),o.moreButtonEl.createSpan({cls:"text-button-label",text:text("common.more")});const s=e=>{const t=o.serialize(),r=Object.entries(t).sort(e).reduce((i,a)=>{const[l,c]=a;return i[l]=c,i},{});o.synchronize(r),o.save()};return o.moreButtonEl.addEventListener("click",e=>{new obsidian.Menu().addItem(n=>n.setTitle(text("metadataEditor.moreButton.showHidden")).setChecked(o.showHidden).onClick(()=>o.toggleShowHidden()).setIcon("lucide-eye-off")).addItem(n=>n.setTitle(text("metadataEditor.moreButton.sort")).setIcon("lucide-sort-asc").setSubmenu().setNoIcon().addItem(r=>r.setTitle(text("common.sort.nameAlphabetical")).onClick(()=>{s(([i],[a])=>i.localeCompare(a))})).addItem(r=>r.setTitle(text("common.sort.nameReverseAlphabetical")).onClick(()=>{s(([i],[a])=>a.localeCompare(i))})).addItem(r=>r.setTitle(text("common.sort.typeAlphabetical")).onClick(()=>{s(([i],[a])=>{var g,f;const l=o.app.metadataTypeManager.getAssignedWidget(i)??"text",c=o.app.metadataTypeManager.getAssignedWidget(a)??"text",{registeredTypeWidgets:d}=o.app.metadataTypeManager,u=((g=d[l])==null?void 0:g.name())??"",h=((f=d[c])==null?void 0:f.name())??"";return u.localeCompare(h)})})).addItem(r=>r.setTitle(text("common.sort.typeReverseAlphabetical")).onClick(()=>{s(([i],[a])=>{var g,f;const l=o.app.metadataTypeManager.getAssignedWidget(i)??"text",c=o.app.metadataTypeManager.getAssignedWidget(a)??"text",{registeredTypeWidgets:d}=o.app.metadataTypeManager,u=((g=d[l])==null?void 0:g.name())??"";return(((f=d[c])==null?void 0:f.name())??"").localeCompare(u)})}))).showAtMouseEvent(e)}),o.addPropertyButtonEl.insertAdjacentElement("afterend",o.moreButtonEl),o},toggleShowHidden=o=>{const e=(o.contentEl.getAttribute("data-better-properties-show-hidden")??"false").toLowerCase()==="true";return o.contentEl.setAttribute("data-better-properties-show-hidden",(!e).toString()),o.showHidden=!e,o},createLabelWidthResizerEl=o=>{o.labelWidthResizerEl&&o.labelWidthResizerEl.remove(),o.labelWidthResizerEl=o.propertyListEl.createDiv({cls:"better-properties-label-width-resizer"});const{app:s,labelWidthResizerEl:e,containerEl:t}=o;e.draggable=!0;let n=0;e.addEventListener("dragstart",l=>{if(e.setAttribute("data-is-dragging","true"),n=l.pageX,!l.dataTransfer)return;l.dataTransfer.effectAllowed="move",l.dataTransfer.dropEffect="move",l.dataTransfer.setDragImage(createDiv(),0,0);const c=createDiv({cls:"better-properties-drag-overlay",attr:{id:"better-properties-drag-overlay"}});c.addEventListener("dragover",d=>{d.preventDefault()}),window.setTimeout(()=>{document.body.appendChild(c)},0)});const r=()=>{var l,c;return((c=(l=t.querySelector(".metadata-property-key"))==null?void 0:l.getBoundingClientRect())==null?void 0:c.width)??0};let i;const a=obsidian.debounce(l=>{const c=l.pageX-n;i===void 0&&(i=r());const d=i+c;t.setCssProps({"--metadata-label-width":d+"px"}),n=l.pageX,i=d},5,!1);return e.addEventListener("drag",a),e.addEventListener("dragend",()=>{var c,d,u;e.removeAttribute("data-is-dragging");const l=(d=(c=t.querySelector(".metadata-property-key"))==null?void 0:c.getBoundingClientRect())==null?void 0:d.width;l!==void 0&&(document.body.setCssProps({"--metadata-label-width":l+"px"}),s.workspace.trigger("better-properties:property-label-width-change",l),t.setCssProps({"--metadata-label-width":""}),(u=document.getElementById("better-properties-drag-overlay"))==null||u.remove())}),e.addEventListener("dblclick",()=>{document.body.setCssProps({"--metadata-label-width":""}),s.workspace.trigger("better-properties:property-label-width-change",void 0)}),o},customizePropertyEditorMenu=o=>{patchMenu(o),o.registerEvent(o.app.workspace.on("better-properties:file-property-menu",(s,e)=>{onFilePropertyMenu(o,s,e)}))},refreshPropertyEditor=(o,s)=>{const e=s.toLowerCase(),t=e.split(".")[0];o.app.metadataTypeManager.trigger("changed",e),o.app.workspace.iterateAllLeaves(n=>{if(!n.view.hasOwnProperty("metadataEditor"))return;n.view.metadataEditor.onMetadataTypeChange(t)})},registerListeners=o=>{const s=vaultEventHandlerFactory(o),e=metadataCacheEventHandlerFactory(o);[o.app.vault.on("create",s),o.app.vault.on("delete",s),o.app.vault.on("rename",s),o.app.metadataCache.on("changed",e)].forEach(n=>o.registerEvent(n))},vaultEventHandlerFactory=o=>obsidian.debounce(()=>{const{propertySettings:s}=o.settings;s&&Object.entries(s).forEach(([e,t])=>{const{optionsType:n,dynamicOptionsType:r}=t[typeKey]??{};n==="dynamic"&&r==="filesInFolder"&&refreshPropertyEditor(o,e)})},250,!0),metadataCacheEventHandlerFactory=o=>obsidian.debounce(()=>{const{propertySettings:s}=o.settings;s&&Object.entries(s).forEach(([e,t])=>{const{optionsType:n,dynamicOptionsType:r}=t[typeKey]??{};n==="dynamic"&&r==="filesFromTag"&&refreshPropertyEditor(o,e)})},250,!0),typeKey="select",selectPropertyType={type:typeKey,icon:"lucide-circle-chevron-down",name:()=>text("customPropertyTypes.select.name"),validate:o=>typeof(o==null?void 0:o.toString())=="string",renderWidget:renderWidget$b,registerListeners,renderSettings:renderSettings$b},selectSettingsSchema=optional(object({useDefaultStyle:optional(boolean(),!1),optionsType:optional(union([literal("manual"),literal("dynamic")]),"manual"),manualAllowCreate:optional(boolean()),manualOptions:optional(array(object({value:string(),label:optional(string()),desc:optional(string()),bgColor:optional(string()),textColor:optional(string())}))),dynamicOptionsType:optional(union([literal("filesInFolder"),literal("filesFromTag"),literal("filesFromInlineJs"),literal("filesFromJsFile")])),dynamicEmptyLabel:optional(string()),folderOptionsPaths:optional(array(string())),folderOptionsIsSubsIncluded:optional(boolean()),folderOptionsExcludeFolderNote:optional(boolean()),tagOptionsTags:optional(array(string())),tagOptionsIncludeNested:optional(boolean()),inlineJsOptionsCode:optional(string()),fileJsOptionsPath:optional(string())})),titleSettingsSchema=optional(object({})),createdSettingsSchema=optional(object({format:optional(string())}));class PropertySuggestModal extends obsidian.FuzzySuggestModal{constructor(s){super(s.app),this.plugin=s}getItems(){return Object.values(this.app.metadataTypeManager.properties).map(({name:s,widget:e})=>{var n;const t=(getPropertyTypeSettings({plugin:this.plugin,property:s,type:"general"}).icon||((n=this.app.metadataTypeManager.getWidget(e))==null?void 0:n.icon))??"lucide-file-question";return{name:s,icon:t}}).sort((s,e)=>s.name.toLowerCase().localeCompare(e.name.toLowerCase()))}getItemText(s){return s.name}onChooseItem(s,e){throw new Error("Method not implemented")}renderSuggestion(s,e){super.renderSuggestion.call(this,s,e),e.empty(),e.classList.add("mod-complex"),e.createDiv({cls:"suggestion-title"}).createDiv({cls:"suggestion-title",text:s.item.name}),obsidian.setIcon(e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair"}),s.item.icon)}}const relationSettingsSchema=optional(object({relatedProperty:optional(string())})),propertySettingsSchema=object({general:optional(object({icon:optional(string(),""),hidden:optional(boolean(),!1),defaultValue:optional(string()),alias:optional(string()),suggestions:optional(array(string())),collapsed:optional(boolean())})),array:arraySettingsSchema,select:selectSettingsSchema,multiselect:multiSelectSettingsSchema,toggle:toggleSettingsSchema,title:titleSettingsSchema,markdown:markdownSettingsSchema,created:createdSettingsSchema,object:objectSettingsSchema,color:colorSettingsSchema,rating:ratingSettingsSchema,relation:relationSettingsSchema,datecustom:dateCustomSettingsSchema,slider:sliderSettingsSchema,time:timeSettingsSchema,numeric:numericSettingsSchema}),getDefaultPropertySettings=()=>Object.entries(propertySettingsSchema.entries).reduce((o,[s,e])=>{const t=s;return o[t]=parse(e,{}),o},{});class PropertyTypeSuggest extends InputSuggest{constructor(s,e){super(s,e)}getSuggestions(s){const{metadataTypeManager:e}=this.app,t=Object.values(e.registeredTypeWidgets).map(r=>({type:r.type,name:r.name()}));if(s==="")return t;const n=s.toLowerCase();return t.filter(({type:r,name:i})=>(r.toLowerCase().includes(n)||i.toLowerCase().includes(n))&&this.setFilterCallback({type:r,name:i}))}parseSuggestion({name:s,type:e}){return{title:s,note:e}}}const betterPropertiesSettingsSchema=object({propertySettings:optional(record(string(),propertySettingsSchema),{}),confirmPropertySettingsReset:optional(boolean(),!0),confirmPropertyDelete:optional(boolean(),!0),propertyLabelWidth:optional(number(),void 0),defaultLabelWidth:optional(string(),"9em"),hiddenPropertyTypes:optional(array(string()),[])}),getDefaultSettings=()=>getDefaults(betterPropertiesSettingsSchema);class BetterPropertiesSettingsTab extends obsidian.PluginSettingTab{constructor(s){super(s.app,s),this.plugin=s}display(){const{plugin:s,containerEl:e}=this;e.empty();const{settings:t}=s;new obsidian.Setting(e).setName("Property label width").setDesc("The width of the label for each frontmatter property.").addExtraButton(n=>{n.setIcon("lucide-rotate-ccw").setTooltip(obsidianText("interface.tooltip-restore-default-settings")).onClick(()=>{t.propertyLabelWidth=void 0,s.app.workspace.trigger("better-properties:property-label-width-change",void 0),this.display()})}).addSlider(n=>{n.setDynamicTooltip().setLimits(0,500,1).setValue(t.propertyLabelWidth??0).onChange(r=>{t.propertyLabelWidth=r,s.app.workspace.trigger("better-properties:property-label-width-change",r)})}),new obsidian.Setting(e).setName("Hidden property types").setDesc("The following types will be disabled.").then(n=>{const r=new MultiselectComponent(n);r.setValues(t.hiddenPropertyTypes??[]).onChange(i=>{t.hiddenPropertyTypes=[...i]}).addSuggest(i=>new PropertyTypeSuggest(s.app,i).setFilter(a=>!r.values.contains(a.type)).onSelect((a,l)=>{l.preventDefault(),l.stopImmediatePropagation(),i.textContent=a.type,r.inputEl.blur(),r.inputEl.focus()})).renderValues()}),new obsidian.Setting(e).setHeading().setName("Warnings"),new obsidian.Setting(e).setName("Confirm reset property settings").setDesc("Prompt before resetting a property's settings.").addToggle(n=>{n.setValue(t.confirmPropertySettingsReset??!0).onChange(r=>{t.confirmPropertySettingsReset=r})}),new obsidian.Setting(e).setName("Confirm delete property").setDesc("Prompt before deleting a property from all notes.").addToggle(n=>{n.setValue(t.confirmPropertyDelete??!0).onChange(r=>{t.confirmPropertyDelete=r})})}hide(){super.hide.call(this),this.plugin.saveSettings();const{plugin:s}=this;sortAndFilterRegisteredTypeWidgets(s),s.refreshPropertyEditors()}}const patchMetadataCache=o=>{const s=around(o.app.metadataCache,{getFrontmatterPropertyValuesForKey:e=>dedupe(monkeyAroundKey,e,function(t){const n=this,{suggestions:r}=getPropertyTypeSettings({plugin:o,property:t,type:"general"});return r??e.call(n,t)})});o.register(s)},setupBpJsListeners=o=>{const s=(t,n)=>{n&&!t.subscribedPaths.has(n.path)||(t.empty(),t.component.unload(),t.component.load(),t.run(t.code))},e=obsidian.debounce(t=>{o.bpjsInstances.forEach(n=>s(n,t))},150,!0);o.registerEvent(o.app.metadataCache.on("changed",t=>e(t))),o.registerEvent(o.app.metadataTypeManager.on("changed",()=>e(null))),o.registerEvent(o.app.vault.on("create",t=>t instanceof obsidian.TFile&&e(t))),o.registerEvent(o.app.vault.on("delete",t=>t instanceof obsidian.TFile&&e(t))),o.registerEvent(o.app.vault.on("modify",t=>t instanceof obsidian.TFile&&e(t))),o.registerEvent(o.app.vault.on("rename",t=>t instanceof obsidian.TFile&&e(t)))};class BpJsApi{constructor(o,s,e,t,n){p(this,"el");p(this,"styleEl");p(this,"subscribedPaths",new Set);this.plugin=o,this.sourcePath=e,this.component=t,this.code=n,this.el=(s==null?void 0:s.createSpan())??createSpan(),this.el.classList.add("better-properties-bpjs"),this.styleEl=this.el.createEl("style"),o.bpjsInstances.add(this)}empty(){var o;this.el.empty(),(o=this.styleEl)==null||o.empty()}get file(){const o=this.plugin.app.vault.getFileByPath(this.sourcePath);if(!o)throw new Error(`File not found at path "${this.sourcePath}"`);return o}get obsidian(){return require("obsidian")}getMetadata({path:o,subscribe:s=!0}={}){const{metadataCache:e,vault:t}=this.plugin.app,n=o?obsidian.normalizePath(o):void 0,r=n?t.getFileByPath(n):null;if(n&&!r)throw new Error(`Failed to get metadata: File not found at "${o}"`);const i=r??this.file;return s&&this.subscribedPaths.add(i.path),e.getFileCache(i)}getProperty({property:o,path:s,subscribe:e=!0}){const t=this.getMetadata({path:s,subscribe:e}),{value:n}=findKeyValueByDotNotation(o,(t==null?void 0:t.frontmatter)??{});return n}renderProperty({property:o,el:s,hideKey:e,path:t,subscribe:n=!0}){const{plugin:r}=this,i=t??this.sourcePath,a=this.getProperty({property:o,path:t,subscribe:n}),l=new InlinePropertyComponent(r,s??this.el,o,a,i,e);l.onKeyChange(()=>{l.keyInputEl&&(l.keyInputEl.value=o)}),l.render()}async markdown({text:o,el:s=this.el}){await obsidian.MarkdownRenderer.render(this.plugin.app,o,s,this.sourcePath,this.component)}async import(path,data){const{vault}=this.plugin.app,normalPath=obsidian.normalizePath(path),lowerPath=normalPath.toLowerCase(),dotSections=lowerPath.split(".");if(dotSections.length<2)throw new Error(`Failed to import module: No file extension was provided in the path "${normalPath}"`);const allowedExtensions=["js","css","json","csv","tsv","yaml","txt","md"],extension=dotSections.reverse()[0].toLowerCase();if(!allowedExtensions.includes(extension)){const o=allowedExtensions.reduce((s,e)=>{const t=`"${e}"`;return s?`${s}, ${t}`:t},"");throw new Error(`Failed to import module: Got extension ".${extension}". Allowed extensions are ${o}`)}const file=vault.getFileByPath(normalPath);if(!file)throw new Error(`Failed to import module: File not found at path "${normalPath}"`);const content=await vault.cachedRead(file);if(this.subscribedPaths.add(file.path),extension==="js"){const exportDefaultRegex=/^export\s+default\s+/gm,contentCommonJs=content.replace(exportDefaultRegex,"module.exports = "),module={};if(eval(contentCommonJs),module.exports===void 0)throw new Error("Failed to import JS file: module.exports is undefined");return module.exports}if(extension==="css"){this.styleEl&&this.styleEl.remove(),this.styleEl=this.el.parentElement.createEl("style"),this.styleEl.textContent=content;return}if(extension==="json")return JSON.parse(content);if(extension==="csv")return parseCsv(content,typeof data=="string"?data:",");if(extension==="tsv")return parseCsv(content,typeof data=="string"?data:"	");if(extension==="yaml")return obsidian.parseYaml(content);if(extension==="md"||extension==="txt")return content}async run(code){this.el.empty();const{success,data,error}=await tryCatch(async()=>{const fn=eval(code);if(typeof fn!="function")throw new Error(`Expect type "function" but got "${typeof fn}"`);return await fn(this)});if(!success){console.error(error),this.el.textContent=error;return}data!=null&&(this.el.textContent=data==null?void 0:data.toString())}}class InlinePropertyComponent extends PropertyComponent{constructor(s,e,t,n,r,i=!1){super(s,e,t,n,r),this.hideKey=i,this.onChange(a=>{const l=s.app.vault.getFileByPath(r);if(!l)throw new Error(`Failed to update property value: File not found at path "${r}"`);s.app.fileManager.processFrontMatter(l,c=>(updateNestedObject(c,t,a),c))})}render(){var e;const s=super.render();return this.hideKey&&((e=this.propertyEl)==null||e.setAttribute("data-better-properties-hide-key","true")),s}}class InlineCodeWidget extends view.WidgetType{constructor(s,e,t,n){super(),this.codeText=s,this.plugin=e,this.file=t,this.view=n}toDOM(){const s=new obsidian.Component;this.destroy=n=>{n.remove(),s.unload()};const e=this.codeText.slice(this.plugin.codePrefix.length),t=new BpJsApi(this.plugin,void 0,this.file.path,s,e);return t.run(e),t.el.classList.add("better-properties-bpjs-code"),t.el}ignoreEvent(s){if(s.type!=="mousedown")return!0;const e=s,t=this.view.posAtCoords({x:e.x,y:e.y});if(e.shiftKey){if(t){const{editor:n}=this.view.state.field(obsidian.editorInfoField);n&&n.setCursor(n.offsetToPos(t))}return!1}return!0}eq(s){return s.codeText===this.codeText}}const createInlineCodePlugin=o=>view.ViewPlugin.fromClass(class{constructor(e){p(this,"decorations");p(this,"view");this.decorations=this.buildDecorations(e),this.view=e}update(e){if(!e.state.field(obsidian.editorLivePreviewField)){this.decorations=view.Decoration.none;return}(e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){this.decorations=view.Decoration.set([]);let t=[];const n=language.syntaxTree(e.state);for(const{from:r,to:i}of e.visibleRanges)n.iterate({from:r,to:i,enter:a=>{const l=a.name.split("_");if(!l.includes("inline-code")&&l.includes("formatting"))return;let c=e.state.doc.sliceString(a.from,a.to);const d=c.startsWith(o.codePrefix);if(selectionAndRangeOverlap(e.state.selection,a.from-1,a.to+1)&&d){this.decorations.between(a.from-1,a.to+1,(f,y,S)=>{this.decorations=this.decorations.update({filterFrom:f,filterTo:y,filter:()=>!1})});return}if(!d)return;const h=e.state.field(obsidian.editorInfoField).file;if(!h)return;let g=view.Decoration.replace({widget:new InlineCodeWidget(c,o,h,e)}).range(a.from,a.to);t.push(g)}});return view.Decoration.set(t)}},{decorations:e=>e.decorations}),selectionAndRangeOverlap=(o,s,e)=>{for(const t of o.ranges)return t.from<=e&&t.to>=s;return!1},createCodeBlockProcessor=o=>{const s=(t,n,r)=>{n.classList.add("better-properties-bpjs-codeblock");const i=new obsidian.MarkdownRenderChild(n);r.addChild(i);const a=new obsidian.Component;i.addChild(a),o.addChild(a),new BpJsApi(o,n,r.sourcePath,a,t).run(t)},e="bpjs";return window.CodeMirror.defineMode(e,t=>window.CodeMirror.getMode(t,"javascript")),[e,s]},createPostProcessor=o=>{const s=(e,t)=>{if(e.tagName.toLowerCase()!=="code"){e.findAll("code").forEach(d=>s(d,t));return}if(!e.textContent.startsWith(o.codePrefix))return;if(!o.app.vault.getFileByPath(t.sourcePath))throw new Error(`File not found at path "${t.sourcePath}"`);const r=e.textContent.slice(o.codePrefix.length),i=createSpan({cls:"better-properties-bpjs-code"});e.replaceWith(i);const a=new obsidian.MarkdownRenderChild(i);t.addChild(a);const l=new obsidian.Component;a.addChild(l),o.addChild(l),new BpJsApi(o,i,t.sourcePath,l,r).run(r)};return s},registerBpJsCodeProcessors=o=>{o.registerMarkdownPostProcessor(createPostProcessor(o)),o.registerMarkdownCodeBlockProcessor(...createCodeBlockProcessor(o)),o.registerEditorExtension([createInlineCodePlugin(o)])},patchMetadataTypeManager=o=>{const s=around(o.app.metadataTypeManager,{getAssignedWidget(e){return dedupe(monkeyAroundKey,e,function(t){const n=this;return e.call(n,getTrueProperty(t))})},setType(e){return dedupe(monkeyAroundKey,e,function(t,n){const r=this;return e.call(r,getTrueProperty(t),n)})}});o.register(s)};class BetterProperties extends obsidian.Plugin{constructor(){super(...arguments);p(this,"settings",getDefaultSettings());p(this,"disabledTypeWidgets",{});p(this,"codePrefix","bpjs:");p(this,"bpjsInstances",new Set)}async onload(){await this.loadSettings(),this.addSettingTab(new BetterPropertiesSettingsTab(this)),patchMetadataTypeManager(this),registerCustomPropertyTypeWidgets(this),wrapAllPropertyTypeWidgets(this),sortAndFilterRegisteredTypeWidgets(this),this.setupCommands(),this.app.workspace.onLayoutReady(async()=>{customizePropertyEditorMenu(this),patchMetadataEditor(this),patchMetadataCache(this),setupBpJsListeners(this),registerBpJsCodeProcessors(this),this.rebuildLeaves()}),this.handlePropertyLabelWidth(),this.registerEvent(this.app.vault.on("config-changed",()=>{this.refreshPropertyEditors()}))}rebuildLeaves(){this.app.workspace.iterateAllLeaves(e=>{e.rebuildView&&e.rebuildView()})}refreshPropertyEditors(){this.app.workspace.iterateAllLeaves(e=>{!(e.view instanceof obsidian.MarkdownView)||!e.view.metadataEditor||e.rebuildView()})}setupCommands(){this.addCommand({id:"refresh-property-editors",name:"Refresh Property Editors",callback:()=>{this.refreshPropertyEditors()}}),this.addCommand({id:"rebuild-views",name:"Rebuild views",callback:()=>{this.rebuildLeaves()}}),this.addCommand({id:"open-property-settings",name:"Open property settings",callback:()=>{const e=new PropertySuggestModal(this);e.onChooseItem=t=>{e.close(),showPropertySettingsModal({plugin:this,property:t.name})},e.open()}}),this.addCommand({id:"rename-property",name:"Rename property",callback:()=>{const e=new PropertySuggestModal(this);e.onChooseItem=t=>{e.close(),openRenameModal({plugin:this,property:t.name})},e.open()}})}handlePropertyLabelWidth(){this.updateSettings(t=>({...t,defaultLabelWidth:document.body.getCssPropertyValue("---metadata-label-width")}));const e=t=>{document.body.setCssProps({"--metadata-label-width":t===void 0?this.settings.defaultLabelWidth:t+"px"})};this.app.workspace.on("better-properties:property-label-width-change",t=>{e(t),this.updateSettings(n=>({...n,propertyLabelWidth:t}))}),e(this.settings.propertyLabelWidth)}onunload(){unregisterCustomPropertyTypeWidgets(this),this.bpjsInstances.forEach(e=>{e.component.unload()})}async onExternalSettingsChange(){await this.loadSettings()}async loadSettings(){const e=await this.loadData();if(!e){this.settings=getDefaultSettings();return}const t=safeParse(betterPropertiesSettingsSchema,e);if(t.success){this.settings=t.output;return}const n="Better Properties: Invalid plugin settings detected!",r="This likely happened because you modified the plugin's settings.json file directly. If not, please open an issue on the plugin's github repository";console.error(n+`
`+r),console.error(t.issues);const i=new obsidian.Modal(this.app);i.setTitle(n),i.contentEl.createEl("p",{text:r}),i.contentEl.createEl("p",{text:"You can also reset the plugin's settings entirely by clicking the button below."});const a=i.contentEl.createDiv({cls:"modal-button-container"});new obsidian.ButtonComponent(a).setWarning().setButtonText("Reset settings").onClick(()=>{this.settings=getDefaultSettings()}),i.open()}async saveSettings(){await this.saveData(this.settings)}async updateSettings(e){const t=e(this.settings);this.settings={...t},await this.saveSettings()}}module.exports=BetterProperties;
