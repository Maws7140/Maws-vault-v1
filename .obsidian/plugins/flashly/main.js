/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ui=Object.create;var it=Object.defineProperty;var hi=Object.getOwnPropertyDescriptor;var pi=Object.getOwnPropertyNames;var fi=Object.getPrototypeOf,gi=Object.prototype.hasOwnProperty;var mi=(o,r,e)=>r in o?it(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var ye=(o,r)=>()=>(r||o((r={exports:{}}).exports,r),r.exports),vi=(o,r)=>{for(var e in r)it(o,e,{get:r[e],enumerable:!0})},ts=(o,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of pi(r))!gi.call(o,s)&&s!==e&&it(o,s,{get:()=>r[s],enumerable:!(t=hi(r,s))||t.enumerable});return o};var pt=(o,r,e)=>(e=o!=null?ui(fi(o)):{},ts(r||!o||!o.__esModule?it(e,"default",{value:o,enumerable:!0}):e,o)),wi=o=>ts(it({},"__esModule",{value:!0}),o);var X=(o,r,e)=>(mi(o,typeof r!="symbol"?r+"":r,e),e);var ms=ye((qr,Qr)=>{((o,r)=>{typeof define=="function"&&define.amd?define([],r):typeof Qr=="object"&&typeof qr<"u"?Qr.exports=r():o.Papa=r()})(qr,function o(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},e,t=!r.document&&!!r.postMessage,s=r.IS_PAPA_WORKER||!1,i={},n=0,a={};function l(k){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(y){var D=x(y);D.chunkSize=parseInt(D.chunkSize),y.step||y.chunk||(D.chunkSize=null),this._handle=new d(D),(this._handle.streamer=this)._config=D}.call(this,k),this.parseChunk=function(y,D){var $=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<$){let R=this._config.newline;R||(_=this._config.quoteChar||'"',R=this._handle.guessLineEndings(y,_)),y=[...y.split(R).slice($)].join(R)}this.isFirstChunk&&F(this._config.beforeFirstChunk)&&(_=this._config.beforeFirstChunk(y))!==void 0&&(y=_),this.isFirstChunk=!1,this._halted=!1;var $=this._partialLine+y,_=(this._partialLine="",this._handle.parse($,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(y=_.meta.cursor,$=(this._finished||(this._partialLine=$.substring(y-this._baseIndex),this._baseIndex=y),_&&_.data&&(this._rowCount+=_.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),s)r.postMessage({results:_,workerId:a.WORKER_ID,finished:$});else if(F(this._config.chunk)&&!D){if(this._config.chunk(_,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=_=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(_.data),this._completeResults.errors=this._completeResults.errors.concat(_.errors),this._completeResults.meta=_.meta),this._completed||!$||!F(this._config.complete)||_&&_.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),$||_&&_.meta.paused||this._nextChunk(),_}this._halted=!0},this._sendError=function(y){F(this._config.error)?this._config.error(y):s&&this._config.error&&r.postMessage({workerId:a.WORKER_ID,error:y,finished:!1})}}function h(k){var y;(k=k||{}).chunkSize||(k.chunkSize=a.RemoteChunkSize),l.call(this,k),this._nextChunk=t?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(D){this._input=D,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(y=new XMLHttpRequest,this._config.withCredentials&&(y.withCredentials=this._config.withCredentials),t||(y.onload=N(this._chunkLoaded,this),y.onerror=N(this._chunkError,this)),y.open(this._config.downloadRequestBody?"POST":"GET",this._input,!t),this._config.downloadRequestHeaders){var D,$=this._config.downloadRequestHeaders;for(D in $)y.setRequestHeader(D,$[D])}var _;this._config.chunkSize&&(_=this._start+this._config.chunkSize-1,y.setRequestHeader("Range","bytes="+this._start+"-"+_));try{y.send(this._config.downloadRequestBody)}catch(R){this._chunkError(R.message)}t&&y.status===0&&this._chunkError()}},this._chunkLoaded=function(){y.readyState===4&&(y.status<200||400<=y.status?this._chunkError():(this._start+=this._config.chunkSize||y.responseText.length,this._finished=!this._config.chunkSize||this._start>=(D=>(D=D.getResponseHeader("Content-Range"))!==null?parseInt(D.substring(D.lastIndexOf("/")+1)):-1)(y),this.parseChunk(y.responseText)))},this._chunkError=function(D){D=y.statusText||D,this._sendError(new Error(D))}}function p(k){(k=k||{}).chunkSize||(k.chunkSize=a.LocalChunkSize),l.call(this,k);var y,D,$=typeof FileReader<"u";this.stream=function(_){this._input=_,D=_.slice||_.webkitSlice||_.mozSlice,$?((y=new FileReader).onload=N(this._chunkLoaded,this),y.onerror=N(this._chunkError,this)):y=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var _=this._input,R=(this._config.chunkSize&&(R=Math.min(this._start+this._config.chunkSize,this._input.size),_=D.call(_,this._start,R)),y.readAsText(_,this._config.encoding));$||this._chunkLoaded({target:{result:R}})},this._chunkLoaded=function(_){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(_.target.result)},this._chunkError=function(){this._sendError(y.error)}}function u(k){var y;l.call(this,k=k||{}),this.stream=function(D){return y=D,this._nextChunk()},this._nextChunk=function(){var D,$;if(!this._finished)return D=this._config.chunkSize,y=D?($=y.substring(0,D),y.substring(D)):($=y,""),this._finished=!y,this.parseChunk($)}}function m(k){l.call(this,k=k||{});var y=[],D=!0,$=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(_){this._input=_,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){$&&y.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),y.length?this.parseChunk(y.shift()):D=!0},this._streamData=N(function(_){try{y.push(typeof _=="string"?_:_.toString(this._config.encoding)),D&&(D=!1,this._checkIsFinished(),this.parseChunk(y.shift()))}catch(R){this._streamError(R)}},this),this._streamError=N(function(_){this._streamCleanUp(),this._sendError(_)},this),this._streamEnd=N(function(){this._streamCleanUp(),$=!0,this._streamData("")},this),this._streamCleanUp=N(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function d(k){var y,D,$,_,R=Math.pow(2,53),f=-R,B=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ne=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,P=this,re=0,M=0,ee=!1,A=!1,T=[],H={data:[],errors:[],meta:{}};function W(Y){return k.skipEmptyLines==="greedy"?Y.join("").trim()==="":Y.length===1&&Y[0].length===0}function j(){if(H&&$&&(pe("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),$=!1),k.skipEmptyLines&&(H.data=H.data.filter(function(ue){return!W(ue)})),de()){let ue=function(he,c){F(k.transformHeader)&&(he=k.transformHeader(he,c)),T.push(he)};var ie=ue;if(H)if(Array.isArray(H.data[0])){for(var Y=0;de()&&Y<H.data.length;Y++)H.data[Y].forEach(ue);H.data.splice(0,1)}else H.data.forEach(ue)}function te(ue,he){for(var c=k.header?{}:[],L=0;L<ue.length;L++){var I=L,C=ue[L],C=((w,E)=>(Q=>(k.dynamicTypingFunction&&k.dynamicTyping[Q]===void 0&&(k.dynamicTyping[Q]=k.dynamicTypingFunction(Q)),(k.dynamicTyping[Q]||k.dynamicTyping)===!0))(w)?E==="true"||E==="TRUE"||E!=="false"&&E!=="FALSE"&&((Q=>{if(B.test(Q)&&(Q=parseFloat(Q),f<Q&&Q<R))return 1})(E)?parseFloat(E):ne.test(E)?new Date(E):E===""?null:E):E)(I=k.header?L>=T.length?"__parsed_extra":T[L]:I,C=k.transform?k.transform(C,I):C);I==="__parsed_extra"?(c[I]=c[I]||[],c[I].push(C)):c[I]=C}return k.header&&(L>T.length?pe("FieldMismatch","TooManyFields","Too many fields: expected "+T.length+" fields but parsed "+L,M+he):L<T.length&&pe("FieldMismatch","TooFewFields","Too few fields: expected "+T.length+" fields but parsed "+L,M+he)),c}var le;H&&(k.header||k.dynamicTyping||k.transform)&&(le=1,!H.data.length||Array.isArray(H.data[0])?(H.data=H.data.map(te),le=H.data.length):H.data=te(H.data,0),k.header&&H.meta&&(H.meta.fields=T),M+=le)}function de(){return k.header&&T.length===0}function pe(Y,te,le,ie){Y={type:Y,code:te,message:le},ie!==void 0&&(Y.row=ie),H.errors.push(Y)}F(k.step)&&(_=k.step,k.step=function(Y){H=Y,de()?j():(j(),H.data.length!==0&&(re+=Y.data.length,k.preview&&re>k.preview?D.abort():(H.data=H.data[0],_(H,P))))}),this.parse=function(Y,te,le){var ie=k.quoteChar||'"',ie=(k.newline||(k.newline=this.guessLineEndings(Y,ie)),$=!1,k.delimiter?F(k.delimiter)&&(k.delimiter=k.delimiter(Y),H.meta.delimiter=k.delimiter):((ie=((ue,he,c,L,I)=>{var C,w,E,Q;I=I||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var U=0;U<I.length;U++){for(var O,V=I[U],K=0,G=0,Z=0,ce=(E=void 0,new v({comments:L,delimiter:V,newline:he,preview:10}).parse(ue)),oe=0;oe<ce.data.length;oe++)c&&W(ce.data[oe])?Z++:(O=ce.data[oe].length,G+=O,E===void 0?E=O:0<O&&(K+=Math.abs(O-E),E=O));0<ce.data.length&&(G/=ce.data.length-Z),(w===void 0||K<=w)&&(Q===void 0||Q<G)&&1.99<G&&(w=K,C=V,Q=G)}return{successful:!!(k.delimiter=C),bestDelimiter:C}})(Y,k.newline,k.skipEmptyLines,k.comments,k.delimitersToGuess)).successful?k.delimiter=ie.bestDelimiter:($=!0,k.delimiter=a.DefaultDelimiter),H.meta.delimiter=k.delimiter),x(k));return k.preview&&k.header&&ie.preview++,y=Y,D=new v(ie),H=D.parse(y,te,le),j(),ee?{meta:{paused:!0}}:H||{meta:{paused:!1}}},this.paused=function(){return ee},this.pause=function(){ee=!0,D.abort(),y=F(k.chunk)?"":y.substring(D.getCharIndex())},this.resume=function(){P.streamer._halted?(ee=!1,P.streamer.parseChunk(y,!0)):setTimeout(P.resume,3)},this.aborted=function(){return A},this.abort=function(){A=!0,D.abort(),H.meta.aborted=!0,F(k.complete)&&k.complete(H),y=""},this.guessLineEndings=function(ue,ie){ue=ue.substring(0,1048576);var ie=new RegExp(g(ie)+"([^]*?)"+g(ie),"gm"),le=(ue=ue.replace(ie,"")).split("\r"),ie=ue.split(`
`),ue=1<ie.length&&ie[0].length<le[0].length;if(le.length===1||ue)return`
`;for(var he=0,c=0;c<le.length;c++)le[c][0]===`
`&&he++;return he>=le.length/2?`\r
`:"\r"}}function g(k){return k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function v(k){var y=(k=k||{}).delimiter,D=k.newline,$=k.comments,_=k.step,R=k.preview,f=k.fastMode,B=null,ne=!1,P=k.quoteChar==null?'"':k.quoteChar,re=P;if(k.escapeChar!==void 0&&(re=k.escapeChar),(typeof y!="string"||-1<a.BAD_DELIMITERS.indexOf(y))&&(y=","),$===y)throw new Error("Comment character same as delimiter");$===!0?$="#":(typeof $!="string"||-1<a.BAD_DELIMITERS.indexOf($))&&($=!1),D!==`
`&&D!=="\r"&&D!==`\r
`&&(D=`
`);var M=0,ee=!1;this.parse=function(A,T,H){if(typeof A!="string")throw new Error("Input must be a string");var W=A.length,j=y.length,de=D.length,pe=$.length,Y=F(_),te=[],le=[],ie=[],ue=M=0;if(!A)return K();if(f||f!==!1&&A.indexOf(P)===-1){for(var he=A.split(D),c=0;c<he.length;c++){if(ie=he[c],M+=ie.length,c!==he.length-1)M+=D.length;else if(H)return K();if(!$||ie.substring(0,pe)!==$){if(Y){if(te=[],Q(ie.split(y)),G(),ee)return K()}else Q(ie.split(y));if(R&&R<=c)return te=te.slice(0,R),K(!0)}}return K()}for(var L=A.indexOf(y,M),I=A.indexOf(D,M),C=new RegExp(g(re)+g(P),"g"),w=A.indexOf(P,M);;)if(A[M]===P)for(w=M,M++;;){if((w=A.indexOf(P,w+1))===-1)return H||le.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:te.length,index:M}),O();if(w===W-1)return O(A.substring(M,w).replace(C,P));if(P===re&&A[w+1]===re)w++;else if(P===re||w===0||A[w-1]!==re){L!==-1&&L<w+1&&(L=A.indexOf(y,w+1));var E=U((I=I!==-1&&I<w+1?A.indexOf(D,w+1):I)===-1?L:Math.min(L,I));if(A.substr(w+1+E,j)===y){ie.push(A.substring(M,w).replace(C,P)),A[M=w+1+E+j]!==P&&(w=A.indexOf(P,M)),L=A.indexOf(y,M),I=A.indexOf(D,M);break}if(E=U(I),A.substring(w+1+E,w+1+E+de)===D){if(ie.push(A.substring(M,w).replace(C,P)),V(w+1+E+de),L=A.indexOf(y,M),w=A.indexOf(P,M),Y&&(G(),ee))return K();if(R&&te.length>=R)return K(!0);break}le.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:te.length,index:M}),w++}}else if($&&ie.length===0&&A.substring(M,M+pe)===$){if(I===-1)return K();M=I+de,I=A.indexOf(D,M),L=A.indexOf(y,M)}else if(L!==-1&&(L<I||I===-1))ie.push(A.substring(M,L)),M=L+j,L=A.indexOf(y,M);else{if(I===-1)break;if(ie.push(A.substring(M,I)),V(I+de),Y&&(G(),ee))return K();if(R&&te.length>=R)return K(!0)}return O();function Q(Z){te.push(Z),ue=M}function U(Z){var ce=0;return ce=Z!==-1&&(Z=A.substring(w+1,Z))&&Z.trim()===""?Z.length:ce}function O(Z){return H||(Z===void 0&&(Z=A.substring(M)),ie.push(Z),M=W,Q(ie),Y&&G()),K()}function V(Z){M=Z,Q(ie),ie=[],I=A.indexOf(D,M)}function K(Z){if(k.header&&!T&&te.length&&!ne){var ce=te[0],oe=Object.create(null),be=new Set(ce);let Le=!1;for(let we=0;we<ce.length;we++){let ke=ce[we];if(oe[ke=F(k.transformHeader)?k.transformHeader(ke,we):ke]){let fe,Be=oe[ke];for(;fe=ke+"_"+Be,Be++,be.has(fe););be.add(fe),ce[we]=fe,oe[ke]++,Le=!0,(B=B===null?{}:B)[fe]=ke}else oe[ke]=1,ce[we]=ke;be.add(ke)}Le&&console.warn("Duplicate headers found and renamed."),ne=!0}return{data:te,errors:le,meta:{delimiter:y,linebreak:D,aborted:ee,truncated:!!Z,cursor:ue+(T||0),renamedHeaders:B}}}function G(){_(K()),te=[],le=[]}},this.abort=function(){ee=!0},this.getCharIndex=function(){return M}}function b(k){var y=k.data,D=i[y.workerId],$=!1;if(y.error)D.userError(y.error,y.file);else if(y.results&&y.results.data){var _={abort:function(){$=!0,S(y.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:z,resume:z};if(F(D.userStep)){for(var R=0;R<y.results.data.length&&(D.userStep({data:y.results.data[R],errors:y.results.errors,meta:y.results.meta},_),!$);R++);delete y.results}else F(D.userChunk)&&(D.userChunk(y.results,_,y.file),delete y.results)}y.finished&&!$&&S(y.workerId,y.results)}function S(k,y){var D=i[k];F(D.userComplete)&&D.userComplete(y),D.terminate(),delete i[k]}function z(){throw new Error("Not implemented.")}function x(k){if(typeof k!="object"||k===null)return k;var y,D=Array.isArray(k)?[]:{};for(y in k)D[y]=x(k[y]);return D}function N(k,y){return function(){k.apply(y,arguments)}}function F(k){return typeof k=="function"}return a.parse=function(k,y){var D=(y=y||{}).dynamicTyping||!1;if(F(D)&&(y.dynamicTypingFunction=D,D={}),y.dynamicTyping=D,y.transform=!!F(y.transform)&&y.transform,!y.worker||!a.WORKERS_SUPPORTED)return D=null,a.NODE_STREAM_INPUT,typeof k=="string"?(k=($=>$.charCodeAt(0)!==65279?$:$.slice(1))(k),D=new(y.download?h:u)(y)):k.readable===!0&&F(k.read)&&F(k.on)?D=new m(y):(r.File&&k instanceof File||k instanceof Object)&&(D=new p(y)),D.stream(k);(D=(()=>{var $;return!!a.WORKERS_SUPPORTED&&($=(()=>{var _=r.URL||r.webkitURL||null,R=o.toString();return a.BLOB_URL||(a.BLOB_URL=_.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",R,")();"],{type:"text/javascript"})))})(),($=new r.Worker($)).onmessage=b,$.id=n++,i[$.id]=$)})()).userStep=y.step,D.userChunk=y.chunk,D.userComplete=y.complete,D.userError=y.error,y.step=F(y.step),y.chunk=F(y.chunk),y.complete=F(y.complete),y.error=F(y.error),delete y.worker,D.postMessage({input:k,config:y,workerId:D.id})},a.unparse=function(k,y){var D=!1,$=!0,_=",",R=`\r
`,f='"',B=f+f,ne=!1,P=null,re=!1,M=((()=>{if(typeof y=="object"){if(typeof y.delimiter!="string"||a.BAD_DELIMITERS.filter(function(T){return y.delimiter.indexOf(T)!==-1}).length||(_=y.delimiter),typeof y.quotes!="boolean"&&typeof y.quotes!="function"&&!Array.isArray(y.quotes)||(D=y.quotes),typeof y.skipEmptyLines!="boolean"&&typeof y.skipEmptyLines!="string"||(ne=y.skipEmptyLines),typeof y.newline=="string"&&(R=y.newline),typeof y.quoteChar=="string"&&(f=y.quoteChar),typeof y.header=="boolean"&&($=y.header),Array.isArray(y.columns)){if(y.columns.length===0)throw new Error("Option columns is empty");P=y.columns}y.escapeChar!==void 0&&(B=y.escapeChar+f),y.escapeFormulae instanceof RegExp?re=y.escapeFormulae:typeof y.escapeFormulae=="boolean"&&y.escapeFormulae&&(re=/^[=+\-@\t\r].*$/)}})(),new RegExp(g(f),"g"));if(typeof k=="string"&&(k=JSON.parse(k)),Array.isArray(k)){if(!k.length||Array.isArray(k[0]))return ee(null,k,ne);if(typeof k[0]=="object")return ee(P||Object.keys(k[0]),k,ne)}else if(typeof k=="object")return typeof k.data=="string"&&(k.data=JSON.parse(k.data)),Array.isArray(k.data)&&(k.fields||(k.fields=k.meta&&k.meta.fields||P),k.fields||(k.fields=Array.isArray(k.data[0])?k.fields:typeof k.data[0]=="object"?Object.keys(k.data[0]):[]),Array.isArray(k.data[0])||typeof k.data[0]=="object"||(k.data=[k.data])),ee(k.fields||[],k.data||[],ne);throw new Error("Unable to serialize unrecognized input");function ee(T,H,W){var j="",de=(typeof T=="string"&&(T=JSON.parse(T)),typeof H=="string"&&(H=JSON.parse(H)),Array.isArray(T)&&0<T.length),pe=!Array.isArray(H[0]);if(de&&$){for(var Y=0;Y<T.length;Y++)0<Y&&(j+=_),j+=A(T[Y],Y);0<H.length&&(j+=R)}for(var te=0;te<H.length;te++){var le=(de?T:H[te]).length,ie=!1,ue=de?Object.keys(H[te]).length===0:H[te].length===0;if(W&&!de&&(ie=W==="greedy"?H[te].join("").trim()==="":H[te].length===1&&H[te][0].length===0),W==="greedy"&&de){for(var he=[],c=0;c<le;c++){var L=pe?T[c]:c;he.push(H[te][L])}ie=he.join("").trim()===""}if(!ie){for(var I=0;I<le;I++){0<I&&!ue&&(j+=_);var C=de&&pe?T[I]:I;j+=A(H[te][C],I)}te<H.length-1&&(!W||0<le&&!ue)&&(j+=R)}}return j}function A(T,H){var W,j;return T==null?"":T.constructor===Date?JSON.stringify(T).slice(1,25):(j=!1,re&&typeof T=="string"&&re.test(T)&&(T="'"+T,j=!0),W=T.toString().replace(M,B),(j=j||D===!0||typeof D=="function"&&D(T,H)||Array.isArray(D)&&D[H]||((de,pe)=>{for(var Y=0;Y<pe.length;Y++)if(-1<de.indexOf(pe[Y]))return!0;return!1})(W,a.BAD_DELIMITERS)||-1<W.indexOf(_)||W.charAt(0)===" "||W.charAt(W.length-1)===" ")?f+W+f:W)}},a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r",`
`,'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!t&&!!r.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=v,a.ParserHandle=d,a.NetworkStreamer=h,a.FileStreamer=p,a.StringStreamer=u,a.ReadableStreamStreamer=m,r.jQuery&&((e=r.jQuery).fn.parse=function(k){var y=k.config||{},D=[];return this.each(function(R){if(!(e(this).prop("tagName").toUpperCase()==="INPUT"&&e(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var f=0;f<this.files.length;f++)D.push({file:this.files[f],inputElem:this,instanceConfig:e.extend({},y)})}),$(),this;function $(){if(D.length===0)F(k.complete)&&k.complete();else{var R,f,B,ne,P=D[0];if(F(k.before)){var re=k.before(P.file,P.inputElem);if(typeof re=="object"){if(re.action==="abort")return R="AbortError",f=P.file,B=P.inputElem,ne=re.reason,void(F(k.error)&&k.error({name:R},f,B,ne));if(re.action==="skip")return void _();typeof re.config=="object"&&(P.instanceConfig=e.extend(P.instanceConfig,re.config))}else if(re==="skip")return void _()}var M=P.instanceConfig.complete;P.instanceConfig.complete=function(ee){F(M)&&M(ee,P.file,P.inputElem),_()},a.parse(P.file,P.instanceConfig)}}function _(){D.splice(0,1),$()}}),s&&(r.onmessage=function(k){k=k.data,a.WORKER_ID===void 0&&k&&(a.WORKER_ID=k.workerId),typeof k.input=="string"?r.postMessage({workerId:a.WORKER_ID,results:a.parse(k.input,k.config),finished:!0}):(r.File&&k.input instanceof File||k.input instanceof Object)&&(k=a.parse(k.input,k.config))&&r.postMessage({workerId:a.WORKER_ID,results:k,finished:!0})}),(h.prototype=Object.create(l.prototype)).constructor=h,(p.prototype=Object.create(l.prototype)).constructor=p,(u.prototype=Object.create(u.prototype)).constructor=u,(m.prototype=Object.create(l.prototype)).constructor=m,a})});var Oe=ye(sr=>{"use strict";sr.getBooleanOption=(o,r)=>{let e=!1;if(r in o&&typeof(e=o[r])!="boolean")throw new TypeError(`Expected the "${r}" option to be a boolean`);return e};sr.cppdb=Symbol();sr.inspect=Symbol.for("nodejs.util.inspect.custom")});var Vr=ye((Wo,bs)=>{"use strict";var Gr={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function He(o,r){if(new.target!==He)return new He(o,r);if(typeof r!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,o),Gr.value=""+o,Object.defineProperty(this,"message",Gr),Error.captureStackTrace(this,He),this.code=r}Object.setPrototypeOf(He,Error);Object.setPrototypeOf(He.prototype,Error.prototype);Object.defineProperty(He.prototype,"name",Gr);bs.exports=He});var _s=ye((Ko,ks)=>{var ir=require("path").sep||"/";ks.exports=Gi;function Gi(o){if(typeof o!="string"||o.length<=7||o.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var r=decodeURI(o.substring(7)),e=r.indexOf("/"),t=r.substring(0,e),s=r.substring(e+1);return t=="localhost"&&(t=""),t&&(t=ir+ir+t),s=s.replace(/^(.+)\|/,"$1:"),ir=="\\"&&(s=s.replace(/\//g,"\\")),/^.+\:/.test(s)||(s=ir+s),t+s}});var Es=ye((tt,xs)=>{var Wr=require("fs"),ar=require("path"),Vi=_s(),nr=ar.join,Wi=ar.dirname,Cs=Wr.accessSync&&function(o){try{Wr.accessSync(o)}catch{return!1}return!0}||Wr.existsSync||ar.existsSync,Ss={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function Ki(o){typeof o=="string"?o={bindings:o}:o||(o={}),Object.keys(Ss).map(function(l){l in o||(o[l]=Ss[l])}),o.module_root||(o.module_root=tt.getRoot(tt.getFileName())),ar.extname(o.bindings)!=".node"&&(o.bindings+=".node");for(var r=typeof __webpack_require__=="function"?__non_webpack_require__:require,e=[],t=0,s=o.try.length,i,n,a;t<s;t++){i=nr.apply(null,o.try[t].map(function(l){return o[l]||l})),e.push(i);try{return n=o.path?r.resolve(i):r(i),o.path||(n.path=i),n}catch(l){if(l.code!=="MODULE_NOT_FOUND"&&l.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(l.message))throw l}}throw a=new Error(`Could not locate the bindings file. Tried:
`+e.map(function(l){return o.arrow+l}).join(`
`)),a.tries=e,a}xs.exports=tt=Ki;tt.getFileName=function(r){var e=Error.prepareStackTrace,t=Error.stackTraceLimit,s={},i;Error.stackTraceLimit=10,Error.prepareStackTrace=function(a,l){for(var h=0,p=l.length;h<p;h++)if(i=l[h].getFileName(),i!==__filename)if(r){if(i!==r)return}else return},Error.captureStackTrace(s),s.stack,Error.prepareStackTrace=e,Error.stackTraceLimit=t;var n="file://";return i.indexOf(n)===0&&(i=Vi(i)),i};tt.getRoot=function(r){for(var e=Wi(r),t;;){if(e==="."&&(e=process.cwd()),Cs(nr(e,"package.json"))||Cs(nr(e,"node_modules")))return e;if(t===e)throw new Error('Could not find module root given file: "'+r+'". Do you have a `package.json` file? ');t=e,e=nr(e,"..")}}});var Ds=ye(qe=>{"use strict";var{cppdb:ze}=Oe();qe.prepare=function(r){return this[ze].prepare(r,this,!1)};qe.exec=function(r){return this[ze].exec(r),this};qe.close=function(){return this[ze].close(),this};qe.loadExtension=function(...r){return this[ze].loadExtension(...r),this};qe.defaultSafeIntegers=function(...r){return this[ze].defaultSafeIntegers(...r),this};qe.unsafeMode=function(...r){return this[ze].unsafeMode(...r),this};qe.getters={name:{get:function(){return this[ze].name},enumerable:!0},open:{get:function(){return this[ze].open},enumerable:!0},inTransaction:{get:function(){return this[ze].inTransaction},enumerable:!0},readonly:{get:function(){return this[ze].readonly},enumerable:!0},memory:{get:function(){return this[ze].memory},enumerable:!0}}});var As=ye((Yo,zs)=>{"use strict";var{cppdb:Zi}=Oe(),Ts=new WeakMap;zs.exports=function(r){if(typeof r!="function")throw new TypeError("Expected first argument to be a function");let e=this[Zi],t=Yi(e,this),{apply:s}=Function.prototype,i={default:{value:or(s,r,e,t.default)},deferred:{value:or(s,r,e,t.deferred)},immediate:{value:or(s,r,e,t.immediate)},exclusive:{value:or(s,r,e,t.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(i.default.value,i),Object.defineProperties(i.deferred.value,i),Object.defineProperties(i.immediate.value,i),Object.defineProperties(i.exclusive.value,i),i.default.value};var Yi=(o,r)=>{let e=Ts.get(o);if(!e){let t={commit:o.prepare("COMMIT",r,!1),rollback:o.prepare("ROLLBACK",r,!1),savepoint:o.prepare("SAVEPOINT `	_bs3.	`",r,!1),release:o.prepare("RELEASE `	_bs3.	`",r,!1),rollbackTo:o.prepare("ROLLBACK TO `	_bs3.	`",r,!1)};Ts.set(o,e={default:Object.assign({begin:o.prepare("BEGIN",r,!1)},t),deferred:Object.assign({begin:o.prepare("BEGIN DEFERRED",r,!1)},t),immediate:Object.assign({begin:o.prepare("BEGIN IMMEDIATE",r,!1)},t),exclusive:Object.assign({begin:o.prepare("BEGIN EXCLUSIVE",r,!1)},t)})}return e},or=(o,r,e,{begin:t,commit:s,rollback:i,savepoint:n,release:a,rollbackTo:l})=>function(){let p,u,m;e.inTransaction?(p=n,u=a,m=l):(p=t,u=s,m=i),p.run();try{let d=o.call(r,this,arguments);if(d&&typeof d.then=="function")throw new TypeError("Transaction function cannot return a promise");return u.run(),d}catch(d){throw e.inTransaction&&(m.run(),m!==i&&u.run()),d}}});var Fs=ye((Jo,Is)=>{"use strict";var{getBooleanOption:Ji,cppdb:Xi}=Oe();Is.exports=function(r,e){if(e==null&&(e={}),typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");let t=Ji(e,"simple"),s=this[Xi].prepare(`PRAGMA ${r}`,this,!0);return t?s.pluck().get():s.all()}});var Ns=ye((Xo,Rs)=>{"use strict";var en=require("fs"),tn=require("path"),{promisify:rn}=require("util"),{cppdb:sn}=Oe(),Os=rn(en.access);Rs.exports=async function(r,e){if(e==null&&(e={}),typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");r=r.trim();let t="attached"in e?e.attached:"main",s="progress"in e?e.progress:null;if(!r)throw new TypeError("Backup filename cannot be an empty string");if(r===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof t!="string")throw new TypeError('Expected the "attached" option to be a string');if(!t)throw new TypeError('The "attached" option cannot be an empty string');if(s!=null&&typeof s!="function")throw new TypeError('Expected the "progress" option to be a function');await Os(tn.dirname(r)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let i=await Os(r).then(()=>!1,()=>!0);return nn(this[sn].backup(this,t,r,i),s||null)};var nn=(o,r)=>{let e=0,t=!0;return new Promise((s,i)=>{setImmediate(function n(){try{let a=o.transfer(e);if(!a.remainingPages){o.close(),s(a);return}if(t&&(t=!1,e=100),r){let l=r(a);if(l!==void 0)if(typeof l=="number"&&l===l)e=Math.max(0,Math.min(2147483647,Math.round(l)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(n)}catch(a){o.close(),i(a)}})})}});var Ms=ye((el,Ls)=>{"use strict";var{cppdb:an}=Oe();Ls.exports=function(r){if(r==null&&(r={}),typeof r!="object")throw new TypeError("Expected first argument to be an options object");let e="attached"in r?r.attached:"main";if(typeof e!="string")throw new TypeError('Expected the "attached" option to be a string');if(!e)throw new TypeError('The "attached" option cannot be an empty string');return this[an].serialize(e)}});var qs=ye((tl,Ps)=>{"use strict";var{getBooleanOption:lr,cppdb:on}=Oe();Ps.exports=function(r,e,t){if(e==null&&(e={}),typeof e=="function"&&(t=e,e={}),typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="function")throw new TypeError("Expected last argument to be a function");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");if(!r)throw new TypeError("User-defined function name cannot be an empty string");let s="safeIntegers"in e?+lr(e,"safeIntegers"):2,i=lr(e,"deterministic"),n=lr(e,"directOnly"),a=lr(e,"varargs"),l=-1;if(!a){if(l=t.length,!Number.isInteger(l)||l<0)throw new TypeError("Expected function.length to be a positive integer");if(l>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[on].function(t,r,l,s,i,n),this}});var $s=ye((rl,Bs)=>{"use strict";var{getBooleanOption:cr,cppdb:ln}=Oe();Bs.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object"||e===null)throw new TypeError("Expected second argument to be an options object");if(!r)throw new TypeError("User-defined function name cannot be an empty string");let t="start"in e?e.start:null,s=Kr(e,"step",!0),i=Kr(e,"inverse",!1),n=Kr(e,"result",!1),a="safeIntegers"in e?+cr(e,"safeIntegers"):2,l=cr(e,"deterministic"),h=cr(e,"directOnly"),p=cr(e,"varargs"),u=-1;if(!p&&(u=Math.max(Qs(s),i?Qs(i):0),u>0&&(u-=1),u>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[ln].aggregate(t,s,i,n,r,u,a,l,h),this};var Kr=(o,r,e)=>{let t=r in o?o[r]:null;if(typeof t=="function")return t;if(t!=null)throw new TypeError(`Expected the "${r}" option to be a function`);if(e)throw new TypeError(`Missing required option "${r}"`);return null},Qs=({length:o})=>{if(Number.isInteger(o)&&o>=0)return o;throw new TypeError("Expected function.length to be a positive integer")}});var Gs=ye((sl,js)=>{"use strict";var{cppdb:cn}=Oe();js.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected first argument to be a string");if(!r)throw new TypeError("Virtual table module name cannot be an empty string");let t=!1;if(typeof e=="object"&&e!==null)t=!0,e=vn(Hs(e,"used",r));else{if(typeof e!="function")throw new TypeError("Expected second argument to be a function or a table definition object");e=dn(e)}return this[cn].table(e,r,t),this};function dn(o){return function(e,t,s,...i){let n={module:e,database:t,table:s},a=gn.call(o,n,i);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${e}" did not return a table definition object`);return Hs(a,"returned",e)}}function Hs(o,r,e){if(!ut.call(o,"rows"))throw new TypeError(`Virtual table module "${e}" ${r} a table definition without a "rows" property`);if(!ut.call(o,"columns"))throw new TypeError(`Virtual table module "${e}" ${r} a table definition without a "columns" property`);let t=o.rows;if(typeof t!="function"||Object.getPrototypeOf(t)!==mn)throw new TypeError(`Virtual table module "${e}" ${r} a table definition with an invalid "rows" property (should be a generator function)`);let s=o.columns;if(!Array.isArray(s)||!(s=[...s]).every(h=>typeof h=="string"))throw new TypeError(`Virtual table module "${e}" ${r} a table definition with an invalid "columns" property (should be an array of strings)`);if(s.length!==new Set(s).size)throw new TypeError(`Virtual table module "${e}" ${r} a table definition with duplicate column names`);if(!s.length)throw new RangeError(`Virtual table module "${e}" ${r} a table definition with zero columns`);let i;if(ut.call(o,"parameters")){if(i=o.parameters,!Array.isArray(i)||!(i=[...i]).every(h=>typeof h=="string"))throw new TypeError(`Virtual table module "${e}" ${r} a table definition with an invalid "parameters" property (should be an array of strings)`)}else i=fn(t);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${e}" ${r} a table definition with duplicate parameter names`);if(i.length>32)throw new RangeError(`Virtual table module "${e}" ${r} a table definition with more than the maximum number of 32 parameters`);for(let h of i)if(s.includes(h))throw new TypeError(`Virtual table module "${e}" ${r} a table definition with column "${h}" which was ambiguously defined as both a column and parameter`);let n=2;if(ut.call(o,"safeIntegers")){let h=o.safeIntegers;if(typeof h!="boolean")throw new TypeError(`Virtual table module "${e}" ${r} a table definition with an invalid "safeIntegers" property (should be a boolean)`);n=+h}let a=!1;if(ut.call(o,"directOnly")&&(a=o.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${e}" ${r} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...i.map(Us).map(h=>`${h} HIDDEN`),...s.map(Us)].join(", ")});`,un(t,new Map(s.map((h,p)=>[h,i.length+p])),e),i,n,a]}function un(o,r,e){return function*(...s){let i=s.map(n=>Buffer.isBuffer(n)?Buffer.from(n):n);for(let n=0;n<r.size;++n)i.push(null);for(let n of o(...s))if(Array.isArray(n))hn(n,i,r.size,e),yield i;else if(typeof n=="object"&&n!==null)pn(n,i,r,e),yield i;else throw new TypeError(`Virtual table module "${e}" yielded something that isn't a valid row object`)}}function hn(o,r,e,t){if(o.length!==e)throw new TypeError(`Virtual table module "${t}" yielded a row with an incorrect number of columns`);let s=r.length-e;for(let i=0;i<e;++i)r[i+s]=o[i]}function pn(o,r,e,t){let s=0;for(let i of Object.keys(o)){let n=e.get(i);if(n===void 0)throw new TypeError(`Virtual table module "${t}" yielded a row with an undeclared column "${i}"`);r[n]=o[i],s+=1}if(s!==e.size)throw new TypeError(`Virtual table module "${t}" yielded a row with missing columns`)}function fn({length:o}){if(!Number.isInteger(o)||o<0)throw new TypeError("Expected function.length to be a positive integer");let r=[];for(let e=0;e<o;++e)r.push(`$${e+1}`);return r}var{hasOwnProperty:ut}=Object.prototype,{apply:gn}=Function.prototype,mn=Object.getPrototypeOf(function*(){}),Us=o=>`"${o.replace(/"/g,'""')}"`,vn=o=>()=>o});var Ws=ye((il,Vs)=>{"use strict";var wn=function(){};Vs.exports=function(r,e){return Object.assign(new wn,this)}});var Js=ye((nl,Ys)=>{"use strict";var yn=require("fs"),Ks=require("path"),dr=Oe(),bn=Vr(),Zs;function Ce(o,r){if(new.target==null)return new Ce(o,r);let e;if(Buffer.isBuffer(o)&&(e=o,o=":memory:"),o==null&&(o=""),r==null&&(r={}),typeof o!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in r)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in r)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let t=o.trim(),s=t===""||t===":memory:",i=dr.getBooleanOption(r,"readonly"),n=dr.getBooleanOption(r,"fileMustExist"),a="timeout"in r?r.timeout:5e3,l="verbose"in r?r.verbose:null,h="nativeBinding"in r?r.nativeBinding:null;if(i&&s&&!e)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(l!=null&&typeof l!="function")throw new TypeError('Expected the "verbose" option to be a function');if(h!=null&&typeof h!="string"&&typeof h!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let p;if(h==null?p=Zs||(Zs=Es()("better_sqlite3.node")):typeof h=="string"?p=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(Ks.resolve(h).replace(/(\.node)?$/,".node")):p=h,p.isInitialized||(p.setErrorConstructor(bn),p.isInitialized=!0),!s&&!t.startsWith("file:")&&!yn.existsSync(Ks.dirname(t)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[dr.cppdb]:{value:new p.Database(t,o,s,i,n,a,l||null,e||null)},...je.getters})}var je=Ds();Ce.prototype.prepare=je.prepare;Ce.prototype.transaction=As();Ce.prototype.pragma=Fs();Ce.prototype.backup=Ns();Ce.prototype.serialize=Ms();Ce.prototype.function=qs();Ce.prototype.aggregate=$s();Ce.prototype.table=Gs();Ce.prototype.loadExtension=je.loadExtension;Ce.prototype.exec=je.exec;Ce.prototype.close=je.close;Ce.prototype.defaultSafeIntegers=je.defaultSafeIntegers;Ce.prototype.unsafeMode=je.unsafeMode;Ce.prototype[dr.inspect]=Ws();Ys.exports=Ce});var Xs=ye((al,Zr)=>{"use strict";Zr.exports=Js();Zr.exports.SqliteError=Vr()});var ti=ye((ei,Yr)=>{(function(o){typeof ei=="object"&&typeof Yr<"u"?Yr.exports=o():typeof define=="function"&&define.amd?define([],o):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=o()})(function(){return function o(r,e,t){function s(a,l){if(!e[a]){if(!r[a]){var h=typeof require=="function"&&require;if(!l&&h)return h(a,!0);if(i)return i(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var u=e[a]={exports:{}};r[a][0].call(u.exports,function(m){var d=r[a][1][m];return s(d||m)},u,u.exports,o,r,e,t)}return e[a].exports}for(var i=typeof require=="function"&&require,n=0;n<t.length;n++)s(t[n]);return s}({1:[function(o,r,e){"use strict";var t=o("./utils"),s=o("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(n){for(var a,l,h,p,u,m,d,g=[],v=0,b=n.length,S=b,z=t.getTypeOf(n)!=="string";v<n.length;)S=b-v,h=z?(a=n[v++],l=v<b?n[v++]:0,v<b?n[v++]:0):(a=n.charCodeAt(v++),l=v<b?n.charCodeAt(v++):0,v<b?n.charCodeAt(v++):0),p=a>>2,u=(3&a)<<4|l>>4,m=1<S?(15&l)<<2|h>>6:64,d=2<S?63&h:64,g.push(i.charAt(p)+i.charAt(u)+i.charAt(m)+i.charAt(d));return g.join("")},e.decode=function(n){var a,l,h,p,u,m,d=0,g=0,v="data:";if(n.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var b,S=3*(n=n.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(n.charAt(n.length-1)===i.charAt(64)&&S--,n.charAt(n.length-2)===i.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=s.uint8array?new Uint8Array(0|S):new Array(0|S);d<n.length;)a=i.indexOf(n.charAt(d++))<<2|(p=i.indexOf(n.charAt(d++)))>>4,l=(15&p)<<4|(u=i.indexOf(n.charAt(d++)))>>2,h=(3&u)<<6|(m=i.indexOf(n.charAt(d++))),b[g++]=a,u!==64&&(b[g++]=l),m!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(o,r,e){"use strict";var t=o("./external"),s=o("./stream/DataWorker"),i=o("./stream/Crc32Probe"),n=o("./stream/DataLengthProbe");function a(l,h,p,u,m){this.compressedSize=l,this.uncompressedSize=h,this.crc32=p,this.compression=u,this.compressedContent=m}a.prototype={getContentWorker:function(){var l=new s(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new n("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new s(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(l,h,p){return l.pipe(new i).pipe(new n("uncompressedSize")).pipe(h.compressWorker(p)).pipe(new n("compressedSize")).withStreamInfo("compression",h)},r.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,r,e){"use strict";var t=o("./stream/GenericWorker");e.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},e.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,r,e){"use strict";var t=o("./utils"),s=function(){for(var i,n=[],a=0;a<256;a++){i=a;for(var l=0;l<8;l++)i=1&i?3988292384^i>>>1:i>>>1;n[a]=i}return n}();r.exports=function(i,n){return i!==void 0&&i.length?t.getTypeOf(i)!=="string"?function(a,l,h,p){var u=s,m=p+h;a^=-1;for(var d=p;d<m;d++)a=a>>>8^u[255&(a^l[d])];return-1^a}(0|n,i,i.length,0):function(a,l,h,p){var u=s,m=p+h;a^=-1;for(var d=p;d<m;d++)a=a>>>8^u[255&(a^l.charCodeAt(d))];return-1^a}(0|n,i,i.length,0):0}},{"./utils":32}],5:[function(o,r,e){"use strict";e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null},{}],6:[function(o,r,e){"use strict";var t=null;t=typeof Promise<"u"?Promise:o("lie"),r.exports={Promise:t}},{lie:37}],7:[function(o,r,e){"use strict";var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=o("pako"),i=o("./utils"),n=o("./stream/GenericWorker"),a=t?"uint8array":"array";function l(h,p){n.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=p,this.meta={}}e.magic="\b\0",i.inherits(l,n),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(a,h.data),!1)},l.prototype.flush=function(){n.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(p){h.push({data:p,meta:h.meta})}},e.compressWorker=function(h){return new l("Deflate",h)},e.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,r,e){"use strict";function t(u,m){var d,g="";for(d=0;d<m;d++)g+=String.fromCharCode(255&u),u>>>=8;return g}function s(u,m,d,g,v,b){var S,z,x=u.file,N=u.compression,F=b!==a.utf8encode,k=i.transformTo("string",b(x.name)),y=i.transformTo("string",a.utf8encode(x.name)),D=x.comment,$=i.transformTo("string",b(D)),_=i.transformTo("string",a.utf8encode(D)),R=y.length!==x.name.length,f=_.length!==D.length,B="",ne="",P="",re=x.dir,M=x.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};m&&!d||(ee.crc32=u.crc32,ee.compressedSize=u.compressedSize,ee.uncompressedSize=u.uncompressedSize);var A=0;m&&(A|=8),F||!R&&!f||(A|=2048);var T=0,H=0;re&&(T|=16),v==="UNIX"?(H=798,T|=function(j,de){var pe=j;return j||(pe=de?16893:33204),(65535&pe)<<16}(x.unixPermissions,re)):(H=20,T|=function(j){return 63&(j||0)}(x.dosPermissions)),S=M.getUTCHours(),S<<=6,S|=M.getUTCMinutes(),S<<=5,S|=M.getUTCSeconds()/2,z=M.getUTCFullYear()-1980,z<<=4,z|=M.getUTCMonth()+1,z<<=5,z|=M.getUTCDate(),R&&(ne=t(1,1)+t(l(k),4)+y,B+="up"+t(ne.length,2)+ne),f&&(P=t(1,1)+t(l($),4)+_,B+="uc"+t(P.length,2)+P);var W="";return W+=`
\0`,W+=t(A,2),W+=N.magic,W+=t(S,2),W+=t(z,2),W+=t(ee.crc32,4),W+=t(ee.compressedSize,4),W+=t(ee.uncompressedSize,4),W+=t(k.length,2),W+=t(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+W+k+B,dirRecord:h.CENTRAL_FILE_HEADER+t(H,2)+W+t($.length,2)+"\0\0\0\0"+t(T,4)+t(g,4)+k+B+$}}var i=o("../utils"),n=o("../stream/GenericWorker"),a=o("../utf8"),l=o("../crc32"),h=o("../signature");function p(u,m,d,g){n.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=d,this.encodeFileName=g,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(p,n),p.prototype.push=function(u){var m=u.meta.percent||0,d=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,n.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:d?(m+100*(d-g-1))/d:100}}))},p.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var d=s(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,d=s(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),m)this.push({data:function(g){return h.DATA_DESCRIPTOR+t(g.crc32,4)+t(g.compressedSize,4)+t(g.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var d=this.bytesWritten-u,g=function(v,b,S,z,x){var N=i.transformTo("string",x(z));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(v,2)+t(v,2)+t(b,4)+t(S,4)+t(N.length,2)+N}(this.dirRecords.length,d,u,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(d){m.processChunk(d)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(d){m.error(d)}),this},p.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(u){var m=this._sources;if(!n.prototype.error.call(this,u))return!1;for(var d=0;d<m.length;d++)try{m[d].error(u)}catch{}return!0},p.prototype.lock=function(){n.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},r.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,r,e){"use strict";var t=o("../compressions"),s=o("./ZipFileWorker");e.generateWorker=function(i,n,a){var l=new s(n.streamFiles,a,n.platform,n.encodeFileName),h=0;try{i.forEach(function(p,u){h++;var m=function(b,S){var z=b||S,x=t[z];if(!x)throw new Error(z+" is not a valid compression method !");return x}(u.options.compression,n.compression),d=u.options.compressionOptions||n.compressionOptions||{},g=u.dir,v=u.date;u._compressWorker(m,d).withStreamInfo("file",{name:p,dir:g,date:v,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(p){l.error(p)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,r,e){"use strict";function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new t;for(var i in this)typeof this[i]!="function"&&(s[i]=this[i]);return s}}(t.prototype=o("./object")).loadAsync=o("./load"),t.support=o("./support"),t.defaults=o("./defaults"),t.version="3.10.1",t.loadAsync=function(s,i){return new t().loadAsync(s,i)},t.external=o("./external"),r.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,r,e){"use strict";var t=o("./utils"),s=o("./external"),i=o("./utf8"),n=o("./zipEntries"),a=o("./stream/Crc32Probe"),l=o("./nodejsUtils");function h(p){return new s.Promise(function(u,m){var d=p.decompressed.getContentWorker().pipe(new a);d.on("error",function(g){m(g)}).on("end",function(){d.streamInfo.crc32!==p.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}r.exports=function(p,u){var m=this;return u=t.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),l.isNode&&l.isStream(p)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",p,!0,u.optimizedBinaryString,u.base64).then(function(d){var g=new n(u);return g.load(d),g}).then(function(d){var g=[s.Promise.resolve(d)],v=d.files;if(u.checkCRC32)for(var b=0;b<v.length;b++)g.push(h(v[b]));return s.Promise.all(g)}).then(function(d){for(var g=d.shift(),v=g.files,b=0;b<v.length;b++){var S=v[b],z=S.fileNameStr,x=t.resolve(S.fileNameStr);m.file(x,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:u.createFolders}),S.dir||(m.file(x).unsafeOriginalName=z)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,r,e){"use strict";var t=o("../utils"),s=o("../stream/GenericWorker");function i(n,a){s.call(this,"Nodejs stream input adapter for "+n),this._upstreamEnded=!1,this._bindStream(a)}t.inherits(i,s),i.prototype._bindStream=function(n){var a=this;(this._stream=n).pause(),n.on("data",function(l){a.push({data:l,meta:{percent:0}})}).on("error",function(l){a.isPaused?this.generatedError=l:a.error(l)}).on("end",function(){a.isPaused?a._upstreamEnded=!0:a.end()})},i.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,r,e){"use strict";var t=o("readable-stream").Readable;function s(i,n,a){t.call(this,n),this._helper=i;var l=this;i.on("data",function(h,p){l.push(h)||l._helper.pause(),a&&a(p)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}o("../utils").inherits(s,t),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(o,r,e){"use strict";r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,s);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,s)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var s=new Buffer(t);return s.fill(0),s},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(o,r,e){"use strict";function t(x,N,F){var k,y=i.getTypeOf(N),D=i.extend(F||{},l);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(x=v(x)),D.createFolders&&(k=g(x))&&b.call(this,k,!0);var $=y==="string"&&D.binary===!1&&D.base64===!1;F&&F.binary!==void 0||(D.binary=!$),(N instanceof h&&N.uncompressedSize===0||D.dir||!N||N.length===0)&&(D.base64=!1,D.binary=!0,N="",D.compression="STORE",y="string");var _=null;_=N instanceof h||N instanceof n?N:m.isNode&&m.isStream(N)?new d(x,N):i.prepareContent(x,N,D.binary,D.optimizedBinaryString,D.base64);var R=new p(x,_,D);this.files[x]=R}var s=o("./utf8"),i=o("./utils"),n=o("./stream/GenericWorker"),a=o("./stream/StreamHelper"),l=o("./defaults"),h=o("./compressedObject"),p=o("./zipObject"),u=o("./generate"),m=o("./nodejsUtils"),d=o("./nodejs/NodejsStreamInputAdapter"),g=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var N=x.lastIndexOf("/");return 0<N?x.substring(0,N):""},v=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},b=function(x,N){return N=N!==void 0?N:l.createFolders,x=v(x),this.files[x]||t.call(this,x,null,{dir:!0,createFolders:N}),this.files[x]};function S(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var z={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var N,F,k;for(N in this.files)k=this.files[N],(F=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&x(F,k)},filter:function(x){var N=[];return this.forEach(function(F,k){x(F,k)&&N.push(k)}),N},file:function(x,N,F){if(arguments.length!==1)return x=this.root+x,t.call(this,x,N,F),this;if(S(x)){var k=x;return this.filter(function(D,$){return!$.dir&&k.test(D)})}var y=this.files[this.root+x];return y&&!y.dir?y:null},folder:function(x){if(!x)return this;if(S(x))return this.filter(function(y,D){return D.dir&&x.test(y)});var N=this.root+x,F=b.call(this,N),k=this.clone();return k.root=F.name,k},remove:function(x){x=this.root+x;var N=this.files[x];if(N||(x.slice(-1)!=="/"&&(x+="/"),N=this.files[x]),N&&!N.dir)delete this.files[x];else for(var F=this.filter(function(y,D){return D.name.slice(0,x.length)===x}),k=0;k<F.length;k++)delete this.files[F[k].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var N,F={};try{if((F=i.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=F.type.toLowerCase(),F.compression=F.compression.toUpperCase(),F.type==="binarystring"&&(F.type="string"),!F.type)throw new Error("No output type specified.");i.checkSupport(F.type),F.platform!=="darwin"&&F.platform!=="freebsd"&&F.platform!=="linux"&&F.platform!=="sunos"||(F.platform="UNIX"),F.platform==="win32"&&(F.platform="DOS");var k=F.comment||this.comment||"";N=u.generateWorker(this,F,k)}catch(y){(N=new n("error")).error(y)}return new a(N,F.type||"string",F.mimeType)},generateAsync:function(x,N){return this.generateInternalStream(x).accumulate(N)},generateNodeStream:function(x,N){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(N)}};r.exports=z},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,r,e){"use strict";r.exports=o("stream")},{stream:void 0}],17:[function(o,r,e){"use strict";var t=o("./DataReader");function s(i){t.call(this,i);for(var n=0;n<this.data.length;n++)i[n]=255&i[n]}o("../utils").inherits(s,t),s.prototype.byteAt=function(i){return this.data[this.zero+i]},s.prototype.lastIndexOfSignature=function(i){for(var n=i.charCodeAt(0),a=i.charCodeAt(1),l=i.charCodeAt(2),h=i.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===n&&this.data[p+1]===a&&this.data[p+2]===l&&this.data[p+3]===h)return p-this.zero;return-1},s.prototype.readAndCheckSignature=function(i){var n=i.charCodeAt(0),a=i.charCodeAt(1),l=i.charCodeAt(2),h=i.charCodeAt(3),p=this.readData(4);return n===p[0]&&a===p[1]&&l===p[2]&&h===p[3]},s.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var n=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,n},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(o,r,e){"use strict";var t=o("../utils");function s(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var n,a=0;for(this.checkOffset(i),n=this.index+i-1;n>=this.index;n--)a=(a<<8)+this.byteAt(n);return this.index+=i,a},readString:function(i){return t.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},r.exports=s},{"../utils":32}],19:[function(o,r,e){"use strict";var t=o("./Uint8ArrayReader");function s(i){t.call(this,i)}o("../utils").inherits(s,t),s.prototype.readData=function(i){this.checkOffset(i);var n=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,n},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,r,e){"use strict";var t=o("./DataReader");function s(i){t.call(this,i)}o("../utils").inherits(s,t),s.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},s.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},s.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},s.prototype.readData=function(i){this.checkOffset(i);var n=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,n},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(o,r,e){"use strict";var t=o("./ArrayReader");function s(i){t.call(this,i)}o("../utils").inherits(s,t),s.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var n=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,n},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(o,r,e){"use strict";var t=o("../utils"),s=o("../support"),i=o("./ArrayReader"),n=o("./StringReader"),a=o("./NodeBufferReader"),l=o("./Uint8ArrayReader");r.exports=function(h){var p=t.getTypeOf(h);return t.checkSupport(p),p!=="string"||s.uint8array?p==="nodebuffer"?new a(h):s.uint8array?new l(t.transformTo("uint8array",h)):new i(t.transformTo("array",h)):new n(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,r,e){"use strict";e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,r,e){"use strict";var t=o("./GenericWorker"),s=o("../utils");function i(n){t.call(this,"ConvertWorker to "+n),this.destType=n}s.inherits(i,t),i.prototype.processChunk=function(n){this.push({data:s.transformTo(this.destType,n.data),meta:n.meta})},r.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(o,r,e){"use strict";var t=o("./GenericWorker"),s=o("../crc32");function i(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(i,t),i.prototype.processChunk=function(n){this.streamInfo.crc32=s(n.data,this.streamInfo.crc32||0),this.push(n)},r.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,r,e){"use strict";var t=o("../utils"),s=o("./GenericWorker");function i(n){s.call(this,"DataLengthProbe for "+n),this.propName=n,this.withStreamInfo(n,0)}t.inherits(i,s),i.prototype.processChunk=function(n){if(n){var a=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=a+n.data.length}s.prototype.processChunk.call(this,n)},r.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(o,r,e){"use strict";var t=o("../utils"),s=o("./GenericWorker");function i(n){s.call(this,"DataWorker");var a=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,n.then(function(l){a.dataIsReady=!0,a.data=l,a.max=l&&l.length||0,a.type=t.getTypeOf(l),a.isPaused||a._tickAndRepeat()},function(l){a.error(l)})}t.inherits(i,s),i.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var n=null,a=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":n=this.data.substring(this.index,a);break;case"uint8array":n=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":n=this.data.slice(this.index,a)}return this.index=a,this.push({data:n,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(o,r,e){"use strict";function t(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,i){return this._listeners[s].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,i){if(this._listeners[s])for(var n=0;n<this._listeners[s].length;n++)this._listeners[s][n].call(this,i)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var i=this;return s.on("data",function(n){i.processChunk(n)}),s.on("end",function(){i.end()}),s.on("error",function(n){i.error(n)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,i){return this.extraStreamInfo[s]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=t},{}],29:[function(o,r,e){"use strict";var t=o("../utils"),s=o("./ConvertWorker"),i=o("./GenericWorker"),n=o("../base64"),a=o("../support"),l=o("../external"),h=null;if(a.nodestream)try{h=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(m,d){return new l.Promise(function(g,v){var b=[],S=m._internalType,z=m._outputType,x=m._mimeType;m.on("data",function(N,F){b.push(N),d&&d(F)}).on("error",function(N){b=[],v(N)}).on("end",function(){try{var N=function(F,k,y){switch(F){case"blob":return t.newBlob(t.transformTo("arraybuffer",k),y);case"base64":return n.encode(k);default:return t.transformTo(F,k)}}(z,function(F,k){var y,D=0,$=null,_=0;for(y=0;y<k.length;y++)_+=k[y].length;switch(F){case"string":return k.join("");case"array":return Array.prototype.concat.apply([],k);case"uint8array":for($=new Uint8Array(_),y=0;y<k.length;y++)$.set(k[y],D),D+=k[y].length;return $;case"nodebuffer":return Buffer.concat(k);default:throw new Error("concat : unsupported type '"+F+"'")}}(S,b),x);g(N)}catch(F){v(F)}b=[]}).resume()})}function u(m,d,g){var v=d;switch(d){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=d,this._mimeType=g,t.checkSupport(v),this._worker=m.pipe(new s(v)),m.lock()}catch(b){this._worker=new i("error"),this._worker.error(b)}}u.prototype={accumulate:function(m){return p(this,m)},on:function(m,d){var g=this;return m==="data"?this._worker.on(m,function(v){d.call(g,v.data,v.meta)}):this._worker.on(m,function(){t.delay(d,arguments,g)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,r,e){"use strict";if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",e.nodebuffer=typeof Buffer<"u",e.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")e.blob=!1;else{var t=new ArrayBuffer(0);try{e.blob=new Blob([t],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(t),e.blob=s.getBlob("application/zip").size===0}catch{e.blob=!1}}}try{e.nodestream=!!o("readable-stream").Readable}catch{e.nodestream=!1}},{"readable-stream":16}],31:[function(o,r,e){"use strict";for(var t=o("./utils"),s=o("./support"),i=o("./nodejsUtils"),n=o("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;a[254]=a[254]=1;function h(){n.call(this,"utf-8 decode"),this.leftOver=null}function p(){n.call(this,"utf-8 encode")}e.utf8encode=function(u){return s.nodebuffer?i.newBufferFrom(u,"utf-8"):function(m){var d,g,v,b,S,z=m.length,x=0;for(b=0;b<z;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<z&&(64512&(v=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(v-56320),b++),x+=g<128?1:g<2048?2:g<65536?3:4;for(d=s.uint8array?new Uint8Array(x):new Array(x),b=S=0;S<x;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<z&&(64512&(v=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(v-56320),b++),g<128?d[S++]=g:(g<2048?d[S++]=192|g>>>6:(g<65536?d[S++]=224|g>>>12:(d[S++]=240|g>>>18,d[S++]=128|g>>>12&63),d[S++]=128|g>>>6&63),d[S++]=128|63&g);return d}(u)},e.utf8decode=function(u){return s.nodebuffer?t.transformTo("nodebuffer",u).toString("utf-8"):function(m){var d,g,v,b,S=m.length,z=new Array(2*S);for(d=g=0;d<S;)if((v=m[d++])<128)z[g++]=v;else if(4<(b=a[v]))z[g++]=65533,d+=b-1;else{for(v&=b===2?31:b===3?15:7;1<b&&d<S;)v=v<<6|63&m[d++],b--;1<b?z[g++]=65533:v<65536?z[g++]=v:(v-=65536,z[g++]=55296|v>>10&1023,z[g++]=56320|1023&v)}return z.length!==g&&(z.subarray?z=z.subarray(0,g):z.length=g),t.applyFromCharCode(z)}(u=t.transformTo(s.uint8array?"uint8array":"array",u))},t.inherits(h,n),h.prototype.processChunk=function(u){var m=t.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var d=m;(m=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),m.set(d,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=function(b,S){var z;for((S=S||b.length)>b.length&&(S=b.length),z=S-1;0<=z&&(192&b[z])==128;)z--;return z<0||z===0?S:z+a[b[z]]>S?z:S}(m),v=m;g!==m.length&&(s.uint8array?(v=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(v=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:e.utf8decode(v),meta:u.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=h,t.inherits(p,n),p.prototype.processChunk=function(u){this.push({data:e.utf8encode(u.data),meta:u.meta})},e.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,r,e){"use strict";var t=o("./support"),s=o("./base64"),i=o("./nodejsUtils"),n=o("./external");function a(d){return d}function l(d,g){for(var v=0;v<d.length;++v)g[v]=255&d.charCodeAt(v);return g}o("setimmediate"),e.newBlob=function(d,g){e.checkSupport("blob");try{return new Blob([d],{type:g})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(d),v.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(d,g,v){var b=[],S=0,z=d.length;if(z<=v)return String.fromCharCode.apply(null,d);for(;S<z;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,d.slice(S,Math.min(S+v,z)))):b.push(String.fromCharCode.apply(null,d.subarray(S,Math.min(S+v,z)))),S+=v;return b.join("")},stringifyByChar:function(d){for(var g="",v=0;v<d.length;v++)g+=String.fromCharCode(d[v]);return g},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function p(d){var g=65536,v=e.getTypeOf(d),b=!0;if(v==="uint8array"?b=h.applyCanBeUsed.uint8array:v==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(d,v,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(d)}function u(d,g){for(var v=0;v<d.length;v++)g[v]=d[v];return g}e.applyFromCharCode=p;var m={};m.string={string:a,array:function(d){return l(d,new Array(d.length))},arraybuffer:function(d){return m.string.uint8array(d).buffer},uint8array:function(d){return l(d,new Uint8Array(d.length))},nodebuffer:function(d){return l(d,i.allocBuffer(d.length))}},m.array={string:p,array:a,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return i.newBufferFrom(d)}},m.arraybuffer={string:function(d){return p(new Uint8Array(d))},array:function(d){return u(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:a,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return i.newBufferFrom(new Uint8Array(d))}},m.uint8array={string:p,array:function(d){return u(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:a,nodebuffer:function(d){return i.newBufferFrom(d)}},m.nodebuffer={string:p,array:function(d){return u(d,new Array(d.length))},arraybuffer:function(d){return m.nodebuffer.uint8array(d).buffer},uint8array:function(d){return u(d,new Uint8Array(d.length))},nodebuffer:a},e.transformTo=function(d,g){if(g=g||"",!d)return g;e.checkSupport(d);var v=e.getTypeOf(g);return m[v][d](g)},e.resolve=function(d){for(var g=d.split("/"),v=[],b=0;b<g.length;b++){var S=g[b];S==="."||S===""&&b!==0&&b!==g.length-1||(S===".."?v.pop():v.push(S))}return v.join("/")},e.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":t.nodebuffer&&i.isBuffer(d)?"nodebuffer":t.uint8array&&d instanceof Uint8Array?"uint8array":t.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(d){if(!t[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(d){var g,v,b="";for(v=0;v<(d||"").length;v++)b+="\\x"+((g=d.charCodeAt(v))<16?"0":"")+g.toString(16).toUpperCase();return b},e.delay=function(d,g,v){setImmediate(function(){d.apply(v||null,g||[])})},e.inherits=function(d,g){function v(){}v.prototype=g.prototype,d.prototype=new v},e.extend=function(){var d,g,v={};for(d=0;d<arguments.length;d++)for(g in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],g)&&v[g]===void 0&&(v[g]=arguments[d][g]);return v},e.prepareContent=function(d,g,v,b,S){return n.Promise.resolve(g).then(function(z){return t.blob&&(z instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(z))!==-1)&&typeof FileReader<"u"?new n.Promise(function(x,N){var F=new FileReader;F.onload=function(k){x(k.target.result)},F.onerror=function(k){N(k.target.error)},F.readAsArrayBuffer(z)}):z}).then(function(z){var x=e.getTypeOf(z);return x?(x==="arraybuffer"?z=e.transformTo("uint8array",z):x==="string"&&(S?z=s.decode(z):v&&b!==!0&&(z=function(N){return l(N,t.uint8array?new Uint8Array(N.length):new Array(N.length))}(z))),z):n.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,r,e){"use strict";var t=o("./reader/readerFor"),s=o("./utils"),i=o("./signature"),n=o("./zipEntry"),a=o("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(p)+", expected "+s.pretty(h)+")")}},isSignature:function(h,p){var u=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===p;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),p=a.uint8array?"uint8array":"array",u=s.transformTo(p,h);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,p,u,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),p=this.reader.readInt(4),u=this.reader.readData(p),this.zip64ExtensibleData[h]={id:h,length:p,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,p;for(h=0;h<this.files.length;h++)p=this.files[h],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(h=new n({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var p=h;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=p-u;if(0<m)this.isSignature(p,i.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=t(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,r,e){"use strict";var t=o("./reader/readerFor"),s=o("./utils"),i=o("./compressedObject"),n=o("./crc32"),a=o("./utf8"),l=o("./compressions"),h=o("./support");function p(u,m){this.options=u,this.loadOptions=m}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,d;if(u.skip(22),this.fileNameLength=u.readInt(2),d=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(g){for(var v in l)if(Object.prototype.hasOwnProperty.call(l,v)&&l[v].magic===g)return l[v];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=t(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,d,g,v=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<v;)m=u.readInt(2),d=u.readInt(2),g=u.readData(d),this.extraFields[m]={id:m,length:d,value:g};u.setIndex(v)},handleUTF8:function(){var u=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var d=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var v=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=t(u.value);return m.readInt(1)!==1||n(this.fileName)!==m.readInt(4)?null:a.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=t(u.value);return m.readInt(1)!==1||n(this.fileComment)!==m.readInt(4)?null:a.utf8decode(m.readData(u.length-5))}return null}},r.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,r,e){"use strict";function t(m,d,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=d,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var s=o("./stream/StreamHelper"),i=o("./stream/DataWorker"),n=o("./utf8"),a=o("./compressedObject"),l=o("./stream/GenericWorker");t.prototype={internalStream:function(m){var d=null,g="string";try{if(!m)throw new Error("No output type specified.");var v=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),d=this._decompressWorker();var b=!this._dataBinary;b&&!v&&(d=d.pipe(new n.Utf8EncodeWorker)),!b&&v&&(d=d.pipe(new n.Utf8DecodeWorker))}catch(S){(d=new l("error")).error(S)}return new s(d,g,"")},async:function(m,d){return this.internalStream(m).accumulate(d)},nodeStream:function(m,d){return this.internalStream(m||"nodebuffer").toNodejsStream(d)},_compressWorker:function(m,d){if(this._data instanceof a&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new n.Utf8EncodeWorker)),a.createWorkerFrom(g,m,d)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new i(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)t.prototype[h[u]]=p;r.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,r,e){(function(t){"use strict";var s,i,n=t.MutationObserver||t.WebKitMutationObserver;if(n){var a=0,l=new n(m),h=t.document.createTextNode("");l.observe(h,{characterData:!0}),s=function(){h.data=a=++a%2}}else if(t.setImmediate||t.MessageChannel===void 0)s="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var d=t.document.createElement("script");d.onreadystatechange=function(){m(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},t.document.documentElement.appendChild(d)}:function(){setTimeout(m,0)};else{var p=new t.MessageChannel;p.port1.onmessage=m,s=function(){p.port2.postMessage(0)}}var u=[];function m(){var d,g;i=!0;for(var v=u.length;v;){for(g=u,u=[],d=-1;++d<v;)g[d]();v=u.length}i=!1}r.exports=function(d){u.push(d)!==1||i||s()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,r,e){"use strict";var t=o("immediate");function s(){}var i={},n=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function h(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,v!==s&&d(this,v)}function p(v,b,S){this.promise=v,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function u(v,b,S){t(function(){var z;try{z=b(S)}catch(x){return i.reject(v,x)}z===v?i.reject(v,new TypeError("Cannot resolve promise with itself")):i.resolve(v,z)})}function m(v){var b=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof b=="function")return function(){b.apply(v,arguments)}}function d(v,b){var S=!1;function z(F){S||(S=!0,i.reject(v,F))}function x(F){S||(S=!0,i.resolve(v,F))}var N=g(function(){b(x,z)});N.status==="error"&&z(N.value)}function g(v,b){var S={};try{S.value=v(b),S.status="success"}catch(z){S.status="error",S.value=z}return S}(r.exports=h).prototype.finally=function(v){if(typeof v!="function")return this;var b=this.constructor;return this.then(function(S){return b.resolve(v()).then(function(){return S})},function(S){return b.resolve(v()).then(function(){throw S})})},h.prototype.catch=function(v){return this.then(null,v)},h.prototype.then=function(v,b){if(typeof v!="function"&&this.state===a||typeof b!="function"&&this.state===n)return this;var S=new this.constructor(s);return this.state!==l?u(S,this.state===a?v:b,this.outcome):this.queue.push(new p(S,v,b)),S},p.prototype.callFulfilled=function(v){i.resolve(this.promise,v)},p.prototype.otherCallFulfilled=function(v){u(this.promise,this.onFulfilled,v)},p.prototype.callRejected=function(v){i.reject(this.promise,v)},p.prototype.otherCallRejected=function(v){u(this.promise,this.onRejected,v)},i.resolve=function(v,b){var S=g(m,b);if(S.status==="error")return i.reject(v,S.value);var z=S.value;if(z)d(v,z);else{v.state=a,v.outcome=b;for(var x=-1,N=v.queue.length;++x<N;)v.queue[x].callFulfilled(b)}return v},i.reject=function(v,b){v.state=n,v.outcome=b;for(var S=-1,z=v.queue.length;++S<z;)v.queue[S].callRejected(b);return v},h.resolve=function(v){return v instanceof this?v:i.resolve(new this(s),v)},h.reject=function(v){var b=new this(s);return i.reject(b,v)},h.all=function(v){var b=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,z=!1;if(!S)return this.resolve([]);for(var x=new Array(S),N=0,F=-1,k=new this(s);++F<S;)y(v[F],F);return k;function y(D,$){b.resolve(D).then(function(_){x[$]=_,++N!==S||z||(z=!0,i.resolve(k,x))},function(_){z||(z=!0,i.reject(k,_))})}},h.race=function(v){var b=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,z=!1;if(!S)return this.resolve([]);for(var x=-1,N=new this(s);++x<S;)F=v[x],b.resolve(F).then(function(k){z||(z=!0,i.resolve(N,k))},function(k){z||(z=!0,i.reject(N,k))});var F;return N}},{immediate:36}],38:[function(o,r,e){"use strict";var t={};(0,o("./lib/utils/common").assign)(t,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),r.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,r,e){"use strict";var t=o("./zlib/deflate"),s=o("./utils/common"),i=o("./utils/strings"),n=o("./zlib/messages"),a=o("./zlib/zstream"),l=Object.prototype.toString,h=0,p=-1,u=0,m=8;function d(v){if(!(this instanceof d))return new d(v);this.options=s.assign({level:p,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},v||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var S=t.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(S!==h)throw new Error(n[S]);if(b.header&&t.deflateSetHeader(this.strm,b.header),b.dictionary){var z;if(z=typeof b.dictionary=="string"?i.string2buf(b.dictionary):l.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(S=t.deflateSetDictionary(this.strm,z))!==h)throw new Error(n[S]);this._dict_set=!0}}function g(v,b){var S=new d(b);if(S.push(v,!0),S.err)throw S.msg||n[S.err];return S.result}d.prototype.push=function(v,b){var S,z,x=this.strm,N=this.options.chunkSize;if(this.ended)return!1;z=b===~~b?b:b===!0?4:0,typeof v=="string"?x.input=i.string2buf(v):l.call(v)==="[object ArrayBuffer]"?x.input=new Uint8Array(v):x.input=v,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new s.Buf8(N),x.next_out=0,x.avail_out=N),(S=t.deflate(x,z))!==1&&S!==h)return this.onEnd(S),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||z!==4&&z!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(s.shrinkBuf(x.output,x.next_out))):this.onData(s.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&S!==1);return z===4?(S=t.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===h):z!==2||(this.onEnd(h),!(x.avail_out=0))},d.prototype.onData=function(v){this.chunks.push(v)},d.prototype.onEnd=function(v){v===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},e.Deflate=d,e.deflate=g,e.deflateRaw=function(v,b){return(b=b||{}).raw=!0,g(v,b)},e.gzip=function(v,b){return(b=b||{}).gzip=!0,g(v,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,r,e){"use strict";var t=o("./zlib/inflate"),s=o("./utils/common"),i=o("./utils/strings"),n=o("./zlib/constants"),a=o("./zlib/messages"),l=o("./zlib/zstream"),h=o("./zlib/gzheader"),p=Object.prototype.toString;function u(d){if(!(this instanceof u))return new u(d);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},d||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||d&&d.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=t.inflateInit2(this.strm,g.windowBits);if(v!==n.Z_OK)throw new Error(a[v]);this.header=new h,t.inflateGetHeader(this.strm,this.header)}function m(d,g){var v=new u(g);if(v.push(d,!0),v.err)throw v.msg||a[v.err];return v.result}u.prototype.push=function(d,g){var v,b,S,z,x,N,F=this.strm,k=this.options.chunkSize,y=this.options.dictionary,D=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof d=="string"?F.input=i.binstring2buf(d):p.call(d)==="[object ArrayBuffer]"?F.input=new Uint8Array(d):F.input=d,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new s.Buf8(k),F.next_out=0,F.avail_out=k),(v=t.inflate(F,n.Z_NO_FLUSH))===n.Z_NEED_DICT&&y&&(N=typeof y=="string"?i.string2buf(y):p.call(y)==="[object ArrayBuffer]"?new Uint8Array(y):y,v=t.inflateSetDictionary(this.strm,N)),v===n.Z_BUF_ERROR&&D===!0&&(v=n.Z_OK,D=!1),v!==n.Z_STREAM_END&&v!==n.Z_OK)return this.onEnd(v),!(this.ended=!0);F.next_out&&(F.avail_out!==0&&v!==n.Z_STREAM_END&&(F.avail_in!==0||b!==n.Z_FINISH&&b!==n.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=i.utf8border(F.output,F.next_out),z=F.next_out-S,x=i.buf2string(F.output,S),F.next_out=z,F.avail_out=k-z,z&&s.arraySet(F.output,F.output,S,z,0),this.onData(x)):this.onData(s.shrinkBuf(F.output,F.next_out)))),F.avail_in===0&&F.avail_out===0&&(D=!0)}while((0<F.avail_in||F.avail_out===0)&&v!==n.Z_STREAM_END);return v===n.Z_STREAM_END&&(b=n.Z_FINISH),b===n.Z_FINISH?(v=t.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===n.Z_OK):b!==n.Z_SYNC_FLUSH||(this.onEnd(n.Z_OK),!(F.avail_out=0))},u.prototype.onData=function(d){this.chunks.push(d)},u.prototype.onEnd=function(d){d===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},e.Inflate=u,e.inflate=m,e.inflateRaw=function(d,g){return(g=g||{}).raw=!0,m(d,g)},e.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,r,e){"use strict";var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";e.assign=function(n){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(n[h]=l[h])}}return n},e.shrinkBuf=function(n,a){return n.length===a?n:n.subarray?n.subarray(0,a):(n.length=a,n)};var s={arraySet:function(n,a,l,h,p){if(a.subarray&&n.subarray)n.set(a.subarray(l,l+h),p);else for(var u=0;u<h;u++)n[p+u]=a[l+u]},flattenChunks:function(n){var a,l,h,p,u,m;for(a=h=0,l=n.length;a<l;a++)h+=n[a].length;for(m=new Uint8Array(h),a=p=0,l=n.length;a<l;a++)u=n[a],m.set(u,p),p+=u.length;return m}},i={arraySet:function(n,a,l,h,p){for(var u=0;u<h;u++)n[p+u]=a[l+u]},flattenChunks:function(n){return[].concat.apply([],n)}};e.setTyped=function(n){n?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)},{}],42:[function(o,r,e){"use strict";var t=o("./common"),s=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var n=new t.Buf8(256),a=0;a<256;a++)n[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(h,p){if(p<65537&&(h.subarray&&i||!h.subarray&&s))return String.fromCharCode.apply(null,t.shrinkBuf(h,p));for(var u="",m=0;m<p;m++)u+=String.fromCharCode(h[m]);return u}n[254]=n[254]=1,e.string2buf=function(h){var p,u,m,d,g,v=h.length,b=0;for(d=0;d<v;d++)(64512&(u=h.charCodeAt(d)))==55296&&d+1<v&&(64512&(m=h.charCodeAt(d+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),d++),b+=u<128?1:u<2048?2:u<65536?3:4;for(p=new t.Buf8(b),d=g=0;g<b;d++)(64512&(u=h.charCodeAt(d)))==55296&&d+1<v&&(64512&(m=h.charCodeAt(d+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),d++),u<128?p[g++]=u:(u<2048?p[g++]=192|u>>>6:(u<65536?p[g++]=224|u>>>12:(p[g++]=240|u>>>18,p[g++]=128|u>>>12&63),p[g++]=128|u>>>6&63),p[g++]=128|63&u);return p},e.buf2binstring=function(h){return l(h,h.length)},e.binstring2buf=function(h){for(var p=new t.Buf8(h.length),u=0,m=p.length;u<m;u++)p[u]=h.charCodeAt(u);return p},e.buf2string=function(h,p){var u,m,d,g,v=p||h.length,b=new Array(2*v);for(u=m=0;u<v;)if((d=h[u++])<128)b[m++]=d;else if(4<(g=n[d]))b[m++]=65533,u+=g-1;else{for(d&=g===2?31:g===3?15:7;1<g&&u<v;)d=d<<6|63&h[u++],g--;1<g?b[m++]=65533:d<65536?b[m++]=d:(d-=65536,b[m++]=55296|d>>10&1023,b[m++]=56320|1023&d)}return l(b,m)},e.utf8border=function(h,p){var u;for((p=p||h.length)>h.length&&(p=h.length),u=p-1;0<=u&&(192&h[u])==128;)u--;return u<0||u===0?p:u+n[h[u]]>p?u:p}},{"./common":41}],43:[function(o,r,e){"use strict";r.exports=function(t,s,i,n){for(var a=65535&t|0,l=t>>>16&65535|0,h=0;i!==0;){for(i-=h=2e3<i?2e3:i;l=l+(a=a+s[n++]|0)|0,--h;);a%=65521,l%=65521}return a|l<<16|0}},{}],44:[function(o,r,e){"use strict";r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,r,e){"use strict";var t=function(){for(var s,i=[],n=0;n<256;n++){s=n;for(var a=0;a<8;a++)s=1&s?3988292384^s>>>1:s>>>1;i[n]=s}return i}();r.exports=function(s,i,n,a){var l=t,h=a+n;s^=-1;for(var p=a;p<h;p++)s=s>>>8^l[255&(s^i[p])];return-1^s}},{}],46:[function(o,r,e){"use strict";var t,s=o("../utils/common"),i=o("./trees"),n=o("./adler32"),a=o("./crc32"),l=o("./messages"),h=0,p=4,u=0,m=-2,d=-1,g=4,v=2,b=8,S=9,z=286,x=30,N=19,F=2*z+1,k=15,y=3,D=258,$=D+y+1,_=42,R=113,f=1,B=2,ne=3,P=4;function re(c,L){return c.msg=l[L],L}function M(c){return(c<<1)-(4<c?9:0)}function ee(c){for(var L=c.length;0<=--L;)c[L]=0}function A(c){var L=c.state,I=L.pending;I>c.avail_out&&(I=c.avail_out),I!==0&&(s.arraySet(c.output,L.pending_buf,L.pending_out,I,c.next_out),c.next_out+=I,L.pending_out+=I,c.total_out+=I,c.avail_out-=I,L.pending-=I,L.pending===0&&(L.pending_out=0))}function T(c,L){i._tr_flush_block(c,0<=c.block_start?c.block_start:-1,c.strstart-c.block_start,L),c.block_start=c.strstart,A(c.strm)}function H(c,L){c.pending_buf[c.pending++]=L}function W(c,L){c.pending_buf[c.pending++]=L>>>8&255,c.pending_buf[c.pending++]=255&L}function j(c,L){var I,C,w=c.max_chain_length,E=c.strstart,Q=c.prev_length,U=c.nice_match,O=c.strstart>c.w_size-$?c.strstart-(c.w_size-$):0,V=c.window,K=c.w_mask,G=c.prev,Z=c.strstart+D,ce=V[E+Q-1],oe=V[E+Q];c.prev_length>=c.good_match&&(w>>=2),U>c.lookahead&&(U=c.lookahead);do if(V[(I=L)+Q]===oe&&V[I+Q-1]===ce&&V[I]===V[E]&&V[++I]===V[E+1]){E+=2,I++;do;while(V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&E<Z);if(C=D-(Z-E),E=Z-D,Q<C){if(c.match_start=L,U<=(Q=C))break;ce=V[E+Q-1],oe=V[E+Q]}}while((L=G[L&K])>O&&--w!=0);return Q<=c.lookahead?Q:c.lookahead}function de(c){var L,I,C,w,E,Q,U,O,V,K,G=c.w_size;do{if(w=c.window_size-c.lookahead-c.strstart,c.strstart>=G+(G-$)){for(s.arraySet(c.window,c.window,G,G,0),c.match_start-=G,c.strstart-=G,c.block_start-=G,L=I=c.hash_size;C=c.head[--L],c.head[L]=G<=C?C-G:0,--I;);for(L=I=G;C=c.prev[--L],c.prev[L]=G<=C?C-G:0,--I;);w+=G}if(c.strm.avail_in===0)break;if(Q=c.strm,U=c.window,O=c.strstart+c.lookahead,V=w,K=void 0,K=Q.avail_in,V<K&&(K=V),I=K===0?0:(Q.avail_in-=K,s.arraySet(U,Q.input,Q.next_in,K,O),Q.state.wrap===1?Q.adler=n(Q.adler,U,K,O):Q.state.wrap===2&&(Q.adler=a(Q.adler,U,K,O)),Q.next_in+=K,Q.total_in+=K,K),c.lookahead+=I,c.lookahead+c.insert>=y)for(E=c.strstart-c.insert,c.ins_h=c.window[E],c.ins_h=(c.ins_h<<c.hash_shift^c.window[E+1])&c.hash_mask;c.insert&&(c.ins_h=(c.ins_h<<c.hash_shift^c.window[E+y-1])&c.hash_mask,c.prev[E&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=E,E++,c.insert--,!(c.lookahead+c.insert<y)););}while(c.lookahead<$&&c.strm.avail_in!==0)}function pe(c,L){for(var I,C;;){if(c.lookahead<$){if(de(c),c.lookahead<$&&L===h)return f;if(c.lookahead===0)break}if(I=0,c.lookahead>=y&&(c.ins_h=(c.ins_h<<c.hash_shift^c.window[c.strstart+y-1])&c.hash_mask,I=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),I!==0&&c.strstart-I<=c.w_size-$&&(c.match_length=j(c,I)),c.match_length>=y)if(C=i._tr_tally(c,c.strstart-c.match_start,c.match_length-y),c.lookahead-=c.match_length,c.match_length<=c.max_lazy_match&&c.lookahead>=y){for(c.match_length--;c.strstart++,c.ins_h=(c.ins_h<<c.hash_shift^c.window[c.strstart+y-1])&c.hash_mask,I=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart,--c.match_length!=0;);c.strstart++}else c.strstart+=c.match_length,c.match_length=0,c.ins_h=c.window[c.strstart],c.ins_h=(c.ins_h<<c.hash_shift^c.window[c.strstart+1])&c.hash_mask;else C=i._tr_tally(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++;if(C&&(T(c,!1),c.strm.avail_out===0))return f}return c.insert=c.strstart<y-1?c.strstart:y-1,L===p?(T(c,!0),c.strm.avail_out===0?ne:P):c.last_lit&&(T(c,!1),c.strm.avail_out===0)?f:B}function Y(c,L){for(var I,C,w;;){if(c.lookahead<$){if(de(c),c.lookahead<$&&L===h)return f;if(c.lookahead===0)break}if(I=0,c.lookahead>=y&&(c.ins_h=(c.ins_h<<c.hash_shift^c.window[c.strstart+y-1])&c.hash_mask,I=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),c.prev_length=c.match_length,c.prev_match=c.match_start,c.match_length=y-1,I!==0&&c.prev_length<c.max_lazy_match&&c.strstart-I<=c.w_size-$&&(c.match_length=j(c,I),c.match_length<=5&&(c.strategy===1||c.match_length===y&&4096<c.strstart-c.match_start)&&(c.match_length=y-1)),c.prev_length>=y&&c.match_length<=c.prev_length){for(w=c.strstart+c.lookahead-y,C=i._tr_tally(c,c.strstart-1-c.prev_match,c.prev_length-y),c.lookahead-=c.prev_length-1,c.prev_length-=2;++c.strstart<=w&&(c.ins_h=(c.ins_h<<c.hash_shift^c.window[c.strstart+y-1])&c.hash_mask,I=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),--c.prev_length!=0;);if(c.match_available=0,c.match_length=y-1,c.strstart++,C&&(T(c,!1),c.strm.avail_out===0))return f}else if(c.match_available){if((C=i._tr_tally(c,0,c.window[c.strstart-1]))&&T(c,!1),c.strstart++,c.lookahead--,c.strm.avail_out===0)return f}else c.match_available=1,c.strstart++,c.lookahead--}return c.match_available&&(C=i._tr_tally(c,0,c.window[c.strstart-1]),c.match_available=0),c.insert=c.strstart<y-1?c.strstart:y-1,L===p?(T(c,!0),c.strm.avail_out===0?ne:P):c.last_lit&&(T(c,!1),c.strm.avail_out===0)?f:B}function te(c,L,I,C,w){this.good_length=c,this.max_lazy=L,this.nice_length=I,this.max_chain=C,this.func=w}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*F),this.dyn_dtree=new s.Buf16(2*(2*x+1)),this.bl_tree=new s.Buf16(2*(2*N+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(k+1),this.heap=new s.Buf16(2*z+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*z+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ie(c){var L;return c&&c.state?(c.total_in=c.total_out=0,c.data_type=v,(L=c.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?_:R,c.adler=L.wrap===2?0:1,L.last_flush=h,i._tr_init(L),u):re(c,m)}function ue(c){var L=ie(c);return L===u&&function(I){I.window_size=2*I.w_size,ee(I.head),I.max_lazy_match=t[I.level].max_lazy,I.good_match=t[I.level].good_length,I.nice_match=t[I.level].nice_length,I.max_chain_length=t[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=y-1,I.match_available=0,I.ins_h=0}(c.state),L}function he(c,L,I,C,w,E){if(!c)return m;var Q=1;if(L===d&&(L=6),C<0?(Q=0,C=-C):15<C&&(Q=2,C-=16),w<1||S<w||I!==b||C<8||15<C||L<0||9<L||E<0||g<E)return re(c,m);C===8&&(C=9);var U=new le;return(c.state=U).strm=c,U.wrap=Q,U.gzhead=null,U.w_bits=C,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=w+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+y-1)/y),U.window=new s.Buf8(2*U.w_size),U.head=new s.Buf16(U.hash_size),U.prev=new s.Buf16(U.w_size),U.lit_bufsize=1<<w+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new s.Buf8(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=L,U.strategy=E,U.method=I,ue(c)}t=[new te(0,0,0,0,function(c,L){var I=65535;for(I>c.pending_buf_size-5&&(I=c.pending_buf_size-5);;){if(c.lookahead<=1){if(de(c),c.lookahead===0&&L===h)return f;if(c.lookahead===0)break}c.strstart+=c.lookahead,c.lookahead=0;var C=c.block_start+I;if((c.strstart===0||c.strstart>=C)&&(c.lookahead=c.strstart-C,c.strstart=C,T(c,!1),c.strm.avail_out===0)||c.strstart-c.block_start>=c.w_size-$&&(T(c,!1),c.strm.avail_out===0))return f}return c.insert=0,L===p?(T(c,!0),c.strm.avail_out===0?ne:P):(c.strstart>c.block_start&&(T(c,!1),c.strm.avail_out),f)}),new te(4,4,8,4,pe),new te(4,5,16,8,pe),new te(4,6,32,32,pe),new te(4,4,16,16,Y),new te(8,16,32,32,Y),new te(8,16,128,128,Y),new te(8,32,128,256,Y),new te(32,128,258,1024,Y),new te(32,258,258,4096,Y)],e.deflateInit=function(c,L){return he(c,L,b,15,8,0)},e.deflateInit2=he,e.deflateReset=ue,e.deflateResetKeep=ie,e.deflateSetHeader=function(c,L){return c&&c.state?c.state.wrap!==2?m:(c.state.gzhead=L,u):m},e.deflate=function(c,L){var I,C,w,E;if(!c||!c.state||5<L||L<0)return c?re(c,m):m;if(C=c.state,!c.output||!c.input&&c.avail_in!==0||C.status===666&&L!==p)return re(c,c.avail_out===0?-5:m);if(C.strm=c,I=C.last_flush,C.last_flush=L,C.status===_)if(C.wrap===2)c.adler=0,H(C,31),H(C,139),H(C,8),C.gzhead?(H(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),H(C,255&C.gzhead.time),H(C,C.gzhead.time>>8&255),H(C,C.gzhead.time>>16&255),H(C,C.gzhead.time>>24&255),H(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),H(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(H(C,255&C.gzhead.extra.length),H(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(c.adler=a(c.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(H(C,0),H(C,0),H(C,0),H(C,0),H(C,0),H(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),H(C,3),C.status=R);else{var Q=b+(C.w_bits-8<<4)<<8;Q|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(Q|=32),Q+=31-Q%31,C.status=R,W(C,Q),C.strstart!==0&&(W(C,c.adler>>>16),W(C,65535&c.adler)),c.adler=1}if(C.status===69)if(C.gzhead.extra){for(w=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>w&&(c.adler=a(c.adler,C.pending_buf,C.pending-w,w)),A(c),w=C.pending,C.pending!==C.pending_buf_size));)H(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>w&&(c.adler=a(c.adler,C.pending_buf,C.pending-w,w)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){w=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>w&&(c.adler=a(c.adler,C.pending_buf,C.pending-w,w)),A(c),w=C.pending,C.pending===C.pending_buf_size)){E=1;break}E=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,H(C,E)}while(E!==0);C.gzhead.hcrc&&C.pending>w&&(c.adler=a(c.adler,C.pending_buf,C.pending-w,w)),E===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){w=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>w&&(c.adler=a(c.adler,C.pending_buf,C.pending-w,w)),A(c),w=C.pending,C.pending===C.pending_buf_size)){E=1;break}E=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,H(C,E)}while(E!==0);C.gzhead.hcrc&&C.pending>w&&(c.adler=a(c.adler,C.pending_buf,C.pending-w,w)),E===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&A(c),C.pending+2<=C.pending_buf_size&&(H(C,255&c.adler),H(C,c.adler>>8&255),c.adler=0,C.status=R)):C.status=R),C.pending!==0){if(A(c),c.avail_out===0)return C.last_flush=-1,u}else if(c.avail_in===0&&M(L)<=M(I)&&L!==p)return re(c,-5);if(C.status===666&&c.avail_in!==0)return re(c,-5);if(c.avail_in!==0||C.lookahead!==0||L!==h&&C.status!==666){var U=C.strategy===2?function(O,V){for(var K;;){if(O.lookahead===0&&(de(O),O.lookahead===0)){if(V===h)return f;break}if(O.match_length=0,K=i._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,K&&(T(O,!1),O.strm.avail_out===0))return f}return O.insert=0,V===p?(T(O,!0),O.strm.avail_out===0?ne:P):O.last_lit&&(T(O,!1),O.strm.avail_out===0)?f:B}(C,L):C.strategy===3?function(O,V){for(var K,G,Z,ce,oe=O.window;;){if(O.lookahead<=D){if(de(O),O.lookahead<=D&&V===h)return f;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=y&&0<O.strstart&&(G=oe[Z=O.strstart-1])===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]){ce=O.strstart+D;do;while(G===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]&&G===oe[++Z]&&Z<ce);O.match_length=D-(ce-Z),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=y?(K=i._tr_tally(O,1,O.match_length-y),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(K=i._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),K&&(T(O,!1),O.strm.avail_out===0))return f}return O.insert=0,V===p?(T(O,!0),O.strm.avail_out===0?ne:P):O.last_lit&&(T(O,!1),O.strm.avail_out===0)?f:B}(C,L):t[C.level].func(C,L);if(U!==ne&&U!==P||(C.status=666),U===f||U===ne)return c.avail_out===0&&(C.last_flush=-1),u;if(U===B&&(L===1?i._tr_align(C):L!==5&&(i._tr_stored_block(C,0,0,!1),L===3&&(ee(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),A(c),c.avail_out===0))return C.last_flush=-1,u}return L!==p?u:C.wrap<=0?1:(C.wrap===2?(H(C,255&c.adler),H(C,c.adler>>8&255),H(C,c.adler>>16&255),H(C,c.adler>>24&255),H(C,255&c.total_in),H(C,c.total_in>>8&255),H(C,c.total_in>>16&255),H(C,c.total_in>>24&255)):(W(C,c.adler>>>16),W(C,65535&c.adler)),A(c),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?u:1)},e.deflateEnd=function(c){var L;return c&&c.state?(L=c.state.status)!==_&&L!==69&&L!==73&&L!==91&&L!==103&&L!==R&&L!==666?re(c,m):(c.state=null,L===R?re(c,-3):u):m},e.deflateSetDictionary=function(c,L){var I,C,w,E,Q,U,O,V,K=L.length;if(!c||!c.state||(E=(I=c.state).wrap)===2||E===1&&I.status!==_||I.lookahead)return m;for(E===1&&(c.adler=n(c.adler,L,K,0)),I.wrap=0,K>=I.w_size&&(E===0&&(ee(I.head),I.strstart=0,I.block_start=0,I.insert=0),V=new s.Buf8(I.w_size),s.arraySet(V,L,K-I.w_size,I.w_size,0),L=V,K=I.w_size),Q=c.avail_in,U=c.next_in,O=c.input,c.avail_in=K,c.next_in=0,c.input=L,de(I);I.lookahead>=y;){for(C=I.strstart,w=I.lookahead-(y-1);I.ins_h=(I.ins_h<<I.hash_shift^I.window[C+y-1])&I.hash_mask,I.prev[C&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=C,C++,--w;);I.strstart=C,I.lookahead=y-1,de(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=y-1,I.match_available=0,c.next_in=U,c.input=O,c.avail_in=Q,I.wrap=E,u},e.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,r,e){"use strict";r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,r,e){"use strict";r.exports=function(t,s){var i,n,a,l,h,p,u,m,d,g,v,b,S,z,x,N,F,k,y,D,$,_,R,f,B;i=t.state,n=t.next_in,f=t.input,a=n+(t.avail_in-5),l=t.next_out,B=t.output,h=l-(s-t.avail_out),p=l+(t.avail_out-257),u=i.dmax,m=i.wsize,d=i.whave,g=i.wnext,v=i.window,b=i.hold,S=i.bits,z=i.lencode,x=i.distcode,N=(1<<i.lenbits)-1,F=(1<<i.distbits)-1;e:do{S<15&&(b+=f[n++]<<S,S+=8,b+=f[n++]<<S,S+=8),k=z[b&N];t:for(;;){if(b>>>=y=k>>>24,S-=y,(y=k>>>16&255)===0)B[l++]=65535&k;else{if(!(16&y)){if(!(64&y)){k=z[(65535&k)+(b&(1<<y)-1)];continue t}if(32&y){i.mode=12;break e}t.msg="invalid literal/length code",i.mode=30;break e}D=65535&k,(y&=15)&&(S<y&&(b+=f[n++]<<S,S+=8),D+=b&(1<<y)-1,b>>>=y,S-=y),S<15&&(b+=f[n++]<<S,S+=8,b+=f[n++]<<S,S+=8),k=x[b&F];r:for(;;){if(b>>>=y=k>>>24,S-=y,!(16&(y=k>>>16&255))){if(!(64&y)){k=x[(65535&k)+(b&(1<<y)-1)];continue r}t.msg="invalid distance code",i.mode=30;break e}if($=65535&k,S<(y&=15)&&(b+=f[n++]<<S,(S+=8)<y&&(b+=f[n++]<<S,S+=8)),u<($+=b&(1<<y)-1)){t.msg="invalid distance too far back",i.mode=30;break e}if(b>>>=y,S-=y,(y=l-h)<$){if(d<(y=$-y)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break e}if(R=v,(_=0)===g){if(_+=m-y,y<D){for(D-=y;B[l++]=v[_++],--y;);_=l-$,R=B}}else if(g<y){if(_+=m+g-y,(y-=g)<D){for(D-=y;B[l++]=v[_++],--y;);if(_=0,g<D){for(D-=y=g;B[l++]=v[_++],--y;);_=l-$,R=B}}}else if(_+=g-y,y<D){for(D-=y;B[l++]=v[_++],--y;);_=l-$,R=B}for(;2<D;)B[l++]=R[_++],B[l++]=R[_++],B[l++]=R[_++],D-=3;D&&(B[l++]=R[_++],1<D&&(B[l++]=R[_++]))}else{for(_=l-$;B[l++]=B[_++],B[l++]=B[_++],B[l++]=B[_++],2<(D-=3););D&&(B[l++]=B[_++],1<D&&(B[l++]=B[_++]))}break}}break}}while(n<a&&l<p);n-=D=S>>3,b&=(1<<(S-=D<<3))-1,t.next_in=n,t.next_out=l,t.avail_in=n<a?a-n+5:5-(n-a),t.avail_out=l<p?p-l+257:257-(l-p),i.hold=b,i.bits=S}},{}],49:[function(o,r,e){"use strict";var t=o("../utils/common"),s=o("./adler32"),i=o("./crc32"),n=o("./inffast"),a=o("./inftrees"),l=1,h=2,p=0,u=-2,m=1,d=852,g=592;function v(_){return(_>>>24&255)+(_>>>8&65280)+((65280&_)<<8)+((255&_)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(_){var R;return _&&_.state?(R=_.state,_.total_in=_.total_out=R.total=0,_.msg="",R.wrap&&(_.adler=1&R.wrap),R.mode=m,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new t.Buf32(d),R.distcode=R.distdyn=new t.Buf32(g),R.sane=1,R.back=-1,p):u}function z(_){var R;return _&&_.state?((R=_.state).wsize=0,R.whave=0,R.wnext=0,S(_)):u}function x(_,R){var f,B;return _&&_.state?(B=_.state,R<0?(f=0,R=-R):(f=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?u:(B.window!==null&&B.wbits!==R&&(B.window=null),B.wrap=f,B.wbits=R,z(_))):u}function N(_,R){var f,B;return _?(B=new b,(_.state=B).window=null,(f=x(_,R))!==p&&(_.state=null),f):u}var F,k,y=!0;function D(_){if(y){var R;for(F=new t.Buf32(512),k=new t.Buf32(32),R=0;R<144;)_.lens[R++]=8;for(;R<256;)_.lens[R++]=9;for(;R<280;)_.lens[R++]=7;for(;R<288;)_.lens[R++]=8;for(a(l,_.lens,0,288,F,0,_.work,{bits:9}),R=0;R<32;)_.lens[R++]=5;a(h,_.lens,0,32,k,0,_.work,{bits:5}),y=!1}_.lencode=F,_.lenbits=9,_.distcode=k,_.distbits=5}function $(_,R,f,B){var ne,P=_.state;return P.window===null&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new t.Buf8(P.wsize)),B>=P.wsize?(t.arraySet(P.window,R,f-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):(B<(ne=P.wsize-P.wnext)&&(ne=B),t.arraySet(P.window,R,f-B,ne,P.wnext),(B-=ne)?(t.arraySet(P.window,R,f-B,B,0),P.wnext=B,P.whave=P.wsize):(P.wnext+=ne,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=ne))),0}e.inflateReset=z,e.inflateReset2=x,e.inflateResetKeep=S,e.inflateInit=function(_){return N(_,15)},e.inflateInit2=N,e.inflate=function(_,R){var f,B,ne,P,re,M,ee,A,T,H,W,j,de,pe,Y,te,le,ie,ue,he,c,L,I,C,w=0,E=new t.Buf8(4),Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_||!_.state||!_.output||!_.input&&_.avail_in!==0)return u;(f=_.state).mode===12&&(f.mode=13),re=_.next_out,ne=_.output,ee=_.avail_out,P=_.next_in,B=_.input,M=_.avail_in,A=f.hold,T=f.bits,H=M,W=ee,L=p;e:for(;;)switch(f.mode){case m:if(f.wrap===0){f.mode=13;break}for(;T<16;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(2&f.wrap&&A===35615){E[f.check=0]=255&A,E[1]=A>>>8&255,f.check=i(f.check,E,2,0),T=A=0,f.mode=2;break}if(f.flags=0,f.head&&(f.head.done=!1),!(1&f.wrap)||(((255&A)<<8)+(A>>8))%31){_.msg="incorrect header check",f.mode=30;break}if((15&A)!=8){_.msg="unknown compression method",f.mode=30;break}if(T-=4,c=8+(15&(A>>>=4)),f.wbits===0)f.wbits=c;else if(c>f.wbits){_.msg="invalid window size",f.mode=30;break}f.dmax=1<<c,_.adler=f.check=1,f.mode=512&A?10:12,T=A=0;break;case 2:for(;T<16;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(f.flags=A,(255&f.flags)!=8){_.msg="unknown compression method",f.mode=30;break}if(57344&f.flags){_.msg="unknown header flags set",f.mode=30;break}f.head&&(f.head.text=A>>8&1),512&f.flags&&(E[0]=255&A,E[1]=A>>>8&255,f.check=i(f.check,E,2,0)),T=A=0,f.mode=3;case 3:for(;T<32;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}f.head&&(f.head.time=A),512&f.flags&&(E[0]=255&A,E[1]=A>>>8&255,E[2]=A>>>16&255,E[3]=A>>>24&255,f.check=i(f.check,E,4,0)),T=A=0,f.mode=4;case 4:for(;T<16;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}f.head&&(f.head.xflags=255&A,f.head.os=A>>8),512&f.flags&&(E[0]=255&A,E[1]=A>>>8&255,f.check=i(f.check,E,2,0)),T=A=0,f.mode=5;case 5:if(1024&f.flags){for(;T<16;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}f.length=A,f.head&&(f.head.extra_len=A),512&f.flags&&(E[0]=255&A,E[1]=A>>>8&255,f.check=i(f.check,E,2,0)),T=A=0}else f.head&&(f.head.extra=null);f.mode=6;case 6:if(1024&f.flags&&(M<(j=f.length)&&(j=M),j&&(f.head&&(c=f.head.extra_len-f.length,f.head.extra||(f.head.extra=new Array(f.head.extra_len)),t.arraySet(f.head.extra,B,P,j,c)),512&f.flags&&(f.check=i(f.check,B,j,P)),M-=j,P+=j,f.length-=j),f.length))break e;f.length=0,f.mode=7;case 7:if(2048&f.flags){if(M===0)break e;for(j=0;c=B[P+j++],f.head&&c&&f.length<65536&&(f.head.name+=String.fromCharCode(c)),c&&j<M;);if(512&f.flags&&(f.check=i(f.check,B,j,P)),M-=j,P+=j,c)break e}else f.head&&(f.head.name=null);f.length=0,f.mode=8;case 8:if(4096&f.flags){if(M===0)break e;for(j=0;c=B[P+j++],f.head&&c&&f.length<65536&&(f.head.comment+=String.fromCharCode(c)),c&&j<M;);if(512&f.flags&&(f.check=i(f.check,B,j,P)),M-=j,P+=j,c)break e}else f.head&&(f.head.comment=null);f.mode=9;case 9:if(512&f.flags){for(;T<16;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(A!==(65535&f.check)){_.msg="header crc mismatch",f.mode=30;break}T=A=0}f.head&&(f.head.hcrc=f.flags>>9&1,f.head.done=!0),_.adler=f.check=0,f.mode=12;break;case 10:for(;T<32;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}_.adler=f.check=v(A),T=A=0,f.mode=11;case 11:if(f.havedict===0)return _.next_out=re,_.avail_out=ee,_.next_in=P,_.avail_in=M,f.hold=A,f.bits=T,2;_.adler=f.check=1,f.mode=12;case 12:if(R===5||R===6)break e;case 13:if(f.last){A>>>=7&T,T-=7&T,f.mode=27;break}for(;T<3;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}switch(f.last=1&A,T-=1,3&(A>>>=1)){case 0:f.mode=14;break;case 1:if(D(f),f.mode=20,R!==6)break;A>>>=2,T-=2;break e;case 2:f.mode=17;break;case 3:_.msg="invalid block type",f.mode=30}A>>>=2,T-=2;break;case 14:for(A>>>=7&T,T-=7&T;T<32;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if((65535&A)!=(A>>>16^65535)){_.msg="invalid stored block lengths",f.mode=30;break}if(f.length=65535&A,T=A=0,f.mode=15,R===6)break e;case 15:f.mode=16;case 16:if(j=f.length){if(M<j&&(j=M),ee<j&&(j=ee),j===0)break e;t.arraySet(ne,B,P,j,re),M-=j,P+=j,ee-=j,re+=j,f.length-=j;break}f.mode=12;break;case 17:for(;T<14;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(f.nlen=257+(31&A),A>>>=5,T-=5,f.ndist=1+(31&A),A>>>=5,T-=5,f.ncode=4+(15&A),A>>>=4,T-=4,286<f.nlen||30<f.ndist){_.msg="too many length or distance symbols",f.mode=30;break}f.have=0,f.mode=18;case 18:for(;f.have<f.ncode;){for(;T<3;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}f.lens[Q[f.have++]]=7&A,A>>>=3,T-=3}for(;f.have<19;)f.lens[Q[f.have++]]=0;if(f.lencode=f.lendyn,f.lenbits=7,I={bits:f.lenbits},L=a(0,f.lens,0,19,f.lencode,0,f.work,I),f.lenbits=I.bits,L){_.msg="invalid code lengths set",f.mode=30;break}f.have=0,f.mode=19;case 19:for(;f.have<f.nlen+f.ndist;){for(;te=(w=f.lencode[A&(1<<f.lenbits)-1])>>>16&255,le=65535&w,!((Y=w>>>24)<=T);){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(le<16)A>>>=Y,T-=Y,f.lens[f.have++]=le;else{if(le===16){for(C=Y+2;T<C;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(A>>>=Y,T-=Y,f.have===0){_.msg="invalid bit length repeat",f.mode=30;break}c=f.lens[f.have-1],j=3+(3&A),A>>>=2,T-=2}else if(le===17){for(C=Y+3;T<C;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}T-=Y,c=0,j=3+(7&(A>>>=Y)),A>>>=3,T-=3}else{for(C=Y+7;T<C;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}T-=Y,c=0,j=11+(127&(A>>>=Y)),A>>>=7,T-=7}if(f.have+j>f.nlen+f.ndist){_.msg="invalid bit length repeat",f.mode=30;break}for(;j--;)f.lens[f.have++]=c}}if(f.mode===30)break;if(f.lens[256]===0){_.msg="invalid code -- missing end-of-block",f.mode=30;break}if(f.lenbits=9,I={bits:f.lenbits},L=a(l,f.lens,0,f.nlen,f.lencode,0,f.work,I),f.lenbits=I.bits,L){_.msg="invalid literal/lengths set",f.mode=30;break}if(f.distbits=6,f.distcode=f.distdyn,I={bits:f.distbits},L=a(h,f.lens,f.nlen,f.ndist,f.distcode,0,f.work,I),f.distbits=I.bits,L){_.msg="invalid distances set",f.mode=30;break}if(f.mode=20,R===6)break e;case 20:f.mode=21;case 21:if(6<=M&&258<=ee){_.next_out=re,_.avail_out=ee,_.next_in=P,_.avail_in=M,f.hold=A,f.bits=T,n(_,W),re=_.next_out,ne=_.output,ee=_.avail_out,P=_.next_in,B=_.input,M=_.avail_in,A=f.hold,T=f.bits,f.mode===12&&(f.back=-1);break}for(f.back=0;te=(w=f.lencode[A&(1<<f.lenbits)-1])>>>16&255,le=65535&w,!((Y=w>>>24)<=T);){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(te&&!(240&te)){for(ie=Y,ue=te,he=le;te=(w=f.lencode[he+((A&(1<<ie+ue)-1)>>ie)])>>>16&255,le=65535&w,!(ie+(Y=w>>>24)<=T);){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}A>>>=ie,T-=ie,f.back+=ie}if(A>>>=Y,T-=Y,f.back+=Y,f.length=le,te===0){f.mode=26;break}if(32&te){f.back=-1,f.mode=12;break}if(64&te){_.msg="invalid literal/length code",f.mode=30;break}f.extra=15&te,f.mode=22;case 22:if(f.extra){for(C=f.extra;T<C;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}f.length+=A&(1<<f.extra)-1,A>>>=f.extra,T-=f.extra,f.back+=f.extra}f.was=f.length,f.mode=23;case 23:for(;te=(w=f.distcode[A&(1<<f.distbits)-1])>>>16&255,le=65535&w,!((Y=w>>>24)<=T);){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(!(240&te)){for(ie=Y,ue=te,he=le;te=(w=f.distcode[he+((A&(1<<ie+ue)-1)>>ie)])>>>16&255,le=65535&w,!(ie+(Y=w>>>24)<=T);){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}A>>>=ie,T-=ie,f.back+=ie}if(A>>>=Y,T-=Y,f.back+=Y,64&te){_.msg="invalid distance code",f.mode=30;break}f.offset=le,f.extra=15&te,f.mode=24;case 24:if(f.extra){for(C=f.extra;T<C;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}f.offset+=A&(1<<f.extra)-1,A>>>=f.extra,T-=f.extra,f.back+=f.extra}if(f.offset>f.dmax){_.msg="invalid distance too far back",f.mode=30;break}f.mode=25;case 25:if(ee===0)break e;if(j=W-ee,f.offset>j){if((j=f.offset-j)>f.whave&&f.sane){_.msg="invalid distance too far back",f.mode=30;break}de=j>f.wnext?(j-=f.wnext,f.wsize-j):f.wnext-j,j>f.length&&(j=f.length),pe=f.window}else pe=ne,de=re-f.offset,j=f.length;for(ee<j&&(j=ee),ee-=j,f.length-=j;ne[re++]=pe[de++],--j;);f.length===0&&(f.mode=21);break;case 26:if(ee===0)break e;ne[re++]=f.length,ee--,f.mode=21;break;case 27:if(f.wrap){for(;T<32;){if(M===0)break e;M--,A|=B[P++]<<T,T+=8}if(W-=ee,_.total_out+=W,f.total+=W,W&&(_.adler=f.check=f.flags?i(f.check,ne,W,re-W):s(f.check,ne,W,re-W)),W=ee,(f.flags?A:v(A))!==f.check){_.msg="incorrect data check",f.mode=30;break}T=A=0}f.mode=28;case 28:if(f.wrap&&f.flags){for(;T<32;){if(M===0)break e;M--,A+=B[P++]<<T,T+=8}if(A!==(4294967295&f.total)){_.msg="incorrect length check",f.mode=30;break}T=A=0}f.mode=29;case 29:L=1;break e;case 30:L=-3;break e;case 31:return-4;case 32:default:return u}return _.next_out=re,_.avail_out=ee,_.next_in=P,_.avail_in=M,f.hold=A,f.bits=T,(f.wsize||W!==_.avail_out&&f.mode<30&&(f.mode<27||R!==4))&&$(_,_.output,_.next_out,W-_.avail_out)?(f.mode=31,-4):(H-=_.avail_in,W-=_.avail_out,_.total_in+=H,_.total_out+=W,f.total+=W,f.wrap&&W&&(_.adler=f.check=f.flags?i(f.check,ne,W,_.next_out-W):s(f.check,ne,W,_.next_out-W)),_.data_type=f.bits+(f.last?64:0)+(f.mode===12?128:0)+(f.mode===20||f.mode===15?256:0),(H==0&&W===0||R===4)&&L===p&&(L=-5),L)},e.inflateEnd=function(_){if(!_||!_.state)return u;var R=_.state;return R.window&&(R.window=null),_.state=null,p},e.inflateGetHeader=function(_,R){var f;return _&&_.state&&2&(f=_.state).wrap?((f.head=R).done=!1,p):u},e.inflateSetDictionary=function(_,R){var f,B=R.length;return _&&_.state?(f=_.state).wrap!==0&&f.mode!==11?u:f.mode===11&&s(1,R,B,0)!==f.check?-3:$(_,R,B,B)?(f.mode=31,-4):(f.havedict=1,p):u},e.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,r,e){"use strict";var t=o("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,p,u,m,d,g,v){var b,S,z,x,N,F,k,y,D,$=v.bits,_=0,R=0,f=0,B=0,ne=0,P=0,re=0,M=0,ee=0,A=0,T=null,H=0,W=new t.Buf16(16),j=new t.Buf16(16),de=null,pe=0;for(_=0;_<=15;_++)W[_]=0;for(R=0;R<u;R++)W[h[p+R]]++;for(ne=$,B=15;1<=B&&W[B]===0;B--);if(B<ne&&(ne=B),B===0)return m[d++]=20971520,m[d++]=20971520,v.bits=1,0;for(f=1;f<B&&W[f]===0;f++);for(ne<f&&(ne=f),_=M=1;_<=15;_++)if(M<<=1,(M-=W[_])<0)return-1;if(0<M&&(l===0||B!==1))return-1;for(j[1]=0,_=1;_<15;_++)j[_+1]=j[_]+W[_];for(R=0;R<u;R++)h[p+R]!==0&&(g[j[h[p+R]]++]=R);if(F=l===0?(T=de=g,19):l===1?(T=s,H-=257,de=i,pe-=257,256):(T=n,de=a,-1),_=f,N=d,re=R=A=0,z=-1,x=(ee=1<<(P=ne))-1,l===1&&852<ee||l===2&&592<ee)return 1;for(;;){for(k=_-re,D=g[R]<F?(y=0,g[R]):g[R]>F?(y=de[pe+g[R]],T[H+g[R]]):(y=96,0),b=1<<_-re,f=S=1<<P;m[N+(A>>re)+(S-=b)]=k<<24|y<<16|D|0,S!==0;);for(b=1<<_-1;A&b;)b>>=1;if(b!==0?(A&=b-1,A+=b):A=0,R++,--W[_]==0){if(_===B)break;_=h[p+g[R]]}if(ne<_&&(A&x)!==z){for(re===0&&(re=ne),N+=f,M=1<<(P=_-re);P+re<B&&!((M-=W[P+re])<=0);)P++,M<<=1;if(ee+=1<<P,l===1&&852<ee||l===2&&592<ee)return 1;m[z=A&x]=ne<<24|P<<16|N-d|0}}return A!==0&&(m[N+A]=_-re<<24|64<<16|0),v.bits=ne,0}},{"../utils/common":41}],51:[function(o,r,e){"use strict";r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,r,e){"use strict";var t=o("../utils/common"),s=0,i=1;function n(w){for(var E=w.length;0<=--E;)w[E]=0}var a=0,l=29,h=256,p=h+1+l,u=30,m=19,d=2*p+1,g=15,v=16,b=7,S=256,z=16,x=17,N=18,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(p+2));n($);var _=new Array(2*u);n(_);var R=new Array(512);n(R);var f=new Array(256);n(f);var B=new Array(l);n(B);var ne,P,re,M=new Array(u);function ee(w,E,Q,U,O){this.static_tree=w,this.extra_bits=E,this.extra_base=Q,this.elems=U,this.max_length=O,this.has_stree=w&&w.length}function A(w,E){this.dyn_tree=w,this.max_code=0,this.stat_desc=E}function T(w){return w<256?R[w]:R[256+(w>>>7)]}function H(w,E){w.pending_buf[w.pending++]=255&E,w.pending_buf[w.pending++]=E>>>8&255}function W(w,E,Q){w.bi_valid>v-Q?(w.bi_buf|=E<<w.bi_valid&65535,H(w,w.bi_buf),w.bi_buf=E>>v-w.bi_valid,w.bi_valid+=Q-v):(w.bi_buf|=E<<w.bi_valid&65535,w.bi_valid+=Q)}function j(w,E,Q){W(w,Q[2*E],Q[2*E+1])}function de(w,E){for(var Q=0;Q|=1&w,w>>>=1,Q<<=1,0<--E;);return Q>>>1}function pe(w,E,Q){var U,O,V=new Array(g+1),K=0;for(U=1;U<=g;U++)V[U]=K=K+Q[U-1]<<1;for(O=0;O<=E;O++){var G=w[2*O+1];G!==0&&(w[2*O]=de(V[G]++,G))}}function Y(w){var E;for(E=0;E<p;E++)w.dyn_ltree[2*E]=0;for(E=0;E<u;E++)w.dyn_dtree[2*E]=0;for(E=0;E<m;E++)w.bl_tree[2*E]=0;w.dyn_ltree[2*S]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function te(w){8<w.bi_valid?H(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function le(w,E,Q,U){var O=2*E,V=2*Q;return w[O]<w[V]||w[O]===w[V]&&U[E]<=U[Q]}function ie(w,E,Q){for(var U=w.heap[Q],O=Q<<1;O<=w.heap_len&&(O<w.heap_len&&le(E,w.heap[O+1],w.heap[O],w.depth)&&O++,!le(E,U,w.heap[O],w.depth));)w.heap[Q]=w.heap[O],Q=O,O<<=1;w.heap[Q]=U}function ue(w,E,Q){var U,O,V,K,G=0;if(w.last_lit!==0)for(;U=w.pending_buf[w.d_buf+2*G]<<8|w.pending_buf[w.d_buf+2*G+1],O=w.pending_buf[w.l_buf+G],G++,U===0?j(w,O,E):(j(w,(V=f[O])+h+1,E),(K=F[V])!==0&&W(w,O-=B[V],K),j(w,V=T(--U),Q),(K=k[V])!==0&&W(w,U-=M[V],K)),G<w.last_lit;);j(w,S,E)}function he(w,E){var Q,U,O,V=E.dyn_tree,K=E.stat_desc.static_tree,G=E.stat_desc.has_stree,Z=E.stat_desc.elems,ce=-1;for(w.heap_len=0,w.heap_max=d,Q=0;Q<Z;Q++)V[2*Q]!==0?(w.heap[++w.heap_len]=ce=Q,w.depth[Q]=0):V[2*Q+1]=0;for(;w.heap_len<2;)V[2*(O=w.heap[++w.heap_len]=ce<2?++ce:0)]=1,w.depth[O]=0,w.opt_len--,G&&(w.static_len-=K[2*O+1]);for(E.max_code=ce,Q=w.heap_len>>1;1<=Q;Q--)ie(w,V,Q);for(O=Z;Q=w.heap[1],w.heap[1]=w.heap[w.heap_len--],ie(w,V,1),U=w.heap[1],w.heap[--w.heap_max]=Q,w.heap[--w.heap_max]=U,V[2*O]=V[2*Q]+V[2*U],w.depth[O]=(w.depth[Q]>=w.depth[U]?w.depth[Q]:w.depth[U])+1,V[2*Q+1]=V[2*U+1]=O,w.heap[1]=O++,ie(w,V,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],function(oe,be){var Le,we,ke,fe,Be,Cr,Re=be.dyn_tree,Xr=be.max_code,li=be.stat_desc.static_tree,ci=be.stat_desc.has_stree,di=be.stat_desc.extra_bits,es=be.stat_desc.extra_base,st=be.stat_desc.max_length,ht=0;for(fe=0;fe<=g;fe++)oe.bl_count[fe]=0;for(Re[2*oe.heap[oe.heap_max]+1]=0,Le=oe.heap_max+1;Le<d;Le++)st<(fe=Re[2*Re[2*(we=oe.heap[Le])+1]+1]+1)&&(fe=st,ht++),Re[2*we+1]=fe,Xr<we||(oe.bl_count[fe]++,Be=0,es<=we&&(Be=di[we-es]),Cr=Re[2*we],oe.opt_len+=Cr*(fe+Be),ci&&(oe.static_len+=Cr*(li[2*we+1]+Be)));if(ht!==0){do{for(fe=st-1;oe.bl_count[fe]===0;)fe--;oe.bl_count[fe]--,oe.bl_count[fe+1]+=2,oe.bl_count[st]--,ht-=2}while(0<ht);for(fe=st;fe!==0;fe--)for(we=oe.bl_count[fe];we!==0;)Xr<(ke=oe.heap[--Le])||(Re[2*ke+1]!==fe&&(oe.opt_len+=(fe-Re[2*ke+1])*Re[2*ke],Re[2*ke+1]=fe),we--)}}(w,E),pe(V,ce,w.bl_count)}function c(w,E,Q){var U,O,V=-1,K=E[1],G=0,Z=7,ce=4;for(K===0&&(Z=138,ce=3),E[2*(Q+1)+1]=65535,U=0;U<=Q;U++)O=K,K=E[2*(U+1)+1],++G<Z&&O===K||(G<ce?w.bl_tree[2*O]+=G:O!==0?(O!==V&&w.bl_tree[2*O]++,w.bl_tree[2*z]++):G<=10?w.bl_tree[2*x]++:w.bl_tree[2*N]++,V=O,ce=(G=0)===K?(Z=138,3):O===K?(Z=6,3):(Z=7,4))}function L(w,E,Q){var U,O,V=-1,K=E[1],G=0,Z=7,ce=4;for(K===0&&(Z=138,ce=3),U=0;U<=Q;U++)if(O=K,K=E[2*(U+1)+1],!(++G<Z&&O===K)){if(G<ce)for(;j(w,O,w.bl_tree),--G!=0;);else O!==0?(O!==V&&(j(w,O,w.bl_tree),G--),j(w,z,w.bl_tree),W(w,G-3,2)):G<=10?(j(w,x,w.bl_tree),W(w,G-3,3)):(j(w,N,w.bl_tree),W(w,G-11,7));V=O,ce=(G=0)===K?(Z=138,3):O===K?(Z=6,3):(Z=7,4)}}n(M);var I=!1;function C(w,E,Q,U){W(w,(a<<1)+(U?1:0),3),function(O,V,K,G){te(O),G&&(H(O,K),H(O,~K)),t.arraySet(O.pending_buf,O.window,V,K,O.pending),O.pending+=K}(w,E,Q,!0)}e._tr_init=function(w){I||(function(){var E,Q,U,O,V,K=new Array(g+1);for(O=U=0;O<l-1;O++)for(B[O]=U,E=0;E<1<<F[O];E++)f[U++]=O;for(f[U-1]=O,O=V=0;O<16;O++)for(M[O]=V,E=0;E<1<<k[O];E++)R[V++]=O;for(V>>=7;O<u;O++)for(M[O]=V<<7,E=0;E<1<<k[O]-7;E++)R[256+V++]=O;for(Q=0;Q<=g;Q++)K[Q]=0;for(E=0;E<=143;)$[2*E+1]=8,E++,K[8]++;for(;E<=255;)$[2*E+1]=9,E++,K[9]++;for(;E<=279;)$[2*E+1]=7,E++,K[7]++;for(;E<=287;)$[2*E+1]=8,E++,K[8]++;for(pe($,p+1,K),E=0;E<u;E++)_[2*E+1]=5,_[2*E]=de(E,5);ne=new ee($,F,h+1,p,g),P=new ee(_,k,0,u,g),re=new ee(new Array(0),y,0,m,b)}(),I=!0),w.l_desc=new A(w.dyn_ltree,ne),w.d_desc=new A(w.dyn_dtree,P),w.bl_desc=new A(w.bl_tree,re),w.bi_buf=0,w.bi_valid=0,Y(w)},e._tr_stored_block=C,e._tr_flush_block=function(w,E,Q,U){var O,V,K=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=function(G){var Z,ce=4093624447;for(Z=0;Z<=31;Z++,ce>>>=1)if(1&ce&&G.dyn_ltree[2*Z]!==0)return s;if(G.dyn_ltree[18]!==0||G.dyn_ltree[20]!==0||G.dyn_ltree[26]!==0)return i;for(Z=32;Z<h;Z++)if(G.dyn_ltree[2*Z]!==0)return i;return s}(w)),he(w,w.l_desc),he(w,w.d_desc),K=function(G){var Z;for(c(G,G.dyn_ltree,G.l_desc.max_code),c(G,G.dyn_dtree,G.d_desc.max_code),he(G,G.bl_desc),Z=m-1;3<=Z&&G.bl_tree[2*D[Z]+1]===0;Z--);return G.opt_len+=3*(Z+1)+5+5+4,Z}(w),O=w.opt_len+3+7>>>3,(V=w.static_len+3+7>>>3)<=O&&(O=V)):O=V=Q+5,Q+4<=O&&E!==-1?C(w,E,Q,U):w.strategy===4||V===O?(W(w,2+(U?1:0),3),ue(w,$,_)):(W(w,4+(U?1:0),3),function(G,Z,ce,oe){var be;for(W(G,Z-257,5),W(G,ce-1,5),W(G,oe-4,4),be=0;be<oe;be++)W(G,G.bl_tree[2*D[be]+1],3);L(G,G.dyn_ltree,Z-1),L(G,G.dyn_dtree,ce-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,K+1),ue(w,w.dyn_ltree,w.dyn_dtree)),Y(w),U&&te(w)},e._tr_tally=function(w,E,Q){return w.pending_buf[w.d_buf+2*w.last_lit]=E>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&E,w.pending_buf[w.l_buf+w.last_lit]=255&Q,w.last_lit++,E===0?w.dyn_ltree[2*Q]++:(w.matches++,E--,w.dyn_ltree[2*(f[Q]+h+1)]++,w.dyn_dtree[2*T(E)]++),w.last_lit===w.lit_bufsize-1},e._tr_align=function(w){W(w,2,3),j(w,S,$),function(E){E.bi_valid===16?(H(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(w)}},{"../utils/common":41}],53:[function(o,r,e){"use strict";r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,r,e){(function(t){(function(s,i){"use strict";if(!s.setImmediate){var n,a,l,h,p=1,u={},m=!1,d=s.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(s);g=g&&g.setTimeout?g:s,n={}.toString.call(s.process)==="[object process]"?function(z){process.nextTick(function(){b(z)})}:function(){if(s.postMessage&&!s.importScripts){var z=!0,x=s.onmessage;return s.onmessage=function(){z=!1},s.postMessage("","*"),s.onmessage=x,z}}()?(h="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",S,!1):s.attachEvent("onmessage",S),function(z){s.postMessage(h+z,"*")}):s.MessageChannel?((l=new MessageChannel).port1.onmessage=function(z){b(z.data)},function(z){l.port2.postMessage(z)}):d&&"onreadystatechange"in d.createElement("script")?(a=d.documentElement,function(z){var x=d.createElement("script");x.onreadystatechange=function(){b(z),x.onreadystatechange=null,a.removeChild(x),x=null},a.appendChild(x)}):function(z){setTimeout(b,0,z)},g.setImmediate=function(z){typeof z!="function"&&(z=new Function(""+z));for(var x=new Array(arguments.length-1),N=0;N<x.length;N++)x[N]=arguments[N+1];var F={callback:z,args:x};return u[p]=F,n(p),p++},g.clearImmediate=v}function v(z){delete u[z]}function b(z){if(m)setTimeout(b,0,z);else{var x=u[z];if(x){m=!0;try{(function(N){var F=N.callback,k=N.args;switch(k.length){case 0:F();break;case 1:F(k[0]);break;case 2:F(k[0],k[1]);break;case 3:F(k[0],k[1],k[2]);break;default:F.apply(i,k)}})(x)}finally{v(z),m=!1}}}}function S(z){z.source===s&&typeof z.data=="string"&&z.data.indexOf(h)===0&&b(+z.data.slice(h.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var kn={};vi(kn,{default:()=>kr});module.exports=wi(kn);var _r=require("obsidian");function rs(o,r,e,t,s){return{id:`quiz-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,title:o,created:new Date,generationMethod:s,sourceCards:e,questions:r,totalQuestions:r.length,config:t,state:"in-progress",lastAccessed:new Date,currentQuestionIndex:0}}function ss(o){let r=o.questions.filter(t=>t.correct===!0).length;return{score:Math.round(r/o.totalQuestions*100),correctCount:r}}function Sr(o,r){if(o.type==="multiple-choice"&&typeof o.correctAnswer=="number")return r===o.correctAnswer;let e=String(o.correctAnswer).toLowerCase().trim(),t=String(r).toLowerCase().trim();return e===t}var is={questionCount:20,includeMultipleChoice:!0,includeFillBlank:!0,includeTrueFalse:!0,useAI:!1,learnMode:!1},ns={enabled:!1,provider:"openai",openai:{apiKey:"",model:"gpt-4",baseUrl:"https://api.openai.com/v1"},anthropic:{apiKey:"",model:"claude-3-5-sonnet-20241022",baseUrl:"https://api.anthropic.com/v1"},gemini:{apiKey:"",model:"gemini-1.5-flash",baseUrl:"https://generativelanguage.googleapis.com/v1beta"},temperature:.7,maxTokens:4e3,systemPrompt:"You are a helpful assistant that generates educational quiz questions from flashcard content. Generate clear, accurate questions that test understanding of the material."};var Me={parser:{inline:{enabled:!0,enableQA:!0,enableMultiLine:!0,enableCloze:!0,createEmptyCards:!0},header:{enabled:!0,flashcardTags:["flashcards","cards"],headerLevels:[2,3,4,5,6],deckNamePriority:["frontmatter","title","subtags"],useSubtags:!0,answerTerminator:"next-header",createEmptyCards:!0,enableExclusion:!0,exclusionComment:"%%NO_FLASHCARD%%"},mixedFormats:!0},review:{scheduler:"fsrs",limits:{reviewPerDay:100,newPerDay:20},includeLearningCards:!0,excludeEmptyCards:!0,deckFilter:[],enableKeyboardShortcuts:!0},quiz:ns,export:{defaultFormat:"csv",defaultLocation:"",includeScheduling:!0,includeTags:!0,includeMedia:!1,csvDelimiter:",",csvIncludeBOM:!0,ankiDeckPrefix:"Flashly",ankiConvertMarkdown:!0,ankiPlainTextMode:!1},browser:{defaultSort:"created-desc",defaultDeckSort:"name-asc",showHierarchy:!0,hierarchyShowFullPath:!0,parentDeckDefaultBehavior:"ask"},tutorial:{completed:!1,version:"1.0.0"},developer:{enableDebugLogging:!1}};var se=require("obsidian");var ft=require("obsidian"),Pe=class extends ft.Modal{constructor(e,t){super(e);this.currentStep=0;this.steps=t.steps,this.onComplete=t.onComplete,this.onSkip=t.onSkip}onOpen(){let{contentEl:e}=this;e.addClass("flashly-tutorial-modal"),this.renderStep(),this.scope.register([],"ArrowRight",()=>(this.currentStep<this.steps.length-1&&this.nextStep(),!1)),this.scope.register([],"ArrowLeft",()=>(this.currentStep>0&&this.previousStep(),!1)),this.scope.register([],"Escape",()=>(this.handleSkip(),!1))}renderStep(){let{contentEl:e}=this;e.empty();let t=this.steps[this.currentStep];e.createDiv({cls:"flashly-tutorial-progress"}).setText(`Step ${this.currentStep+1} of ${this.steps.length}`);let i=e.createDiv({cls:"flashly-tutorial-step-content"}),n=i.createDiv({cls:"flashly-tutorial-title-row"}),a=n.createSpan({cls:"flashly-tutorial-icon"}),l=this.getIconForStep(this.currentStep);(0,ft.setIcon)(a,l),n.createEl("h3",{text:t.title});let h=i.createDiv(),u=new DOMParser().parseFromString(t.content,"text/html");Array.from(u.body.childNodes).forEach(b=>{h.appendChild(b.cloneNode(!0))}),t.image&&i.createDiv({cls:"flashly-tutorial-image"}).createEl("img",{attr:{src:t.image,alt:t.title}});let m=e.createDiv({cls:"flashly-tutorial-buttons"}),d=m.createEl("button",{text:"Previous"});d.disabled=this.currentStep===0,d.onclick=()=>this.previousStep();let g=this.currentStep===this.steps.length-1,v=m.createEl("button",{text:g?"Finish":"Skip tutorial",cls:g?"":"flashly-tutorial-skip"});if(v.onclick=()=>{g?this.handleComplete():this.handleSkip()},!g){let b=m.createEl("button",{text:"Next",cls:"mod-cta"});b.onclick=()=>this.nextStep()}}nextStep(){this.currentStep<this.steps.length-1&&(this.currentStep++,this.renderStep())}previousStep(){this.currentStep>0&&(this.currentStep--,this.renderStep())}handleSkip(){this.onSkip(),this.close()}handleComplete(){this.onComplete(),this.close()}getIconForStep(e){return["sparkles","pencil","search","target","layers"][e]||"info"}onClose(){let{contentEl:e}=this;e.empty()}};function Ve(){return[{title:"Welcome to Flashly!",content:`
				<p>Flashly helps you create and review flashcards directly in Obsidian.</p>
				<p>This quick tutorial will show you:</p>
				<ul>
					<li>How to create flashcards</li>
					<li>How to review them</li>
					<li>How to manage your decks</li>
				</ul>
				<p><strong>Let's get started!</strong></p>
			`},{title:"Creating flashcards",content:`
				<p>There are three ways to create flashcards:</p>
				
				<p><strong>1. Q&A format:</strong> <code>Question::Answer</code></p>
				<p style="margin-left: 20px; font-style: italic;">What is the capital of France?::Paris</p>
				
				<p><strong>2. Cloze deletions:</strong> Use <code>{curly braces}</code></p>
				<p style="margin-left: 20px; font-style: italic;">The capital of France is {Paris}.</p>
				
				<p><strong>3. Header-based:</strong> Questions under tagged headers</p>
				<p style="margin-left: 20px; font-style: italic;">Add #flashcards tag to a header, then list questions below</p>
				
				<p><strong>Try creating your first flashcard now!</strong></p>
			`},{title:"Scanning your vault",content:`
				<p>Once you've created flashcards, run the scan command:</p>
				<ol>
					<li>Press <kbd>Ctrl/Cmd + P</kbd></li>
					<li>Type "Flashly: scan vault for flashcards"</li>
					<li>Press <kbd>Enter</kbd></li>
				</ol>
				
				<p>Flashly will find all flashcards in your notes.</p>
				
				<p><strong>Tip:</strong> You can also use the ribbon icon to open the flashcard browser, which automatically scans.</p>
			`},{title:"Reviewing flashcards",content:`
				<p>To start reviewing:</p>
				<ul>
					<li>Press <kbd>Ctrl/Cmd + P</kbd></li>
					<li>Type "Flashly: start review session"</li>
					<li>Or click the status bar showing due cards</li>
				</ul>
				
				<p><strong>During review:</strong></p>
				<ul>
					<li><kbd>Spacebar</kbd>: Show answer</li>
					<li><kbd>1-4</kbd>: Rate your recall (1=again, 4=easy)</li>
					<li><kbd>Esc</kbd>: Exit review</li>
				</ul>
				
				<p>Flashly uses the FSRS algorithm for optimal scheduling!</p>
			`},{title:"Flashcard browser & more",content:`
				<p>The flashcard browser lets you:</p>
				<ul>
					<li>View all your cards and decks</li>
					<li>Edit or delete cards</li>
					<li>Filter by deck, tags, or status</li>
					<li>Export to Anki, Quizlet, or CSV</li>
					<li>View statistics</li>
				</ul>
				
				<p>Open it from the ribbon icon (layers) or command palette.</p>
				
				<p><strong>You're ready to start learning! Happy studying!</strong></p>
				
				<p style="margin-top: 20px; font-size: 12px; color: var(--text-muted);">
					You can replay this tutorial anytime from Settings \u2192 Flashly
				</p>
			`}]}var gt=class extends se.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new se.Setting(e).setName("Inline flashcards").setHeading(),new se.Setting(e).setName("Enable inline flashcards").setDesc("Parse Q::A, ??, and {cloze} formats").addToggle(t=>t.setValue(this.plugin.settings.parser.inline.enabled).onChange(async s=>{this.plugin.settings.parser.inline.enabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.parser.inline.enabled&&(new se.Setting(e).setName("Enable q::a format").setDesc("Single-line question::answer format").addToggle(t=>t.setValue(this.plugin.settings.parser.inline.enableQA).onChange(async s=>{this.plugin.settings.parser.inline.enableQA=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Enable ?? Format").setDesc("Multi-line question/answer format").addToggle(t=>t.setValue(this.plugin.settings.parser.inline.enableMultiLine).onChange(async s=>{this.plugin.settings.parser.inline.enableMultiLine=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Enable {cloze} format").setDesc("Cloze deletion format").addToggle(t=>t.setValue(this.plugin.settings.parser.inline.enableCloze).onChange(async s=>{this.plugin.settings.parser.inline.enableCloze=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Create empty cards").setDesc("Create flashcards even when answer is empty").addToggle(t=>t.setValue(this.plugin.settings.parser.inline.createEmptyCards).onChange(async s=>{this.plugin.settings.parser.inline.createEmptyCards=s,await this.plugin.saveSettings()}))),new se.Setting(e).setName("Header-based flashcards").setHeading(),new se.Setting(e).setName("Enable header-based flashcards").setDesc("Convert headers in tagged notes to flashcards").addToggle(t=>t.setValue(this.plugin.settings.parser.header.enabled).onChange(async s=>{this.plugin.settings.parser.header.enabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.parser.header.enabled&&(new se.Setting(e).setName("Flashcard tags").setDesc("Tags that mark notes for header parsing (comma-separated)").addText(t=>t.setPlaceholder("Flashcards, cards").setValue(this.plugin.settings.parser.header.flashcardTags.join(", ")).onChange(async s=>{this.plugin.settings.parser.header.flashcardTags=s.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})),new se.Setting(e).setName("Header levels").setDesc("Which header levels to convert (2-6, comma-separated)").addText(t=>t.setPlaceholder("2, 3, 4, 5, 6").setValue(this.plugin.settings.parser.header.headerLevels.join(", ")).onChange(async s=>{let i=s.split(",").map(n=>parseInt(n.trim())).filter(n=>n>=2&&n<=6);this.plugin.settings.parser.header.headerLevels=i,await this.plugin.saveSettings()})),new se.Setting(e).setName("Deck name priority").setDesc("Order to determine deck name: frontmatter, title, subtags").addDropdown(t=>t.addOption("frontmatter,title,subtags","Frontmatter \u2192 title \u2192 subtags").addOption("title,frontmatter,subtags","Title \u2192 frontmatter \u2192 subtags").addOption("frontmatter,subtags,title","Frontmatter \u2192 subtags \u2192 title").setValue(this.plugin.settings.parser.header.deckNamePriority.join(",")).onChange(async s=>{this.plugin.settings.parser.header.deckNamePriority=s.split(","),await this.plugin.saveSettings()})),new se.Setting(e).setName("Use subtags for deck names").setDesc("Use #flashcards/math as deck name").addToggle(t=>t.setValue(this.plugin.settings.parser.header.useSubtags).onChange(async s=>{this.plugin.settings.parser.header.useSubtags=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Answer terminator").setDesc("How to determine where answer ends").addDropdown(t=>t.addOption("next-header","Next header").addOption("blank-line","Blank line").addOption("hr","Horizontal rule").setValue(this.plugin.settings.parser.header.answerTerminator).onChange(async s=>{this.plugin.settings.parser.header.answerTerminator=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Create empty cards").setDesc("Create flashcards even when answer is empty").addToggle(t=>t.setValue(this.plugin.settings.parser.header.createEmptyCards).onChange(async s=>{this.plugin.settings.parser.header.createEmptyCards=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Enable exclusion comments").setDesc("Allow %%no_flashcard%% to skip headers").addToggle(t=>t.setValue(this.plugin.settings.parser.header.enableExclusion).onChange(async s=>{this.plugin.settings.parser.header.enableExclusion=s,await this.plugin.saveSettings()})),this.plugin.settings.parser.header.enableExclusion&&new se.Setting(e).setName("Exclusion comment").setDesc("Comment text to exclude headers").addText(t=>t.setPlaceholder("%%no_flashcard%%").setValue(this.plugin.settings.parser.header.exclusionComment).onChange(async s=>{this.plugin.settings.parser.header.exclusionComment=s,await this.plugin.saveSettings()}))),new se.Setting(e).setName("Advanced").setHeading(),new se.Setting(e).setName("Allow mixed formats").setDesc("Allow both inline and header flashcards in same note").addToggle(t=>t.setValue(this.plugin.settings.parser.mixedFormats).onChange(async s=>{this.plugin.settings.parser.mixedFormats=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Review sessions").setHeading(),new se.Setting(e).setName("Scheduler algorithm").setDesc("Choose between fsrs (default) or sm-2 fallback").addDropdown(t=>{let s=this.plugin.settings.review.scheduler;t.addOption("fsrs","Fsrs (recommended)"),t.addOption("sm2","Sm-2 fallback"),t.setValue(s),t.onChange(async i=>{this.plugin.settings.review.scheduler=i,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Daily due limit").setDesc("Maximum number of due cards per review session").addText(t=>{t.inputEl.type="number",t.setPlaceholder("100"),t.setValue(String(this.plugin.settings.review.limits.reviewPerDay)),t.onChange(async s=>{let i=parseInt(s,10);this.plugin.settings.review.limits.reviewPerDay=Number.isNaN(i)?0:Math.max(0,i),await this.plugin.saveSettings()})}),new se.Setting(e).setName("Daily new limit").setDesc("Maximum number of new cards introduced per session").addText(t=>{t.inputEl.type="number",t.setPlaceholder("20"),t.setValue(String(this.plugin.settings.review.limits.newPerDay)),t.onChange(async s=>{let i=parseInt(s,10);this.plugin.settings.review.limits.newPerDay=Number.isNaN(i)?0:Math.max(0,i),await this.plugin.saveSettings()})}),new se.Setting(e).setName("Include learning cards").setDesc("Keep cards in learning steps within the queue").addToggle(t=>t.setValue(this.plugin.settings.review.includeLearningCards).onChange(async s=>{this.plugin.settings.review.includeLearningCards=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Ignore empty answers").setDesc("Skip cards without answers until filled in").addToggle(t=>t.setValue(this.plugin.settings.review.excludeEmptyCards).onChange(async s=>{this.plugin.settings.review.excludeEmptyCards=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Deck filter").setDesc("Only review specific decks (comma-separated, leave blank for all decks)").addText(t=>{t.setPlaceholder("Biology, chemistry"),t.setValue(this.plugin.settings.review.deckFilter.join(", ")),t.onChange(async s=>{this.plugin.settings.review.deckFilter=s.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})}),new se.Setting(e).setName("Keyboard shortcuts").setDesc("Enable keyboard controls (space, 1-4, esc) in review sessions").addToggle(t=>t.setValue(this.plugin.settings.review.enableKeyboardShortcuts).onChange(async s=>{this.plugin.settings.review.enableKeyboardShortcuts=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Quiz generation (AI-powered)").setHeading(),new se.Setting(e).setName("Enable AI quiz generation").setDesc("Use AI to generate quiz questions from your flashcards").addToggle(t=>t.setValue(this.plugin.settings.quiz.enabled).onChange(async s=>{this.plugin.settings.quiz.enabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.quiz.enabled&&(new se.Setting(e).setName("AI provider").setDesc("Choose your AI provider for quiz generation").addDropdown(t=>t.addOption("openai","Openai (gpt-4, gpt-3.5)").addOption("anthropic","Anthropic (claude)").addOption("gemini","Google gemini").addOption("custom","Custom API endpoint").setValue(this.plugin.settings.quiz.provider).onChange(async s=>{this.plugin.settings.quiz.provider=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.quiz.provider==="openai"&&(new se.Setting(e).setName("Openai configuration").setHeading(),new se.Setting(e).setName("API key").setDesc("Your openai API key").addText(t=>{t.inputEl.type="password",t.setPlaceholder("Sk-..."),t.setValue(this.plugin.settings.quiz.openai?.apiKey||""),t.onChange(async s=>{this.plugin.settings.quiz.openai||(this.plugin.settings.quiz.openai={apiKey:"",model:"gpt-4"}),this.plugin.settings.quiz.openai.apiKey=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Model").setDesc("Openai model to use").addDropdown(t=>t.addOption("gpt-4","Gpt-4 (most capable)").addOption("gpt-4-turbo","Gpt-4 turbo (faster)").addOption("gpt-3.5-turbo","Gpt-3.5 turbo (cheaper)").setValue(this.plugin.settings.quiz.openai?.model||"gpt-4").onChange(async s=>{this.plugin.settings.quiz.openai||(this.plugin.settings.quiz.openai={apiKey:"",model:"gpt-4"}),this.plugin.settings.quiz.openai.model=s,await this.plugin.saveSettings()}))),this.plugin.settings.quiz.provider==="anthropic"&&(new se.Setting(e).setName("Anthropic configuration").setHeading(),new se.Setting(e).setName("API key").setDesc("Your anthropic API key").addText(t=>{t.inputEl.type="password",t.setPlaceholder("Sk-ant-..."),t.setValue(this.plugin.settings.quiz.anthropic?.apiKey||""),t.onChange(async s=>{this.plugin.settings.quiz.anthropic||(this.plugin.settings.quiz.anthropic={apiKey:"",model:"claude-3-5-sonnet-20241022"}),this.plugin.settings.quiz.anthropic.apiKey=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Model").setDesc("Anthropic model to use").addDropdown(t=>t.addOption("claude-3-5-sonnet-20241022","Claude 3.5 sonnet").addOption("claude-3-opus-20240229","Claude 3 opus").addOption("claude-3-sonnet-20240229","Claude 3 sonnet").addOption("claude-3-haiku-20240307","Claude 3 haiku").setValue(this.plugin.settings.quiz.anthropic?.model||"claude-3-5-sonnet-20241022").onChange(async s=>{this.plugin.settings.quiz.anthropic||(this.plugin.settings.quiz.anthropic={apiKey:"",model:"claude-3-5-sonnet-20241022"}),this.plugin.settings.quiz.anthropic.model=s,await this.plugin.saveSettings()}))),this.plugin.settings.quiz.provider==="gemini"&&(new se.Setting(e).setName("Google gemini configuration").setHeading(),new se.Setting(e).setName("API key").setDesc("Your google AI studio API key").addText(t=>{t.inputEl.type="password",t.setPlaceholder("Aiza..."),t.setValue(this.plugin.settings.quiz.gemini?.apiKey||""),t.onChange(async s=>{this.plugin.settings.quiz.gemini||(this.plugin.settings.quiz.gemini={apiKey:"",model:"gemini-1.5-pro"}),this.plugin.settings.quiz.gemini.apiKey=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Model").setDesc("Gemini model to use").addDropdown(t=>t.addOption("gemini-2.5-pro","Gemini 2.5 pro (most capable, reasoning)").addOption("gemini-2.5-flash","Gemini 2.5 Flash (fast, best price/performance)").addOption("gemini-2.0-flash","Gemini 2.0 flash").addOption("gemini-1.5-pro","Gemini 1.5 pro (legacy)").addOption("gemini-1.5-flash","Gemini 1.5 flash (legacy)").setValue(this.plugin.settings.quiz.gemini?.model||"gemini-2.5-flash").onChange(async s=>{this.plugin.settings.quiz.gemini||(this.plugin.settings.quiz.gemini={apiKey:"",model:"gemini-1.5-pro"}),this.plugin.settings.quiz.gemini.model=s,await this.plugin.saveSettings()}))),this.plugin.settings.quiz.provider==="custom"&&(new se.Setting(e).setName("Custom API configuration").setHeading(),new se.Setting(e).setName("API key").setDesc("Your API key").addText(t=>{t.inputEl.type="password",t.setPlaceholder("Enter API key"),t.setValue(this.plugin.settings.quiz.custom?.apiKey||""),t.onChange(async s=>{this.plugin.settings.quiz.custom||(this.plugin.settings.quiz.custom={apiKey:"",model:"",baseUrl:""}),this.plugin.settings.quiz.custom.apiKey=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Base URL").setDesc("API endpoint URL").addText(t=>{t.setPlaceholder("https://api.example.com/v1"),t.setValue(this.plugin.settings.quiz.custom?.baseUrl||""),t.onChange(async s=>{this.plugin.settings.quiz.custom||(this.plugin.settings.quiz.custom={apiKey:"",model:"",baseUrl:""}),this.plugin.settings.quiz.custom.baseUrl=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Model name").setDesc("Model identifier").addText(t=>{t.setPlaceholder("Model-name"),t.setValue(this.plugin.settings.quiz.custom?.model||""),t.onChange(async s=>{this.plugin.settings.quiz.custom||(this.plugin.settings.quiz.custom={apiKey:"",model:"",baseUrl:""}),this.plugin.settings.quiz.custom.model=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("Endpoint path (optional)").setDesc("API endpoint path (defaults to /chat/completions if not specified)").addText(t=>{t.setPlaceholder("/chat/completions"),t.setValue(this.plugin.settings.quiz.custom?.endpoint||""),t.onChange(async s=>{this.plugin.settings.quiz.custom||(this.plugin.settings.quiz.custom={apiKey:"",model:"",baseUrl:""}),this.plugin.settings.quiz.custom.endpoint=s,await this.plugin.saveSettings()})})),new se.Setting(e).setName("Advanced").setHeading(),new se.Setting(e).setName("Temperature").setDesc("Creativity level (0-1). Higher = more creative, lower = more focused").addSlider(t=>t.setLimits(0,1,.1).setValue(this.plugin.settings.quiz.temperature).setDynamicTooltip().onChange(async s=>{this.plugin.settings.quiz.temperature=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Max tokens").setDesc("Maximum response length").addText(t=>{t.inputEl.type="number",t.setPlaceholder("2000"),t.setValue(String(this.plugin.settings.quiz.maxTokens)),t.onChange(async s=>{let i=parseInt(s,10);this.plugin.settings.quiz.maxTokens=Number.isNaN(i)?2e3:i,await this.plugin.saveSettings()})}),new se.Setting(e).setName("System prompt").setDesc("Custom instructions for the AI (optional)").addTextArea(t=>{t.setPlaceholder("You are a helpful assistant..."),t.setValue(this.plugin.settings.quiz.systemPrompt||""),t.onChange(async s=>{this.plugin.settings.quiz.systemPrompt=s,await this.plugin.saveSettings()}),t.inputEl.rows=4})),new se.Setting(e).setName("Flashcard browser").setHeading(),new se.Setting(e).setName("Default deck sort").setDesc("Default sorting for the deck list in the browser").addDropdown(t=>t.addOption("name-asc","Name (A-Z)").addOption("name-desc","Name (Z-A)").addOption("cards-desc","Most cards").addOption("cards-asc","Fewest cards").addOption("due-desc","Most due").addOption("due-asc","Least due").addOption("new-desc","Most new cards").addOption("new-asc","Fewest new cards").addOption("studied-desc","Recently studied").addOption("studied-asc","Least recently studied").setValue(this.plugin.settings.browser.defaultDeckSort).onChange(async s=>{this.plugin.settings.browser.defaultDeckSort=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Default card sort").setDesc("Default sorting for cards when viewing a deck").addDropdown(t=>t.addOption("created-desc","Most recently made").addOption("created-asc","Oldest first").addOption("updated-desc","Recently updated").addOption("updated-asc","Least recently updated").addOption("due-asc","Due soonest").addOption("due-desc","Due latest").addOption("deck-asc","Deck (A-Z)").addOption("deck-desc","Deck (Z-A)").setValue(this.plugin.settings.browser.defaultSort).onChange(async s=>{this.plugin.settings.browser.defaultSort=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Show deck hierarchy").setDesc("Display decks in hierarchical structure with visual grouping (e.g., Math/Algebra)").addToggle(t=>t.setValue(this.plugin.settings.browser.showHierarchy).onChange(async s=>{this.plugin.settings.browser.showHierarchy=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Show full deck paths").setDesc('Show "Math/Algebra" instead of just "Algebra" in deck names').addToggle(t=>t.setValue(this.plugin.settings.browser.hierarchyShowFullPath).onChange(async s=>{this.plugin.settings.browser.hierarchyShowFullPath=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Parent deck review behavior").setDesc("What to do when reviewing a deck that has sub-decks").addDropdown(t=>t.addOption("ask","Ask each time").addOption("all","Always include sub-decks").addOption("direct","Only direct cards").setValue(this.plugin.settings.browser.parentDeckDefaultBehavior).onChange(async s=>{this.plugin.settings.browser.parentDeckDefaultBehavior=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Tutorial").setHeading(),new se.Setting(e).setName("Replay tutorial").setDesc("Show the first-time user tutorial again").addButton(t=>t.setButtonText("Replay tutorial").setTooltip("Replay the interactive tutorial").onClick(()=>{new Pe(this.app,{steps:Ve(),onComplete:()=>{},onSkip:()=>{}}).open()})),new se.Setting(e).setName("Developer").setHeading(),new se.Setting(e).setName("Enable debug logging").setDesc("Show detailed debug logs in the console (useful for troubleshooting)").addToggle(t=>t.setValue(this.plugin.settings.developer.enableDebugLogging).onChange(async s=>{this.plugin.settings.developer.enableDebugLogging=s,await this.plugin.saveSettings()}))}};var mt={totalSessions:0,totalReviews:0,totalDueReviewed:0,totalNewReviewed:0,cardsReviewedToday:0,lastReviewDate:null},vt=class{constructor(r){this.cards=new Map;this.reviewStats={...mt};this.plugin=r}async load(){let r=await this.plugin.loadData();if(!r||!r.cards){this.cards=new Map,this.reviewStats={...mt};return}for(let[e,t]of Object.entries(r.cards))this.cards.set(e,this.deserializeCard(t));r.reviewStats?this.reviewStats={...mt,...r.reviewStats}:this.reviewStats={...mt}}async save(){let r=await this.plugin.loadData()||{},e={cards:{},lastSync:Date.now(),reviewStats:this.reviewStats};for(let[s,i]of this.cards.entries())e.cards[s]=this.serializeCard(i);let t={...r,...e};await this.plugin.saveData(t)}addCard(r){this.cards.set(r.id,r)}addCards(r){for(let e of r)this.cards.set(e.id,e)}getCard(r){return this.cards.get(r)}getAllCards(){return Array.from(this.cards.values())}updateCard(r,e){let t=this.cards.get(r);if(!t)return;let s={...t,...e,updated:new Date};this.cards.set(r,s)}deleteCard(r){this.cards.delete(r)}getCardsByDeck(r){return this.getAllCards().filter(e=>e.deck===r)}getCardsByTag(r){return this.getAllCards().filter(e=>e.tags.includes(r))}getCardsByFile(r){return this.getAllCards().filter(e=>e.source.file===r)}getCardsNeedingFilling(){return this.getAllCards().filter(r=>r.needsFilling)}getCardCount(){return this.cards.size}getDeckNames(){let r=new Set;for(let e of this.cards.values())r.add(e.deck);return Array.from(r)}getStatistics(){return{totalCards:this.getCardCount(),totalDecks:this.getDeckNames().length,cardsNeedingFilling:this.getCardsNeedingFilling().length}}getReviewStatistics(){return{...this.reviewStats}}recordReviewSession(r){let t=(r.finishedAt??r.startedAt??new Date).toISOString();this.isSameDay(t,this.reviewStats.lastReviewDate)||(this.reviewStats.cardsReviewedToday=0),this.reviewStats.totalSessions+=1,this.reviewStats.totalReviews+=r.totalReviewed,this.reviewStats.totalDueReviewed+=r.reviewedDue,this.reviewStats.totalNewReviewed+=r.reviewedNew,this.reviewStats.cardsReviewedToday+=r.totalReviewed,this.reviewStats.lastReviewDate=t}isSameDay(r,e){if(!r||!e)return!1;let t=new Date(r),s=new Date(e);return t.getUTCFullYear()===s.getUTCFullYear()&&t.getUTCMonth()===s.getUTCMonth()&&t.getUTCDate()===s.getUTCDate()}serializeCard(r){return{id:r.id,front:r.front,back:r.back,deck:r.deck,tags:r.tags,needsFilling:r.needsFilling,source:r.source,fsrsCard:r.fsrsCard,created:r.created.toISOString(),updated:r.updated.toISOString()}}deserializeCard(r){let e={...r.fsrsCard,due:new Date(r.fsrsCard.due),last_review:r.fsrsCard.last_review?new Date(r.fsrsCard.last_review):void 0};return{id:r.id,front:r.front,back:r.back,deck:r.deck,tags:r.tags,needsFilling:r.needsFilling,source:r.source,fsrsCard:e,created:new Date(r.created),updated:new Date(r.updated)}}};var J=(o=>(o[o.New=0]="New",o[o.Learning=1]="Learning",o[o.Review=2]="Review",o[o.Relearning=3]="Relearning",o))(J||{}),q=(o=>(o[o.Manual=0]="Manual",o[o.Again=1]="Again",o[o.Hard=2]="Hard",o[o.Good=3]="Good",o[o.Easy=4]="Easy",o))(q||{}),ae=class{static card(r){return{...r,state:ae.state(r.state),due:ae.time(r.due),last_review:r.last_review?ae.time(r.last_review):void 0}}static rating(r){if(typeof r=="string"){let e=r.charAt(0).toUpperCase(),t=r.slice(1).toLowerCase(),s=q[`${e}${t}`];if(s===void 0)throw new Error(`Invalid rating:[${r}]`);return s}else if(typeof r=="number")return r;throw new Error(`Invalid rating:[${r}]`)}static state(r){if(typeof r=="string"){let e=r.charAt(0).toUpperCase(),t=r.slice(1).toLowerCase(),s=J[`${e}${t}`];if(s===void 0)throw new Error(`Invalid state:[${r}]`);return s}else if(typeof r=="number")return r;throw new Error(`Invalid state:[${r}]`)}static time(r){let e=new Date(r);if(typeof r=="object"&&r!==null&&!Number.isNaN(Date.parse(r)||+e))return e;if(typeof r=="string"){let t=Date.parse(r);if(Number.isNaN(t))throw new Error(`Invalid date:[${r}]`);return new Date(t)}else if(typeof r=="number")return new Date(r);throw new Error(`Invalid date:[${r}]`)}static review_log(r){return{...r,due:ae.time(r.due),rating:ae.rating(r.rating),state:ae.state(r.state),review:ae.time(r.review)}}};Date.prototype.scheduler=function(o,r){return Ee(this,o,r)};Date.prototype.diff=function(o,r){return We(this,o,r)};Date.prototype.format=function(){return yi(this)};Date.prototype.dueFormat=function(o,r,e){return bi(this,o,r,e)};function Ee(o,r,e){return new Date(e?ae.time(o).getTime()+r*24*60*60*1e3:ae.time(o).getTime()+r*60*1e3)}function We(o,r,e){if(!o||!r)throw new Error("Invalid date");let t=ae.time(o).getTime()-ae.time(r).getTime(),s=0;switch(e){case"days":s=Math.floor(t/(24*60*60*1e3));break;case"minutes":s=Math.floor(t/(60*1e3));break}return s}function yi(o){let r=ae.time(o),e=r.getFullYear(),t=r.getMonth()+1,s=r.getDate(),i=r.getHours(),n=r.getMinutes(),a=r.getSeconds();return`${e}-${nt(t)}-${nt(s)} ${nt(i)}:${nt(n)}:${nt(a)}`}function nt(o){return o<10?`0${o}`:`${o}`}var xr=[60,60,24,31,12],Er=["second","min","hour","day","month","year"];function bi(o,r,e,t=Er){o=ae.time(o),r=ae.time(r),t.length!==Er.length&&(t=Er);let s=o.getTime()-r.getTime(),i=0;for(s/=1e3,i=0;i<xr.length&&!(s<xr[i]);i++)s/=xr[i];return`${Math.floor(s)}${e?t[i]:""}`}var ki=Object.freeze([q.Again,q.Hard,q.Good,q.Easy]),_i=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function Ci(o,r,e){let t=1;for(let n of _i)t+=n.factor*Math.max(Math.min(o,n.end)-n.start,0);o=Math.min(o,e);let s=Math.max(2,Math.round(o-t)),i=Math.min(Math.round(o+t),e);return o>r&&(s=Math.max(s,r+1)),s=Math.min(s,i),{min_ivl:s,max_ivl:i}}function Se(o,r,e){return Math.min(Math.max(o,r),e)}function Si(o,r){let e=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),t=Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate());return Math.floor((t-e)/864e5)}var xi=o=>{let r=o.slice(-1),e=parseInt(o.slice(0,-1),10);if(Number.isNaN(e)||!Number.isFinite(e)||e<0)throw new Error(`Invalid step value: ${o}`);switch(r){case"m":return e;case"h":return e*60;case"d":return e*1440;default:throw new Error(`Invalid step unit: ${o}, expected m/h/d`)}},Ei=(o,r,e)=>{let t=r===J.Relearning||r===J.Review?o.relearning_steps:o.learning_steps,s=t.length;if(s===0||e>=s)return{};let i=t[0],n=xi,a=()=>n(i),l=()=>{if(s===1)return Math.round(n(i)*1.5);let d=t[1];return Math.round((n(i)+n(d))/2)},h=d=>d<0||d>=s?null:t[d],p=d=>n(d),u={},m=h(Math.max(0,e));if(r===J.Review)return u[q.Again]={scheduled_minutes:n(m),next_step:0},u;{u[q.Again]={scheduled_minutes:a(),next_step:0},u[q.Hard]={scheduled_minutes:l(),next_step:e};let d=h(e+1);if(d){let g=p(d);g&&(u[q.Good]={scheduled_minutes:Math.round(g),next_step:e+1})}}return u};function Di(){let o=this.review_time.getTime(),r=this.current.reps,e=this.current.difficulty*this.current.stability;return`${o}_${r}_${e}`}var St=(o=>(o.SCHEDULER="Scheduler",o.LEARNING_STEPS="LearningSteps",o.SEED="Seed",o))(St||{}),yt=class{constructor(r,e,t,s){X(this,"last");X(this,"current");X(this,"review_time");X(this,"next",new Map);X(this,"algorithm");X(this,"strategies");X(this,"elapsed_days",0);this.algorithm=t,this.last=ae.card(r),this.current=ae.card(r),this.review_time=ae.time(e),this.strategies=s,this.init()}checkGrade(r){if(!Number.isFinite(r)||r<0||r>4)throw new Error(`Invalid grade "${r}",expected 1-4`)}init(){let{state:r,last_review:e}=this.current,t=0;r!==J.New&&e&&(t=Si(e,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=t,this.current.elapsed_days=t,this.current.reps+=1;let s=Di;if(this.strategies){let i=this.strategies.get(St.SEED);i&&(s=i)}this.algorithm.seed=s.call(this)}preview(){return{[q.Again]:this.review(q.Again),[q.Hard]:this.review(q.Hard),[q.Good]:this.review(q.Good),[q.Easy]:this.review(q.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let r of ki)yield this.review(r)}review(r){let{state:e}=this.last,t;switch(this.checkGrade(r),e){case J.New:t=this.newState(r);break;case J.Learning:case J.Relearning:t=this.learningState(r);break;case J.Review:t=this.reviewState(r);break}return t}buildLog(r){let{last_review:e,due:t,elapsed_days:s}=this.last;return{rating:r,state:this.current.state,due:e||t,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:s,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}},Tr=class{constructor(r){X(this,"c");X(this,"s0");X(this,"s1");X(this,"s2");let e=Ti();this.c=1,this.s0=e(" "),this.s1=e(" "),this.s2=e(" "),r==null&&(r=Date.now()),this.s0-=e(r),this.s0<0&&(this.s0+=1),this.s1-=e(r),this.s1<0&&(this.s1+=1),this.s2-=e(r),this.s2<0&&(this.s2+=1)}next(){let r=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.c=r|0,this.s2=r-this.c,this.s2}set state(r){this.c=r.c,this.s0=r.s0,this.s1=r.s1,this.s2=r.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function Ti(){let o=4022871197;return function(e){e=String(e);for(let t=0;t<e.length;t++){o+=e.charCodeAt(t);let s=.02519603282416938*o;o=s>>>0,s-=o,s*=o,o=s>>>0,s-=o,o+=s*4294967296}return(o>>>0)*23283064365386963e-26}}function zi(o){let r=new Tr(o),e=()=>r.next();return e.int32=()=>r.next()*4294967296|0,e.double=()=>e()+(e()*2097152|0)*11102230246251565e-32,e.state=()=>r.state,e.importState=t=>(r.state=t,e),e}var Ai="5.2.3",Ii=.9,Fi=36500,Oi=!1,xt=!0,Ri=Object.freeze(["1m","10m"]),Ni=Object.freeze(["10m"]),On=`v${Ai} using FSRS-6.0`,De=.001;var wt=100,as=.5,Li=.1542,os=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,Li]),Mi=2,Pi=(o,r=xt)=>[[De,wt],[De,wt],[De,wt],[De,wt],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,o],[0,o],[r?.01:0,.8],[.1,.8]],Dr=(o,r,e=xt)=>{let t=Mi;if(Math.max(0,r)>1){let i=-(Math.log(o[11])+Math.log(Math.pow(2,o[13])-1)+o[14]*.3)/r;t=Se(+i.toFixed(8),.01,2)}return Pi(t,e).slice(0,o.length).map(([i,n],a)=>Se(o[a]||0,i,n))};var Fr=(o,r=0,e=xt)=>{if(o===void 0)return[...os];switch(o.length){case 21:return Dr(Array.from(o),r,e);case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),Dr(Array.from(o),r,e).concat([0,as]);case 17:{let t=Dr(Array.from(o),r,e);return t[4]=+(t[5]*2+t[4]).toFixed(8),t[5]=+(Math.log(t[5]*3+1)/3).toFixed(8),t[6]=+(t[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),t.concat([0,0,0,as])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...os]}},bt=o=>{let r=Array.isArray(o?.learning_steps)?o.learning_steps:Ri,e=Array.isArray(o?.relearning_steps)?o.relearning_steps:Ni,t=o?.enable_short_term??xt,s=Fr(o?.w,e.length,t);return{request_retention:o?.request_retention||Ii,maximum_interval:o?.maximum_interval||Fi,w:s,enable_fuzz:o?.enable_fuzz??Oi,enable_short_term:t,learning_steps:r,relearning_steps:e}};function Ne(o,r){let e={due:o?ae.time(o):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:J.New,last_review:void 0};return r&&typeof r=="function"?r(e):e}var ls=o=>{let r=typeof o=="number"?-o:-o[20],e=Math.exp(Math.pow(r,-1)*Math.log(.9))-1;return{decay:r,factor:+e.toFixed(8)}};function zr(o,r,e){let{decay:t,factor:s}=ls(o);return+Math.pow(1+s*r/e,t).toFixed(8)}var Ar=class{constructor(r){X(this,"param");X(this,"intervalModifier");X(this,"_seed");X(this,"forgetting_curve");this.param=new Proxy(bt(r),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=zr.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(r){this._seed=r}calculate_interval_modifier(r){if(r<=0||r>1)throw new Error("Requested retention rate should be in the range (0,1]");let{decay:e,factor:t}=ls(this.param.w);return+((Math.pow(r,1/e)-1)/t).toFixed(8)}get parameters(){return this.param}set parameters(r){this.update_parameters(r)}params_handler_proxy(){let r=this;return{set:function(e,t,s){return t==="request_retention"&&Number.isFinite(s)?r.intervalModifier=r.calculate_interval_modifier(Number(s)):t==="w"&&(s=Fr(s,e.relearning_steps.length,e.enable_short_term),r.forgetting_curve=zr.bind(this,s),r.intervalModifier=r.calculate_interval_modifier(Number(e.request_retention))),Reflect.set(e,t,s),!0}}}update_parameters(r){let e=bt(r);for(let t in e){let s=t;this.param[s]=e[s]}}init_stability(r){return Math.max(this.param.w[r-1],.1)}init_difficulty(r){return+(this.param.w[4]-Math.exp((r-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(r,e){if(!this.param.enable_fuzz||r<2.5)return Math.round(r);let s=zi(this._seed)(),{min_ivl:i,max_ivl:n}=Ci(r,e,this.param.maximum_interval);return Math.floor(s*(n-i+1)+i)}next_interval(r,e){let t=Math.min(Math.max(1,Math.round(r*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(t,e)}linear_damping(r,e){return+(r*(10-e)/9).toFixed(8)}next_difficulty(r,e){let t=-this.param.w[6]*(e-3),s=r+this.linear_damping(t,r);return Se(this.mean_reversion(this.init_difficulty(q.Easy),s),1,10)}mean_reversion(r,e){return+(this.param.w[7]*r+(1-this.param.w[7])*e).toFixed(8)}next_recall_stability(r,e,t,s){let i=q.Hard===s?this.param.w[15]:1,n=q.Easy===s?this.param.w[16]:1;return+Se(e*(1+Math.exp(this.param.w[8])*(11-r)*Math.pow(e,-this.param.w[9])*(Math.exp((1-t)*this.param.w[10])-1)*i*n),De,36500).toFixed(8)}next_forget_stability(r,e,t){return+Se(this.param.w[11]*Math.pow(r,-this.param.w[12])*(Math.pow(e+1,this.param.w[13])-1)*Math.exp((1-t)*this.param.w[14]),De,36500).toFixed(8)}next_short_term_stability(r,e){let t=Math.pow(r,-this.param.w[19])*Math.exp(this.param.w[17]*(e-3+this.param.w[18])),s=e>=3?Math.max(t,1):t;return+Se(r*s,De,36500).toFixed(8)}next_state(r,e,t){let{difficulty:s,stability:i}=r??{difficulty:0,stability:0};if(e<0)throw new Error(`Invalid delta_t "${e}"`);if(t<0||t>4)throw new Error(`Invalid grade "${t}"`);if(s===0&&i===0)return{difficulty:Se(this.init_difficulty(t),1,10),stability:this.init_stability(t)};if(t===0)return{difficulty:s,stability:i};if(s<1||i<De)throw new Error(`Invalid memory state { difficulty: ${s}, stability: ${i} }`);let n=this.forgetting_curve(e,i),a=this.next_recall_stability(s,i,n,t),l=this.next_forget_stability(s,i,n),h=this.next_short_term_stability(i,t),p=a;if(t===1){let[m,d]=[0,0];this.param.enable_short_term&&(m=this.param.w[17],d=this.param.w[18]);let g=i/Math.exp(m*d);p=Se(+g.toFixed(8),De,l)}return e===0&&this.param.enable_short_term&&(p=h),{difficulty:this.next_difficulty(s,t),stability:p}}},kt=class extends yt{constructor(e,t,s,i){super(e,t,s,i);X(this,"learningStepsStrategy");let n=Ei;if(this.strategies){let a=this.strategies.get(St.LEARNING_STEPS);a&&(n=a)}this.learningStepsStrategy=n}getLearningInfo(e,t){let s=this.algorithm.parameters;e.learning_steps=e.learning_steps||0;let i=this.learningStepsStrategy(s,e.state,this.current.state===J.Learning&&t!==q.Again&&t!==q.Hard?e.learning_steps+1:e.learning_steps),n=Math.max(0,i[t]?.scheduled_minutes??0),a=Math.max(0,i[t]?.next_step??0);return{scheduled_minutes:n,next_steps:a}}applyLearningSteps(e,t,s){let{scheduled_minutes:i,next_steps:n}=this.getLearningInfo(this.current,t);if(i>0&&i<1440)e.learning_steps=n,e.scheduled_days=0,e.state=s,e.due=Ee(this.review_time,Math.round(i),!1);else if(e.state=J.Review,i>=1440)e.learning_steps=n,e.due=Ee(this.review_time,Math.round(i),!1),e.scheduled_days=Math.floor(i/1440);else{e.learning_steps=0;let a=this.algorithm.next_interval(e.stability,this.elapsed_days);e.scheduled_days=a,e.due=Ee(this.review_time,a,!0)}}newState(e){let t=this.next.get(e);if(t)return t;let s=ae.card(this.current);s.difficulty=Se(this.algorithm.init_difficulty(e),1,10),s.stability=this.algorithm.init_stability(e),this.applyLearningSteps(s,e,J.Learning);let i={card:s,log:this.buildLog(e)};return this.next.set(e,i),i}learningState(e){let t=this.next.get(e);if(t)return t;let{state:s,difficulty:i,stability:n}=this.last,a=ae.card(this.current);a.difficulty=this.algorithm.next_difficulty(i,e),a.stability=this.algorithm.next_short_term_stability(n,e),this.applyLearningSteps(a,e,s);let l={card:a,log:this.buildLog(e)};return this.next.set(e,l),l}reviewState(e){let t=this.next.get(e);if(t)return t;let s=this.elapsed_days,{difficulty:i,stability:n}=this.last,a=this.algorithm.forgetting_curve(s,n),l=ae.card(this.current),h=ae.card(this.current),p=ae.card(this.current),u=ae.card(this.current);this.next_ds(l,h,p,u,i,n,a),this.next_interval(h,p,u,s),this.next_state(h,p,u),this.applyLearningSteps(l,q.Again,J.Relearning),l.lapses+=1;let m={card:l,log:this.buildLog(q.Again)},d={card:h,log:super.buildLog(q.Hard)},g={card:p,log:super.buildLog(q.Good)},v={card:u,log:super.buildLog(q.Easy)};return this.next.set(q.Again,m),this.next.set(q.Hard,d),this.next.set(q.Good,g),this.next.set(q.Easy,v),this.next.get(e)}next_ds(e,t,s,i,n,a,l){e.difficulty=this.algorithm.next_difficulty(n,q.Again);let h=a/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),p=this.algorithm.next_forget_stability(n,a,l);e.stability=Se(+h.toFixed(8),De,p),t.difficulty=this.algorithm.next_difficulty(n,q.Hard),t.stability=this.algorithm.next_recall_stability(n,a,l,q.Hard),s.difficulty=this.algorithm.next_difficulty(n,q.Good),s.stability=this.algorithm.next_recall_stability(n,a,l,q.Good),i.difficulty=this.algorithm.next_difficulty(n,q.Easy),i.stability=this.algorithm.next_recall_stability(n,a,l,q.Easy)}next_interval(e,t,s,i){let n,a;n=this.algorithm.next_interval(e.stability,i),a=this.algorithm.next_interval(t.stability,i),n=Math.min(n,a),a=Math.max(a,n+1);let l=Math.max(this.algorithm.next_interval(s.stability,i),a+1);e.scheduled_days=n,e.due=Ee(this.review_time,n,!0),t.scheduled_days=a,t.due=Ee(this.review_time,a,!0),s.scheduled_days=l,s.due=Ee(this.review_time,l,!0)}next_state(e,t,s){e.state=J.Review,e.learning_steps=0,t.state=J.Review,t.learning_steps=0,s.state=J.Review,s.learning_steps=0}},_t=class extends yt{newState(r){let e=this.next.get(r);if(e)return e;this.current.scheduled_days=0,this.current.elapsed_days=0;let t=ae.card(this.current),s=ae.card(this.current),i=ae.card(this.current),n=ae.card(this.current);this.init_ds(t,s,i,n);let a=0;return this.next_interval(t,s,i,n,a),this.next_state(t,s,i,n),this.update_next(t,s,i,n),this.next.get(r)}init_ds(r,e,t,s){r.difficulty=Se(this.algorithm.init_difficulty(q.Again),1,10),r.stability=this.algorithm.init_stability(q.Again),e.difficulty=Se(this.algorithm.init_difficulty(q.Hard),1,10),e.stability=this.algorithm.init_stability(q.Hard),t.difficulty=Se(this.algorithm.init_difficulty(q.Good),1,10),t.stability=this.algorithm.init_stability(q.Good),s.difficulty=Se(this.algorithm.init_difficulty(q.Easy),1,10),s.stability=this.algorithm.init_stability(q.Easy)}learningState(r){return this.reviewState(r)}reviewState(r){let e=this.next.get(r);if(e)return e;let t=this.elapsed_days,{difficulty:s,stability:i}=this.last,n=this.algorithm.forgetting_curve(t,i),a=ae.card(this.current),l=ae.card(this.current),h=ae.card(this.current),p=ae.card(this.current);return this.next_ds(a,l,h,p,s,i,n),this.next_interval(a,l,h,p,t),this.next_state(a,l,h,p),a.lapses+=1,this.update_next(a,l,h,p),this.next.get(r)}next_ds(r,e,t,s,i,n,a){r.difficulty=this.algorithm.next_difficulty(i,q.Again);let l=this.algorithm.next_forget_stability(i,n,a);r.stability=Se(n,De,l),e.difficulty=this.algorithm.next_difficulty(i,q.Hard),e.stability=this.algorithm.next_recall_stability(i,n,a,q.Hard),t.difficulty=this.algorithm.next_difficulty(i,q.Good),t.stability=this.algorithm.next_recall_stability(i,n,a,q.Good),s.difficulty=this.algorithm.next_difficulty(i,q.Easy),s.stability=this.algorithm.next_recall_stability(i,n,a,q.Easy)}next_interval(r,e,t,s,i){let n,a,l,h;n=this.algorithm.next_interval(r.stability,i),a=this.algorithm.next_interval(e.stability,i),l=this.algorithm.next_interval(t.stability,i),h=this.algorithm.next_interval(s.stability,i),n=Math.min(n,a),a=Math.max(a,n+1),l=Math.max(l,a+1),h=Math.max(h,l+1),r.scheduled_days=n,r.due=Ee(this.review_time,n,!0),e.scheduled_days=a,e.due=Ee(this.review_time,a,!0),t.scheduled_days=l,t.due=Ee(this.review_time,l,!0),s.scheduled_days=h,s.due=Ee(this.review_time,h,!0)}next_state(r,e,t,s){r.state=J.Review,r.learning_steps=0,e.state=J.Review,e.learning_steps=0,t.state=J.Review,t.learning_steps=0,s.state=J.Review,s.learning_steps=0}update_next(r,e,t,s){let i={card:r,log:this.buildLog(q.Again)},n={card:e,log:super.buildLog(q.Hard)},a={card:t,log:super.buildLog(q.Good)},l={card:s,log:super.buildLog(q.Easy)};this.next.set(q.Again,i),this.next.set(q.Hard,n),this.next.set(q.Good,a),this.next.set(q.Easy,l)}},Ir=class{constructor(r){X(this,"fsrs");this.fsrs=r}replay(r,e,t){return this.fsrs.next(r,e,t)}handleManualRating(r,e,t,s,i,n,a){if(typeof e>"u")throw new Error("reschedule: state is required for manual rating");let l,h;if(e===J.New)l={rating:q.Manual,state:e,due:a??t,stability:r.stability,difficulty:r.difficulty,elapsed_days:s,last_elapsed_days:r.elapsed_days,scheduled_days:r.scheduled_days,learning_steps:r.learning_steps,review:t},h=Ne(t),h.last_review=t;else{if(typeof a>"u")throw new Error("reschedule: due is required for manual rating");let p=We(a,t,"days");l={rating:q.Manual,state:r.state,due:r.last_review||r.due,stability:r.stability,difficulty:r.difficulty,elapsed_days:s,last_elapsed_days:r.elapsed_days,scheduled_days:r.scheduled_days,learning_steps:r.learning_steps,review:t},h={...r,state:e,due:a,last_review:t,stability:i||r.stability,difficulty:n||r.difficulty,elapsed_days:s,scheduled_days:p,reps:r.reps+1}}return{card:h,log:l}}reschedule(r,e){let t=[],s=Ne(r.due);for(let i of e){let n;if(i.review=ae.time(i.review),i.rating===q.Manual){let a=0;s.state!==J.New&&s.last_review&&(a=We(i.review,s.last_review,"days")),n=this.handleManualRating(s,i.state,i.review,a,i.stability,i.difficulty,i.due?ae.time(i.due):void 0)}else n=this.replay(s,i.review,i.rating);t.push(n),s=n.card}return t}calculateManualRecord(r,e,t,s){if(!t)return null;let{card:i,log:n}=t,a=ae.card(r);return a.due.getTime()===i.due.getTime()?null:(a.scheduled_days=We(i.due,a.due,"days"),this.handleManualRating(a,i.state,ae.time(e),n.elapsed_days,s?i.stability:void 0,s?i.difficulty:void 0,i.due))}},Ct=class extends Ar{constructor(e){super(e);X(this,"strategyHandler",new Map);X(this,"Scheduler");let{enable_short_term:t}=this.parameters;this.Scheduler=t?kt:_t}params_handler_proxy(){let e=this;return{set:function(t,s,i){return s==="request_retention"&&Number.isFinite(i)?e.intervalModifier=e.calculate_interval_modifier(Number(i)):s==="enable_short_term"?e.Scheduler=i===!0?kt:_t:s==="w"&&(i=Fr(i,t.relearning_steps.length,t.enable_short_term),e.forgetting_curve=zr.bind(this,i),e.intervalModifier=e.calculate_interval_modifier(Number(t.request_retention))),Reflect.set(t,s,i),!0}}}useStrategy(e,t){return this.strategyHandler.set(e,t),this}clearStrategy(e){return e?this.strategyHandler.delete(e):this.strategyHandler.clear(),this}getScheduler(e,t){let i=this.strategyHandler.get(St.SCHEDULER)||this.Scheduler;return new i(e,t,this,this.strategyHandler)}repeat(e,t,s){let n=this.getScheduler(e,t).preview();return s&&typeof s=="function"?s(n):n}next(e,t,s,i){let n=this.getScheduler(e,t),a=ae.rating(s);if(a===q.Manual)throw new Error("Cannot review a manual rating");let l=n.review(a);return i&&typeof i=="function"?i(l):l}get_retrievability(e,t,s=!0){let i=ae.card(e);t=t?ae.time(t):new Date;let n=i.state!==J.New?Math.max(We(t,i.last_review,"days"),0):0,a=i.state!==J.New?this.forgetting_curve(n,+i.stability.toFixed(8)):0;return s?`${(a*100).toFixed(2)}%`:a}rollback(e,t,s){let i=ae.card(e),n=ae.review_log(t);if(n.rating===q.Manual)throw new Error("Cannot rollback a manual rating");let a,l,h;switch(n.state){case J.New:a=n.due,l=void 0,h=0;break;case J.Learning:case J.Relearning:case J.Review:a=n.review,l=n.due,h=i.lapses-(n.rating===q.Again&&n.state===J.Review?1:0);break}let p={...i,due:a,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.last_elapsed_days,scheduled_days:n.scheduled_days,reps:Math.max(0,i.reps-1),lapses:Math.max(0,h),learning_steps:n.learning_steps,state:n.state,last_review:l};return s&&typeof s=="function"?s(p):p}forget(e,t,s=!1,i){let n=ae.card(e);t=ae.time(t);let a=n.state===J.New?0:We(t,n.due,"days"),l={rating:q.Manual,state:n.state,due:n.due,stability:n.stability,difficulty:n.difficulty,elapsed_days:0,last_elapsed_days:n.elapsed_days,scheduled_days:a,learning_steps:n.learning_steps,review:t},p={card:{...n,due:t,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:s?0:n.reps,lapses:s?0:n.lapses,learning_steps:0,state:J.New,last_review:n.last_review},log:l};return i&&typeof i=="function"?i(p):p}reschedule(e,t=[],s={}){let{recordLogHandler:i,reviewsOrderBy:n,skipManual:a=!0,now:l=new Date,update_memory_state:h=!1}=s;n&&typeof n=="function"&&t.sort(n),a&&(t=t.filter(v=>v.rating!==q.Manual));let p=new Ir(this),u=p.reschedule(s.first_card||Ne(),t),m=u.length,d=ae.card(e),g=p.calculateManualRecord(d,l,m?u[m-1]:void 0,h);return i&&typeof i=="function"?{collections:u.map(i),reschedule_item:g?i(g):null}:{collections:u,reschedule_item:g}}};function Ke(o,r,e,t,s,i="Default",n=[]){let a=`${e}:L${t}`,l=new Date,h=r.trim();return{id:a,front:o.trim(),back:h,deck:i,tags:n,needsFilling:h==="",source:{file:e,line:t},fsrsCard:s,created:l,updated:l}}function cs(o){switch(o){case J.New:return"New";case J.Learning:return"Learning";case J.Review:return"Review";case J.Relearning:return"Relearning";default:return"Unknown"}}function Tt(o,r,e,t,s){if(!r)return o.basename;for(let i of e){let n=null;switch(i){case"frontmatter":n=r.frontmatter?.deck;break;case"subtags":t&&(n=qi(r,s));break;case"title":n=o.basename;break}if(n)return Et(n)}return o.basename}function qi(o,r){let e=[];if(o.frontmatter?.tags){let t=Array.isArray(o.frontmatter.tags)?o.frontmatter.tags:[o.frontmatter.tags];e.push(...t)}o.tags&&e.push(...o.tags.map(t=>t.tag.replace(/^#/,"")));for(let t of e)for(let s of r)if(t.startsWith(`${s}/`))return t.substring(s.length+1);return null}function Et(o){return o.split("/").map(r=>r.trim()).filter(r=>r.length>0).join("/")}function zt(o){return Et(o).split("/").filter(r=>r.length>0)}function Qi(o,r){let e=Et(o).toLowerCase(),t=Et(r).toLowerCase();return e===t?!1:e.startsWith(t+"/")}function ds(o){let r=zt(o);return r.length<=1?null:r.slice(0,-1).join("/")}function Dt(o){return zt(o).length-1}function at(o,r){return r.filter(e=>Qi(e,o))}function us(o,r){let e=Dt(o);return at(o,r).filter(t=>Dt(t)===e+1)}var At=class{constructor(r,e,t){this.settings=r;this.app=e;this.flashcardTags=t}extractDeckFromPath(r){return(r.replace(/\\/g,"/").split("/").pop()||"Default").replace(/\.md$/,"")}async parseWithFile(r){if(!this.app)throw new Error("InlineParser.parseWithFile requires app instance in constructor");let e=await this.app.vault.read(r),t=this.app.metadataCache.getFileCache(r),s=Tt(r,t,["frontmatter","subtags","title"],!0,this.flashcardTags||["flashcards"]);return this.parseContent(e,r.path,s)}parse(r,e){let t=this.extractDeckFromPath(e);return this.parseContent(r,e,t)}parseContent(r,e,t){let s=[],i=r.split(`
`),n=!1,a=0;for(;a<i.length;){let l=i[a];if(l.trim().startsWith("```")){n=!n,a++;continue}if(n){a++;continue}if(!l.trim()){a++;continue}if(this.settings.enableQA){let p=this.parseQA(l,e,a+1,t);if(p){s.push(p),a++;continue}}if(this.settings.enableMultiLine&&a+1<i.length&&i[a+1].trim()==="??"){let p=this.parseMultiLine(i,a,e,t);if(p.card){s.push(p.card),a=p.endIndex;continue}}if(this.settings.enableCloze){let p=this.parseCloze(l,e,a+1,t);p.length>0&&s.push(...p)}a++}return s}parseQA(r,e,t,s){if(!r.includes("::"))return null;let i=[],n="",a=0;for(;a<r.length;)if(a<r.length-1&&r[a]===":"&&r[a+1]===":")if(a>0&&r[a-1]==="\\")n=n.slice(0,-1)+"::",a+=2;else{i.push(n),n="",a+=2,i.push(r.slice(a));break}else n+=r[a],a++;if(i.length!==2)return null;let l=i[0].trim(),h=i[1].trim();if(!l||!h&&!this.settings.createEmptyCards)return null;let p=Ne(new Date);return Ke(l,h,e,t,p,s)}parseMultiLine(r,e,t,s){let i=r[e].trim(),n=e+1;if(!i)return{card:null,endIndex:e+2};let a=[],l=e+2;for(;l<r.length;){let m=r[l].trim();if(l+1<r.length&&r[l+1].trim()==="??"||m.includes("::")&&!m.includes("\\::")||this.settings.enableCloze&&m.match(/\{[^}]+\}/))break;m?a.push(m):a.length>0&&a.push(""),l++}let h=a.join(`
`).trim();if(!h&&!this.settings.createEmptyCards)return{card:null,endIndex:l};let p=Ne(new Date);return{card:Ke(i,h,t,n,p,s),endIndex:l}}parseCloze(r,e,t,s){let i=[],n=/\{([^{}]*(?:\{[^{}]*\}[^{}]*)*)\}/g,a=Array.from(r.matchAll(n));return a.length===0||a.forEach((l,h)=>{let p=l[1],u=r,m=0;u=u.replace(n,(v,b)=>m===h?(m++,"[...]"):(m++,b));let d=Ne(new Date),g=Ke(u,p,e,t,d,s);i.push(g)}),i}};var It=class{constructor(r,e){this.settings=r;this.app=e}hasFlashcardTag(r){let e=this.app.metadataCache.getFileCache(r);if(!e)return!1;let t=[];if(e.frontmatter?.tags){let s=Array.isArray(e.frontmatter.tags)?e.frontmatter.tags:[e.frontmatter.tags];t.push(...s.filter(i=>i!=null).map(i=>String(i).trim().replace(/^#/,"")).filter(i=>i.length>0))}return e.tags&&t.push(...e.tags.map(s=>s.tag.replace(/^#/,""))),t.some(s=>this.settings.flashcardTags.some(i=>s===i||s.startsWith(`${i}/`)))}getDeckName(r,e){return Tt(r,e,this.settings.deckNamePriority,this.settings.useSubtags,this.settings.flashcardTags)}async parse(r){if(!this.hasFlashcardTag(r))return[];let e=await this.app.vault.read(r),t=this.app.metadataCache.getFileCache(r);if(!t)return[];let s=this.getDeckName(r,t),i=this.extractTags(t),n=e.split(`
`),a=this.extractHeaders(n),l=[];for(let h=0;h<a.length;h++){let p=a[h];if(!this.settings.headerLevels.includes(p.level))continue;let u=a[h+1],m=u?u.lineNumber:n.length,d=this.extractAnswer(n,p.lineNumber+1,m);if(d.trim()||this.settings.createEmptyCards){let g=Ne(new Date),v=Ke(p.text,d,r.path,p.lineNumber+1,g,s,i);l.push(v)}}return l}extractHeaders(r){let e=[],t=!1;for(let s=0;s<r.length;s++){let i=r[s];if(i.trim().startsWith("```")){t=!t;continue}if(t||this.settings.enableExclusion&&s>0&&r[s-1].trim().includes(`<!-- ${this.settings.exclusionComment} -->`))continue;let n=i.match(/^(#{1,6})\s+(.+)$/);if(n){let a=n[1].length;this.settings.headerLevels.includes(a)&&e.push({level:a,text:n[2].trim(),lineNumber:s})}}return e}extractAnswer(r,e,t){let s=[];for(let i=e;i<t;i++){let n=r[i];if(this.settings.answerTerminator==="blank-line"){if(n.trim()===""&&s.length>0)break}else if(this.settings.answerTerminator==="hr"&&n.trim().match(/^[-*_]{3,}$/))break;s.push(n)}return s.join(`
`).trim()}extractTags(r){let e=[];if(r.frontmatter?.tags){let i=Array.isArray(r.frontmatter.tags)?r.frontmatter.tags:[r.frontmatter.tags];e.push(...i)}r.tags&&e.push(...r.tags.map(i=>i.tag));let t=new Set,s=[];for(let i of e)t.has(i)||(t.add(i),s.push(i));return s}};var ot=class{constructor(r,e){this.settings=r;this.app=e;this.inlineParser=new At(r.inline,e,r.header.flashcardTags),this.headerParser=new It(r.header,e)}async parseFile(r){let e=[];if(!this.headerParser.hasFlashcardTag(r))return[];if(this.settings.header.enabled){let s=await this.headerParser.parse(r);e.push(...s)}if(this.settings.inline.enabled){let s=await this.inlineParser.parseWithFile(r);e.push(...s)}return this.deduplicate(e)}async parseVault(){let r=this.app.vault.getMarkdownFiles(),e=[];for(let t of r){let s=await this.parseFile(t);e.push(...s)}return e}async parseFiles(r){let e=[];for(let t of r){let s=await this.parseFile(t);e.push(...s)}return e}deduplicate(r){let e=new Set,t=[];for(let s of r)e.has(s.id)||(e.add(s.id),t.push(s));return t}async getParsingStats(r){let e=await this.parseFile(r),t={totalCards:e.length,inlineCards:0,headerCards:0,cardsNeedingFilling:e.filter(s=>s.needsFilling).length,uniqueDecks:[...new Set(e.map(s=>s.deck))].length};for(let s of e)s.back.includes(`
`)?t.headerCards++:t.inlineCards++;return t}};var Ft=require("obsidian"),Ot=class{constructor(r,e,t,s){this.app=r;this.storage=e;this.parser=t;this.plugin=s}getId(){return"scan-vault"}getName(){return"Scan vault for flashcards"}getCallback(){return async()=>{await this.execute()}}async execute(){let r={filesScanned:0,cardsFound:0,cardsAdded:0,cardsUpdated:0,cardsDeleted:0,errors:0};new Ft.Notice("Scanning vault for flashcards...");try{let e=this.app.vault.getMarkdownFiles(),t=new Set(this.storage.getAllCards().map(n=>n.id)),s=new Set;for(let n of e)try{let a=await this.parser.parseFile(n);r.filesScanned++,r.cardsFound+=a.length;for(let l of a)s.add(l.id),this.storage.getCard(l.id)?(this.storage.updateCard(l.id,l),r.cardsUpdated++):(this.storage.addCard(l),r.cardsAdded++)}catch(a){r.errors++,console.error(`Error scanning file ${n.path}:`,a)}for(let n of t)s.has(n)||(this.storage.deleteCard(n),r.cardsDeleted++);await this.storage.save(),this.plugin&&this.plugin.refreshBrowserViews();let i=this.formatCompletionMessage(r);new Ft.Notice(i)}catch(e){new Ft.Notice("Error scanning vault: "+e.message),console.error("Scan error:",e)}return r}formatCompletionMessage(r){let e=[];return e.push(`Found ${r.cardsFound} flashcard${r.cardsFound!==1?"s":""}`),r.cardsAdded>0&&e.push(`${r.cardsAdded} new`),r.cardsUpdated>0&&e.push(`${r.cardsUpdated} updated`),r.cardsDeleted>0&&e.push(`${r.cardsDeleted} deleted`),r.errors>0&&e.push(`${r.errors} error${r.errors!==1?"s":""}`),e.join(", ")}};var ge=require("obsidian");var Rt=class{constructor(r=[],e){this.cards=[];this.filters={};this.sortBy="due-asc";this.searchQuery="";this.viewState={mode:"deck-list",selectedDeck:null,currentCardIndex:0,showingAnswer:!1};this.cards=r,e&&(this.sortBy=e)}setCards(r){this.cards=r}setFilter(r){this.filters=r}setSearchQuery(r){this.searchQuery=r}setSortBy(r){this.sortBy=r}getSortBy(){return this.sortBy}clearFilters(){this.filters={},this.searchQuery=""}getFilteredCards(){let r=[...this.cards];if(this.searchQuery){let e=this.searchQuery.toLowerCase();r=r.filter(t=>t.front.toLowerCase().includes(e)||t.back.toLowerCase().includes(e))}return this.filters.decks&&this.filters.decks.length>0&&(r=r.filter(e=>(this.filters.decks??[]).includes(e.deck))),this.filters.tags&&this.filters.tags.length>0&&(r=r.filter(e=>(this.filters.tags??[]).some(t=>e.tags.includes(t)))),this.filters.status&&this.filters.status.length>0&&(r=r.filter(e=>(this.filters.status??[]).includes(e.fsrsCard.state))),r=this.applySorting(r),r}applySorting(r){let e=[...r];switch(this.sortBy){case"created-asc":e.sort((t,s)=>t.created.getTime()-s.created.getTime());break;case"created-desc":e.sort((t,s)=>s.created.getTime()-t.created.getTime());break;case"updated-asc":e.sort((t,s)=>t.updated.getTime()-s.updated.getTime());break;case"updated-desc":e.sort((t,s)=>s.updated.getTime()-t.updated.getTime());break;case"due-asc":e.sort((t,s)=>t.fsrsCard.due.getTime()-s.fsrsCard.due.getTime());break;case"due-desc":e.sort((t,s)=>s.fsrsCard.due.getTime()-t.fsrsCard.due.getTime());break;case"deck-asc":e.sort((t,s)=>t.deck.localeCompare(s.deck));break;case"deck-desc":e.sort((t,s)=>s.deck.localeCompare(t.deck));break}return e}getStatistics(){let r=this.cards.length,e=this.getAvailableDecks().length,t=new Date;t.setHours(23,59,59,999);let s=this.cards.filter(i=>i.fsrsCard.due.getTime()<=t.getTime()).length;return{totalCards:r,cardsDueToday:s,deckCount:e}}getCardsGroupedByDeck(){let r=new Map;for(let e of this.cards){r.has(e.deck)||r.set(e.deck,[]);let t=r.get(e.deck);t&&t.push(e)}return r}getAvailableDecks(){let r=new Set;for(let e of this.cards)r.add(e.deck);return Array.from(r).sort()}getAvailableTags(){let r=new Set;for(let e of this.cards)for(let t of e.tags)r.add(t);return Array.from(r).sort()}getViewState(){return{...this.viewState}}getDeckList(){let r=new Map;for(let s of this.cards){r.has(s.deck)||r.set(s.deck,[]);let i=r.get(s.deck);i&&i.push(s)}let e=Array.from(r.keys()),t=[];for(let[s,i]of r.entries()){let n=zt(s),a=n.length>0?n[n.length-1]:s,l=ds(s),h=Dt(s),p=us(s,e),u=p.length>0,m={totalCards:i.length,dueToday:this.countDueToday(i),newCards:i.filter(b=>b.fsrsCard.state===J.New).length,learningCards:i.filter(b=>b.fsrsCard.state===J.Learning).length,reviewCards:i.filter(b=>b.fsrsCard.state===J.Review).length,relearnCards:i.filter(b=>b.fsrsCard.state===J.Relearning).length,lastStudied:this.getLastStudiedDate(i)},g=at(s,e).flatMap(b=>r.get(b)||[]),v=[...i,...g];t.push({name:s,displayName:a,parentDeck:l,level:h,hasChildren:u,childCount:p.length,...m,totalCardsIncludingChildren:v.length,dueTodayIncludingChildren:this.countDueToday(v)})}return t}selectDeck(r){this.viewState.selectedDeck=r,this.viewState.mode="card-view",this.viewState.currentCardIndex=0,this.viewState.showingAnswer=!1}getCardsInSelectedDeck(){if(!this.viewState.selectedDeck)return[];let r=this.cards.filter(e=>e.deck===this.viewState.selectedDeck);return this.applySorting(r)}getCurrentCard(){let r=this.getCardsInSelectedDeck();return r.length===0||this.viewState.currentCardIndex>=r.length?null:r[this.viewState.currentCardIndex]}goToNextCard(){let r=this.getCardsInSelectedDeck();this.viewState.currentCardIndex<r.length-1&&(this.viewState.currentCardIndex++,this.viewState.showingAnswer=!1)}goToPreviousCard(){this.viewState.currentCardIndex>0&&(this.viewState.currentCardIndex--,this.viewState.showingAnswer=!1)}flipCard(){this.viewState.showingAnswer=!this.viewState.showingAnswer}backToDeckList(){this.viewState.mode="deck-list",this.viewState.selectedDeck=null,this.viewState.currentCardIndex=0,this.viewState.showingAnswer=!1}countDueToday(r){let e=new Date;return e.setHours(23,59,59,999),r.filter(t=>t.fsrsCard.due.getTime()<=e.getTime()).length}getLastStudiedDate(r){let e=r.filter(t=>t.fsrsCard.last_review);return e.length===0?null:e.reduce((t,s)=>{let i=s.fsrsCard.last_review;if(!i)return t;let n=new Date(i);return n>t?n:t},new Date(0))}};var hs=require("obsidian"),Nt=class extends hs.Modal{constructor(e,t,s){super(e);this.deck=t;this.onChoose=s;this.choice="cancel"}onOpen(){let{contentEl:e}=this;e.addClass("flashly-parent-deck-modal"),e.createEl("h2",{text:`Review "${this.deck.name}"?`});let t=e.createEl("p",{text:`This deck has ${this.deck.childCount} sub-deck${this.deck.childCount!==1?"s":""}. How would you like to review?`}),s=e.createDiv({cls:"review-choice-stats"});s.createEl("p",{text:`Direct cards: ${this.deck.totalCards} total, ${this.deck.dueToday} due`}),s.createEl("p",{text:`Including sub-decks: ${this.deck.totalCardsIncludingChildren} total, ${this.deck.dueTodayIncludingChildren} due`});let i=e.createDiv({cls:"modal-button-container"});i.createEl("button",{cls:"mod-cta",text:`Review all (${this.deck.dueTodayIncludingChildren} due)`}).addEventListener("click",()=>{this.choice="all",this.close()});let a=i.createEl("button",{text:`Review direct only (${this.deck.dueToday} due)`});this.deck.totalCards===0&&(a.disabled=!0,a.title="This deck has no direct cards, only cards in sub-decks"),a.addEventListener("click",()=>{this.choice="direct",this.close()}),i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.choice="cancel",this.close()})}onClose(){this.onChoose(this.choice),this.contentEl.empty()}};var Ze="flashcard-browser-view",$e=class extends ge.ItemView{constructor(e,t){super(e);this.deckSearchQuery="";this.component=new ge.Component;this.isAnimating=!1;this.animationTimeoutId=null;this.deckGridContainer=null;this.isRendering=!1;this.needsRerender=!1;this.activeLeafRefreshTimeout=null;this.plugin=t,this.viewModel=new Rt([],t.settings.browser.defaultSort),this.deckSortBy=t.settings.browser.defaultDeckSort}getViewType(){return Ze}getDisplayText(){return"Flashcard browser"}getIcon(){return"layers"}async onOpen(){this.component.load(),this.refreshCards(),this.render(),this.registerDomEvent(this.containerEl,"keydown",t=>{this.handleKeyPress(t)}),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{t&&t.view instanceof $e&&t.view===this&&(this.activeLeafRefreshTimeout!==null&&window.clearTimeout(this.activeLeafRefreshTimeout),this.activeLeafRefreshTimeout=window.setTimeout(()=>{this.activeLeafRefreshTimeout=null,this.refreshCards()},0))}));let e=null;this.registerEvent(this.app.vault.on("modify",()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.refreshCards()},2e3)})),this.containerEl.setAttribute("tabindex","-1")}async onClose(){this.animationTimeoutId!==null&&(window.clearTimeout(this.animationTimeoutId),this.animationTimeoutId=null),this.activeLeafRefreshTimeout!==null&&(window.clearTimeout(this.activeLeafRefreshTimeout),this.activeLeafRefreshTimeout=null),this.component.unload()}refreshCards(){let e=this.plugin.storage.getAllCards();this.viewModel.setCards(e),this.render()}refresh(){this.refreshCards()}async render(){if(this.isRendering){this.needsRerender=!0;return}try{this.isRendering=!0;let e=this.contentEl;e.empty(),e.addClass("flashcard-browser-view"),this.viewModel.getViewState().mode==="deck-list"?this.renderDeckListView(e):await this.renderCardView(e)}finally{this.isRendering=!1,this.needsRerender&&(this.needsRerender=!1,this.render())}}renderDeckListView(e){let t=e.createDiv({cls:"deck-list-view"});this.renderDeckListHeader(t),this.renderDeckSearch(t),this.renderDeckGrid(t)}renderDeckListHeader(e){let t=e.createDiv({cls:"deck-list-header"}),s=t.createDiv({cls:"deck-list-title-row"});s.createEl("h2",{text:"Your decks",cls:"deck-list-title"});let i=s.createDiv({cls:"deck-list-header-actions"}),n=i.createEl("button",{cls:"deck-header-btn",attr:{"aria-label":"Generate quiz"}}),a=n.createSpan({cls:"deck-btn-icon"});(0,ge.setIcon)(a,"help-circle"),n.createSpan({cls:"deck-btn-text",text:"Generate quiz"}),n.addEventListener("click",()=>{this.app.commands.executeCommandById("flashly:generate-quiz")});let l=i.createEl("button",{cls:"deck-header-btn",attr:{"aria-label":"View quiz history"}}),h=l.createSpan({cls:"deck-btn-icon"});(0,ge.setIcon)(h,"history"),l.createSpan({cls:"deck-btn-text",text:"Quiz history"}),l.addEventListener("click",()=>{(async()=>await this.app.workspace.getLeaf("tab").setViewState({type:"flashly-quiz-history-view",active:!0}))()});let p=i.createEl("button",{cls:"deck-header-btn",attr:{"aria-label":"View statistics"}}),u=p.createSpan({cls:"deck-btn-icon"});(0,ge.setIcon)(u,"bar-chart-2"),p.createSpan({cls:"deck-btn-text",text:"Statistics"}),p.addEventListener("click",()=>{(async()=>await this.app.workspace.getLeaf("tab").setViewState({type:"flashly-statistics-view",active:!0}))()});let m=i.createEl("button",{cls:"deck-header-btn deck-scan-btn",attr:{"aria-label":"Scan for flashcards"}}),d=m.createSpan({cls:"deck-btn-icon"});(0,ge.setIcon)(d,"search"),m.createSpan({cls:"deck-btn-text",text:"Scan vault"}),m.addEventListener("click",()=>{this.app.commands.executeCommandById("flashly:scan-vault")});let g=this.viewModel.getStatistics(),v=t.createDiv({cls:"deck-list-stats"});v.createSpan({text:`${g.deckCount} decks`}),v.createSpan({text:" \u2022 "}),v.createSpan({text:`${g.totalCards} total cards`}),v.createSpan({text:" \u2022 "}),v.createSpan({text:`${g.cardsDueToday} due today`})}renderDeckSearch(e){let t=e.createDiv({cls:"deck-search-row"});t.createDiv({cls:"deck-search"}).createEl("input",{type:"text",placeholder:"Search decks...",cls:"deck-search-input",value:this.deckSearchQuery}).addEventListener("input",h=>{this.deckSearchQuery=h.target.value,this.updateDeckGrid()});let n=t.createDiv({cls:"deck-sort"});n.createSpan({cls:"deck-sort-label",text:"Sort: "});let a=n.createEl("select",{cls:"deck-sort-select"}),l=[{value:"name-asc",label:"Name (A-Z)"},{value:"name-desc",label:"Name (Z-A)"},{value:"cards-desc",label:"Most cards"},{value:"cards-asc",label:"Fewest cards"},{value:"due-desc",label:"Most due"},{value:"due-asc",label:"Least due"},{value:"new-desc",label:"Most new cards"},{value:"new-asc",label:"Fewest new cards"},{value:"studied-desc",label:"Recently studied"},{value:"studied-asc",label:"Least recently studied"}];for(let h of l){let p=a.createEl("option",{value:h.value,text:h.label});h.value===this.deckSortBy&&(p.selected=!0)}a.addEventListener("change",h=>{this.deckSortBy=h.target.value,this.plugin.settings.browser.defaultDeckSort=this.deckSortBy,this.plugin.saveSettings(),this.updateDeckGrid()})}sortDecks(e){let t=[...e];switch(this.deckSortBy){case"name-asc":t.sort((s,i)=>s.name.localeCompare(i.name));break;case"name-desc":t.sort((s,i)=>i.name.localeCompare(s.name));break;case"cards-desc":t.sort((s,i)=>i.totalCards-s.totalCards);break;case"cards-asc":t.sort((s,i)=>s.totalCards-i.totalCards);break;case"due-desc":t.sort((s,i)=>i.dueToday-s.dueToday);break;case"due-asc":t.sort((s,i)=>s.dueToday-i.dueToday);break;case"new-desc":t.sort((s,i)=>i.newCards-s.newCards);break;case"new-asc":t.sort((s,i)=>s.newCards-i.newCards);break;case"studied-desc":t.sort((s,i)=>!s.lastStudied&&!i.lastStudied?0:s.lastStudied?i.lastStudied?i.lastStudied.getTime()-s.lastStudied.getTime():-1:1);break;case"studied-asc":t.sort((s,i)=>!s.lastStudied&&!i.lastStudied?0:s.lastStudied?i.lastStudied?s.lastStudied.getTime()-i.lastStudied.getTime():1:-1);break}return t}updateDeckGrid(){this.deckGridContainer&&this.populateDeckGrid(this.deckGridContainer)}renderDeckGrid(e){this.deckGridContainer=e.createDiv({cls:"deck-grid"}),this.populateDeckGrid(this.deckGridContainer)}populateDeckGrid(e){e.empty();let t=this.viewModel.getDeckList(),s=this.deckSearchQuery?t.filter(n=>n.name.toLowerCase().includes(this.deckSearchQuery.toLowerCase())):t,i=this.sortDecks(s);if(i.length===0){this.renderDeckListEmptyState(e,t.length===0);return}for(let n of i)this.renderDeckCard(e,n)}renderDeckCard(e,t){let s=e.createDiv({cls:"deck-card"}),i=`deck-card-level-${Math.min(t.level,3)}`;s.addClass(i),t.hasChildren&&s.addClass("deck-card-parent");let n=s.createDiv({cls:"deck-card-header"});if(t.level>0){let d=n.createSpan({cls:"deck-indent"});d.style.width=`${t.level*16}px`}let a=n.createSpan({cls:"deck-icon"});(0,ge.setIcon)(a,t.hasChildren?"folder":"book-open"),n.createSpan({cls:"deck-name",text:t.name});let l=s.createDiv({cls:"deck-stats"}),h=l.createDiv({cls:"deck-stat"});t.hasChildren?(h.createDiv({cls:"deck-stat-value",text:`${t.totalCards} (+${t.totalCardsIncludingChildren-t.totalCards})`}),h.createDiv({cls:"deck-stat-label",text:"Cards (+ children)"})):(h.createDiv({cls:"deck-stat-value",text:t.totalCards.toString()}),h.createDiv({cls:"deck-stat-label",text:"Total cards"}));let p=l.createDiv({cls:"deck-stat"});t.hasChildren?(p.createDiv({cls:"deck-stat-value",text:`${t.dueToday} (+${t.dueTodayIncludingChildren-t.dueToday})`}),p.createDiv({cls:"deck-stat-label",text:"Due (+ children)"})):(p.createDiv({cls:"deck-stat-value",text:t.dueToday.toString()}),p.createDiv({cls:"deck-stat-label",text:"Due today"}));let u=s.createDiv({cls:"deck-last-studied"});if(t.lastStudied){let d=Math.floor((Date.now()-t.lastStudied.getTime())/864e5);d===0?u.setText("Studied today"):d===1?u.setText("Last studied yesterday"):u.setText(`Last studied ${d} days ago`)}else u.setText("Never studied");let m=s.createEl("button",{cls:"deck-study-btn",text:"Study deck"});m.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.startDeckReview(t)}),s.addEventListener("click",d=>{d.target instanceof Node&&m.contains(d.target)||(this.viewModel.selectDeck(t.name),this.render())})}renderDeckListEmptyState(e,t){let s=e.createDiv({cls:"empty-state deck-list-empty-state"}),i=s.createEl("div",{cls:"empty-icon"});(0,ge.setIcon)(i,this.deckSearchQuery?"search":"inbox"),s.createEl("div",{cls:"empty-title",text:"No decks found"}),s.createEl("div",{cls:"empty-message",text:this.deckSearchQuery?"No decks match your search. Try a different query.":'Create flashcards in your notes and run "Scan vault for flashcards".'}),t&&s.createEl("button",{cls:"mod-cta",text:"Scan vault for flashcards"}).addEventListener("click",()=>{this.app.commands.executeCommandById("flashly:scan-vault")})}async renderCardView(e){let t=e.createDiv({cls:"card-view"});this.renderCardViewHeader(t),this.renderCardSort(t),this.renderCardProgress(t),await this.renderCardDisplay(t),this.renderCardNavigation(t),this.renderCardActions(t)}renderCardViewHeader(e){let t=e.createDiv({cls:"card-view-header"});t.createEl("button",{cls:"back-to-decks-btn",text:"\u2190 back to decks"}).addEventListener("click",()=>{this.viewModel.backToDeckList(),this.render()});let i=this.viewModel.getViewState();t.createDiv({cls:"deck-title",text:i.selectedDeck??""})}renderCardSort(e){let s=e.createDiv({cls:"card-sort-row"}).createDiv({cls:"card-sort"});s.createSpan({cls:"card-sort-label",text:"Sort: "});let i=s.createEl("select",{cls:"card-sort-select"}),n=[{value:"created-desc",label:"Most recently made"},{value:"created-asc",label:"Oldest first"},{value:"updated-desc",label:"Recently updated"},{value:"updated-asc",label:"Least recently updated"},{value:"due-asc",label:"Due soonest"},{value:"due-desc",label:"Due latest"},{value:"deck-asc",label:"Deck (A-Z)"},{value:"deck-desc",label:"Deck (Z-A)"}],a=this.viewModel.getSortBy();for(let l of n){let h=i.createEl("option",{value:l.value,text:l.label});l.value===a&&(h.selected=!0)}i.addEventListener("change",l=>{let h=l.target.value;this.viewModel.setSortBy(h),this.plugin.settings.browser.defaultSort=h,this.plugin.saveSettings(),this.render()})}renderCardProgress(e){let t=e.createDiv({cls:"card-progress"}),s=this.viewModel.getViewState(),i=this.viewModel.getCardsInSelectedDeck();t.createDiv({cls:"card-counter",text:`Card ${s.currentCardIndex+1} of ${i.length}`});let n=new Date;n.setHours(23,59,59,999);let a=i.filter(l=>l.fsrsCard.due.getTime()<=n.getTime()).length;t.createDiv({cls:"cards-due",text:`${a} card${a!==1?"s":""} due today`})}async renderCardDisplay(e){let t=e.createDiv({cls:"card-display"}),s=this.viewModel.getCurrentCard();if(!s){t.createDiv({cls:"empty-state",text:"No cards in this deck"});return}let i=this.viewModel.getViewState(),a=t.createDiv({cls:"card-container"}).createDiv({cls:"card-inner"});i.showingAnswer&&a.addClass("flipped");let l=a.createDiv({cls:"card-face card-front"}),h=l.createDiv({cls:"card-text"});await ge.MarkdownRenderer.render(this.app,s.front,h,s.source.file,this.component),l.createEl("button",{cls:"flip-btn",text:"Show answer"}).addEventListener("click",()=>{this.flipWithAnimation()});let u=a.createDiv({cls:"card-face card-back"}),m=u.createDiv({cls:"card-text"});await ge.MarkdownRenderer.render(this.app,s.back,m,s.source.file,this.component),u.createEl("button",{cls:"flip-btn",text:"Show question"}).addEventListener("click",()=>{this.flipWithAnimation()})}renderCardNavigation(e){let t=e.createDiv({cls:"card-navigation"}),s=this.viewModel.getViewState(),i=this.viewModel.getCardsInSelectedDeck(),n=t.createEl("button",{cls:"nav-btn prev-btn",text:"\u2190 previous"});n.disabled=s.currentCardIndex===0,n.addEventListener("click",()=>{this.viewModel.goToPreviousCard(),this.render()});let a=t.createEl("button",{cls:"nav-btn next-btn",text:"Next \u2192"});a.disabled=s.currentCardIndex>=i.length-1,a.addEventListener("click",()=>{this.viewModel.goToNextCard(),this.render()})}renderCardActions(e){let t=e.createDiv({cls:"card-actions"}),s=this.viewModel.getCurrentCard();if(!s)return;t.createEl("button",{cls:"action-btn open-btn",text:"Open note"}).addEventListener("click",()=>void this.openCardNote(s)),t.createEl("button",{cls:"action-btn delete-btn",text:"Delete"}).addEventListener("click",()=>this.deleteCard(s))}async openCardNote(e){this.app.workspace.layoutReady||await new Promise(a=>{this.app.workspace.onLayoutReady(()=>a(null))});let t=this.app.vault.getAbstractFileByPath(e.source.file),s=0;for(;!t&&s<3;)await new Promise(a=>setTimeout(a,200)),t=this.app.vault.getAbstractFileByPath(e.source.file),s++;if(!t){console.error("Flashly: file not found in vault:",e.source.file),new ge.Notice(`Could not find file: ${e.source.file}

The file may have been moved, renamed, or deleted.
If you recently changed your vault structure, try rescanning for flashcards.`);return}if(!(t instanceof ge.TFile)){console.error("Flashly: path is not a file:",e.source.file,"Type:",t.constructor.name),new ge.Notice(`Path is a folder, not a file: ${e.source.file}`);return}await this.app.workspace.getLeaf(!1).openFile(t);let n=this.app.workspace.getActiveViewOfType(ge.ItemView);if(n&&"editor"in n){let a=n.editor;a&&(a.setCursor({line:e.source.line-1,ch:0}),a.scrollIntoView({from:{line:e.source.line-1,ch:0},to:{line:e.source.line-1,ch:0}}))}}deleteCard(e){new Or(this.app,e,()=>{this.plugin.storage.deleteCard(e.id),this.plugin.storage.save(),new ge.Notice("Card deleted"),this.refreshCards()}).open()}async startDeckReview(e){let t=this.plugin.startReviewCommand;if(!t){new ge.Notice("Review command is not ready yet. Try again in a moment.");return}try{let s;if(e.hasChildren){let i=await new Promise(n=>{new Nt(this.app,e,n).open()});if(i==="cancel")return;if(i==="all"){let n=this.viewModel.getDeckList().map(l=>l.name),a=at(e.name,n);s=[e.name,...a]}else s=[e.name]}else s=[e.name];await t.startReview(s)}catch(s){console.error("Flashly: failed to start review session for deck",e.name,s),new ge.Notice("Failed to start review session. Check console for details.")}}flipWithAnimation(){if(this.isAnimating)return;let e=this.containerEl.querySelector(".card-inner");if(!e){this.viewModel.flipCard(),this.render();return}this.isAnimating=!0,e.addClass("animating"),this.viewModel.flipCard();let{showingAnswer:t}=this.viewModel.getViewState();e.toggleClass("flipped",t),this.animationTimeoutId!==null&&window.clearTimeout(this.animationTimeoutId),this.animationTimeoutId=window.setTimeout(()=>{e&&e.isConnected&&e.removeClass("animating"),this.isAnimating=!1,this.animationTimeoutId=null},400)}handleKeyPress(e){this.viewModel.getViewState().mode==="deck-list"?this.handleDeckListKeyPress(e):this.handleCardViewKeyPress(e)}handleDeckListKeyPress(e){switch(e.key){case"/":{e.preventDefault();let t=this.containerEl.querySelector(".deck-search-input");t&&t.focus();break}case"Escape":{let t=this.containerEl.querySelector(".deck-search-input:focus");t&&(t.blur(),this.containerEl.focus());break}}}handleCardViewKeyPress(e){let t=this.viewModel.getCardsInSelectedDeck(),s=this.viewModel.getViewState();switch(e.key){case"ArrowRight":case"n":e.preventDefault(),s.currentCardIndex<t.length-1&&(this.viewModel.goToNextCard(),this.render());break;case"ArrowLeft":case"p":e.preventDefault(),s.currentCardIndex>0&&(this.viewModel.goToPreviousCard(),this.render());break;case" ":case"f":e.preventDefault(),this.flipWithAnimation();break;case"Escape":e.preventDefault(),this.viewModel.backToDeckList(),this.render();break;case"Enter":{e.preventDefault();let i=this.viewModel.getCurrentCard();i&&this.openCardNote(i);break}case"Delete":case"Backspace":{e.preventDefault();let i=this.viewModel.getCurrentCard();i&&this.deleteCard(i);break}}}},Or=class extends ge.Modal{constructor(e,t,s){super(e);this.card=t,this.onConfirm=s}onOpen(){let{contentEl:e}=this;e.addClass("flashly-confirm-delete-modal"),e.createEl("h2",{text:"Delete flashcard?"}),e.createEl("p",{text:"Are you sure you want to delete this flashcard? This cannot be undone."});let t=e.createDiv({cls:"card-preview"});t.createEl("strong",{text:"Front: "}),t.createSpan({text:this.card.front});let s=e.createDiv({cls:"modal-button-container"});s.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Ue=require("obsidian");var lt="flashly-statistics-view",Lt=class extends Ue.ItemView{constructor(e,t){super(e);this.renderQueue=Promise.resolve();this.plugin=t}getViewType(){return lt}getDisplayText(){return"Flashcard statistics"}getIcon(){return"bar-chart"}async onOpen(){this.queueRender()}async onClose(){this.containerEl.empty()}renderInternal(){let e=this.containerEl;e.empty(),e.addClass("flashly-statistics-view");let s=e.createDiv({cls:"stats-header"}).createDiv({cls:"stats-title-row"});s.createEl("h2",{text:"Statistics dashboard",cls:"stats-title"});let i=s.createEl("button",{cls:"stats-refresh-btn",attr:{"aria-label":"Refresh statistics"}});(0,Ue.setIcon)(i,"refresh-cw"),i.addEventListener("click",()=>this.queueRender());let n=this.plugin.storage.getAllCards();this.renderOverviewCards(e,n),this.renderDeckBreakdown(e,n),this.renderReviewActivity(e,n),this.renderCardDistribution(e,n),this.renderQuizStatistics(e)}renderOverviewCards(e,t){let s=e.createDiv({cls:"stats-overview"}),i=t.length,n=t.filter(p=>!p.fsrsCard||!p.fsrsCard.due?!1:new Date(p.fsrsCard.due)<=new Date).length,a=t.filter(p=>p.fsrsCard?.state===J.New).length,l=t.filter(p=>p.fsrsCard?.state===J.Review).length;[{label:"Total cards",value:i,icon:"library",color:"blue"},{label:"Due today",value:n,icon:"clock",color:"orange"},{label:"New cards",value:a,icon:"sparkles",color:"green"},{label:"Review cards",value:l,icon:"repeat",color:"purple"}].forEach(p=>{let u=s.createDiv({cls:"stats-overview-card"});u.addClass(`stats-color-${p.color}`);let m=u.createDiv({cls:"stats-card-icon"});(0,Ue.setIcon)(m,p.icon);let d=u.createDiv({cls:"stats-card-content"});d.createDiv({text:String(p.value),cls:"stats-card-value"}),d.createDiv({text:p.label,cls:"stats-card-label"})})}renderDeckBreakdown(e,t){let s=e.createDiv({cls:"stats-section"});s.createEl("h3",{text:"Deck breakdown",cls:"stats-section-title"});let i=this.calculateDeckStats(t);if(i.length===0){s.createDiv({text:"No decks found. Start creating flashcards to see statistics!",cls:"stats-empty-message"});return}let n=s.createDiv({cls:"stats-deck-list"});i.forEach(a=>{let l=n.createDiv({cls:"stats-deck-item"});l.addClass("stats-deck-item-clickable");let h=t.find(z=>z.deck===a.name);h&&l.addEventListener("click",()=>{(async()=>this.app.vault.getAbstractFileByPath(h.source.file)&&await this.app.workspace.openLinkText(h.source.file,"",!1))()});let p=l.createDiv({cls:"stats-deck-header"}),u=p.createSpan({cls:"stats-deck-icon"});(0,Ue.setIcon)(u,"folder"),p.createSpan({text:a.name,cls:"stats-deck-name"}),p.createSpan({text:String(a.total),cls:"stats-deck-total"});let d=l.createDiv({cls:"stats-deck-details"}).createDiv({cls:"stats-grid"});this.createStatPill(d,"New",a.new,"green"),this.createStatPill(d,"Learning",a.learning,"orange"),this.createStatPill(d,"Review",a.review,"blue");let g=l.createDiv({cls:"stats-progress-bar"}),v=a.new/a.total*100,b=a.learning/a.total*100,S=a.review/a.total*100;g.createDiv({cls:"stats-progress-segment stats-progress-new",attr:{style:`width: ${v}%`}}),g.createDiv({cls:"stats-progress-segment stats-progress-learning",attr:{style:`width: ${b}%`}}),g.createDiv({cls:"stats-progress-segment stats-progress-review",attr:{style:`width: ${S}%`}})})}renderReviewActivity(e,t){let s=e.createDiv({cls:"stats-section"});s.createEl("h3",{text:"Review activity",cls:"stats-section-title"});let i=new Date,n=new Date(i);n.setDate(i.getDate()-30);let a=new Map;for(let u=new Date(n);u<=i;u.setDate(u.getDate()+1)){let m=u.toISOString().split("T")[0];a.set(m,0)}t.forEach(u=>{if(u.fsrsCard?.last_review){let m=new Date(u.fsrsCard.last_review);if(m>=n&&m<=i){let d=m.toISOString().split("T")[0];a.set(d,(a.get(d)||0)+1)}}});let l=s.createDiv({cls:"stats-activity-grid"}),h=Math.max(...Array.from(a.values()),1);Array.from(a.entries()).forEach(([u,m])=>{let d=m===0?0:Math.ceil(m/h*4),g=l.createDiv({cls:"stats-activity-cell"});g.addClass(`stats-activity-intensity-${d}`),g.setAttr("title",`${u}: ${m} reviews`)});let p=s.createDiv({cls:"stats-activity-legend"});p.createSpan({text:"Less",cls:"stats-legend-label"});for(let u=0;u<=4;u++)p.createDiv({cls:"stats-activity-cell"}).addClass(`stats-activity-intensity-${u}`);p.createSpan({text:"More",cls:"stats-legend-label"})}renderCardDistribution(e,t){let s=e.createDiv({cls:"stats-section"});s.createEl("h3",{text:"Card distribution",cls:"stats-section-title"});let i={new:t.filter(l=>l.fsrsCard?.state===J.New).length,learning:t.filter(l=>l.fsrsCard?.state===J.Learning).length,review:t.filter(l=>l.fsrsCard?.state===J.Review).length,relearning:t.filter(l=>l.fsrsCard?.state===J.Relearning).length},n=t.length,a=s.createDiv({cls:"stats-distribution-chart"});Object.entries(i).forEach(([l,h])=>{let p=n>0?h/n*100:0,u=a.createDiv({cls:"stats-distribution-row"}),m=u.createDiv({cls:"stats-distribution-label"});m.createSpan({text:l.charAt(0).toUpperCase()+l.slice(1)}),m.createSpan({text:String(h),cls:"stats-distribution-count"});let g=u.createDiv({cls:"stats-distribution-bar-container"}).createDiv({cls:"stats-distribution-bar"});g.addClass(`stats-bar-${l}`),g.setCssProps({"--bar-width":`${p}%`}),u.createSpan({text:`${p.toFixed(1)}%`,cls:"stats-distribution-percentage"})})}calculateDeckStats(e){let t=new Map;return e.forEach(s=>{let i=s.deck||"Default";t.has(i)||t.set(i,{name:i,total:0,new:0,learning:0,review:0,averageRetention:0});let n=t.get(i);n.total++,s.fsrsCard?.state===J.New?n.new++:s.fsrsCard?.state===J.Learning?n.learning++:s.fsrsCard?.state===J.Review&&n.review++}),Array.from(t.values()).sort((s,i)=>i.total-s.total)}createStatPill(e,t,s,i){let n=e.createDiv({cls:"stats-pill"});n.addClass(`stats-pill-${i}`),n.createSpan({text:t,cls:"stats-pill-label"}),n.createSpan({text:String(s),cls:"stats-pill-value"})}renderQuizStatistics(e){let t=e.createDiv({cls:"stats-section"});t.createEl("h3",{text:"Quiz performance",cls:"stats-section-title"});let i=this.plugin.quizStorage.getAllQuizzes().filter(x=>x.completed);if(i.length===0){t.createDiv({text:'No quizzes completed yet. Use "Generate quiz" to create your first quiz!',cls:"stats-empty-message"});return}let n=t.createDiv({cls:"stats-quiz-overview"}),a=i.length,l=i.reduce((x,N)=>x+N.totalQuestions,0),h=i.reduce((x,N)=>x+(N.score||0),0)/a,p=i.reduce((x,N)=>x+(N.correctCount||0),0),u=l>0?p/l*100:0;[{label:"Quizzes Taken",value:a,icon:"file-text",color:"blue"},{label:"Avg Score",value:`${h.toFixed(1)}%`,icon:"target",color:"green"},{label:"Questions Answered",value:l,icon:"help-circle",color:"purple"},{label:"Accuracy",value:`${u.toFixed(1)}%`,icon:"check-circle",color:"orange"}].forEach(x=>{let N=n.createDiv({cls:"stats-quiz-card"});N.addClass(`stats-color-${x.color}`);let F=N.createDiv({cls:"stats-card-icon"});(0,Ue.setIcon)(F,x.icon);let k=N.createDiv({cls:"stats-card-content"});k.createDiv({text:String(x.value),cls:"stats-card-value"}),k.createDiv({text:x.label,cls:"stats-card-label"})});let d=t.createDiv({cls:"stats-quiz-history"});d.createEl("h4",{text:"Recent quizzes",cls:"stats-subsection-title"});let g=i.sort((x,N)=>new Date(N.completed).getTime()-new Date(x.completed).getTime()).slice(0,5),v=d.createDiv({cls:"stats-quiz-history-list"});g.forEach(x=>{let N=v.createDiv({cls:"stats-quiz-item"}),F=N.createDiv({cls:"stats-quiz-item-header"});F.createSpan({text:x.title,cls:"stats-quiz-item-title"});let k=F.createSpan({cls:"stats-quiz-item-score"});k.setText(`${x.score}%`),x.score>=90?k.addClass("stats-score-excellent"):x.score>=70?k.addClass("stats-score-good"):x.score>=50?k.addClass("stats-score-fair"):k.addClass("stats-score-poor");let y=N.createDiv({cls:"stats-quiz-item-details"}),D=y.createDiv({cls:"stats-quiz-details-left"});D.createSpan({text:`${x.correctCount} / ${x.totalQuestions} correct`,cls:"stats-quiz-detail"}),D.createSpan({cls:"stats-quiz-badge"}).setText(x.generationMethod==="ai-generated"?"\u{1F916} AI":"\u{1F4CB} Traditional");let _=y.createDiv({cls:"stats-quiz-details-right"}),R=new Date(x.completed),f=this.formatTimeAgo(R);_.createSpan({text:f,cls:"stats-quiz-time"})});let b=t.createDiv({cls:"stats-quiz-types"});b.createEl("h4",{text:"Question type performance",cls:"stats-subsection-title"});let S=this.calculateQuizTypeStats(i),z=b.createDiv({cls:"stats-type-grid"});Object.entries(S).forEach(([x,N])=>{let F=z.createDiv({cls:"stats-type-card"});F.createDiv({text:this.formatQuestionType(x),cls:"stats-type-name"});let k=N.total>0?N.correct/N.total*100:0,D=F.createDiv({cls:"stats-type-accuracy-bar"}).createDiv({cls:"stats-type-accuracy-fill"});D.setCssProps({"--accuracy-width":`${k}%`}),k>=80?D.addClass("stats-accuracy-high"):k>=60?D.addClass("stats-accuracy-medium"):D.addClass("stats-accuracy-low"),F.createDiv({text:`${k.toFixed(0)}% (${N.correct}/${N.total})`,cls:"stats-type-stats"})})}calculateQuizTypeStats(e){let t={"multiple-choice":{correct:0,total:0},"fill-blank":{correct:0,total:0},"true-false":{correct:0,total:0}};return e.forEach(s=>{s.questions.forEach(i=>{t[i.type]&&(t[i.type].total++,i.correct&&t[i.type].correct++)})}),Object.fromEntries(Object.entries(t).filter(([s,i])=>i.total>0))}formatQuestionType(e){switch(e){case"multiple-choice":return"Multiple choice";case"fill-blank":return"Fill in the blank";case"true-false":return"True/false";default:return e}}formatTimeAgo(e){let s=new Date().getTime()-e.getTime(),i=Math.floor(s/6e4),n=Math.floor(s/36e5),a=Math.floor(s/864e5);return i<1?"Just now":i<60?`${i}m ago`:n<24?`${n}h ago`:a<7?`${a}d ago`:e.toLocaleDateString()}queueRender(){this.renderQueue=this.renderQueue.then(()=>this.renderInternal()).catch(e=>{console.error("Flashly: failed to render statistics view",e)})}};var me=require("obsidian");var Rr="flashly-quiz-view",Mt=class extends me.ItemView{constructor(e,t){super(e);this.currentQuiz=null;this.currentQuestionIndex=0;this.component=null;this.debounceTimer=null;this.learnModeEnabled=!1;this.questionQueue=[];this.currentQueuePosition=0;this.answeredQuestions=new Set;this.plugin=t,this.keydownHandler=this.handleKeydown.bind(this)}getViewType(){return Rr}getDisplayText(){return"Quiz"}getIcon(){return"help-circle"}async onOpen(){this.component=new me.Component,this.component.load(),this.render(),document.addEventListener("keydown",this.keydownHandler)}async onClose(){this.debounceTimer!==null&&(window.clearTimeout(this.debounceTimer),this.debounceTimer=null),this.component&&(this.component.unload(),this.component=null),document.removeEventListener("keydown",this.keydownHandler),this.containerEl.empty()}loadQuiz(e){this.currentQuiz=e,this.learnModeEnabled=e.config.learnMode??!1,this.learnModeEnabled?e.learnModeStats?.savedQueue&&e.learnModeStats?.savedQueuePosition!==void 0?(this.questionQueue=[...e.learnModeStats.savedQueue],this.currentQueuePosition=e.learnModeStats.savedQueuePosition,this.answeredQuestions=new Set(e.learnModeStats.savedAnsweredQuestions||[])):(this.questionQueue=Array.from({length:e.questions.length},(t,s)=>s),this.currentQueuePosition=0,this.answeredQuestions.clear()):this.currentQuestionIndex=e.currentQuestionIndex??0,this.render()}async saveQuizProgress(){if(this.currentQuiz&&!this.currentQuiz.completed)try{this.currentQuiz.lastAccessed=new Date,this.currentQuiz.state="in-progress",this.currentQuiz.currentQuestionIndex=this.currentQuestionIndex,this.learnModeEnabled&&(this.currentQuiz.learnModeStats||(this.currentQuiz.learnModeStats={totalAttempts:0,questionsRequeued:0,firstPassCorrect:0}),this.currentQuiz.learnModeStats.savedQueue=[...this.questionQueue],this.currentQuiz.learnModeStats.savedQueuePosition=this.currentQueuePosition,this.currentQuiz.learnModeStats.savedAnsweredQuestions=Array.from(this.answeredQuestions)),await this.plugin.quizStorage.updateQuiz(this.currentQuiz),this.plugin.logger.debug("Quiz progress saved:",this.currentQuiz.id)}catch(e){console.error("Failed to save quiz progress:",e)}}getCurrentQuestion(){if(!this.currentQuiz)return null;if(this.learnModeEnabled){let e=this.questionQueue[this.currentQueuePosition];return this.currentQuiz.questions[e]}return this.currentQuiz.questions[this.currentQuestionIndex]}getCurrentQuestionIndex(){return this.learnModeEnabled?this.questionQueue[this.currentQueuePosition]:this.currentQuestionIndex}async render(){let e=this.containerEl.scrollTop;this.component&&this.component.unload(),this.component=new me.Component,this.component.load();let t=this.containerEl;if(t.empty(),t.addClass("flashly-quiz-view"),!this.currentQuiz){this.renderNoQuiz(t),requestAnimationFrame(()=>{this.containerEl.scrollTop=e});return}if(this.currentQuiz.completed){this.renderResults(t),requestAnimationFrame(()=>{this.containerEl.scrollTop=e});return}await this.renderQuestion(t),requestAnimationFrame(()=>{this.containerEl.scrollTop=e})}renderNoQuiz(e){let t=e.createDiv({cls:"quiz-empty-state"}),s=t.createDiv({cls:"quiz-empty-icon"});(0,me.setIcon)(s,"file-question"),t.createEl("h3",{text:"No quiz loaded",cls:"quiz-empty-title"}),t.createEl("p",{text:'Use the "generate quiz" command to create a new quiz.',cls:"quiz-empty-message"})}async renderQuestion(e){if(!this.currentQuiz)return;let t=this.getCurrentQuestion();if(!t)return;e.createDiv({cls:"quiz-header"}).createEl("h2",{text:this.currentQuiz.title,cls:"quiz-title"});let i=e.createDiv({cls:"quiz-progress"});if(this.learnModeEnabled){let g=this.questionQueue.length-this.currentQueuePosition,v=this.answeredQuestions.size,b=this.currentQuiz.totalQuestions;i.createDiv({cls:"quiz-progress-text quiz-progress-learn-mode"}).setText(`${g} remaining in queue | ${v} of ${b} checked`)}else{let v=i.createDiv({cls:"quiz-progress-bar"}).createDiv({cls:"quiz-progress-fill"}),b=(this.currentQuestionIndex+1)/this.currentQuiz.totalQuestions*100;v.setCssProps({"--progress-width":`${b}%`}),i.createDiv({cls:"quiz-progress-text"}).setText(`Question ${this.currentQuestionIndex+1} of ${this.currentQuiz.totalQuestions}`)}let n=e.createDiv({cls:"quiz-question-container"}),a=n.createDiv({cls:"quiz-type-badge"});a.setText(this.getQuestionTypeLabel(t.type)),a.addClass(`quiz-type-${t.type}`);let h=n.createDiv({cls:"quiz-question-prompt"}).createDiv({cls:"quiz-prompt-content"});this.component&&await me.MarkdownRenderer.render(this.app,t.prompt,h,"",this.component);let p=n.createDiv({cls:"quiz-answer-area"});t.type==="multiple-choice"&&t.options?await this.renderMultipleChoice(p,t):t.type==="fill-blank"?this.renderFillBlank(p,t):t.type==="true-false"&&t.options&&await this.renderTrueFalse(p,t),setTimeout(()=>{p.scrollHeight>p.clientHeight&&p.addClass("has-scroll")},100),this.learnModeEnabled&&t.checked&&await this.renderLearnModeFeedback(n,t);let u=e.createDiv({cls:"quiz-navigation"});this.learnModeEnabled?t.checked?u.createEl("button",{text:"Continue \u2192",cls:"quiz-nav-btn quiz-nav-primary"}).addEventListener("click",()=>{this.handleLearnModeContinue()}):u.createEl("button",{text:"Check answer",cls:"quiz-nav-btn quiz-nav-primary"}).addEventListener("click",()=>{this.handleCheckAnswer()}):(this.currentQuestionIndex>0&&u.createEl("button",{text:"\u2190 previous",cls:"quiz-nav-btn"}).addEventListener("click",()=>{this.currentQuestionIndex--,this.saveQuizProgress(),this.render()}),u.createEl("button",{text:this.currentQuestionIndex<this.currentQuiz.totalQuestions-1?"Next \u2192":"Finish quiz",cls:"quiz-nav-btn quiz-nav-primary"}).addEventListener("click",()=>{this.currentQuiz&&(this.currentQuestionIndex<this.currentQuiz.totalQuestions-1?(this.currentQuestionIndex++,this.saveQuizProgress(),this.render()):this.finishQuiz())}));let m=e.createDiv({cls:"quiz-keyboard-hints"});m.createEl("span",{text:"Shortcuts: ",cls:"quiz-hint-label"});let d=["\u2190/\u2192 navigate","Enter/space next","Esc close"];(t.type==="multiple-choice"||t.type==="true-false")&&(t.type==="multiple-choice"?d.push("1-4 select"):d.push("T/F select")),d.forEach((g,v)=>{v>0&&m.createSpan({text:" \u2022 ",cls:"quiz-hint-separator"}),m.createSpan({text:g,cls:"quiz-hint-item"})})}async renderMultipleChoice(e,t){if(t.options)for(let s=0;s<t.options.length;s++){let i=t.options[s],n=e.createEl("button",{cls:"quiz-option-btn"}),a=n.createDiv({cls:"quiz-option-content"});this.component&&await me.MarkdownRenderer.render(this.app,i,a,"",this.component),t.userAnswer===s&&n.addClass("quiz-option-selected"),n.addEventListener("click",()=>{t.userAnswer=s,this.saveQuizProgress(),this.render()})}}renderFillBlank(e,t){let s=e.createEl("input",{type:"text",cls:"quiz-input",placeholder:"Type your answer..."});t.userAnswer!==void 0&&(s.value=String(t.userAnswer)),s.addEventListener("input",i=>{let n=i.target.value;this.debounceTimer!==null&&window.clearTimeout(this.debounceTimer),t.userAnswer=n,this.debounceTimer=window.setTimeout(()=>{this.saveQuizProgress()},500)}),setTimeout(()=>s.focus(),100)}async renderTrueFalse(e,t){if(t.options)for(let s of t.options){let i=e.createEl("button",{cls:"quiz-option-btn quiz-option-tf"}),n=i.createDiv({cls:"quiz-option-content"});this.component&&await me.MarkdownRenderer.render(this.app,s,n,"",this.component);let a=s.toLowerCase();t.userAnswer===a&&i.addClass("quiz-option-selected"),i.addEventListener("click",()=>{t.userAnswer=a,this.saveQuizProgress(),this.render()})}}async handleCheckAnswer(){let e=this.getCurrentQuestion(),t=this.getCurrentQuestionIndex();if(e){if(!e.userAnswer&&e.userAnswer!==0){new me.Notice("Please select an answer first");return}e.checked=!0,e.correct=Sr(e,e.userAnswer),e.attemptCount=(e.attemptCount||0)+1,this.answeredQuestions.add(t),e.correct||this.questionQueue.push(t),await this.saveQuizProgress(),await this.render()}}handleLearnModeContinue(){if(this.currentQueuePosition++,this.currentQueuePosition>=this.questionQueue.length)this.finishLearnModeQuiz();else{let e=this.getCurrentQuestion();e&&e.checked&&!e.correct&&(e.checked=!1,e.userAnswer=void 0),this.saveQuizProgress(),this.render()}}async finishLearnModeQuiz(){if(!this.currentQuiz)return;let e=this.currentQuiz.questions.length,t=this.currentQuiz.questions.reduce((n,a)=>n+(a.attemptCount||1),0),s=this.currentQuiz.questions.filter(n=>(n.attemptCount||1)>1).length,i=this.currentQuiz.questions.filter(n=>(n.attemptCount||1)===1).length;this.currentQuiz.completed=new Date,this.currentQuiz.score=100,this.currentQuiz.correctCount=e,this.currentQuiz.state="completed",this.currentQuiz.learnModeStats={totalAttempts:t,questionsRequeued:s,firstPassCorrect:i};try{await this.plugin.quizStorage.updateQuiz(this.currentQuiz),this.plugin.logger.debug("Learn mode quiz completed:",this.currentQuiz.id)}catch(n){console.error("Failed to save learn mode quiz:",n),new me.Notice("Failed to save quiz results")}await this.render()}async renderLearnModeFeedback(e,t){let s=e.createDiv({cls:"quiz-learn-feedback"});if(t.correct)s.addClass("quiz-learn-feedback-correct"),s.createEl("h3",{text:"\u2713 correct!",cls:"quiz-learn-feedback-title"});else{s.addClass("quiz-learn-feedback-incorrect"),s.createEl("h3",{text:"\u2717 incorrect",cls:"quiz-learn-feedback-title"});let i=s.createDiv({cls:"quiz-learn-your-answer"});i.createEl("strong",{text:"Your answer: "});let n=i.createDiv({cls:"quiz-answer-content"});if(this.component){let h=this.formatAnswer(t,t.userAnswer);await me.MarkdownRenderer.render(this.app,h,n,"",this.component)}let a=s.createDiv({cls:"quiz-learn-correct-answer"});a.createEl("strong",{text:"Correct answer: "});let l=a.createDiv({cls:"quiz-answer-content"});if(this.component){let h=this.formatAnswer(t,t.correctAnswer);await me.MarkdownRenderer.render(this.app,h,l,"",this.component)}if(t.explanation){let h=s.createDiv({cls:"quiz-learn-explanation"});h.createEl("strong",{text:"Explanation:"});let p=h.createDiv({cls:"quiz-explanation-content"});this.component&&await me.MarkdownRenderer.render(this.app,t.explanation,p,"",this.component)}s.createDiv({text:"this question will appear again later.",cls:"quiz-learn-requeue-notice"})}}formatAnswer(e,t){return e.type==="multiple-choice"&&typeof t=="number"&&e.options&&e.options[t]||String(t)}async finishQuiz(){if(!this.currentQuiz)return;this.currentQuiz.questions.forEach(i=>{i.userAnswer!==void 0?i.correct=Sr(i,i.userAnswer):i.correct=!1});let{score:e,correctCount:t}=ss(this.currentQuiz);this.currentQuiz.score=e,this.currentQuiz.correctCount=t,this.currentQuiz.completed=new Date,this.currentQuiz.state="completed";let s=this.plugin.quizStorage;try{await s.updateQuiz(this.currentQuiz),this.plugin.logger.debug("Quiz updated successfully:",this.currentQuiz.id,"Completed:",this.currentQuiz.completed);let i=s.getQuiz(this.currentQuiz.id);this.plugin.logger.debug("Quiz retrieved after save:",i?.completed)}catch(i){console.error("Failed to update quiz:",i),new me.Notice("Failed to save quiz results")}this.render()}renderResults(e){if(!this.currentQuiz)return;let t=e.createDiv({cls:"quiz-results-container"}),s=t.createDiv({cls:"quiz-score-card"});s.createEl("h2",{text:"Quiz complete!",cls:"quiz-results-title"});let i=s.createDiv({cls:"quiz-score-display"});i.createDiv({cls:"quiz-score-value"}).setText(`${this.currentQuiz.score}%`),i.createDiv({cls:"quiz-score-label"}).setText(`${this.currentQuiz.correctCount} / ${this.currentQuiz.totalQuestions} correct`);let l=s.createDiv({cls:"quiz-performance-message"});this.currentQuiz.score>=90?l.setText("Excellent work!"):this.currentQuiz.score>=70?l.setText("Good job!"):this.currentQuiz.score>=50?l.setText("Keep practicing!"):l.setText("Review the material and try again!");let h=t.createDiv({cls:"quiz-review-section"});h.createEl("h3",{text:"Review answers",cls:"quiz-review-title"}),this.currentQuiz.questions.forEach((g,v)=>{let b=h.createDiv({cls:"quiz-review-question"});b.addClass(g.correct?"quiz-review-correct":"quiz-review-incorrect");let S=b.createDiv({cls:"quiz-review-header"});if(S.createSpan({text:`Q${v+1}: `,cls:"quiz-review-number"}),S.createSpan({text:g.prompt,cls:"quiz-review-prompt"}),S.createSpan({cls:"quiz-review-icon"}).setText(g.correct?"\u2713":"\u2717"),!g.correct){let x=b.createDiv({cls:"quiz-answer-details"}),N=x.createDiv({cls:"quiz-your-answer"});N.createSpan({text:"Your answer: ",cls:"quiz-answer-label"}),N.createSpan({text:String(this.getAnswerDisplay(g,g.userAnswer))});let F=x.createDiv({cls:"quiz-correct-answer"});F.createSpan({text:"Correct answer: ",cls:"quiz-answer-label"}),F.createSpan({text:String(this.getAnswerDisplay(g,g.correctAnswer))})}if(g.explanation){let x=b.createDiv({cls:"quiz-explanation"});x.createEl("strong",{text:"Explanation: "}),x.createSpan({text:g.explanation})}});let p=t.createDiv({cls:"quiz-results-actions"}),u=p.createEl("button",{text:"New quiz",cls:"quiz-action-btn quiz-btn-primary"}),m=u.createSpan({cls:"quiz-btn-icon"});(0,me.setIcon)(m,"refresh-cw"),u.prepend(m),u.addEventListener("click",()=>{this.app.commands.executeCommandById("flashly:generate-quiz")}),p.createEl("button",{text:"Close",cls:"quiz-action-btn"}).addEventListener("click",()=>{this.leaf.detach()})}getAnswerDisplay(e,t){return t==null?"(no answer)":e.type==="multiple-choice"&&typeof t=="number"&&e.options&&e.options[t]||String(t)}getQuestionTypeLabel(e){switch(e){case"multiple-choice":return"Multiple choice";case"fill-blank":return"Fill in the blank";case"true-false":return"True/False";default:return e}}handleKeydown(e){let t=e.target;if(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||!this.currentQuiz||this.currentQuiz.completed)return;let s=this.currentQuiz.questions[this.currentQuestionIndex];if(s){if(e.key==="Escape"){e.preventDefault(),this.leaf.detach();return}if(e.key==="Enter"||e.key===" "){e.preventDefault(),this.currentQuestionIndex<this.currentQuiz.totalQuestions-1?(this.currentQuestionIndex++,this.saveQuizProgress(),this.render()):this.finishQuiz();return}if(e.key==="ArrowLeft"){e.preventDefault(),this.currentQuestionIndex>0&&(this.currentQuestionIndex--,this.saveQuizProgress(),this.render());return}if(e.key==="ArrowRight"){e.preventDefault(),this.currentQuestionIndex<this.currentQuiz.totalQuestions-1&&(this.currentQuestionIndex++,this.saveQuizProgress(),this.render());return}if(s.type==="multiple-choice"&&s.options){let i=parseInt(e.key);if(i>=1&&i<=s.options.length){e.preventDefault(),s.userAnswer=i-1,this.saveQuizProgress(),this.render();return}}if(s.type==="true-false"){if(e.key.toLowerCase()==="t"){e.preventDefault(),s.userAnswer="true",this.saveQuizProgress(),this.render();return}if(e.key.toLowerCase()==="f"){e.preventDefault(),s.userAnswer="false",this.saveQuizProgress(),this.render();return}}}}};var _e=require("obsidian"),ct="flashly-quiz-history-view",Pt=class extends _e.ItemView{constructor(e,t){super(e);this.sortBy="date";this.filterMethod="all";this.filterState="all";this.renderQueue=Promise.resolve();this.plugin=t}getViewType(){return ct}getDisplayText(){return"Quiz history"}getIcon(){return"history"}async onOpen(){this.queueRender()}async onClose(){this.containerEl.empty()}renderInternal(){let e=this.containerEl;e.empty(),e.addClass("flashly-quiz-history-view");let t=e.createDiv({cls:"quiz-history-header"});t.createEl("h2",{text:"Quiz history",cls:"quiz-history-title"});let s=t.createEl("button",{cls:"quiz-history-refresh-btn",attr:{"aria-label":"Refresh quiz history"}});(0,_e.setIcon)(s,"refresh-cw"),s.addEventListener("click",()=>this.queueRender());let i=this.plugin.quizStorage.getAllQuizzes();this.plugin.logger.debug("Quiz history - all quizzes:",i.length),this.plugin.logger.debug("Quiz history - quizzes:",i);let n=i.filter(p=>p.completed),a=i.filter(p=>!p.completed);if(this.plugin.logger.debug("Quiz history - completed quizzes:",n.length),this.plugin.logger.debug("Quiz history - in-progress quizzes:",a.length),i.length===0){this.renderEmptyState(e);return}this.renderControls(e);let l=i;this.filterState==="completed"?l=n:this.filterState==="in-progress"&&(l=a),this.filterMethod!=="all"&&(l=l.filter(p=>this.filterMethod==="ai"?p.generationMethod==="ai-generated":p.generationMethod==="traditional"));let h=this.sortQuizzes(l);n.length>0&&this.renderSummary(e,n),this.renderQuizList(e,h)}renderEmptyState(e){let t=e.createDiv({cls:"quiz-history-empty"}),s=t.createDiv({cls:"quiz-history-empty-icon"});(0,_e.setIcon)(s,"file-question"),t.createEl("h3",{text:"No quiz history",cls:"quiz-history-empty-title"}),t.createEl("p",{text:"Complete some quizzes to see your history here.",cls:"quiz-history-empty-message"}),t.createEl("button",{text:"Generate quiz",cls:"quiz-history-empty-btn"}).addEventListener("click",()=>{this.app.commands.executeCommandById("flashly:generate-quiz")})}renderControls(e){let t=e.createDiv({cls:"quiz-history-controls"}),s=t.createDiv({cls:"quiz-history-control"});s.createSpan({text:"Status: ",cls:"quiz-history-control-label"});let i=s.createEl("select",{cls:"quiz-history-select"});[{value:"all",label:"All quizzes"},{value:"completed",label:"Completed only"},{value:"in-progress",label:"In progress only"}].forEach(d=>{let g=i.createEl("option",{text:d.label,value:d.value});d.value===this.filterState&&(g.selected=!0)}),i.addEventListener("change",d=>{this.filterState=d.target.value,this.queueRender()});let a=t.createDiv({cls:"quiz-history-control"});a.createSpan({text:"Sort by: ",cls:"quiz-history-control-label"});let l=a.createEl("select",{cls:"quiz-history-select"});[{value:"date",label:"Date (newest)"},{value:"score",label:"Score (highest)"},{value:"title",label:"Title (A-Z)"}].forEach(d=>{let g=l.createEl("option",{text:d.label,value:d.value});d.value===this.sortBy&&(g.selected=!0)}),l.addEventListener("change",d=>{this.sortBy=d.target.value,this.queueRender()});let p=t.createDiv({cls:"quiz-history-control"});p.createSpan({text:"Method: ",cls:"quiz-history-control-label"});let u=p.createEl("select",{cls:"quiz-history-select"});[{value:"all",label:"All methods"},{value:"traditional",label:"Traditional only"},{value:"ai",label:"AI generated only"}].forEach(d=>{let g=u.createEl("option",{text:d.label,value:d.value});d.value===this.filterMethod&&(g.selected=!0)}),u.addEventListener("change",d=>{this.filterMethod=d.target.value,this.queueRender()})}renderSummary(e,t){let s=e.createDiv({cls:"quiz-history-summary"}),i=t.length,n=t.reduce((p,u)=>p+(u.score||0),0)/i,a=t.reduce((p,u)=>p+u.totalQuestions,0),l=t.filter(p=>p.generationMethod==="ai-generated").length;[{label:"Total quizzes",value:i,icon:"file-text"},{label:"Average score",value:`${n.toFixed(1)}%`,icon:"target"},{label:"Questions answered",value:a,icon:"help-circle"},{label:"AI generated",value:l,icon:"sparkles"}].forEach(p=>{let u=s.createDiv({cls:"quiz-history-summary-card"}),m=u.createDiv({cls:"quiz-summary-icon"});(0,_e.setIcon)(m,p.icon);let d=u.createDiv({cls:"quiz-summary-content"});d.createDiv({text:String(p.value),cls:"quiz-summary-value"}),d.createDiv({text:p.label,cls:"quiz-summary-label"})})}renderQuizList(e,t){let s=e.createDiv({cls:"quiz-history-list"});t.forEach(i=>{let n=s.createDiv({cls:"quiz-history-card"});i.completed||n.addClass("quiz-card-in-progress");let a=n.createDiv({cls:"quiz-card-header"}),l=a.createDiv({cls:"quiz-card-title-section"});l.createDiv({text:i.title,cls:"quiz-card-title"}),l.createSpan({cls:"quiz-card-badge"}).setText(i.generationMethod==="ai-generated"?"AI":"Traditional"),i.completed||l.createSpan({cls:"quiz-card-in-progress-badge"}).setText("In progress"),i.config.learnMode&&l.createSpan({cls:"quiz-card-learn-mode-badge"}).setText("Learn mode");let p=a.createDiv({cls:"quiz-card-score"});if(i.completed)p.setText(`${i.score}%`),i.score>=90?p.addClass("quiz-score-excellent"):i.score>=70?p.addClass("quiz-score-good"):i.score>=50?p.addClass("quiz-score-fair"):p.addClass("quiz-score-poor");else{let v=i.questions.filter(S=>S.userAnswer!==void 0).length,b=Math.round(v/i.totalQuestions*100);p.setText(`${b}%`),p.addClass("quiz-progress-indicator")}let u=n.createDiv({cls:"quiz-card-details"}),m=u.createDiv({cls:"quiz-card-details-grid"});if(i.completed){m.createDiv({text:`${i.correctCount} / ${i.totalQuestions} correct`,cls:"quiz-card-detail"});let v=new Date(i.completed);m.createDiv({text:this.formatDate(v),cls:"quiz-card-detail"});let b=this.calculateTimeTaken(i);if(b&&m.createDiv({text:b,cls:"quiz-card-detail"}),i.learnModeStats){let S=u.createDiv({cls:"quiz-learn-stats"});S.createDiv({text:`First-try correct: ${i.learnModeStats.firstPassCorrect}/${i.totalQuestions}`}),S.createDiv({text:`Total attempts: ${i.learnModeStats.totalAttempts}`}),S.createDiv({text:`Questions retried: ${i.learnModeStats.questionsRequeued}`})}}else{let v=i.questions.filter(S=>S.userAnswer!==void 0).length;m.createDiv({text:`${v} / ${i.totalQuestions} answered`,cls:"quiz-card-detail"});let b=(i.currentQuestionIndex??0)+1;if(m.createDiv({text:`Currently on question ${b}`,cls:"quiz-card-detail"}),i.lastAccessed){let S=new Date(i.lastAccessed);m.createDiv({text:`Last accessed ${this.formatDate(S)}`,cls:"quiz-card-detail"})}}let d=n.createDiv({cls:"quiz-card-actions"});i.completed?(d.createEl("button",{text:"View",cls:"quiz-card-btn quiz-card-btn-primary"}).addEventListener("click",()=>void this.viewQuiz(i)),d.createEl("button",{text:"Retake",cls:"quiz-card-btn"}).addEventListener("click",()=>void this.retakeQuiz(i)),d.createEl("button",{text:"Export",cls:"quiz-card-btn"}).addEventListener("click",()=>void this.exportQuiz(i))):(d.createEl("button",{text:"Resume",cls:"quiz-card-btn quiz-card-btn-primary"}).addEventListener("click",()=>void this.resumeQuiz(i)),d.createEl("button",{text:"Start over",cls:"quiz-card-btn"}).addEventListener("click",()=>void this.startOver(i))),d.createEl("button",{text:"Delete",cls:"quiz-card-btn quiz-card-btn-danger"}).addEventListener("click",()=>this.confirmDelete(i))})}sortQuizzes(e){let t=[...e];switch(this.sortBy){case"date":t.sort((s,i)=>{let n=s.completed?new Date(s.completed):s.lastAccessed?new Date(s.lastAccessed):new Date(s.created);return(i.completed?new Date(i.completed):i.lastAccessed?new Date(i.lastAccessed):new Date(i.created)).getTime()-n.getTime()});break;case"score":t.sort((s,i)=>!s.completed&&i.completed?1:s.completed&&!i.completed?-1:(i.score||0)-(s.score||0));break;case"title":t.sort((s,i)=>s.title.localeCompare(i.title));break}return t}formatDate(e){let s=new Date().getTime()-e.getTime(),i=Math.floor(s/864e5);return i===0?"Today":i===1?"Yesterday":i<7?`${i} days ago`:e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}calculateTimeTaken(e){if(!e.completed||!e.created)return null;let t=new Date(e.completed).getTime()-new Date(e.created).getTime(),s=Math.floor(t/6e4),i=Math.floor(t%6e4/1e3);return s>0?`${s}m ${i}s`:`${i}s`}async viewQuiz(e){let t=this.app.workspace.getLeaf("tab");await t.setViewState({type:"flashly-quiz-view",active:!0});let s=t.view;s&&"loadQuiz"in s&&s.loadQuiz(e)}async retakeQuiz(e){let t={...e,id:`quiz-${Date.now()}`,created:new Date,completed:void 0,score:void 0,correctCount:void 0,state:"in-progress",lastAccessed:new Date,currentQuestionIndex:0,questions:e.questions.map(n=>({...n,userAnswer:void 0,correct:void 0,checked:void 0,attemptCount:void 0})),learnModeStats:e.config.learnMode?{totalAttempts:0,questionsRequeued:0,firstPassCorrect:0}:void 0};await this.plugin.quizStorage.addQuiz(t);let s=this.app.workspace.getLeaf("tab");await s.setViewState({type:"flashly-quiz-view",active:!0});let i=s.view;i&&"loadQuiz"in i&&i.loadQuiz(t),new _e.Notice("Quiz ready! Good luck!")}async resumeQuiz(e){let t=this.app.workspace.getLeaf("tab");await t.setViewState({type:"flashly-quiz-view",active:!0});let s=t.view;s&&"loadQuiz"in s&&s.loadQuiz(e),new _e.Notice("Resuming quiz...")}async startOver(e){e.questions.forEach(i=>{i.userAnswer=void 0,i.correct=void 0,i.checked=void 0,i.attemptCount=void 0}),e.currentQuestionIndex=0,e.lastAccessed=new Date,e.state="in-progress",e.learnModeStats&&(e.learnModeStats.savedQueue=void 0,e.learnModeStats.savedQueuePosition=void 0,e.learnModeStats.savedAnsweredQuestions=void 0),await this.plugin.quizStorage.updateQuiz(e);let t=this.app.workspace.getLeaf("tab");await t.setViewState({type:"flashly-quiz-view",active:!0});let s=t.view;s&&"loadQuiz"in s&&s.loadQuiz(e),new _e.Notice("Quiz reset. Starting from the beginning...")}async exportQuiz(e){try{let t=this.generateQuizMarkdown(e),s=e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),i=new Date(e.completed).toISOString().split("T")[0],n=`quiz_${s}_${i}.md`,a=await this.promptForFilePath(n);if(!a)return;await this.app.vault.create(a,t),new _e.Notice(`Quiz exported to ${a}`)}catch(t){console.error("Failed to export quiz:",t),new _e.Notice(`Failed to export quiz: ${t.message}`)}}generateQuizMarkdown(e){let t=new Date(e.completed).toLocaleString(),s=e.score||0,i=`# ${e.title}

`;return i+=`**Completed:** ${t}
`,i+=`**Score:** ${s}% (${e.correctCount}/${e.totalQuestions} correct)
`,i+=`**Generation method:** ${e.generationMethod==="ai-generated"?"AI-generated":"Traditional"}

`,i+=`---

`,e.questions.forEach((n,a)=>{i+=`## Question ${a+1}

`,i+=`**Type:** ${this.formatQuestionType(n.type)}

`,i+=`${n.prompt}

`,n.options&&n.options.length>0&&(i+=`**Options:**
`,n.options.forEach((l,h)=>{let p=n.type==="multiple-choice"&&n.correctAnswer===h,u=n.userAnswer===h,m=p?"\u2705":u?"\u274C":"";i+=`${h+1}. ${l} ${m}
`}),i+=`
`),i+=`**Your answer:** ${this.formatAnswerForExport(n,n.userAnswer)}
`,i+=`**Correct answer:** ${this.formatAnswerForExport(n,n.correctAnswer)}
`,i+=`**Result:** ${n.correct?"\u2705 Correct":"\u274C Incorrect"}
`,n.explanation&&(i+=`
**Explanation:** ${n.explanation}
`),i+=`
---

`}),i+=`## Summary

`,i+=`- **Total questions:** ${e.totalQuestions}
`,i+=`- **Correct answers:** ${e.correctCount}
`,i+=`- **Incorrect answers:** ${e.totalQuestions-(e.correctCount||0)}
`,i+=`- **Final score:** ${s}%
`,i+=`
---

`,i+=`*Exported from Flashly - spaced repetition flashcards for Obsidian*
`,i}formatAnswerForExport(e,t){return t==null?"(no answer)":e.type==="multiple-choice"&&typeof t=="number"&&e.options?`${t+1}. ${e.options[t]}`:String(t)}formatQuestionType(e){switch(e){case"multiple-choice":return"Multiple choice";case"fill-blank":return"Fill in the blank";case"true-false":return"True/false";default:return e}}async promptForFilePath(e){return new Promise(t=>{new Nr(this.app,e,i=>{t(i)}).open()})}confirmDelete(e){new Lr(this.app,e,()=>{(async()=>(await this.plugin.quizStorage.deleteQuiz(e.id),new _e.Notice("Quiz deleted"),this.queueRender()))()}).open()}queueRender(){this.renderQueue=this.renderQueue.then(()=>this.renderInternal()).catch(e=>{console.error("Flashly: failed to render quiz history view",e)})}},Nr=class extends _e.Modal{constructor(e,t,s){super(e);this.defaultName=t,this.onConfirm=s}onOpen(){let{contentEl:e}=this;e.addClass("flashly-export-quiz-modal"),e.createEl("h2",{text:"Export quiz"}),e.createEl("p",{text:"Choose where to save the exported quiz Markdown file."});let t=e.createEl("input",{type:"text",placeholder:"file path (e.g., quizzes/my-quiz.md)",value:this.defaultName});t.addClass("quiz-export-input"),t.focus();let s=e.createDiv({cls:"modal-button-container"}),i=s.createEl("button",{text:"Export",cls:"mod-cta"});i.addEventListener("click",()=>{let a=t.value.trim();a&&this.onConfirm(a),this.close()}),s.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.onConfirm(null),this.close()}),t.addEventListener("keydown",a=>{a.key==="Enter"&&i.click()})}onClose(){let{contentEl:e}=this;e.empty()}},Lr=class extends _e.Modal{constructor(e,t,s){super(e);this.quiz=t,this.onConfirm=s}onOpen(){let{contentEl:e}=this;e.addClass("flashly-confirm-delete-modal"),e.createEl("h2",{text:"Delete quiz?"}),e.createEl("p",{text:`Are you sure you want to delete "${this.quiz.title}"? This action cannot be undone.`});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(),this.close()}),t.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Bi=100,$i=20,qt=class{constructor(r){this.storage=r}build(r={}){let{decks:e,limitDue:t=Bi,limitNew:s=$i,includeLearning:i=!0,now:n,excludeEmptyAnswers:a=!0}=r,l=n??new Date,h=this.filterCards(this.storage.getAllCards(),{decks:e,includeLearning:i,excludeEmptyAnswers:a}),p=this.sortDue(h.filter(g=>this.isDue(g,l))),u=this.sortNew(h.filter(g=>this.isNew(g)));if(t<0||s<0)throw new Error("Queue limits must be non-negative.");let m=p.slice(0,t),d=u.slice(0,s);return{due:m,new:d,remainingDue:Math.max(0,p.length-m.length),remainingNew:Math.max(0,u.length-d.length),generatedAt:l,totalDue:p.length,totalNew:u.length}}filterCards(r,e){let t=e.decks?new Set(e.decks.map(s=>s.toLowerCase())):null;return r.filter(s=>!(e.excludeEmptyAnswers&&s.needsFilling||t&&!t.has(s.deck.toLowerCase())||!e.includeLearning&&s.fsrsCard.state===J.Learning))}isNew(r){return r.fsrsCard.state===J.New}isDue(r,e){if(!r.fsrsCard?.due||this.isNew(r))return!1;let t=new Date(e);return t.setHours(23,59,59,999),r.fsrsCard.due.getTime()<=t.getTime()}sortDue(r){return[...r].sort((e,t)=>{let s=e.fsrsCard.due.getTime()-t.fsrsCard.due.getTime();return s!==0?s:e.updated.getTime()-t.updated.getTime()})}sortNew(r){return[...r].sort((e,t)=>e.created.getTime()-t.created.getTime())}};var Qt=class{constructor(r){this.plugin=r;this.quizzes=new Map;this.quizHistory=[]}async load(){let r=await this.plugin.loadData();if(!r||!r.quizStorage){this.plugin.logger.debug("Quiz storage: No existing data found, initializing empty storage"),this.quizzes=new Map,this.quizHistory=[];return}let e=r.quizStorage;for(let[t,s]of Object.entries(e.quizzes||{}))this.quizzes.set(t,this.deserializeQuiz(s));this.quizHistory=e.quizHistory||[],this.plugin.logger.debug("Quiz storage loaded:",this.quizzes.size,"quizzes")}async save(){try{let r=await this.plugin.loadData()||{},e={quizzes:{},quizHistory:this.quizHistory};for(let[t,s]of this.quizzes.entries())e.quizzes[t]=this.serializeQuiz(s);r.quizStorage=e,await this.plugin.saveData(r),this.plugin.logger.debug("Quiz storage saved successfully:",this.quizzes.size,"quizzes")}catch(r){throw console.error("Failed to save quiz storage:",r),r}}async addQuiz(r){this.quizzes.set(r.id,r),this.quizHistory.unshift(r.id),await this.save()}async updateQuiz(r){if(!this.quizzes.has(r.id))throw new Error(`Quiz ${r.id} not found`);this.quizzes.set(r.id,r),await this.save()}getQuiz(r){return this.quizzes.get(r)}getAllQuizzes(){return Array.from(this.quizzes.values())}getQuizHistory(r){return(r?this.quizHistory.slice(0,r):this.quizHistory).map(t=>this.quizzes.get(t)).filter(t=>t!==void 0)}async deleteQuiz(r){this.quizzes.delete(r),this.quizHistory=this.quizHistory.filter(e=>e!==r),await this.save()}getStatistics(){let r=this.getAllQuizzes(),e=r.filter(t=>t.completed);return{total:r.length,completed:e.length,averageScore:e.length>0?e.reduce((t,s)=>t+(s.score||0),0)/e.length:0,totalQuestions:r.reduce((t,s)=>t+s.totalQuestions,0)}}serializeQuiz(r){return{id:r.id,title:r.title,created:r.created.toISOString(),completed:r.completed?.toISOString(),generationMethod:r.generationMethod,sourceCards:r.sourceCards,questions:r.questions,score:r.score,correctCount:r.correctCount,totalQuestions:r.totalQuestions,config:r.config}}deserializeQuiz(r){return{id:r.id,title:r.title,created:new Date(r.created),completed:r.completed?new Date(r.completed):void 0,generationMethod:r.generationMethod,sourceCards:r.sourceCards,questions:r.questions,score:r.score,correctCount:r.correctCount,totalQuestions:r.totalQuestions,config:r.config}}};var Mr=require("obsidian");var Ae={[q.Again]:"Again",[q.Hard]:"Hard",[q.Good]:"Good",[q.Easy]:"Easy"};var Bt=class{constructor(r=()=>new Date,e){this.clock=r,this.params=bt({enable_fuzz:!0,enable_short_term:!1,...e}),this.fsrs=new Ct(this.params)}now(r){return r??this.clock()}toPreview(r){return{[q.Again]:{rating:q.Again,label:Ae[q.Again],nextReview:r[q.Again].card.due,intervalDays:r[q.Again].card.scheduled_days},[q.Hard]:{rating:q.Hard,label:Ae[q.Hard],nextReview:r[q.Hard].card.due,intervalDays:r[q.Hard].card.scheduled_days},[q.Good]:{rating:q.Good,label:Ae[q.Good],nextReview:r[q.Good].card.due,intervalDays:r[q.Good].card.scheduled_days},[q.Easy]:{rating:q.Easy,label:Ae[q.Easy],nextReview:r[q.Easy].card.due,intervalDays:r[q.Easy].card.scheduled_days}}}getPreview(r,e){let t=this.fsrs.repeat(r.fsrsCard,this.now(e));return this.toPreview(t)}applyRating(r,e,t){let s=this.now(t),n=this.fsrs.repeat(r.fsrsCard,s)[e];return{updatedCard:{...r,fsrsCard:n.card,updated:s},rating:e,nextReview:n.card.due,intervalDays:n.card.scheduled_days,log:n.log}}formatDate(r){return r.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}};var Ui=24*60*60*1e3,Hi=10/(60*24),$t=class{constructor(r=()=>new Date){this.clock=r}now(r){return r??this.clock()}minutesToDays(r){return r/(60*24)}compute(r,e,t){let s=r.fsrsCard,i=Math.max(s.scheduled_days||0,1),n=s.reps??0,a=s.lapses??0,l=s.difficulty||2.5,h=l,p=i,u=n,m=a,d=J.Review;switch(e){case q.Again:{h=Math.max(1.3,l-.2),p=Hi,u=0,m=a+1,d=J.Relearning;break}case q.Hard:{h=Math.max(1.3,l-.15),p=Math.max(1,i*.5),u=n+1,d=J.Relearning;break}case q.Good:{h=l,n===0?p=1:n===1?p=6:p=Math.max(1,i*h),u=n+1,d=J.Review;break}case q.Easy:{h=l+.15,n===0?p=1:n===1?p=6:p=Math.max(1,i*h*1.3),u=n+1,d=J.Review;break}}let g=new Date(t.getTime()+p*Ui);return{intervalDays:p,due:g,easeFactor:h,reps:u,lapses:m,state:d}}getPreview(r,e){let t=this.now(e),s=this.compute(r,q.Again,t),i=this.compute(r,q.Hard,t),n=this.compute(r,q.Good,t),a=this.compute(r,q.Easy,t);return{[q.Again]:{rating:q.Again,label:Ae[q.Again],nextReview:s.due,intervalDays:s.intervalDays},[q.Hard]:{rating:q.Hard,label:Ae[q.Hard],nextReview:i.due,intervalDays:i.intervalDays},[q.Good]:{rating:q.Good,label:Ae[q.Good],nextReview:n.due,intervalDays:n.intervalDays},[q.Easy]:{rating:q.Easy,label:Ae[q.Easy],nextReview:a.due,intervalDays:a.intervalDays}}}applyRating(r,e,t){let s=this.now(t),i=this.compute(r,e,s),n={...r.fsrsCard,due:i.due,scheduled_days:i.intervalDays,last_review:s,difficulty:i.easeFactor,stability:Math.max(i.intervalDays,r.fsrsCard.stability??i.intervalDays),reps:i.reps,lapses:i.lapses,state:i.state};return{updatedCard:{...r,fsrsCard:n,updated:s},rating:e,nextReview:i.due,intervalDays:i.intervalDays,log:{scheduler:"sm2",rating:e,intervalDays:i.intervalDays}}}};var Ut=class{constructor(r){this.storage=r.storage,this.scheduler=r.scheduler;let e=[...r.queueSnapshot.due.map(s=>({card:s,type:"due"})),...r.queueSnapshot.new.map(s=>({card:s,type:"new"}))],t=e.length>0?new Date:null;this.state={status:e.length>0?"in-progress":"complete",startedAt:t,finishedAt:e.length>0?null:new Date,queue:e,index:0,showingAnswer:!1,completed:[],queueSnapshot:r.queueSnapshot}}isComplete(){return this.state.status==="complete"}getQueueSnapshot(){return this.state.queueSnapshot}getCurrentCard(){return this.isComplete()||this.state.queue.length===0?null:this.state.queue[this.state.index]??null}getCurrentPreview(r){let e=this.getCurrentCard();return e?this.scheduler.getPreview(e.card,r):null}getProgress(){return{currentIndex:Math.min(this.state.index,Math.max(this.state.queue.length-1,0)),totalCards:this.state.queue.length+this.state.completed.length,completed:this.state.completed.length,showingAnswer:this.state.showingAnswer}}toggleAnswer(){this.isComplete()||(this.state.showingAnswer=!this.state.showingAnswer)}async rateCard(r,e=new Date){let t=this.getCurrentCard();if(!t)return null;let s=this.scheduler.applyRating(t.card,r,e);return this.storage.updateCard(t.card.id,{fsrsCard:s.updatedCard.fsrsCard}),await this.storage.save(),this.state.completed.push({cardId:t.card.id,type:t.type,rating:r,outcome:s,completedAt:e}),this.removeCurrentCard(),this.state.queue.length===0?(this.state.status="complete",this.state.finishedAt=e):this.state.index=Math.min(this.state.index,this.state.queue.length-1),this.state.showingAnswer=!1,{outcome:s,remaining:this.state.queue.length,completed:this.state.completed.length,nextCard:this.getCurrentCard()?.card??null}}removeCurrentCard(){this.state.queue.length!==0&&this.state.queue.splice(this.state.index,1)}getSummary(){let r=this.state.completed.filter(t=>t.type==="due").length,e=this.state.completed.filter(t=>t.type==="new").length;return{totalReviewed:this.state.completed.length,reviewedDue:r,reviewedNew:e,startedAt:this.state.startedAt,finishedAt:this.state.finishedAt}}getCompleted(){return[...this.state.completed]}};var Ie=require("obsidian");var ps=[q.Again,q.Hard,q.Good,q.Easy],Ht=class extends Ie.Modal{constructor(e,t,s){super(e);this.viewModel=t;this.options=s;this.ratingButtons=new Map;this.component=null;this.isAnimating=!1;this.currentCardId=null;this.boundKeydown=i=>this.handleKeydown(i)}onOpen(){if(this.viewModel.isComplete()){new Ie.Notice("No cards available for review."),this.close();return}this.component=new Ie.Component,this.component.load(),this.buildLayout(),this.render(),this.options.enableKeyboardShortcuts&&window.addEventListener("keydown",this.boundKeydown)}onClose(){this.component&&(this.component.unload(),this.component=null),this.contentEl.empty(),this.options.enableKeyboardShortcuts&&window.removeEventListener("keydown",this.boundKeydown)}buildLayout(){let{contentEl:e}=this;e.empty(),e.addClass("flashly-review-modal"),e.createEl("h2",{text:"Flashly review session"}).addClass("flashly-review-title"),this.cardContainer=e.createDiv({cls:"flashly-card-container"}),this.cardInner=this.cardContainer.createDiv({cls:"flashly-card-inner"});let s=this.cardInner.createDiv({cls:"flashly-card-face flashly-card-front flashly-card-clickable"});this.frontEl=s.createDiv({cls:"flashly-card-content"}),s.addEventListener("click",a=>{(a.target===s||s.contains(a.target))&&this.toggleWithAnimation()});let i=this.cardInner.createDiv({cls:"flashly-card-face flashly-card-back flashly-card-clickable"});this.backEl=i.createDiv({cls:"flashly-card-content"}),i.addEventListener("click",a=>{(a.target===i||i.contains(a.target))&&this.toggleWithAnimation()});let n=e.createDiv({cls:"flashly-rating-container"});ps.forEach(a=>{let l=n.createEl("button",{text:"...",cls:"flashly-rating-btn"});l.addEventListener("click",()=>{this.handleRating(a)}),this.ratingButtons.set(a,l)}),this.progressEl=e.createDiv({cls:"flashly-session-progress"})}render(){if(this.viewModel.isComplete()){this.renderSummary(),this.options.onComplete?.(this.viewModel.getSummary());return}this.renderCard(),this.renderRatings(),this.renderProgress()}renderCard(){let e=this.viewModel.getCurrentCard();if(!e)return;let t=this.viewModel.getProgress().showingAnswer,s=this.currentCardId!==e.card.id;s&&!t?(this.cardInner.addClass("no-transition"),this.cardInner.removeClass("flipped"),this.cardInner.offsetHeight,this.cardInner.removeClass("no-transition"),this.currentCardId=e.card.id):(this.cardInner.toggleClass("flipped",t),s&&(this.currentCardId=e.card.id)),this.component&&this.component.unload(),this.component=new Ie.Component,this.component.load(),this.frontEl.empty(),this.backEl.empty(),this.component&&(Ie.MarkdownRenderer.render(this.app,e.card.front,this.frontEl,e.card.source.file,this.component),Ie.MarkdownRenderer.render(this.app,e.card.back,this.backEl,e.card.source.file,this.component))}renderRatings(){let e=this.viewModel.getCurrentPreview();e&&ps.forEach(t=>{let s=e[t],i=this.ratingButtons.get(t);if(!s||!i)return;let n=this.formatInterval(s.intervalDays);i.setText(`${s.label} - ${n}`),i.setAttr("data-rating",s.label.toLowerCase())})}renderProgress(){let e=this.viewModel.getProgress(),t=this.viewModel.getQueueSnapshot(),s=Math.max(t.totalDue-this.countCompletedOfType("due"),0),i=Math.max(t.totalNew-this.countCompletedOfType("new"),0);this.progressEl.setText(`${e.completed}/${e.totalCards} reviewed - ${s} due remaining - ${i} new remaining`)}countCompletedOfType(e){return this.viewModel.getCompleted().filter(t=>t.type===e).length}async handleRating(e){this.viewModel.isComplete()||(await this.viewModel.rateCard(e),this.render())}handleKeydown(e){if(!e.defaultPrevented)switch(e.key){case" ":e.preventDefault(),this.toggleWithAnimation();break;case"1":e.preventDefault(),this.handleRating(q.Again);break;case"2":e.preventDefault(),this.handleRating(q.Hard);break;case"3":e.preventDefault(),this.handleRating(q.Good);break;case"4":e.preventDefault(),this.handleRating(q.Easy);break;case"Escape":e.preventDefault(),this.close();break}}renderSummary(){let e=this.viewModel.getSummary(),{contentEl:t}=this;t.empty();let s=t.createDiv({cls:"flashly-summary-container"});s.createEl("h2",{text:"Review session complete!"}),s.createEl("p",{text:`Reviewed ${e.totalReviewed} card${e.totalReviewed===1?"":"s"}.`});let i=s.createEl("ul");i.createEl("li",{text:`${e.reviewedDue} due cards`}),i.createEl("li",{text:`${e.reviewedNew} new cards`}),s.createEl("button",{text:"Close",cls:"mod-cta"}).addEventListener("click",()=>this.close())}toggleWithAnimation(){this.isAnimating||(this.isAnimating=!0,this.cardInner.addClass("animating"),this.viewModel.toggleAnswer(),this.renderCard(),setTimeout(()=>{this.cardInner.removeClass("animating"),this.isAnimating=!1},400))}formatInterval(e){if(e<1){let s=Math.round(e*24*60);if(s<60)return`${s} minute${s===1?"":"s"}`;let i=Math.round(e*24);return`${i} hour${i===1?"":"s"}`}if(e<7){let s=Math.round(e);return`${s} day${s===1?"":"s"}`}let t=Math.round(e/7);return`${t} week${t===1?"":"s"}`}};var gs=require("obsidian"),jt=Symbol("ALL_DECKS"),fs="All decks",Ye=class extends gs.SuggestModal{constructor(e,t,s){super(e);this.selection=null;this.decks=t,this.onSelect=s,this.setPlaceholder("Select a deck to review")}getSuggestions(e){let t=e.trim().toLowerCase(),s=[jt,...this.decks];return t?s.filter(i=>i===jt?fs.toLowerCase().includes(t):i.toLowerCase().includes(t)):s}renderSuggestion(e,t){let s=e===jt?fs:e;t.createEl("div",{text:s})}onChooseSuggestion(e){this.selection=e===jt?void 0:[e],this.close()}onClose(){this.onSelect(this.selection)}};var Gt=class{constructor(r,e,t,s,i){this.app=r;this.storage=e;this.queueService=t;this.getSettings=s;this.plugin=i}getId(){return"start-review"}getName(){return"Start review session"}getCallback(){return()=>this.startReview()}createScheduler(r){return r==="sm2"?new $t:new Bt}async startReview(r){let e=this.getSettings(),t=this.createScheduler(e.review.scheduler),s=await this.resolveDeckSelection(e,r??void 0);if(s===null){new Mr.Notice("Review cancelled.");return}let i=this.queueService.build({decks:s??void 0,limitDue:e.review.limits.reviewPerDay,limitNew:e.review.limits.newPerDay,includeLearning:e.review.includeLearningCards,excludeEmptyAnswers:e.review.excludeEmptyCards});if(i.due.length===0&&i.new.length===0){new Mr.Notice("No flashcards are due or new. Great job staying on track!");return}let n=new Ut({storage:this.storage,scheduler:t,queueSnapshot:i});new Ht(this.app,n,{enableKeyboardShortcuts:e.review.enableKeyboardShortcuts,onComplete:l=>{this.storage.recordReviewSession(l),this.storage.save(),this.plugin&&this.plugin.refreshBrowserViews()}}).open()}async resolveDeckSelection(r,e){if(e&&e.length>0)return e;if(r.review.deckFilter.length>0)return r.review.deckFilter;let t=this.storage.getDeckNames().sort((s,i)=>s.localeCompare(i));if(t.length!==0)return t.length===1?[t[0]]:new Promise(s=>{new Ye(this.app,t,n=>s(n)).open()})}};var Vt=require("obsidian");var Wt=class{constructor(r,e,t,s){this.app=r;this.storage=e;this.getSettings=t;this.plugin=s}getId(){return"refresh-decks"}getName(){return"Force decks ready for review"}getCallback(){return()=>this.refreshDecks()}async refreshDecks(r){let e=this.getSettings(),t=await this.resolveDeckSelection(e,r);if(t===null){new Vt.Notice("Refresh cancelled.");return}let s=t?new Set(t.map(l=>l.toLowerCase())):null,i=this.storage.getAllCards(),n=new Date,a=0;for(let l of i){if(s&&!s.has(l.deck.toLowerCase()))continue;let{fsrsCard:h}=l,p={...h,due:new Date(n.getTime()-60*1e3),state:h.state===J.New?J.Review:h.state};this.storage.updateCard(l.id,{fsrsCard:p}),a++}if(a===0){new Vt.Notice("No matching cards found to refresh.");return}await this.storage.save(),this.plugin&&this.plugin.refreshBrowserViews(),new Vt.Notice(`Forced ${a} card${a===1?"":"s"} ready for review.`)}async resolveDeckSelection(r,e){if(e&&e.length>0)return e;if(r.review.deckFilter.length>0)return r.review.deckFilter;let t=this.storage.getDeckNames().sort((s,i)=>s.localeCompare(i));if(t.length!==0)return t.length===1?[t[0]]:new Promise(s=>{new Ye(this.app,t,s).open()})}};var ve=require("obsidian");var Kt=class{generateQuestions(r,e){if(r.length===0)throw new Error("No cards available to generate quiz");let t=[],s=[];if(e.includeMultipleChoice&&s.push("multiple-choice"),e.includeFillBlank&&s.push("fill-blank"),e.includeTrueFalse&&s.push("true-false"),s.length===0)throw new Error("At least one question type must be enabled");let i=this.shuffleArray([...r]),n=Math.floor(e.questionCount/s.length),a=e.questionCount%s.length,l=0;for(s.forEach((h,p)=>{let u=n+(p<a?1:0);for(let m=0;m<u&&l<i.length;m++){let d=i[l];l++;try{let g=null;switch(h){case"multiple-choice":g=this.generateMultipleChoice(d,r);break;case"fill-blank":g=this.generateFillBlank(d);break;case"true-false":g=this.generateTrueFalse(d,r);break}g&&t.push(g)}catch(g){console.warn(`Failed to generate ${h} question for card ${d.id}:`,g)}}});t.length<e.questionCount&&l<i.length;){let h=i[l];l++;for(let p of s)try{let u=null;switch(p){case"multiple-choice":u=this.generateMultipleChoice(h,r);break;case"fill-blank":u=this.generateFillBlank(h);break;case"true-false":u=this.generateTrueFalse(h,r);break}if(u){t.push(u);break}}catch{continue}}return t.slice(0,e.questionCount)}generateMultipleChoice(r,e){if(!r.back||r.back.trim()==="")return null;let t=e.filter(h=>h.deck===r.deck&&h.id!==r.id&&h.back&&h.back.trim()!==""&&h.back!==r.back);if(t.length<3)return null;let n=[...this.shuffleArray(t).slice(0,3).map(h=>h.back.trim()),r.back.trim()],a=this.shuffleArray(n),l=a.indexOf(r.back.trim());return{id:`q-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,type:"multiple-choice",prompt:r.front,options:a,correctAnswer:l,sourceCardId:r.id}}generateFillBlank(r){let e=/\{([^}]+)\}/g,t=r.front.match(e);if(!t||t.length===0)return!r.back||r.back.trim()===""?null:{id:`q-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,type:"fill-blank",prompt:r.front,correctAnswer:r.back.trim(),sourceCardId:r.id};let s=t[0],i=s.slice(1,-1),n=r.front.replace(s,"_____");return{id:`q-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,type:"fill-blank",prompt:n,correctAnswer:i.trim(),sourceCardId:r.id}}generateTrueFalse(r,e){if(!r.back||r.back.trim()==="")return null;let t=Math.random()>.5,s,i;if(t)s=`True or False: ${r.front} - ${r.back}`,i="true";else{let n=e.filter(a=>a.deck===r.deck&&a.id!==r.id&&a.back&&a.back.trim()!==""&&a.back!==r.back);if(n.length===0)s=`True or False: ${r.front} - ${r.back}`,i="true";else{let a=n[Math.floor(Math.random()*n.length)];s=`True or False: ${r.front} - ${a.back}`,i="false"}}return{id:`q-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,type:"true-false",prompt:s,options:["True","False"],correctAnswer:i,sourceCardId:r.id}}shuffleArray(r){let e=[...r];for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}};var dt=require("obsidian"),Zt=class{constructor(r,e){this.settings=r;this.logger=e}async generateQuestions(r,e){if(r.length===0)throw new Error("No cards available to generate quiz");if(!this.settings.enabled)throw new Error("AI quiz generation is not enabled in settings");let t=r.map(a=>({id:a.id,front:a.front,back:a.back,deck:a.deck})),s=this.buildPrompt(t,e),i;switch(this.settings.provider){case"openai":i=await this.callOpenAI(s);break;case"anthropic":i=await this.callAnthropic(s);break;case"gemini":i=await this.callGemini(s);break;case"custom":i=await this.callCustomAPI(s);break;default:return this.handleUnknownProvider(this.settings.provider)}let n=this.removeDuplicateQuestions(i.questions);return n.length<i.questions.length&&this.logger?.log(`Removed ${i.questions.length-n.length} duplicate question(s)`),n}handleUnknownProvider(r){throw new Error(`Unknown AI provider: ${String(r)}`)}buildPrompt(r,e){let t=[];return e.includeMultipleChoice&&t.push("multiple-choice"),e.includeFillBlank&&t.push("fill-in-the-blank"),e.includeTrueFalse&&t.push("true-false"),`You are an educational quiz generator. Generate ${e.questionCount} quiz questions from the following flashcards.

**Question Types to Generate:**
${t.map(s=>`- ${s}`).join(`
`)}

**Flashcards:**
${r.map((s,i)=>`${i+1}. Q: ${s.front}
   A: ${s.back}`).join(`

`)}

**Instructions:**
1. Generate exactly ${e.questionCount} questions
2. Distribute questions evenly across the requested types
3. For multiple-choice questions, provide 4 options with the correct answer
4. For fill-in-the-blank, create a clear prompt with a blank to fill
5. For true-false, create statements that test understanding
6. Make questions clear, unambiguous, and test real understanding
7. Use varied difficulty levels
8. IMPORTANT: Each question must be unique - do NOT create duplicate questions with the same or very similar prompts

**Response Format (JSON):**
{
  "questions": [
    {
      "type": "multiple-choice",
      "prompt": "Question text here",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correctAnswer": 0,
      "explanation": "Optional explanation"
    },
    {
      "type": "fill-blank",
      "prompt": "Question with _____ to fill",
      "correctAnswer": "answer text",
      "explanation": "Optional explanation"
    },
    {
      "type": "true-false",
      "prompt": "Statement to evaluate",
      "options": ["True", "False"],
      "correctAnswer": "true",
      "explanation": "Optional explanation"
    }
  ]
}

Respond ONLY with valid JSON in the format above. Do not include any other text.`}removeDuplicateQuestions(r){let e=new Set,t=[];for(let s of r){let i=s.prompt.toLowerCase().trim().replace(/\s+/g," ");e.has(i)||(e.add(i),t.push(s))}return t}async callOpenAI(r){if(!this.settings.openai?.apiKey)throw new Error("OpenAI API key not configured");let e=this.settings.openai.baseUrl||"https://api.openai.com/v1",t=this.settings.openai.model||"gpt-4";try{let i=(await(0,dt.requestUrl)({url:`${e}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.settings.openai.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:t,messages:[{role:"system",content:this.settings.systemPrompt||"You are a helpful educational assistant that generates quiz questions."},{role:"user",content:r}],temperature:this.settings.temperature,max_tokens:this.settings.maxTokens})})).json,n=i.choices[0].message.content;return{questions:JSON.parse(n).questions.map(h=>({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:h.type,prompt:h.prompt,options:h.options,correctAnswer:h.correctAnswer,explanation:h.explanation})),metadata:{model:i.model,tokensUsed:i.usage?.total_tokens}}}catch(s){throw console.error("OpenAI API error:",s),new Error(`Failed to generate quiz with OpenAI: ${s.message}`)}}async callAnthropic(r){if(!this.settings.anthropic?.apiKey)throw new Error("Anthropic API key not configured");let e=this.settings.anthropic.baseUrl||"https://api.anthropic.com/v1",t=this.settings.anthropic.model||"claude-3-5-sonnet-20241022";try{let i=(await(0,dt.requestUrl)({url:`${e}/messages`,method:"POST",headers:{"x-api-key":this.settings.anthropic.apiKey,"anthropic-version":"2023-06-01","Content-Type":"application/json"},body:JSON.stringify({model:t,max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,system:this.settings.systemPrompt||"You are a helpful educational assistant that generates quiz questions.",messages:[{role:"user",content:r}]})})).json,n=i.content[0].text;return{questions:JSON.parse(n).questions.map(h=>({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:h.type,prompt:h.prompt,options:h.options,correctAnswer:h.correctAnswer,explanation:h.explanation})),metadata:{model:i.model,tokensUsed:i.usage?.input_tokens+i.usage?.output_tokens}}}catch(s){throw console.error("Anthropic API error:",s),new Error(`Failed to generate quiz with Anthropic: ${s.message}`)}}async callGemini(r){if(!this.settings.gemini?.apiKey)throw new Error("Gemini API key not configured");let e=this.settings.gemini.baseUrl||"https://generativelanguage.googleapis.com/v1beta",t=this.settings.gemini.model||"gemini-1.5-flash",s;try{let u=`${e}/models/${t}:generateContent`;this.logger?.debug("Gemini API URL:",u),this.logger?.debug("Using Gemini model:",t),s=await(0,dt.requestUrl)({url:u,method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.settings.gemini.apiKey},body:JSON.stringify({contents:[{parts:[{text:`${this.settings.systemPrompt||"You are a helpful educational assistant that generates quiz questions."}

${r}`}]}],generationConfig:{temperature:this.settings.temperature,maxOutputTokens:this.settings.maxTokens,responseMimeType:"application/json"}})})}catch(u){let m=u;console.error("Gemini API request failed:",m),console.error("Error status:",m.status);let d="Unknown error";try{if(m.json){let g=m.json;console.error("Gemini error response:",JSON.stringify(g,null,2)),g.error?.message?d=g.error.message:g.message?d=g.message:d=JSON.stringify(g)}else m.text&&(d=m.text,console.error("Gemini error text:",d))}catch(g){console.error("Could not parse error response:",g)}throw m.status===400?new Error(`Gemini API returned 400 Bad Request: ${d}. Common causes: invalid model name (check that '${t}' exists), invalid parameters, or malformed request.`):m.status===401||m.status===403?new Error(`Gemini API authentication failed (${m.status}): ${d}. Check your API key in settings.`):m.status===429?new Error(`Gemini API rate limit exceeded: ${d}. Please wait and try again.`):new Error(`Gemini API request failed (status ${m.status??"unknown"}): ${d}`)}let i=s.json;if(this.logger?.debug("Full Gemini API response:",JSON.stringify(i,null,2)),!i.candidates||i.candidates.length===0)throw console.error("No candidates in response:",i),i.promptFeedback?.blockReason?new Error(`Gemini blocked the request: ${i.promptFeedback.blockReason}. Reason: ${i.promptFeedback.safetyRatings?.[0]?.category||"Unknown"}`):new Error("Gemini returned no response candidates. The request may have been blocked or failed.");let n=i.candidates[0],a=n.content.parts[0].text,l=n.finishReason;if(this.logger?.log("Gemini finishReason:",l),this.logger?.log("Response length:",a.length,"characters"),l==="MAX_TOKENS"||l==="LENGTH")throw console.warn(`Gemini response was truncated. Finish reason: ${l}`),new Error(`Quiz generation incomplete: Response was too long (finish reason: ${l}). Try generating fewer questions or increase max tokens in settings.`);if(l!=="STOP"&&l!=="FINISH_REASON_UNSPECIFIED"&&console.warn(`Unexpected finish reason: ${l}`),this.logger?.debug("Raw Gemini response (first 500 chars):",a.substring(0,500)+"..."),this.logger?.debug("Raw Gemini response (last 200 chars):","..."+a.substring(Math.max(0,a.length-200))),a=a.trim(),a.startsWith("```")&&(a=a.replace(/^```(?:json)?\s*\n/,""),a=a.replace(/\n```\s*$/,""),a=a.trim()),!a.startsWith("{")||!a.endsWith("}"))throw console.error("Content does not look like complete JSON"),console.error("Starts with:",a.substring(0,50)),console.error("Ends with:",a.substring(Math.max(0,a.length-50))),new Error("Response appears incomplete (doesn't start/end with braces). This usually means the response was truncated. Try generating fewer questions or increase max tokens.");let h;try{h=JSON.parse(a)}catch(u){console.error("JSON parse error:",u),console.error("Failed content length:",a.length),console.error("Failed content (first 500 chars):",a.substring(0,500)),console.error("Failed content (last 200 chars):",a.substring(Math.max(0,a.length-200)));let m=u instanceof Error?u.message:"Unknown parse error";throw new Error(`Invalid JSON response from Gemini (${m}). The response was likely truncated. Try generating fewer questions (current settings requested questions may be too many) or increase max tokens in settings.`)}if(!h.questions||!Array.isArray(h.questions))throw console.error("Invalid response structure:",h),new Error('Gemini response missing "questions" array');return{questions:h.questions.map(u=>({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:u.type,prompt:u.prompt,options:u.options,correctAnswer:u.correctAnswer,explanation:u.explanation})),metadata:{model:t,tokensUsed:i.usageMetadata?.totalTokenCount}}}async callCustomAPI(r){if(!this.settings.custom?.apiKey||!this.settings.custom?.baseUrl)throw new Error("Custom API configuration incomplete");try{let e={Authorization:`Bearer ${this.settings.custom.apiKey}`,"Content-Type":"application/json",...this.settings.custom.headers},t=this.settings.custom.endpoint||"/chat/completions",s=this.settings.custom.baseUrl.replace(/\/+$/,""),i=t.startsWith("/")?`${s}${t}`:`${s}/${t}`,l=(await(0,dt.requestUrl)({url:i,method:"POST",headers:e,body:JSON.stringify({model:this.settings.custom.model,messages:[{role:"system",content:this.settings.systemPrompt||"You are a helpful educational assistant that generates quiz questions."},{role:"user",content:r}],temperature:this.settings.temperature,max_tokens:this.settings.maxTokens})})).json.choices[0].message.content;return{questions:JSON.parse(l).questions.map(u=>({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:u.type,prompt:u.prompt,options:u.options,correctAnswer:u.correctAnswer,explanation:u.explanation})),metadata:{model:this.settings.custom.model}}}catch(e){throw console.error("Custom API error:",e),new Error(`Failed to generate quiz with custom API: ${e.message}`)}}};var Pr=class extends ve.Modal{constructor(e,t){super(e);this.plugin=t,this.config={...is}}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("flashly-generate-quiz-modal"),e.createEl("h2",{text:"Generate quiz"}),new ve.Setting(e).setName("Quiz title").setDesc("Give your quiz a name").addText(p=>{p.setPlaceholder("My quiz"),p.inputEl.id="quiz-title-input"}),new ve.Setting(e).setName("Number of questions").setDesc("How many questions to generate").addText(p=>{p.inputEl.type="number",p.setValue(String(this.config.questionCount)),p.onChange(u=>{let m=parseInt(u);this.config.questionCount=isNaN(m)?20:Math.max(1,m)})}),e.createEl("h3",{text:"Question types"}),new ve.Setting(e).setName("Multiple choice").setDesc("Include multiple choice questions").addToggle(p=>{p.setValue(this.config.includeMultipleChoice),p.onChange(u=>{this.config.includeMultipleChoice=u})}),new ve.Setting(e).setName("Fill in the blank").setDesc("Include fill-in-the-blank questions").addToggle(p=>{p.setValue(this.config.includeFillBlank),p.onChange(u=>{this.config.includeFillBlank=u})}),new ve.Setting(e).setName("True/false").setDesc("Include true/false questions").addToggle(p=>{p.setValue(this.config.includeTrueFalse),p.onChange(u=>{this.config.includeTrueFalse=u})}),new ve.Setting(e).setName("Learn mode").setDesc("Get immediate feedback and retry incorrect answers until you master all questions").addToggle(p=>{p.setValue(this.config.learnMode??!1),p.onChange(u=>{this.config.learnMode=u})}),new ve.Setting(e).setName("Filter by decks").setDesc("Select which decks to include (leave all unchecked for all decks)");let t=this.plugin.storage.getAllCards(),s=new Set;t.forEach(p=>{p.deck&&s.add(p.deck)});let i=Array.from(s).sort(),n=e.createDiv({cls:"quiz-deck-selection"});if(i.length===0)n.createDiv({text:"No decks found. Create some flashcards first!",cls:"quiz-warning"});else{let p=new Set,m=n.createDiv({cls:"quiz-deck-search-container"}).createEl("input",{type:"text",placeholder:"Search decks...",cls:"quiz-deck-search-input"}),d=n.createDiv({cls:"quiz-deck-controls"}),g=d.createEl("button",{text:"Select all",cls:"quiz-deck-control-btn"}),v=d.createEl("button",{text:"Deselect all",cls:"quiz-deck-control-btn"}),b=n.createDiv({cls:"quiz-deck-list"}),S=[];i.forEach(z=>{let x=b.createDiv({cls:"quiz-deck-item"}),N=x.createEl("input",{type:"checkbox"});N.id=`deck-${z}`,x.createEl("label",{text:z,attr:{for:`deck-${z}`}}).addClass("quiz-deck-label");let k=t.filter(y=>y.deck===z).length;x.createSpan({text:` (${k} card${k!==1?"s":""})`,cls:"quiz-deck-count"}),N.addEventListener("change",()=>{N.checked?p.add(z):p.delete(z),this.config.deckFilter=Array.from(p)}),S.push({element:x,name:z,checkbox:N})}),m.addEventListener("input",()=>{let z=m.value.toLowerCase();S.forEach(F=>{let k=F.name.toLowerCase().includes(z);F.element.toggleClass("hidden",!k)});let x=S.filter(F=>!F.element.hasClass("hidden")),N=b.querySelector(".quiz-deck-no-results");x.length===0?(N||(N=b.createDiv({text:"No decks found",cls:"quiz-deck-no-results"})),N.removeClass("hidden")):N&&N.addClass("hidden")}),g.addEventListener("click",z=>{z.preventDefault(),S.forEach(x=>{x.element.hasClass("hidden")||(p.add(x.name),x.checkbox.checked=!0)}),this.config.deckFilter=Array.from(p)}),v.addEventListener("click",z=>{z.preventDefault(),S.forEach(x=>{x.element.hasClass("hidden")||(p.delete(x.name),x.checkbox.checked=!1)}),this.config.deckFilter=Array.from(p)})}this.plugin.settings.quiz.enabled&&(e.createEl("h3",{text:"AI generation"}),new ve.Setting(e).setName("Use AI to generate questions").setDesc("Use AI to create creative quiz questions").addToggle(p=>{p.setValue(this.config.useAI),p.onChange(u=>{this.config.useAI=u})}),this.plugin.settings.quiz.provider==="openai"&&!this.plugin.settings.quiz.openai?.apiKey?e.createDiv({text:"\u26A0\uFE0F OpenAI API key not configured. Please configure in settings.",cls:"quiz-warning"}):this.plugin.settings.quiz.provider==="anthropic"&&!this.plugin.settings.quiz.anthropic?.apiKey?e.createDiv({text:"\u26A0\uFE0F Anthropic API key not configured. Please configure in settings.",cls:"quiz-warning"}):this.plugin.settings.quiz.provider==="gemini"&&!this.plugin.settings.quiz.gemini?.apiKey?e.createDiv({text:"\u26A0\uFE0F Gemini API key not configured. Please configure in settings.",cls:"quiz-warning"}):this.plugin.settings.quiz.provider==="custom"&&(!this.plugin.settings.quiz.custom?.apiKey||!this.plugin.settings.quiz.custom?.baseUrl)&&e.createDiv({text:"\u26A0\uFE0F Custom API not fully configured. Please configure in settings.",cls:"quiz-warning"}));let a=e.createDiv({cls:"modal-button-container"});a.createEl("button",{text:"Generate quiz",cls:"mod-cta"}).addEventListener("click",()=>{this.generateQuiz()}),a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}async generateQuiz(){try{if(!this.config.includeMultipleChoice&&!this.config.includeFillBlank&&!this.config.includeTrueFalse){new ve.Notice("Please select at least one question type");return}let t=this.contentEl.querySelector("#quiz-title-input")?.value||"Untitled Quiz",s=this.plugin.storage.getAllCards();if(this.config.deckFilter&&this.config.deckFilter.length>0&&(s=s.filter(u=>this.config.deckFilter.some(m=>u.deck.toLowerCase().includes(m.toLowerCase())))),s.length===0){new ve.Notice("No cards available. Please scan for flashcards first.");return}!this.config.useAI&&s.length<this.config.questionCount&&(new ve.Notice(`Only ${s.length} cards available. Generating ${s.length} questions instead.`),this.config.questionCount=s.length);let i=new ve.Notice("Generating quiz...",0),n,a;this.config.useAI&&this.plugin.settings.quiz.enabled?(a="ai-generated",n=await new Zt(this.plugin.settings.quiz,this.plugin.logger).generateQuestions(s,this.config),i.hide(),new ve.Notice("Quiz generated with AI! \u{1F916}")):(a="traditional",n=new Kt().generateQuestions(s,this.config),i.hide(),new ve.Notice("Quiz generated! \u{1F4DD}"));let l=rs(t,n,s.map(u=>u.id),this.config,a);await this.plugin.quizStorage.addQuiz(l);let h=this.app.workspace.getLeaf("tab");await h.setViewState({type:"flashly-quiz-view",active:!0});let p=h.view;p&&"loadQuiz"in p&&p.loadQuiz(l),this.close()}catch(e){console.error("Failed to generate quiz:",e),new ve.Notice(`Failed to generate quiz: ${e.message}`)}}onClose(){let{contentEl:e}=this;e.empty()}},Yt=class{constructor(r,e){this.app=r;this.plugin=e}getId(){return"generate-quiz"}getName(){return"Generate quiz"}getCallback(){return()=>{new Pr(this.app,this.plugin).open()}}};var Jr=require("obsidian");var Br=pt(ms());var Jt=class{transform(r,e){let t=[];for(let s of r){let i={Front:this.cleanText(s.front),Back:this.cleanText(s.back),Deck:s.deck,Tags:e.includeTags?s.tags.join(","):""};e.includeScheduling&&s.fsrsCard&&(i.State=cs(s.fsrsCard.state),i.Due=s.fsrsCard.due?s.fsrsCard.due.toISOString():"",i.Interval=s.fsrsCard.scheduled_days||0,i.EaseFactor=s.fsrsCard.difficulty||2.5),i.Created=s.created.toISOString(),i.Updated=s.updated.toISOString(),i.SourceFile=s.source.file,i.SourceLine=s.source.line,t.push(i)}return t}validate(r){if(!Array.isArray(r))return!1;if(r.length===0)return!0;let e=r[0];return typeof e.Front=="string"&&typeof e.Back=="string"&&typeof e.Deck=="string"}cleanText(r){return r.replace(/\r\n/g," ").replace(/\n/g," ").trim()}},Xt=class{transform(r,e){return r.map(t=>({term:this.stripMarkdown(t.front),definition:this.stripMarkdown(t.back)}))}validate(r){if(!Array.isArray(r))return!1;if(r.length===0)return!0;let e=r[0];return typeof e.term=="string"&&typeof e.definition=="string"}stripMarkdown(r){return r.replace(/^#{1,6}\s+/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/`([^`]+)`/g,"$1").replace(/!\[([^\]]*)\]\([^)]+\)/g,"").replace(/\r\n/g," ").replace(/\n/g," ").trim()}};var er=class{export(r,e){let t;return e.format==="csv-quizlet"?t=this.exportQuizlet(r,e):t=this.exportGeneric(r,e),t}exportGeneric(r,e){let s=new Jt().transform(r,e),i=e.includeBOM?"\uFEFF":"",n=Br.unparse(s,{delimiter:e.delimiter||",",header:e.includeHeaders!==!1,newline:`\r
`,quotes:!0,quoteChar:'"',escapeChar:'"'});return i+n}exportQuizlet(r,e){let s=new Xt().transform(r,e),i=e.includeBOM?"\uFEFF":"",n=Br.unparse(s,{delimiter:",",header:!0,columns:["term","definition"],newline:`\r
`,quotes:!0,quoteChar:'"',escapeChar:'"'});return i+n}};var tr=class{constructor(r){this.options=r;this.codeBlockPlaceholders=new Map}convert(r){if(this.options.plainTextMode)return this.stripAllFormatting(r);let e=r;return e=this.protectCodeBlocks(e),e=this.convertHeaders(e),e=this.convertLists(e),e=this.convertBlockquotes(e),e=this.convertHorizontalRules(e),this.options.stripObsidianSyntax||(e=this.convertWikilinks(e),e=this.convertHighlights(e),e=this.convertCallouts(e)),e=this.removeComments(e),e=this.convertImages(e),e=this.convertInlineCode(e),e=this.convertLinks(e),e=this.convertBold(e),e=this.convertItalic(e),e=this.convertStrikethrough(e),e=this.restoreCodeBlocks(e),e=this.convertLineBreaks(e),e=this.cleanupWhitespace(e),e}protectCodeBlocks(r){return r.replace(/```(\w*)\r?\n([\s\S]*?)```/g,(e,t,s)=>{let i=`<<<CODEBLOCK${Date.now()}N${this.codeBlockPlaceholders.size}>>>`,n=`<pre><code class="language-${t}">${this.escapeHTML(s.trim())}</code></pre>`;return this.codeBlockPlaceholders.set(i,n),i})}restoreCodeBlocks(r){for(let[e,t]of this.codeBlockPlaceholders.entries())r=r.replace(e,t);return r}convertHeaders(r){return r=r.replace(/^######\s+(.+)$/gm,"<h6>$1</h6>"),r=r.replace(/^#####\s+(.+)$/gm,"<h5>$1</h5>"),r=r.replace(/^####\s+(.+)$/gm,"<h4>$1</h4>"),r=r.replace(/^###\s+(.+)$/gm,"<h3>$1</h3>"),r=r.replace(/^##\s+(.+)$/gm,"<h2>$1</h2>"),r=r.replace(/^#\s+(.+)$/gm,"<h1>$1</h1>"),r}convertLists(r){let e=r.split(`
`),t=[],s=!1,i=null;for(let n=0;n<e.length;n++){let a=e[n],l=a.match(/^[-*+]\s+(.+)$/),h=a.match(/^\d+\.\s+(.+)$/);l?(s?i==="ol"&&(t.push("</ol>"),t.push("<ul>"),i="ul"):(t.push("<ul>"),s=!0,i="ul"),t.push(`<li>${l[1]}</li>`)):h?(s?i==="ul"&&(t.push("</ul>"),t.push("<ol>"),i="ol"):(t.push("<ol>"),s=!0,i="ol"),t.push(`<li>${h[1]}</li>`)):(s&&(t.push(i==="ul"?"</ul>":"</ol>"),s=!1,i=null),t.push(a))}return s&&t.push(i==="ul"?"</ul>":"</ol>"),t.join(`
`)}convertBlockquotes(r){let e=r.split(`
`),t=[],s=!1;for(let i of e){let n=i.match(/^>\s+(.+)$/);n?(s||(t.push("<blockquote>"),s=!0),t.push(n[1])):(s&&(t.push("</blockquote>"),s=!1),t.push(i))}return s&&t.push("</blockquote>"),t.join(`
`)}convertHorizontalRules(r){return r.replace(/^([-*_])\1{2,}$/gm,"<hr>")}convertWikilinks(r){return r=r.replace(/!\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,(e,t,s,i)=>{let n=i||t.split("/").pop()?.split(".")[0]||"image";return`<img src="${t}" alt="${n}">`}),this.options.convertWikilinks?r.replace(/\[\[([^\]|]+)\|([^\]]+)\]\]/g,"$2").replace(/\[\[([^\]]+)\]\]/g,"$1"):r.replace(/\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,(e,t,s,i)=>i||t)}convertHighlights(r){return r.replace(/==(.+?)==/g,"<mark>$1</mark>")}convertCallouts(r){return r.replace(/^>\s*\[!(\w+)\]\s*(.*)$/gm,'<div class="callout callout-$1"><strong>$2</strong></div>')}removeComments(r){return r.replace(/%%[\s\S]*?%%/g,"")}convertInlineCode(r){return r.replace(/`([^`]+)`/g,"<code>$1</code>")}convertImages(r){return r=r.replace(/!\[\[([^\]]+)\]\]/g,'<img src="$1" alt="">'),r=r.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img src="$2" alt="$1">'),r}convertLinks(r){return r.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2">$1</a>')}convertBold(r){return r=r.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),r=r.replace(/__(.+?)__/g,"<strong>$1</strong>"),r}convertItalic(r){return r=r.replace(/(?<!\*)\*(?!\*)([^*]+)\*(?!\*)/g,"<em>$1</em>"),r=r.replace(/(?<!_)_(?!_)([^_]+)_(?!_)/g,"<em>$1</em>"),r}convertStrikethrough(r){return r.replace(/~~(.+?)~~/g,"<del>$1</del>")}convertLineBreaks(r){return r.replace(/\n/g,"<br>")}cleanupWhitespace(r){return r=r.replace(/(<br>){3,}/g,"<br><br>"),r=r.replace(/<br>(<\/(ul|ol|blockquote|div|h[1-6])>)/g,"$1"),r=r.replace(/(<(ul|ol|blockquote|div|h[1-6])>)<br>/g,"$1"),r.trim()}escapeHTML(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}stripAllFormatting(r){let e=r;return e=e.replace(/```[\s\S]*?```/g,""),e=e.replace(/^#{1,6}\s+/gm,""),e=e.replace(/^[-*+]\s+/gm,""),e=e.replace(/^\d+\.\s+/gm,""),e=e.replace(/^>\s+/gm,""),e=e.replace(/\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,(t,s,i,n)=>n||s),e=e.replace(/==(.+?)==/g,"$1"),e=e.replace(/%%[\s\S]*?%%/g,""),e=e.replace(/`([^`]+)`/g,"$1"),e=e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,""),e=e.replace(/!\[\[([^\]]+)\]\]/g,""),e=e.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),e=e.replace(/\*\*(.+?)\*\*/g,"$1"),e=e.replace(/__(.+?)__/g,"$1"),e=e.replace(/\*([^*]+)\*/g,"$1"),e=e.replace(/_([^_]+)_/g,"$1"),e=e.replace(/~~(.+?)~~/g,"$1"),e=e.replace(/^([-*_]){3,}$/gm,""),e.trim()}};function $r(o,r={}){return new tr({preserveCodeBlocks:!0,convertWikilinks:!0,stripObsidianSyntax:!1,plainTextMode:!1,...r}).convert(o)}function Ur(o){return new tr({preserveCodeBlocks:!1,convertWikilinks:!1,stripObsidianSyntax:!0,plainTextMode:!0}).convert(o)}var rr=class{transform(r,e){return r.map(t=>this.transformCard(t,e))}validate(r){return r.every(e=>e.deckName&&e.modelName&&e.fields&&e.fields.Front&&e.fields.Back)}transformCard(r,e){let t=this.getDeckName(r,e),s=this.transformFields(r,e),i=this.transformTags(r,e);return{deckName:t,modelName:"Basic",fields:s,tags:i,guid:this.generateGuid(r)}}getDeckName(r,e){let t=e.ankiDeckPrefix||"Flashly",s=r.deck||"Default";return`${t}::${s}`}transformFields(r,e){let t=r.front,s=r.back;return e.ankiPlainTextMode?(t=Ur(t),s=Ur(s)):e.ankiConvertMarkdown&&(t=$r(t,{convertWikilinks:!0,stripObsidianSyntax:!1}),s=$r(s,{convertWikilinks:!0,stripObsidianSyntax:!1})),{Front:t,Back:s}}transformTags(r,e){return!e.includeTags||!r.tags?[]:r.tags.map(t=>t.replace(/^#/,"").replace(/\//g,"::"))}generateGuid(r){let e=`${r.front}${r.back}${r.deck}`;return this.simpleHash(e)}simpleHash(r){let e=0;for(let t=0;t<r.length;t++){let s=r.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return Math.abs(e).toString(36)}convertToSM2(r){if(!r.fsrsCard||r.fsrsCard.state===J.New)return null;let t=2.5-(r.fsrsCard.difficulty||5)/10*1.2;return{interval:r.fsrsCard.scheduled_days||1,repetitions:r.fsrsCard.reps||0,easeFactor:Math.max(1.3,Math.min(2.5,t))}}};var ai=require("obsidian");var ji=pt(require("crypto"),1);function Hr(){let o=BigInt(Date.now()),r=BigInt(Math.floor(Math.random()*1e6));return o*1000000n+r}function Te(){return Math.floor(Date.now()/1e3)}function jr(o){return o.join("")}function vs(o){return o.length===0?"":" "+o.join(" ")+" "}function ws(){return Math.floor(Math.random()*1e9)+1e9}function ys(){return Math.floor(Date.now()/1e3)*1e3+Math.floor(Math.random()*1e3)}var Je=class{constructor(r){X(this,"modelId");X(this,"fields");X(this,"tags");X(this,"guid");X(this,"sort");this.modelId=r.modelId??0,this.fields=[...r.fields],this.tags=[...r.tags??""],this.guid=r.guid?BigInt(r.guid):Hr(),this.sort=0}setField(r,e){if(r>=0&&r<this.fields.length)this.fields[r]=e;else throw new Error(`Field index ${r} is out of range`)}getField(r){if(r>=0&&r<this.fields.length)return this.fields[r]??"";throw new Error(`Field index ${r} is out of range`)}addTag(r){this.tags.includes(r)||this.tags.push(r)}removeTag(r){let e=this.tags.indexOf(r);e>-1&&this.tags.splice(e,1)}checksum(){let r=jr(this.fields),e=0;for(let t=0;t<r.length;t++)e+=r.charCodeAt(t);return e}toSqlValues(){return{id:Date.now()+Math.floor(Math.random()*1e6),guid:this.guid.toString(),mid:this.modelId,mod:Te(),usn:-1,tags:vs(this.tags),flds:jr(this.fields),sfld:this.fields[0]||"",csum:this.checksum(),flags:0,data:""}}};var Xe=class{constructor(r,e,t=0,s=1){X(this,"id");X(this,"noteId");X(this,"deckId");X(this,"ord");X(this,"mod");X(this,"usn");X(this,"type");X(this,"queue");X(this,"due");X(this,"ivl");X(this,"factor");X(this,"reps");X(this,"lapses");X(this,"left");X(this,"odue");X(this,"odid");X(this,"flags");X(this,"data");this.id=(Date.now()+Math.floor(Math.random()*1e6)).toString(),this.noteId=r,this.deckId=e,this.ord=t,this.mod=Te(),this.usn=-1,this.type=0,this.queue=0,this.due=s,this.ivl=0,this.factor=0,this.reps=0,this.lapses=0,this.left=0,this.odue=0,this.odid=0,this.flags=0,this.data=""}toSqlValues(){return{id:parseInt(this.id),nid:parseInt(this.noteId),did:this.deckId,ord:this.ord,mod:this.mod,usn:this.usn,type:this.type,queue:this.queue,due:this.due,ivl:this.ivl,factor:this.factor,reps:this.reps,lapses:this.lapses,left:this.left,odue:this.odue,odid:this.odid,flags:this.flags,data:this.data}}};var et=class{constructor(r){X(this,"deckId");X(this,"name");X(this,"description");X(this,"notes");X(this,"cards");this.deckId=r.deckId??ws(),this.name=r.name,this.description=r.description??"",this.notes=[],this.cards=[]}addNote(r,e){this.notes.push(r);let s=r.toSqlValues().id.toString(),i=this.cards.length+1;if(e)for(let n=0;n<e.templates.length;n++){let a=new Xe(s,this.deckId,n,i+n);this.cards.push(a)}else{let n=new Xe(s,this.deckId,0,i);this.cards.push(n)}}addNotes(r,e){for(let t of r)this.addNote(t,e)}getNoteCount(){return this.notes.length}getCardCount(){return this.cards.length}toJson(){let r={id:this.deckId,name:this.name,desc:this.description,mod:Te(),usn:-1,collapsed:!1,newToday:[0,0],revToday:[0,0],lrnToday:[0,0],timeToday:[0,0],dyn:0,extendNew:10,extendRev:50,conf:1};return JSON.stringify(r)}};var Fe=class{constructor(r){X(this,"modelId");X(this,"name");X(this,"fields");X(this,"templates");X(this,"css");X(this,"latexPre");X(this,"latexPost");X(this,"type");X(this,"tags");this.modelId=r.modelId??ys(),this.name=r.name,this.fields=this.processFields(r.fields),this.templates=this.processTemplates(r.templates),this.css=r.css??this.getDefaultCss(),this.latexPre=r.latexPre??this.getDefaultLatexPre(),this.latexPost=r.latexPost??this.getDefaultLatexPost(),this.type=r.type??0,this.tags=r.tags??[]}processFields(r){return r.map((e,t)=>({name:e.name,font:e.font??"Arial",size:e.size??20,sticky:e.sticky??!1,rtl:e.rtl??!1,ord:e.ord??t}))}processTemplates(r){return r.map((e,t)=>({name:e.name,qfmt:e.qfmt,afmt:e.afmt,bqfmt:e.bqfmt??"",bafmt:e.bafmt??"",did:e.did??void 0,bfont:e.bfont??"",bsize:e.bsize??0,ord:e.ord??t}))}getDefaultCss(){return`.card {
      font-family: arial;
      font-size: 20px;
      text-align: center;
      color: black;
      background-color: white;
    }`}getDefaultLatexPre(){return`\\documentclass[12pt]{article}
      \\special{papersize=3in,5in}
      \\usepackage[utf8]{inputenc}
      \\usepackage{amssymb,amsmath}
      \\pagestyle{empty}
      \\setlength{\\parindent}{0in}
      \\begin{document}`}getDefaultLatexPost(){return"\\end{document}"}toJson(){let r={css:this.css,did:1,flds:this.fields.map(e=>({font:e.font,media:[],name:e.name,ord:e.ord,rtl:e.rtl,size:e.size,sticky:e.sticky})),id:this.modelId,latexPost:this.latexPost,latexPre:this.latexPre,mod:Te(),name:this.name,req:[[0,"any",[0]]],sortf:0,tags:this.tags,tmpls:this.templates.map(e=>({afmt:e.afmt,bafmt:e.bafmt,bfont:e.bfont,bqfmt:e.bqfmt,bsize:e.bsize,did:e.did,name:e.name,ord:e.ord,qfmt:e.qfmt})),type:this.type,usn:-1,vers:[]};return JSON.stringify(r)}};var ri=pt(Xs(),1),si=pt(ti(),1),Ge=require("fs"),ii=require("os"),ni=require("path");var rt=class{constructor(r){X(this,"decks");X(this,"models");X(this,"media");this.decks=[],this.models=[],this.media=r?.media??[]}addDeck(r){this.decks.push(r)}addModel(r){this.models.push(r)}addMedia(r){this.media.push(r)}addMediaFiles(r){this.media.push(...r)}createDatabase(){let r=(0,ni.join)((0,ii.tmpdir)(),`anki_${Date.now()}.db`),e=(0,ri.default)(r);try{this.createTables(e),this.insertCollectionData(e),this.insertModels(e),this.insertDecks(e);let t=this.insertNotes(e);this.insertCards(e,t),e.close();let s=(0,Ge.readFileSync)(r);return(0,Ge.unlinkSync)(r),s}catch(t){e.close();try{(0,Ge.unlinkSync)(r)}catch{}throw t}}createTables(r){r.exec(`
      CREATE TABLE col (
        id INTEGER PRIMARY KEY,
        crt INTEGER NOT NULL,
        mod INTEGER NOT NULL,
        scm INTEGER NOT NULL,
        ver INTEGER NOT NULL,
        dty INTEGER NOT NULL,
        usn INTEGER NOT NULL,
        ls INTEGER NOT NULL,
        conf TEXT NOT NULL,
        models TEXT NOT NULL,
        decks TEXT NOT NULL,
        dconf TEXT NOT NULL,
        tags TEXT NOT NULL
      )
    `),r.exec(`
      CREATE TABLE notes (
        id INTEGER PRIMARY KEY,
        guid TEXT NOT NULL,
        mid INTEGER NOT NULL,
        mod INTEGER NOT NULL,
        usn INTEGER NOT NULL,
        tags TEXT NOT NULL,
        flds TEXT NOT NULL,
        sfld TEXT NOT NULL,
        csum INTEGER NOT NULL,
        flags INTEGER NOT NULL,
        data TEXT NOT NULL
      )
    `),r.exec(`
      CREATE TABLE cards (
        id INTEGER PRIMARY KEY,
        nid INTEGER NOT NULL,
        did INTEGER NOT NULL,
        ord INTEGER NOT NULL,
        mod INTEGER NOT NULL,
        usn INTEGER NOT NULL,
        type INTEGER NOT NULL,
        queue INTEGER NOT NULL,
        due INTEGER NOT NULL,
        ivl INTEGER NOT NULL,
        factor INTEGER NOT NULL,
        reps INTEGER NOT NULL,
        lapses INTEGER NOT NULL,
        left INTEGER NOT NULL,
        odue INTEGER NOT NULL,
        odid INTEGER NOT NULL,
        flags INTEGER NOT NULL,
        data TEXT NOT NULL
      )
    `),r.exec(`
      CREATE TABLE revlog (
        id INTEGER PRIMARY KEY,
        cid INTEGER NOT NULL,
        usn INTEGER NOT NULL,
        ease INTEGER NOT NULL,
        ivl INTEGER NOT NULL,
        lastIvl INTEGER NOT NULL,
        factor INTEGER NOT NULL,
        time INTEGER NOT NULL,
        type INTEGER NOT NULL
      )
    `),r.exec(`
      CREATE TABLE graves (
        usn INTEGER NOT NULL,
        oid INTEGER NOT NULL,
        type INTEGER NOT NULL
      )
    `),r.exec("CREATE INDEX ix_notes_usn ON notes (usn)"),r.exec("CREATE INDEX ix_cards_usn ON cards (usn)"),r.exec("CREATE INDEX ix_cards_nid ON cards (nid)"),r.exec("CREATE INDEX ix_cards_sched ON cards (did, queue, due)"),r.exec("CREATE INDEX ix_revlog_usn ON revlog (usn)"),r.exec("CREATE INDEX ix_revlog_cid ON revlog (cid)")}insertCollectionData(r){let e=Te(),t=this.models.reduce((l,h)=>(l[h.modelId]=JSON.parse(h.toJson()),l),{}),s=this.decks.reduce((l,h)=>(l[h.deckId]=JSON.parse(h.toJson()),l),{});Object.keys(s).length===0&&(s[1]={id:1,name:"Default",desc:"",mod:e,usn:-1,collapsed:!1,newToday:[0,0],revToday:[0,0],lrnToday:[0,0],timeToday:[0,0],dyn:0,extendNew:10,extendRev:50,conf:1});let i={nextPos:1,estTimes:!0,activeDecks:Object.keys(s).map(l=>parseInt(l)),sortType:"noteFld",timeLim:0,sortBackwards:!1,addToCur:!0,curDeck:Object.keys(s)[0]?parseInt(Object.keys(s)[0]??""):1,newBury:!0,newSpread:0,dueCounts:!0,curModel:Object.keys(t)[0]||"1607392319",collapseTime:1200},n={1:{id:1,name:"Default",new:{bury:!0,delays:[1,10],initialFactor:2500,ints:[1,4,7],order:1,perDay:20,separate:!0},lapse:{delays:[10],leechAction:0,leechFails:8,minInt:1,mult:0},rev:{bury:!0,ease4:1.3,fuzz:.05,ivlFct:1,maxIvl:36500,minSpace:1,perDay:100},timer:0,maxTaken:60,usn:0,mod:0,autoplay:!0,replayq:!0}};r.prepare(`
      INSERT INTO col (id, crt, mod, scm, ver, dty, usn, ls, conf, models, decks, dconf, tags)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(1,e,e,e,11,0,0,0,JSON.stringify(i),JSON.stringify(t),JSON.stringify(s),JSON.stringify(n),"{}")}insertModels(r){}insertDecks(r){}insertNotes(r){if(this.decks.length===0)return new Map;let e=r.prepare(`
      INSERT INTO notes (id, guid, mid, mod, usn, tags, flds, sfld, csum, flags, data)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `),t=new Map;for(let s of this.decks)for(let i of s.notes){let n=i.toSqlValues();e.run(n.id,n.guid,n.mid,n.mod,n.usn,n.tags,n.flds,n.sfld,n.csum,n.flags,n.data),t.set(n.guid,n.id)}return t}insertCards(r,e){if(this.decks.length===0)return;let t=r.prepare(`
      INSERT INTO cards (id, nid, did, ord, mod, usn, type, queue, due, ivl, factor, reps, lapses, left, odue, odid, flags, data)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `),s=1,i=1;for(let n of this.decks)for(let a=0;a<n.notes.length;a++){let l=n.notes[a],h=l.guid.toString(),p=e.get(h);if(!p){console.error(`Could not find database ID for note GUID: ${h}`);continue}let u=this.models.find(d=>d.modelId===l.modelId),m=u?u.templates.length:1;for(let d=0;d<m;d++){let g=s++;t.run(g,p,n.deckId,d,Te(),-1,0,0,i++,0,0,0,0,0,0,0,0,"")}}}createMediaJson(){let r={};return this.media.forEach((e,t)=>{r[t.toString()]=e.name}),JSON.stringify(r)}async writeToFile(r){let e=await this.writeToBuffer();(0,Ge.writeFileSync)(r,e)}async writeToBuffer(){let r=new si.default,e=this.createDatabase();return r.file("collection.anki2",e),this.media.forEach((s,i)=>{r.file(i.toString(),s.data)}),r.file("media",this.createMediaJson()),await r.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:6}})}};var Qe={BASIC_MODEL:new Fe({modelId:1607392319,name:"Basic",fields:[{name:"Front"},{name:"Back"}],templates:[{name:"Card 1",qfmt:"{{Front}}",afmt:'{{FrontSide}}<hr id="answer">{{Back}}'}]}),BASIC_AND_REVERSED_CARD_MODEL:new Fe({modelId:1607392320,name:"Basic (and reversed card)",fields:[{name:"Front"},{name:"Back"}],templates:[{name:"Card 1",qfmt:"{{Front}}",afmt:'{{FrontSide}}<hr id="answer">{{Back}}'},{name:"Card 2",qfmt:"{{Back}}",afmt:'{{FrontSide}}<hr id="answer">{{Front}}'}]}),BASIC_OPTIONAL_REVERSED_CARD_MODEL:new Fe({modelId:1607392321,name:"Basic (optional reversed card)",fields:[{name:"Front"},{name:"Back"},{name:"Add Reverse"}],templates:[{name:"Card 1",qfmt:"{{Front}}",afmt:'{{FrontSide}}<hr id="answer">{{Back}}'},{name:"Card 2",qfmt:"{{#Add Reverse}}{{Back}}{{/Add Reverse}}",afmt:'{{FrontSide}}<hr id="answer">{{Front}}'}]}),BASIC_TYPE_IN_THE_ANSWER_MODEL:new Fe({modelId:1607392322,name:"Basic (type in the answer)",fields:[{name:"Front"},{name:"Back"}],templates:[{name:"Card 1",qfmt:"{{Front}}<br>{{type:Back}}",afmt:'{{Front}}<hr id="answer">{{Back}}'}]}),CLOZE_MODEL:new Fe({modelId:1607392323,name:"Cloze",fields:[{name:"Text"},{name:"Back Extra"}],templates:[{name:"Cloze",qfmt:"{{cloze:Text}}",afmt:"{{cloze:Text}}<br>{{Back Extra}}"}],type:1}),IMAGE_OCCLUSION_MODEL:new Fe({modelId:1607392324,name:"Image Occlusion",fields:[{name:"Image"},{name:"Question"},{name:"Answer"},{name:"Remarks"}],templates:[{name:"Card 1",qfmt:"{{Image}}<br>{{Question}}",afmt:'{{Image}}<hr id="answer">{{Answer}}<br>{{Remarks}}'}]})};var ur=class{constructor(r){this.app=r;this.transformer=new rr}async export(r,e){let t=this.transformer.transform(r,e),s=t.length>0?t[0].deckName:e.ankiDeckPrefix||"Flashly",i=new rt,n=new et({name:s,description:`Exported from Flashly on ${new Date().toISOString()}`}),a=new Map;for(let h of t){await this.extractAndAddMedia(h.fields.Front,a),await this.extractAndAddMedia(h.fields.Back,a);let p=new Je({modelId:Qe.BASIC_MODEL.modelId,fields:[h.fields.Front,h.fields.Back],tags:h.tags});n.addNote(p,Qe.BASIC_MODEL)}for(let[h,p]of a.entries())i.addMedia({name:h,data:Buffer.from(p)});i.addDeck(n),i.addModel(Qe.BASIC_MODEL);let l=await i.writeToBuffer();return new Blob([l],{type:"application/octet-stream"})}async exportMultipleDecks(r,e){let t=this.transformer.transform(r,e),s=new Map;for(let n of t)s.has(n.deckName)||s.set(n.deckName,[]),s.get(n.deckName).push(n);let i=new Map;for(let[n,a]of s.entries()){let l=new rt,h=new et({name:n,description:`Exported from Flashly on ${new Date().toISOString()}`}),p=new Map;for(let d of a){await this.extractAndAddMedia(d.fields.Front,p),await this.extractAndAddMedia(d.fields.Back,p);let g=new Je({modelId:Qe.BASIC_MODEL.modelId,fields:[d.fields.Front,d.fields.Back],tags:d.tags});h.addNote(g,Qe.BASIC_MODEL)}for(let[d,g]of p.entries())l.addMedia({name:d,data:Buffer.from(g)});l.addDeck(h),l.addModel(Qe.BASIC_MODEL);let u=await l.writeToBuffer(),m=new Blob([u],{type:"application/octet-stream"});i.set(n,m)}return i}async extractAndAddMedia(r,e){if(!this.app)return;let t=this.extractMediaReferences(r);for(let s of t)if(!e.has(s))try{let i=this.app.metadataCache.getFirstLinkpathDest(s,"");if(i instanceof ai.TFile){let n=await this.app.vault.readBinary(i),a=Buffer.from(n);e.set(s,a)}}catch(i){console.warn(`Failed to load media file: ${s}`,i)}}extractMediaReferences(r){let e=[],t=/!\[\[([^\]]+?)\]\]/g,s;for(;(s=t.exec(r))!==null;){let a=s[1].split("|")[0].trim();e.push(a)}let i=/!\[.*?\]\(([^)]+?)\)/g;for(;(s=i.exec(r))!==null;){let a=s[1].trim();!a.startsWith("http://")&&!a.startsWith("https://")&&e.push(a)}let n=/<img[^>]+src=["']([^"']+)["']/g;for(;(s=n.exec(r))!==null;){let a=s[1].trim();!a.startsWith("http://")&&!a.startsWith("https://")&&!a.startsWith("data:")&&e.push(a)}return e}};var hr=class{transform(r,e){let t={};for(let s of r){let i=this.transformCard(s,e),n=s.deck||"Default";t[n]||(t[n]=[]),t[n].push(i)}return{version:"2.0.0",exportDate:new Date().toISOString(),totalCards:r.length,decks:t}}validate(r){if(!r.version||!r.exportDate||!r.decks)return!1;for(let e of Object.values(r.decks)){if(!Array.isArray(e))return!1;for(let t of e)if(!t.front||!t.back)return!1}return!0}transformCard(r,e){let t={front:r.front,back:r.back,deck:r.deck||"Default",tags:e.includeTags&&r.tags?r.tags:[],created:r.created.toISOString(),updated:r.updated.toISOString(),sourceFile:r.source.file,sourceLine:r.source.line};return r.fsrsCard.due&&(t.due=r.fsrsCard.due.toISOString()),e.includeScheduling&&r.fsrsCard&&(t.fsrsCard={state:r.fsrsCard.state,difficulty:r.fsrsCard.difficulty,stability:r.fsrsCard.stability,scheduled_days:r.fsrsCard.scheduled_days,reps:r.fsrsCard.reps,lapses:r.fsrsCard.lapses,last_review:r.fsrsCard.last_review?.toISOString()}),t}static parse(r){let e=JSON.parse(r),t=[];for(let s of Object.values(e.decks))for(let i of s){let n={front:i.front,back:i.back,deck:i.deck,tags:i.tags,created:new Date(i.created),updated:new Date(i.updated),source:{file:i.sourceFile,line:i.sourceLine}};t.push(n)}return t}};var pr=class{constructor(){this.transformer=new hr}export(r,e){let t=this.transformer.transform(r,e);return JSON.stringify(t,null,2)}exportCompact(r,e){let t=this.transformer.transform(r,e);return JSON.stringify(t)}};var fr=class{transform(r,e){let t=new Map,s=new Map;for(let i of r){let n=i.deck||"Default";s.has(n)||s.set(n,[]),s.get(n).push(i)}for(let[i,n]of s.entries()){let a=this.generateDeckMarkdown(i,n,e);t.set(i,a)}return{decks:t}}validate(r){return r.decks&&r.decks.size>0}generateDeckMarkdown(r,e,t){let s=[];s.push(`# ${r}`),s.push(""),s.push(`Exported: ${new Date().toLocaleString()}`),s.push(`Total Cards: ${e.length}`),s.push(""),s.push("---"),s.push("");for(let i=0;i<e.length;i++){let n=e[i];s.push(`## Card ${i+1}`),s.push(""),t.includeTags&&n.tags&&n.tags.length>0&&(s.push(`**Tags:** ${n.tags.join(", ")}`),s.push("")),s.push("### Front"),s.push(""),s.push(n.front),s.push(""),s.push("### Back"),s.push(""),s.push(n.back),s.push(""),t.includeScheduling&&(s.push("### Metadata"),s.push(""),s.push(`- **Created:** ${n.created.toLocaleString()}`),s.push(`- **Updated:** ${n.updated.toLocaleString()}`),s.push(`- **Review Count:** ${n.fsrsCard.reps||0}`),n.fsrsCard.due&&s.push(`- **Due:** ${n.fsrsCard.due.toLocaleString()}`),n.fsrsCard&&(s.push(`- **State:** ${n.fsrsCard.state}`),n.fsrsCard.difficulty!==void 0&&s.push(`- **Difficulty:** ${n.fsrsCard.difficulty.toFixed(2)}`),n.fsrsCard.stability!==void 0&&s.push(`- **Stability:** ${n.fsrsCard.stability.toFixed(2)}`)),s.push(`- **Source:** ${n.source.file}:${n.source.line}`),s.push("")),s.push("---"),s.push("")}return s.join(`
`)}generateCombinedMarkdown(r,e){let t=[];t.push("# Flashly Export"),t.push(""),t.push(`Exported: ${new Date().toLocaleString()}`),t.push(`Total Cards: ${r.length}`),t.push("");let s=new Map;for(let i of r){let n=i.deck||"Default";s.has(n)||s.set(n,[]),s.get(n).push(i)}t.push("## Table of Contents"),t.push("");for(let i of s.keys())t.push(`- [${i}](#${this.slugify(i)})`);t.push(""),t.push("---"),t.push("");for(let[i,n]of s.entries()){t.push(`# ${i}`),t.push(""),t.push(`Cards in this deck: ${n.length}`),t.push("");for(let a=0;a<n.length;a++){let l=n[a];t.push(`## ${a+1}. ${this.truncate(l.front,50)}`),t.push(""),e.includeTags&&l.tags&&l.tags.length>0&&(t.push(`**Tags:** ${l.tags.join(", ")}`),t.push("")),t.push("**Q:** "+l.front),t.push(""),t.push("**A:** "+l.back),t.push(""),t.push("---"),t.push("")}}return t.join(`
`)}slugify(r){return r.toLowerCase().replace(/[^\w]+/g,"-")}truncate(r,e){return r.length<=e?r:r.substring(0,e)+"..."}};var gr=class{constructor(){this.transformer=new fr}export(r,e){return this.transformer.transform(r,e).decks}exportCombined(r,e){return this.transformer.generateCombinedMarkdown(r,e)}};var mr=class{constructor(r,e,t){this.app=r;this.storage=e;this.settings=t;this.exportHistory=[]}async export(r){let e=Date.now();try{let t=this.filterCards(r);if(t.length===0)return{success:!1,error:"No cards match the export criteria",cardCount:0,timestamp:new Date};let s;switch(r.format){case"csv":case"csv-quizlet":s=await this.exportCSV(t,r);break;case"anki":s=await this.exportAnki(t,r);break;case"json":s=await this.exportJSON(t,r);break;case"markdown":s=await this.exportMarkdown(t,r);break;default:return this.handleUnsupportedFormat(r.format)}let i=Date.now()-e,n={success:!0,filePath:s,cardCount:t.length,timestamp:new Date};return this.recordExport(n,r.format),new Jr.Notice(`\u2705 Exported ${t.length} cards in ${i}ms`),n}catch(t){return console.error("Export failed:",t),new Jr.Notice(`\u274C Export failed: ${t.message}`),{success:!1,error:t.message,cardCount:0,timestamp:new Date}}}filterCards(r){let e=this.storage.getAllCards();return r.selectedDecks&&r.selectedDecks.length>0&&(e=e.filter(t=>r.selectedDecks.includes(t.deck))),r.selectedTags&&r.selectedTags.length>0&&(e=e.filter(t=>t.tags.some(s=>r.selectedTags.includes(s)))),r.dateRange&&(e=e.filter(t=>{let s=new Date(t.created);return s>=r.dateRange.start&&s<=r.dateRange.end})),e}async exportCSV(r,e){let t=new er,s={...e,format:e.format,delimiter:this.settings().export.csvDelimiter,includeHeaders:!0,includeBOM:this.settings().export.csvIncludeBOM},i=t.export(r,s),n=new Date().toISOString().replace(/:/g,"-").split(".")[0],l=`flashly-export-${e.format==="csv-quizlet"?"quizlet":"flashcards"}-${n}.csv`;return await this.saveFile(l,i)}async exportAnki(r,e){let t=new ur(this.app);e.ankiDeckPrefix=this.settings().export.ankiDeckPrefix,e.ankiConvertMarkdown=this.settings().export.ankiConvertMarkdown,e.ankiPlainTextMode=this.settings().export.ankiPlainTextMode;let i=await(await t.export(r,e)).arrayBuffer(),n=new Uint8Array(i),l=`flashly-export-anki-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.apkg`;return await this.saveFileBinary(l,n)}async exportJSON(r,e){let s=new pr().export(r,e),n=`flashly-export-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.json`;return await this.saveFile(n,s)}async exportMarkdown(r,e){let s=new gr().exportCombined(r,e),n=`flashly-export-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.md`;return await this.saveFile(n,s)}preview(r,e=10){let t=this.filterCards(r),s=t.slice(0,e);return{cards:s,totalCount:t.length,previewCount:s.length}}getAvailableDecks(){return this.storage.getDeckNames()}getAvailableTags(){let r=new Set,e=this.storage.getAllCards();for(let t of e)for(let s of t.tags)r.add(s);return Array.from(r).sort()}getExportHistory(){return[...this.exportHistory]}recordExport(r,e){r.success&&r.filePath&&(this.exportHistory.unshift({id:`${Date.now()}-${Math.random()}`,timestamp:r.timestamp,format:e,cardCount:r.cardCount,filePath:r.filePath,success:!0}),this.exportHistory.length>20&&(this.exportHistory=this.exportHistory.slice(0,20)))}async saveFile(r,e){let{vault:t}=this.app,s="flashly-exports";try{await t.adapter.mkdir(s)}catch{}let i=`${s}/${r}`;return await t.adapter.write(i,e),i}async saveFileBinary(r,e){let{vault:t}=this.app,s="flashly-exports";try{await t.adapter.mkdir(s)}catch{}let i=`${s}/${r}`,n=new ArrayBuffer(e.byteLength);return new Uint8Array(n).set(e),await t.adapter.writeBinary(i,n),i}handleUnsupportedFormat(r){throw new Error(`Unsupported export format: ${String(r)}`)}};var oi=require("obsidian");var xe=require("obsidian"),vr=class extends xe.Modal{constructor(e,t){super(e);this.exportService=t;this.format="csv";this.selectedDecks=[];this.includeScheduling=!0;this.includeTags=!0;this.includeMedia=!1}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Export flashcards"}),new xe.Setting(e).setName("Export format").setDesc("Choose the format for exported flashcards").addDropdown(d=>{d.addOption("csv","CSV (generic)").addOption("csv-quizlet","CSV (quizlet format)").addOption("anki","Anki (.apkg)").addOption("json","JSON").addOption("markdown","Markdown").setValue(this.format).onChange(g=>{this.format=g})});let t=this.exportService.getAvailableDecks(),s=e.createDiv({cls:"export-deck-selection"});s.createEl("h3",{text:"Select decks"});let i=s.createDiv({cls:"export-button-group"}),n=i.createEl("button",{text:"Select all"}),a=i.createEl("button",{text:"Deselect all"});n.onclick=()=>{this.selectedDecks=[...t],l.forEach(d=>{d.setValue(!0)})},a.onclick=()=>{this.selectedDecks=[],l.forEach(d=>{d.setValue(!1)})};let l=[];t.forEach(d=>{new xe.Setting(s).setName(d).addToggle(g=>{l.push(g),g.setValue(!0).onChange(v=>{v?this.selectedDecks.includes(d)||this.selectedDecks.push(d):this.selectedDecks=this.selectedDecks.filter(b=>b!==d)}),this.selectedDecks.push(d)})}),e.createEl("h3",{text:"Export options"}),new xe.Setting(e).setName("Include tags").setDesc("Include card tags in export").addToggle(d=>d.setValue(this.includeTags).onChange(g=>this.includeTags=g)),new xe.Setting(e).setName("Include scheduling data").setDesc("Include scheduling information (due dates, review history)").addToggle(d=>d.setValue(this.includeScheduling).onChange(g=>this.includeScheduling=g)),new xe.Setting(e).setName("Include media").setDesc("Include images and audio (Anki only)").addToggle(d=>d.setValue(this.includeMedia).onChange(g=>this.includeMedia=g));let h=e.createDiv({cls:"export-action-buttons"}),p=h.createEl("button",{text:"Preview"});p.onclick=()=>this.preview();let u=h.createEl("button",{text:"Export",cls:"mod-cta"});u.onclick=()=>void this.export();let m=h.createEl("button",{text:"Cancel"});m.onclick=()=>this.close()}preview(){let e={format:this.format,selectedDecks:this.selectedDecks,includeScheduling:this.includeScheduling,includeTags:this.includeTags,includeMedia:this.includeMedia},t=this.exportService.preview(e,10);new xe.Notice(`Preview: ${t.previewCount} of ${t.totalCount} cards will be exported`)}async export(){if(this.selectedDecks.length===0){new xe.Notice("Please select at least one deck to export");return}let e={format:this.format,selectedDecks:this.selectedDecks,includeScheduling:this.includeScheduling,includeTags:this.includeTags,includeMedia:this.includeMedia};new xe.Notice("Starting export..."),this.close();let t=await this.exportService.export(e);t.success?new xe.Notice(`\u2705 exported ${t.cardCount} cards to ${t.filePath}`):new xe.Notice(`\u274C export failed: ${t.error}`)}onClose(){let{contentEl:e}=this;e.empty()}};var wr=class{constructor(r,e){this.app=r;this.exportService=e;this.id="export-flashcards";this.name="Export flashcards"}getId(){return this.id}getName(){return this.name}getCallback(){return()=>{if(this.exportService.getAvailableDecks().length===0){new oi.Notice("No flashcards found to export. Scan your vault first.");return}new vr(this.app,this.exportService).open()}}};var yr=class{constructor(r){this.app=r}getId(){return"replay-tutorial"}getName(){return"Replay tutorial"}getCallback(){return()=>{new Pe(this.app,{steps:Ve(),onComplete:()=>{},onSkip:()=>{}}).open()}}};var br=class{constructor(r){this.plugin=r}get isDebugEnabled(){return this.plugin.settings.developer.enableDebugLogging}debug(...r){this.isDebugEnabled&&console.debug("[Flashly]",...r)}log(...r){this.isDebugEnabled&&console.debug("[Flashly]",...r)}warn(...r){console.warn("[Flashly]",...r)}error(...r){console.error("[Flashly]",...r)}};var kr=class extends _r.Plugin{async onload(){await this.loadSettings(),this.logger=new br(this),this.storage=new vt(this),await this.storage.load(),this.quizStorage=new Qt(this),await this.quizStorage.load(),this.parser=new ot(this.settings.parser,this.app),this.reviewQueue=new qt(this.storage),this.exportService=new mr(this.app,this.storage,()=>this.settings),this.registerView(Ze,e=>new $e(e,this)),this.registerView(lt,e=>new Lt(e,this)),this.registerView(Rr,e=>new Mt(e,this)),this.registerView(ct,e=>new Pt(e,this)),this.scanCommand=new Ot(this.app,this.storage,this.parser,this),this.addCommand({id:this.scanCommand.getId(),name:this.scanCommand.getName(),callback:this.scanCommand.getCallback()}),this.startReviewCommand=new Gt(this.app,this.storage,this.reviewQueue,()=>this.settings,this),this.addCommand({id:this.startReviewCommand.getId(),name:this.startReviewCommand.getName(),callback:this.startReviewCommand.getCallback()}),this.refreshDecksCommand=new Wt(this.app,this.storage,()=>this.settings,this),this.addCommand({id:this.refreshDecksCommand.getId(),name:this.refreshDecksCommand.getName(),callback:this.refreshDecksCommand.getCallback()}),this.generateQuizCommand=new Yt(this.app,this),this.addCommand({id:this.generateQuizCommand.getId(),name:this.generateQuizCommand.getName(),callback:this.generateQuizCommand.getCallback()}),this.exportCommand=new wr(this.app,this.exportService),this.addCommand({id:this.exportCommand.getId(),name:this.exportCommand.getName(),callback:this.exportCommand.getCallback()}),this.replayTutorialCommand=new yr(this.app),this.addCommand({id:this.replayTutorialCommand.getId(),name:this.replayTutorialCommand.getName(),callback:this.replayTutorialCommand.getCallback()}),this.addCommand({id:"open-flashcard-browser",name:"Open flashcard browser",callback:()=>void this.activateBrowserView()}),this.addCommand({id:"open-statistics",name:"View statistics",callback:()=>void this.activateStatisticsView()}),this.addCommand({id:"open-quiz-history",name:"View quiz history",callback:()=>void this.activateQuizHistoryView()}),this.addRibbonIcon("layers","Flashcard browser",()=>{this.activateBrowserView()}),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.registerInterval(window.setInterval(()=>this.updateStatusBar(),6e4)),this.addSettingTab(new gt(this.app,this)),this.settings.tutorial.completed||setTimeout(()=>{this.showTutorial()},1e3)}async activateBrowserView(){let{workspace:e}=this.app,t=e.getLeavesOfType(Ze)[0];if(!t){let s=e.getRightLeaf(!1);s&&(await s.setViewState({type:Ze,active:!0}),t=s)}t&&await e.revealLeaf(t)}refreshBrowserViews(){this.app.workspace.getLeavesOfType(Ze).forEach(t=>{let s=t.view;s instanceof $e&&s.refresh()})}async activateStatisticsView(){let{workspace:e}=this.app,t=e.getLeavesOfType(lt)[0];if(!t){let s=e.getRightLeaf(!1);s&&(await s.setViewState({type:lt,active:!0}),t=s)}t&&await e.revealLeaf(t)}async activateQuizHistoryView(){let{workspace:e}=this.app,t=e.getLeavesOfType(ct)[0];if(!t){let s=e.getRightLeaf(!1);s&&(await s.setViewState({type:ct,active:!0}),t=s)}t&&await e.revealLeaf(t)}onunload(){}showTutorial(){new Pe(this.app,{steps:Ve(),onComplete:()=>{(async()=>(this.settings.tutorial.completed=!0,this.settings.tutorial.completedDate=new Date().toISOString(),await this.saveSettings(),new _r.Notice("Tutorial completed! Access it anytime from settings.")))()},onSkip:()=>{(async()=>(this.settings.tutorial.completed=!0,await this.saveSettings()))()}}).open()}async loadSettings(){let e=await this.loadData();this.settings={...Me,...e??{},parser:{...Me.parser,...e?.parser??{}},review:{...Me.review,...e?.review??{}},quiz:{...Me.quiz,...e?.quiz??{}},export:{...Me.export,...e?.export??{}},tutorial:{...Me.tutorial,...e?.tutorial??{}},developer:{...Me.developer,...e?.developer??{}}}}async saveSettings(){await this.saveData(this.settings),this.parser=new ot(this.settings.parser,this.app)}updateStatusBar(){if(!this.statusBarItem)return;let e=this.storage.getAllCards(),t=e.filter(i=>!i.fsrsCard||!i.fsrsCard.due?!1:new Date(i.fsrsCard.due)<=new Date).length,s=e.length;t>0?(this.statusBarItem.setText(`\u{1F4DD} ${t} due (${s} total)`),this.statusBarItem.addClass("flashly-status-bar-due")):(this.statusBarItem.setText(`\u{1F4DD} ${s} cards`),this.statusBarItem.removeClass("flashly-status-bar-due")),this.statusBarItem.onclick=()=>{this.activateBrowserView()}}};
/*! Bundled license information:

papaparse/papaparse.min.js:
  (* @license
  Papa Parse
  v5.5.3
  https://github.com/mholt/PapaParse
  License: MIT
  *)

jszip/dist/jszip.min.js:
  (*!
  
  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>
  
  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.
  
  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  *)
*/
