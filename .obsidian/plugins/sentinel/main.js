/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var A=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var K=(t,e)=>{for(var n in e)A(t,n,{get:e[n],enumerable:!0})},ee=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of X(e))!Z.call(t,a)&&a!==n&&A(t,a,{get:()=>e[a],enumerable:!(i=J(e,a))||i.enumerable});return t};var te=t=>ee(A({},"__esModule",{value:!0}),t);var se={};K(se,{default:()=>C});module.exports=te(se);var Q=require("obsidian");var S={actions:[]};var h=require("obsidian");var d=require("obsidian");var N=require("obsidian"),b=class extends N.AbstractInputSuggest{constructor(e,n){super(e,n),this.pluginApp=e,this.inputEl=n}getSuggestions(e){let n=this.pluginApp.commands.listCommands(),i=e.toLowerCase();return n.filter(a=>a.name.toLowerCase().includes(i)||a.id.toLowerCase().includes(i)).slice(0,5)}renderSuggestion(e,n){n.setText(e.name)}selectSuggestion(e){this.inputEl.value=e.id,this.inputEl.dispatchEvent(new Event("input")),this.inputEl.blur(),this.close()}};function M(t,e,n,i,a){let r=t.createDiv("sentinel--action-container");new d.Setting(r).setName("Where").addText(o=>o.setValue(e.where).onChange(async s=>{e.where=s,await i.saveSettings()})),new d.Setting(r).setName("When").addDropdown(o=>o.addOptions({everyOpen:"Accessing a note",firstOpen:"Opening a note once, reset on closing Obsidian",firstOpenWithReset:"Opening a note once, reset on closing the note",everyClose:"Closing a note",everyLeave:"Leaving a note",firstLeave:"Leaving a note once, reset on reopening Obsidian",leaveChanged:"Leaving a note with changes",leaveChangedNoFrontmatter:"Leaving a note with changes, exclude Frontmatter"}).setValue(e.when).onChange(async s=>{e.when=s,await i.saveSettings()})),new d.Setting(r).setName("What").addDropdown(o=>o.addOptions({property:"Set a property",command:"Execute a command"}).setValue(e.what).onChange(async s=>{e.what=s,s==="property"?e.commandId=void 0:(e.propertyName=void 0,e.propertyValue=void 0),await i.saveSettings(),a()})),e.what==="property"?(new d.Setting(r).setName("Property name").addText(o=>o.setValue(e.propertyName||"").onChange(async s=>{e.propertyName=s,await i.saveSettings()})),new d.Setting(r).setName("Value").addText(o=>o.setValue(e.propertyValue||"").onChange(async s=>{e.propertyValue=s,await i.saveSettings()})),new d.Setting(r).setName("Skip Existing").addToggle(o=>o.setValue(e.skipExisting||!1).onChange(async s=>{e.skipExisting=s,await i.saveSettings()}))):new d.Setting(r).setName("Command").addText(o=>{let s=o.setValue(e.commandId||"").setPlaceholder("Search commands...").onChange(async l=>{e.commandId=l,await i.saveSettings()}),c=s.inputEl;return new b(i.app,c),s}),new d.Setting(r).addButton(o=>o.setButtonText("Remove").setClass("mod-destructive").onClick(async()=>{i.settings.actions.splice(n,1),await i.saveSettings(),a()}))}var v=class extends h.PluginSettingTab{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty(),e.createEl("h3",{text:"Actions"}),this.plugin.settings.actions&&this.plugin.settings.actions.forEach((i,a)=>{M(e,i,a,this.plugin,this.display.bind(this))}),new h.Setting(e).addButton(i=>i.setButtonText("Add action").setClass("mod-cta").onClick(async()=>{this.plugin.settings.actions||(this.plugin.settings.actions=[]),this.plugin.settings.actions.push({where:"",when:"firstOpen",what:"property"}),await this.plugin.saveSettings(),this.display()})),new h.Setting(e).setName("Resources").setHeading(),e.createEl("p",{text:"For detailed examples and full documentation, please refer to the following resources:"}),e.createEl("ul").createEl("li").createEl("a",{href:"https://github.com/gsarig/obsidian-sentinel",text:"The project on GitHub"})}};var E=require("obsidian");var R=require("obsidian");var w=require("obsidian");var V=require("obsidian");var I={errorModifyFile:"Error modifying the file.",errorReadingFile:"Error reading the file.",errorProcessingFile:"Error processing the file.",invalidAppInstance:"The `app` instance is undefined or invalid.",commandNotFound:"Commmand {label} not  found",missingPropertyName:"Property name is missing",errorIncrementingPropery:"Error incrementing property: {label}",failedUpdatingProperty:"Failed to update property: {label}",failedExecutingCommand:"Failed to execute command: {label}",failedUpdatingFile:"Failed to update file: {label}",invalidDateFormat:"Invalid date format in template: {label}",invalidTimeFormat:"Invalid time format in template: {label}",invalidWhere:"Invalid regex or comparison error in 'where': {label}"};var ie=I;function p(t,e){let n=ie[t];if(!n)throw new Error(`Label key "${t}" not found in labels.json`);return e?n.replace(/{(\w+)}/g,(i,a)=>e[a]||i):n}async function F(t,e){try{return await t.vault.read(e)}catch(n){return new V.Notice(p("errorReadingFile")),null}}function O(t){var n;let e=t.workspace.rootSplit;return((n=e==null?void 0:e.children)==null?void 0:n.length)>1}function P(t){let e=t.match(/^---\r?\n[\s\S]*?\r?\n---\r?\n/);return e?t.slice(e[0].length):t}async function D(t,e,n,i,a,r){if(n){let m=e.vault.getAbstractFileByPath(n.path);if(m instanceof w.TFile){e.workspace.getLeavesOfType("markdown").some(g=>{var y;return((y=g.view.file)==null?void 0:y.path)===m.path})||a(m,"everyClose"),a(m,"everyLeave");let f=i.get(n.path);if(f&&f.lastModified!==m.stat.mtime){let g=await F(e,m);if(g!==null&&f.lastContent){let y=P(f.lastContent),q=P(g);y!==q&&a(m,"leaveChangedNoFrontmatter"),f.lastContent=g}a(m,"leaveChanged"),f.lastModified=m.stat.mtime}n.hasBlurred||(n.hasBlurred=!0,a(m,"firstLeave"))}}if(!((t==null?void 0:t.view)instanceof w.FileView))return null;let o=t.view.file;if(!(o instanceof w.TFile))return null;let s=Date.now(),c=o.path;O(e)||a(o,"everyOpen");let l=i.get(c);if(l)l.lastModified!==o.stat.mtime&&(l.lastModified=o.stat.mtime),l.lastOpened=s,l.firstTimeOpened=!1;else{let m=await F(e,o);if(m===null)return null;l={path:c,lastModified:o.stat.mtime,lastOpened:s,firstTimeOpened:!0,hasBlurred:!1,lastContent:m},i.set(c,l),r.has(c)||(a(o,"firstOpen"),r.add(c)),a(o,"firstOpenWithReset")}return l.lastModified=o.stat.mtime,l}function H(t,e){let n=null,i=new Map,a=new Set;if(!e)return()=>{};let r=async s=>{let c=await D(s,t,n,i,e,a);c&&(n=c)},o=()=>{let s=t.workspace.getLeavesOfType("markdown"),c=new Set(s.map(l=>{var m;return l.view instanceof R.MarkdownView?(m=l.view.file)==null?void 0:m.path:null}).filter(l=>l!==null));for(let[l]of i)c.has(l)||i.delete(l)};return t.workspace.on("active-leaf-change",r),t.workspace.on("layout-change",o),()=>{i.forEach(s=>{s.hasChangesTimeout&&clearTimeout(s.hasChangesTimeout)}),t.workspace.off("active-leaf-change",r),t.workspace.off("layout-change",o),i.clear(),a.clear(),n=null}}var U=require("obsidian");function B(t,e){return t.commands?t.commands.findCommand(e)?(t.commands.executeCommandById(e),!0):(new U.Notice(p("commandNotFound",{label:e})),!1):!1}var L=require("obsidian");async function T(t,e,n,i,a=!1){try{return await e.fileManager.processFrontMatter(t,r=>{let o=r[n];a&&o!==void 0||(typeof o=="boolean"&&new L.Notice(p("failedUpdatingProperty",{label:n})),r[n]=i(o||0))}),!0}catch(r){return new L.Notice(p("failedUpdatingFile",{label:t.path})),!1}}var x=require("obsidian");async function Y(t,e,n,i=0,a=1){if(!(e!=null&&e.vault))return new x.Notice(p("invalidAppInstance")),null;if(!n)return new x.Notice(p("missingPropertyName")),null;let r=null;try{await T(t,e,n,o=>{let s;return typeof o=="string"?s=parseFloat(o)||i:s=o||i,r=s+a,r})}catch(o){return new x.Notice(p("errorIncrementingPropery",{label:n})),null}return r}var u=require("obsidian");function $(t,e=""){return t.replace(/{{[^{}]*}}/g,n=>/^{{\s*date(?::([^}]+))?\s*}}$/.test(n)?n.replace(/{{\s*date(?::([^}]+))?\s*}}/,(i,a)=>{if(!a||a.trim()==="today")return(0,u.moment)().format("YYYY-MM-DD");let r=a.match(/^([+-]\d+)([dMyw])$/);if(r){let o=parseInt(r[1],10),s=r[2];return(0,u.moment)().add(o,s).format("YYYY-MM-DD")}try{return(0,u.moment)().format(a)}catch(o){return new u.Notice(p("invalidDateFormat",{label:a})),n}}):/^{{\s*time(?::([^}]+))?\s*}}$/.test(n)?n.replace(/{{\s*time(?::([^}]+))?\s*}}/,(i,a)=>{if(!a)return(0,u.moment)().format("HH:mm");try{return(0,u.moment)().format(a)}catch(r){return new u.Notice(p("invalidTimeFormat",{label:a})),n}}):/^{{\s*title\s*}}$/.test(n)?e||"":n)}async function j(t,e,n,i,a=!1){var c;if(!(e!=null&&e.vault)||!n||!i)return!1;let r=i.match(/^{{\s*increment(?::([^}]+))?\s*}}$/);if(r){let l=(c=r[1])==null?void 0:c.split(","),m=l&&l[0]?Number(l[0]):0,W=l&&l[1]?Number(l[1]):1;try{return await Y(t,e,n,m,W),!0}catch(f){return!1}}let o=t.basename||"",s=$(i,o);try{return await T(t,e,n,()=>s,a),!0}catch(l){return!1}}var z=require("obsidian");function re(t,e,n){var i,a;if(t.startsWith("#")&&!t.includes(" ")){let r=t.slice(1),o=n.metadataCache.getFileCache(e),s=((i=o==null?void 0:o.tags)==null?void 0:i.map(m=>m.tag.slice(1)))||[],c=((a=o==null?void 0:o.frontmatter)==null?void 0:a.tags)||[];return[...s,...Array.isArray(c)?c:[c]].includes(r)}return!1}function oe(t,e){if(t.endsWith("/")){let n=e.path.toLowerCase(),i=t.toLowerCase();return n.startsWith(i)}return!1}function ae(t,e){return e.basename.toLowerCase()===t.toLowerCase()}function k(t,e,n){let i=t.trim(),a=i.startsWith("!"),r=a?i.slice(1):i,o=re(r,e,n)||oe(r,e)||ae(r,e);return a?!o:o}function G(t,e,n){if(!t||t.trim()==="")return!0;try{if(t.startsWith("/")&&t.endsWith("/"))return new RegExp(t.slice(1,-1)).test(e.path);if(t.includes(",")){let i=t.split(",");return i.some(r=>r.trim().startsWith("!"))?i.every(r=>k(r,e,n)):i.some(r=>k(r,e,n))}return k(t,e,n)}catch(i){return new z.Notice(p("invalidWhere",{label:t})),!1}}function _(t,e){H(t,async(n,i)=>{let a=e.actions.filter(r=>r.when===i);for(let r of a)if(G(r.where,n,t)){if(r.what==="property"&&r.propertyName&&r.propertyValue)try{await j(n,t,r.propertyName,r.propertyValue,r.skipExisting||!1)}catch(o){new E.Notice(p("failedUpdatingProperty",{label:r.propertyName}))}else if(r.what==="command"&&r.commandId)try{B(t,r.commandId)}catch(o){new E.Notice(p("failedExecutingCommand",{label:r.commandId}))}}})}var C=class extends Q.Plugin{async onload(){this.settings=Object.assign({},S),await this.loadData().then(e=>{e&&(this.settings=Object.assign({},S,e))}),this.addSettingTab(new v(this.app,this)),_(this.app,this.settings)}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */